n USB connection,3:Discard log on reboot if never armed
    // @User: Standard
    AP_GROUPINFO("_DISARMED",  2, AP_Logger, _params.log_disarmed,       0),

    // @Param: _REPLAY
    // @DisplayName: Enable logging of information needed for Replay
    // @Description: If LOG_REPLAY is set to 1 then the EKF2 and EKF3 state estimators will log detailed information needed for diagnosing problems with the Kalman filter. LOG_DISARMED must be set to 1 or 2 or else the log will not contain the pre-flight data required for replay testing of the EKF's. It is suggested that you also raise LOG_FILE_BUFSIZE to give more buffer space for logging and use a high quality microSD card to ensure no sensor data is lost.
    // @Values: 0:Disabled,1:Enabled
    // @User: Standard
    AP_GROUPINFO("_REPLAY",  3, AP_Logger, _params.log_replay,       0),

    // @Param: _FILE_DSRMROT
    // @DisplayName: Stop logging to current file on disarm
    // @Description: When set, the current log file is closed when the vehicle is disarmed.  If LOG_DISARMED is set then a fresh log will be opened. Applies to the File and Block logging backends.
    // @Values: 0:Disabled,1:Enabled
    // @User: Standard
    AP_GROUPINFO("_FILE_DSRMROT",  4, AP_Logger, _params.file_disarm_rot,       0),

#if HAL_LOGGING_MAVLINK_ENABLED
    // @Param: _MAV_BUFSIZE
    // @DisplayName: Maximum AP_Logger MAVLink Backend buffer size
    // @Description: Maximum amount of memory to allocate to AP_Logger-over-mavlink
    // @User: Advanced
    // @Units: kB
    AP_GROUPINFO("_MAV_BUFSIZE",  5, AP_Logger, _params.mav_bufsize,       HAL_LOGGING_MAV_BUFSIZE),
#endif

    // @Param: _FILE_TIMEOUT
    // @DisplayName: Timeout before giving up on file writes
    // @Description: This controls the amount of time before failing writes to a log file cause the file to be closed and logging stopped.
    // @User: Standard
    // @Units: s
    AP_GROUPINFO("_FILE_TIMEOUT",  6, AP_Logger, _params.file_timeout,     HAL_LOGGING_FILE_TIMEOUT),

    // @Param: _FILE_MB_FREE
    // @DisplayName: Old logs on the SD card will be deleted to maintain this amount of free space
    // @Description: Set this such that the free space is larger than your largest typical flight log
    // @Units: MB
    // @Range: 10 1000
    // @User: Standard
    AP_GROUPINFO("_FILE_MB_FREE",  7, AP_Logger, _params.min_MB_free, 500),

    // @Param: _FILE_RATEMAX
    // @DisplayName: Maximum logging rate for file backend
    // @Description: This sets the maximum rate that streaming log messages will be logged to the file backend. A value of zero means that rate limiting is disabled.
    // @Units: Hz
    // @Range: 0 1000
    // @Increment: 0.1
    // @User: Standard
    AP_GROUPINFO("_FILE_RATEMAX",  8, AP_Logger, _params.file_ratemax, 0),

#if HAL_LOGGING_MAVLINK_ENABLED
    // @Param: _MAV_RATEMAX
    // @DisplayName: Maximum logging rate for mavlink backend
    // @Description: This sets the maximum rate that streaming log messages will be logged to the mavlink backend. A value of zero means that rate limiting is disabled.
    // @Units: Hz
    // @Range: 0 1000
    // @Increment: 0.1
    // @User: Standard
    AP_GROUPINFO("_MAV_RATEMAX",  9, AP_Logger, _params.mav_ratemax, 0),
#endif

#if HAL_LOGGING_BLOCK_ENABLED
    // @Param: _BLK_RATEMAX
    // @DisplayName: Maximum logging rate for block backend
    // @Description: This sets the maximum rate that streaming log messages will be logged to the block backend. A value of zero means that rate limiting is disabled.
    // @Units: Hz
    // @Range: 0 1000
    // @Increment: 0.1
    // @User: Standard
    AP_GROUPINFO("_BLK_RATEMAX", 10, AP_Logger, _params.blk_ratemax, 0),
#endif

    // @Param: _DARM_RATEMAX
    // @DisplayName: Maximum logging rate when disarmed
    // @Description: This sets the maximum rate that streaming log messages will be logged to any backend when disarmed. A value of zero means that the normal backend rate limit is applied.
    // @Units: Hz
    // @Range: 0 1000
    // @Increment: 0.1
    // @User: Standard
    AP_GROUPINFO("_DARM_RATEMAX",  11, AP_Logger, _params.disarm_ratemax, 0),

    // @Param: _MAX_FILES
    // @DisplayName: Maximum number of log files
    // @Description: This sets the maximum number of log file that will be written on dataflash or sd card before starting to rotate log number. Limit is capped at 500 logs.
    // @Range: 2 500
    // @Increment: 1
    // @User: Advanced
    // @RebootRequired: True
    AP_GROUPINFO("_MAX_FILES", 12, AP_Logger, _params.max_log_files, MAX_LOG_FILES),

    AP_GROUPEND
};

#define streq(x, y) (!strcmp(x, y))

AP_Logger::AP_Logger()
{
    AP_Param::setup_object_defaults(this, var_info);
    if (_singleton != nullptr) {
        AP_HAL::panic("AP_Logger must be singleton");
    }

    _singleton = this;
}

void AP_Logger::init(const AP_Int32 &log_bitmask, const struct LogStructure *structures, uint8_t num_types)
{
    _log_bitmask = &log_bitmask;

    // convert from 8 bit to 16 bit LOG_FILE_BUFSIZE
    _params.file_bufsize.convert_parameter_width(AP_PARAM_INT8);

    if (hal.util->was_watchdog_armed()) {
        GCS_SEND_TEXT(MAV_SEVERITY_INFO, "Forcing logging for watchdog reset");
        _params.log_disarmed.set(LogDisarmed::LOG_WHILE_DISARMED);
    }
#if CONFIG_HAL_BOARD == HAL_BOARD_SITL
    validate_structures(structures, num_types);
    dump_structures(structures, num_types);
#endif
    _num_types = num_types;
    _structures = structures;

    // the "main" logging type needs to come before mavlink so that
    // index 0 is correct
    static const struct {
        Backend_Type type;
        AP_Logger_Backend* (*probe_fn)(AP_Logger&, LoggerMessageWriter_DFLogStart*);
    } backend_configs[] {
#if HAL_LOGGING_FILESYSTEM_ENABLED
        { Backend_Type::FILESYSTEM, AP_Logger_File::probe },
#endif
#if HAL_LOGGING_DATAFLASH_ENABLED
        { Backend_Type::BLOCK, HAL_LOGGING_DATAFLASH_DRIVER::probe },
#endif
#if HAL_LOGGING_MAVLINK_ENABLED
        { Backend_Type::MAVLINK, AP_Logger_MAVLink::probe },
#endif
};

    for (const auto &backend_config : backend_configs) {
        if ((_params.backend_types & uint8_t(backend_config.type)) == 0) {
            continue;
        }
        if (_next_backend == LOGGER_MAX_BACKENDS) {
            AP_BoardConfig::config_error("Too many backends");
            return;
        }
        LoggerMessageWriter_DFLogStart *message_writer =
            NEW_NOTHROW LoggerMessageWriter_DFLogStart();
        if (message_writer == nullptr)  {
            AP_BoardConfig::allocation_error("message writer");
        }
        backends[_next_backend] = backend_config.probe_fn(*this, message_writer);
        if (backends[_next_backend] == nullptr) {
            AP_BoardConfig::allocation_error("logger backend");
        }
        _next_backend++;
    }

    for (uint8_t i=0; i<_next_backend; i++) {
        backends[i]->Init();
    }

    start_io_thread();

    EnableWrites(true);
}

#if CONFIG_HAL_BOARD == HAL_BOARD_SITL
#include <stdio.h>

#define DEBUG_LOG_STRUCTURES 0

extern const AP_HAL::HAL& hal;
#define Debug(fmt, args ...)  do {::fprintf(stderr, "%s:%d: " fmt "\n", __FUNCTION__, __LINE__, ## args); } while(0)

/// return the number of commas present in string
static uint8_t count_commas(const char *string)
{
    uint8_t ret = 0;
    for (uint8_t i=0; i<strlen(string); i++) {
        if (string[i] == ',') {
            ret++;
        }
    }
    return ret;
}

/// return a unit name given its ID
const char* AP_Logger::unit_name(const uint8_t unit_id)
{
    for (uint8_t i=0; i<_num_units; i++) {
        if (_units[i].ID == unit_id) {
            return _units[i].unit;
        }
    }
    return nullptr;
}

/// return a multiplier value given its ID
double AP_Logger::multiplier_name(const uint8_t multiplier_id)
{
    for (uint8_t i=0; i<_num_multipliers; i++) {
        if (_multipliers[i].ID == multiplier_id) {
            return _multipliers[i].multiplier;
        }
    }
    // Should we abort here?
    return 1.0f;
}

/// pretty-print field information from a log structure
void AP_Logger::dump_structure_field(const struct LogStructure *logstructure, const char *label, const uint8_t fieldnum)
{
    ::fprintf(stderr, "  %s (%s)*(%f)\n", label, unit_name(logstructure->units[fieldnum]), multiplier_name(logstructure->multipliers[fieldnum]));
}

/// pretty-print log structures
/// @note structures MUST be well-formed
void AP_Logger::dump_structures(const struct LogStructure *logstructures, const uint8_t num_types)
{
#if DEBUG_LOG_STRUCTURES
    for (uint16_t i=0; i<num_types; i++) {
        const struct LogStructure *logstructure = &logstructures[i];
        ::fprintf(stderr, "%s\n", logstructure->name);
        char label[32] = { };
        uint8_t labeloffset = 0;
        int8_t fieldnum = 0;
        for (uint8_t j=0; j<strlen(logstructure->labels); j++) {
            char labelchar = logstructure->labels[j];
            if (labelchar == '\0') {
                break;
            }
            if (labelchar == ',') {
                dump_structure_field(logstructure, label, fieldnum);
                fieldnum++;
                labeloffset = 0;
                memset(label, '\0', 32);
            } else {
                label[labeloffset++] = labelchar;
            }
        }
        dump_structure_field(logstructure, label, fieldnum);
        ::fprintf(stderr, "\n"); // just add a CR to the output
    }
#endif
}

bool AP_Logger::labels_string_is_good(const char *labels) const
{
    bool passed = true;
    if (strlen(labels) >= LS_LABELS_SIZE) {
        Debug("Labels string too long (%u > %u)", unsigned(strlen(labels)), unsigned(LS_LABELS_SIZE));
        passed = false;
    }
    // This goes through and slices labels up into substrings by
    // changing commas to nulls - keeping references to each string in
    // label_offsets.
    char *label_offsets[LS_LABELS_SIZE];
    uint8_t label_offsets_offset = 0;
    char labels_copy[LS_LABELS_SIZE+1] {};
    strncpy(labels_copy, labels, LS_LABELS_SIZE);
    if (labels_copy[0] == ',') {
        Debug("Leading comma in (%s)", labels);
        passed = false;
    }
    label_offsets[label_offsets_offset++] = labels_copy;
    const uint8_t len = strnlen(labels_copy, LS_LABELS_SIZE);
    for (uint8_t i=0; i<len; i++) {
        if (labels_copy[i] == ',') {
            if (labels_copy[i+1] == '\0') {
                Debug("Trailing comma in (%s)", labels);
                passed = false;
                continue;
            }
            labels_copy[i] = '\0';
            label_offsets[label_offsets_offset++] = &labels_copy[i+1];
        }
    }
    for (uint8_t i=0; i<label_offsets_offset-1; i++) {
        for (uint8_t j=i+1; j<label_offsets_offset; j++) {
            if (!strcmp(label_offsets[i], label_offsets[j])) {
                Debug("Duplicate label (%s) in (%s)", label_offsets[i], labels);
                passed = false;
            }
        }
    }
    return passed;
}

bool AP_Logger::validate_structure(const struct LogStructure *logstructure, const int16_t offset)
{
    bool passed = true;

#if DEBUG_LOG_STRUCTURES
    Debug("offset=%d ID=%d NAME=%s", offset, logstructure->msg_type, logstructure->name);
#endif

    // fields must be null-terminated
#define CHECK_ENTRY(fieldname,fieldname_s,fieldlen)                     \
    do {                                                                \
        if (strnlen(logstructure->fieldname, fieldlen) > fieldlen-1) {  \
            Debug("  Message %s." fieldname_s " not NULL-terminated or too long", logstructure->name); \
            passed = false;                                             \
        }                                                               \
    } while (false)
    CHECK_ENTRY(name, "name", LS_NAME_SIZE);
    CHECK_ENTRY(format, "format", LS_FORMAT_SIZE);
    CHECK_ENTRY(labels, "labels", LS_LABELS_SIZE);
    CHECK_ENTRY(units, "units", LS_UNITS_SIZE);
    CHECK_ENTRY(multipliers, "multipliers", LS_MULTIPLIERS_SIZE);
#undef CHECK_ENTRY

    // ensure each message ID is only used once
    if (seen_ids[logstructure->msg_type]) {
        Debug("  ID %d used twice (LogStructure offset=%d)", logstructure->msg_type, offset);
        passed = false;
    }
    seen_ids[l/*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include <AP_HAL/AP_HAL.h>
#include <AP_Math/AP_Math.h>
#include "AP_MotorsSingle.h"
#include <GCS_MAVLink/GCS.h>
#include <SRV_Channel/SRV_Channel.h>

extern const AP_HAL::HAL& hal;

// init
void AP_MotorsSingle::init(motor_frame_class frame_class, motor_frame_type frame_type)
{
    // make sure 6 output channels are mapped
    for (uint8_t i = 0; i < 6; i++) {
        add_motor_num(CH_1 + i);
    }

    // set the motor_enabled flag so that the main ESC can be calibrated like other frame types
    motor_enabled[AP_MOTORS_MOT_5] = true;
    motor_enabled[AP_MOTORS_MOT_6] = true;

    // setup actuator scaling
    for (uint8_t i = 0; i < NUM_ACTUATORS; i++) {
        SRV_Channels::set_angle(SRV_Channels::get_motor_function(i), AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
    }

    _mav_type = MAV_TYPE_COAXIAL;

    // record successful initialisation if what we setup was the desired frame_class
    set_initialised_ok(frame_class == MOTOR_FRAME_SINGLE);
}

// set frame class (i.e. quad, hexa, heli) and type (i.e. x, plus)
void AP_MotorsSingle::set_frame_class_and_type(motor_frame_class frame_class, motor_frame_type frame_type)
{
    // nothing to do
}

// set update rate to motors - a value in hertz
void AP_MotorsSingle::set_update_rate(uint16_t speed_hz)
{
    // record requested speed
    _speed_hz = speed_hz;

    uint32_t mask =
        1U << AP_MOTORS_MOT_5 |
        1U << AP_MOTORS_MOT_6 ;
    rc_set_freq(mask, _speed_hz);
}

void AP_MotorsSingle::output_to_motors()
{
    if (!initialised_ok()) {
        return;
    }
    switch (_spool_state) {
        case SpoolState::SHUT_DOWN:
            // sends minimum values out to the motors
            rc_write_angle(AP_MOTORS_MOT_1, _roll_radio_passthrough * AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
            rc_write_angle(AP_MOTORS_MOT_2, _pitch_radio_passthrough * AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
            rc_write_angle(AP_MOTORS_MOT_3, -_roll_radio_passthrough * AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
            rc_write_angle(AP_MOTORS_MOT_4, -_pitch_radio_passthrough * AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
            rc_write(AP_MOTORS_MOT_5, output_to_pwm(0));
            rc_write(AP_MOTORS_MOT_6, output_to_pwm(0));
            break;
        case SpoolState::GROUND_IDLE:
            // sends output to motors when armed but not flying
            for (uint8_t i = 0; i < NUM_ACTUATORS; i++) {
                rc_write_angle(AP_MOTORS_MOT_1 + i, _spin_up_ratio * _actuator_out[i] * AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
            }
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_5], actuator_spin_up_to_ground_idle());
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_6], actuator_spin_up_to_ground_idle());
            rc_write(AP_MOTORS_MOT_5, output_to_pwm(_actuator[AP_MOTORS_MOT_5]));
            rc_write(AP_MOTORS_MOT_6, output_to_pwm(_actuator[AP_MOTORS_MOT_6]));
            break;
        case SpoolState::SPOOLING_UP:
        case SpoolState::THROTTLE_UNLIMITED:
        case SpoolState::SPOOLING_DOWN:
            // set motor output based on thrust requests
            for (uint8_t i = 0; i < NUM_ACTUATORS; i++) {
                rc_write_angle(AP_MOTORS_MOT_1 + i, _actuator_out[i] * AP_MOTORS_SINGLE_SERVO_INPUT_RANGE);
            }
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_5], thr_lin.thrust_to_actuator(_thrust_out));
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_6], thr_lin.thrust_to_actuator(_thrust_out));
            rc_write(AP_MOTORS_MOT_5, output_to_pwm(_actuator[AP_MOTORS_MOT_5]));
            rc_write(AP_MOTORS_MOT_6, output_to_pwm(_actuator[AP_MOTORS_MOT_6]));
            break;
    }
}

// get_motor_mask - returns a bitmask of which outputs are being used for motors or servos (1 means being used)
//  this can be used to ensure other pwm outputs (i.e. for servos) do not conflict
uint32_t AP_MotorsSingle::get_motor_mask()
{
    uint32_t motor_mask =
        1U << AP_MOTORS_MOT_5 |
        1U << AP_MOTORS_MOT_6;

    uint32_t mask = motor_mask_to_srv_channel_mask(motor_mask);

    // add parent's mask
    mask |= AP_MotorsMulticopter::get_motor_mask();

    return mask;
}

// sends commands to the motors
void AP_MotorsSingle::output_armed_stabilizing()
{
    float   roll_thrust;                // roll thrust input value, +/- 1.0
    float   pitch_thrust;               // pitch thrust input value, +/- 1.0
    float   yaw_thrust;                 // yaw thrust input value, +/- 1.0
    float   throttle_thrust;            // throttle thrust input value, 0.0 - 1.0
    float   throttle_avg_max;           // throttle thrust average maximum value, 0.0 - 1.0
    float   thrust_min_rpy;             // the minimum throttle setting that will not limit the roll and pitch output
    float   thr_adj;                    // the difference between the pilot's desired throttle and throttle_thrust_best_rpy
    float   rp_scale = 1.0f;            // this is used to scale the roll, pitch and yaw to fit within the motor limits
    float   actuator_allowed = 0.0f;    // amount of yaw we can fit in
    float   actuator[NUM_ACTUATORS];    // combined roll, pitch and yaw thrusts for each actuator
    float   actuator_max = 0.0f;        // maximum actuator value

    // apply voltage and air pressure compensation
    const float compensation_gain = thr_lin.get_compensation_gain();
    roll_thrust = (_roll_in + _roll_in_ff) * compensation_gain;
    pitch_thrust = (_pitch_in + _pitch_in_ff) * compensation_gain;
    yaw_thrust = (_yaw_in + _yaw_in_ff) * compensation_gain;
    throttle_thrust = get_throttle() * compensation_gain;
    throttle_avg_max = _throttle_avg_max * compensation_gain;

    // sanity check throttle is above zero and below current limited throttle
    if (throttle_thrust <= 0.0f) {
        throttle_thrust = 0.0f;
        limit.throttle_lower = true;
    }
    if (throttle_thrust >= _throttle_thrust_max) {
        throttle_thrust = _throttle_thrust_max;
        limit.throttle_upper = true;
    }

    throttle_avg_max = constrain_float(throttle_avg_max, throttle_thrust, _throttle_thrust_max);

    float rp_thrust_max = MAX(fabsf(roll_thrust), fabsf(pitch_thrust));

    // calculate how much roll and pitch must be scaled to leave enough range for the minimum yaw
    if (is_zero(rp_thrust_max)) {
        rp_scale = 1.0f;
    } else {
        rp_scale = constrain_float((1.0f - MIN(fabsf(yaw_thrust), (float) _yaw_headroom * 0.001f)) / rp_thrust_max, 0.0f, 1.0f);
        if (rp_scale < 1.0f) {
            limit.roll = true;
            limit.pitch = true;
        }
    }

    actuator_allowed = 1.0f - rp_scale * rp_thrust_max;
    if (fabsf(yaw_thrust) > actuator_allowed) {
        yaw_thrust = constrain_float(yaw_thrust, -actuator_allowed, actuator_allowed);
        limit.yaw = true;
    }

    // combine roll, pitch and yaw on each actuator
    // front servo
    actuator[0] = rp_scale * roll_thrust - yaw_thrust;
    // right servo
    actuator[1] = rp_scale * pitch_thrust - yaw_thrust;
    // rear servo
    actuator[2] = -rp_scale * roll_thrust - yaw_thrust;
    // left servo
    actuator[3] = -rp_scale * pitch_thrust - yaw_thrust;

    // calculate the minimum thrust that doesn't limit the roll, pitch and yaw forces
    thrust_min_rpy = MAX(MAX(fabsf(actuator[0]), fabsf(actuator[1])), MAX(fabsf(actuator[2]), fabsf(actuator[3])));

    thr_adj = throttle_thrust - throttle_avg_max;
    if (thr_adj < (thrust_min_rpy - throttle_avg_max)) {
        // Throttle can't be reduced to the desired level because this would mean roll or pitch control
        // would not be able to reach the desired level because of lack of thrust.
        thr_adj = MIN(thrust_min_rpy, throttle_avg_max) - throttle_avg_max;
    }

    // calculate the throttle setting for the lift fan
    _thrust_out = throttle_avg_max + thr_adj;
    // compensation_gain can never be zero
    _throttle_out = _thrust_out / compensation_gain;

    if (is_zero(_thrust_out)) {
        limit.roll = true;
        limit.pitch = true;
        limit.yaw = true;
    }

    // limit thrust out for calculation of actuator gains
    float thrust_out_actuator = constrain_float(MAX(_throttle_hover * 0.5f, _thrust_out), 0.5f, 1.0f);

    // calculate the maximum allowed actuator output and maximum requested actuator output
    for (uint8_t i = 0; i < NUM_ACTUATORS; i++) {
        if (actuator_max > fabsf(actuator[i])) {
            actuator_max = fabsf(actuator[i]);
        }
    }
    if (actuator_max > thrust_out_actuator && !is_zero(actuator_max)) {
        // roll, pitch and yaw request can not be achieved at full servo defection
        // reduce roll, pitch and yaw to reduce the requested defection to maximum
        limit.roll = true;
        limit.pitch = true;
        limit.yaw = true;
        rp_scale = thrust_out_actuator / actuator_max;
    } else {
        rp_scale = 1.0f;
    }

    // force of a lifting surface is approximately equal to the angle of attack times the airflow velocity squared
    // static thrust is proportional to the airflow velocity squared
    // therefore the torque of the roll and pitch actuators should be approximately proportional to
    // the angle of attack multiplied by the static thrust.
    for (uint8_t i = 0; i < NUM_ACTUATORS; i++) {
        _actuator_out[i] = constrain_float(rp_scale * actuator[i] / thrust_out_actuator, -1.0f, 1.0f);
    }
}

// output_test_seq - spin a motor at the pwm value specified
//  motor_seq is the motor's sequence number from 1 to the number of motors on the frame
//  pwm value is an actual pwm value that will be output, normally in the range of 1000 ~ 2000
void AP_MotorsSingle::_output_test_seq(uint8_t motor_seq, int16_t pwm)
{
    // output to motors and servos
    switch (motor_seq) {
        case 1:
            // flap servo 1
            rc_write(AP_MOTORS_MOT_1, pwm);
            break;
        case 2:
            // flap servo 2
            rc_write(AP_MOTORS_MOT_2, pwm);
            break;
        case 3:
            // flap servo 3
            rc_write(AP_MOTORS_MOT_3, pwm);
            break;
        case 4:
            // flap servo 4
            rc_write(AP_MOTORS_MOT_4, pwm);
            break;
        case 5:
            // spin motor 1
            rc_write(AP_MOTORS_MOT_5, pwm);
            break;
        case 6:
            // spin motor 2
            rc_write(AP_MOTORS_MOT_6, pwm);
            break;
        default:
            // do nothing
            break;
    }
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /// @file	AP_MotorsSingle.h
/// @brief	Motor and Servo control class for Singlecopters
#pragma once

#include <AP_Common/AP_Common.h>
#include <AP_Math/AP_Math.h>        // ArduPilot Mega Vector/Matrix math Library
#include "AP_MotorsMulticopter.h"

// feedback direction
#define AP_MOTORS_SING_POSITIVE      1
#define AP_MOTORS_SING_NEGATIVE     -1

#define NUM_ACTUATORS 4

#define AP_MOTORS_SINGLE_SPEED_DIGITAL_SERVOS 250 // update rate for digital servos
#define AP_MOTORS_SINGLE_SPEED_ANALOG_SERVOS 125  // update rate for analog servos

#define AP_MOTORS_SINGLE_SERVO_INPUT_RANGE      4500    // roll or pitch input of -4500 will cause servos to their minimum (i.e. radio_min), +4500 will move them to their maximum (i.e. radio_max)

/// @class      AP_MotorsSingle
class AP_MotorsSingle : public AP_MotorsMulticopter {
public:

    /// Constructor
    AP_MotorsSingle(uint16_t speed_hz = AP_MOTORS_SPEED_DEFAULT) :
        AP_MotorsMulticopter(speed_hz)
    {
    };

    // init
    void                init(motor_frame_class frame_class, motor_frame_type frame_type) override;

    // set frame class (i.e. quad, hexa, heli) and type (i.e. x, plus)
    void set_frame_class_and_type(motor_frame_class frame_class, motor_frame_type frame_type) override;

    // set update rate to motors - a value in hertz
    void                set_update_rate( uint16_t speed_hz ) override;

    // output_to_motors - sends minimum values out to the motors
    virtual void        output_to_motors() override;

    // get_motor_mask - returns a bitmask of which outputs are being used for motors or servos (1 means being used)
    //  this can be used to ensure other pwm outputs (i.e. for servos) do not conflict
    uint32_t            get_motor_mask() override;

    // Run arming checks
    bool arming_checks(size_t buflen, char *buffer) const override { return AP_Motors::arming_checks(buflen, buffer); }

protected:
    // output - sends commands to the motors
    void                output_armed_stabilizing() override;

    const char* _get_frame_string() const override { return "SINGLE"; }

    // output_test_seq - spin a motor at the pwm value specified
    //  motor_seq is the motor's sequence number from 1 to the number of motors on the frame
    //  pwm value is an actual pwm value that will be output, normally in the range of 1000 ~ 2000
    virtual void        _output_test_seq(uint8_t motor_seq, int16_t pwm) override;

    int16_t             _throttle_radio_output;   // total throttle pwm value, summed onto throttle channel minimum, typically ~1100-1900
    float               _actuator_out[NUM_ACTUATORS]; // combined roll, pitch, yaw and throttle outputs to motors in 0~1 range
    float               _thrust_out;
};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

/*
 *       AP_MotorsTailsitter.cpp - ArduCopter motors library for tailsitters and bicopters
 *
 */

#include <AP_HAL/AP_HAL.h>
#include <AP_Math/AP_Math.h>
#include "AP_MotorsTailsitter.h"
#include <GCS_MAVLink/GCS.h>
#include <SRV_Channel/SRV_Channel.h>

extern const AP_HAL::HAL& hal;

#define SERVO_OUTPUT_RANGE  4500

// init
void AP_MotorsTailsitter::init(motor_frame_class frame_class, motor_frame_type frame_type)
{
    // setup default motor and servo mappings
    _has_diff_thrust = SRV_Channels::function_assigned(SRV_Channel::k_throttleRight) || SRV_Channels::function_assigned(SRV_Channel::k_throttleLeft);

    // right throttle defaults to servo output 1
    SRV_Channels::set_aux_channel_default(SRV_Channel::k_throttleRight, CH_1);

    // left throttle defaults to servo output 2
    SRV_Channels::set_aux_channel_default(SRV_Channel::k_throttleLeft, CH_2);

    // right servo defaults to servo output 3
    SRV_Channels::set_aux_channel_default(SRV_Channel::k_tiltMotorRight, CH_3);
    SRV_Channels::set_angle(SRV_Channel::k_tiltMotorRight, SERVO_OUTPUT_RANGE);

    // left servo defaults to servo output 4
    SRV_Channels::set_aux_channel_default(SRV_Channel::k_tiltMotorLeft, CH_4);
    SRV_Channels::set_angle(SRV_Channel::k_tiltMotorLeft, SERVO_OUTPUT_RANGE);

    _mav_type = MAV_TYPE_VTOL_DUOROTOR;

    // record successful initialisation if what we setup was the desired frame_class
    set_initialised_ok(frame_class == MOTOR_FRAME_TAILSITTER);
}


/// Constructor
AP_MotorsTailsitter::AP_MotorsTailsitter(uint16_t speed_hz) :
    AP_MotorsMulticopter(speed_hz)
{
    set_update_rate(speed_hz);
}


// set update rate to motors - a value in hertz
void AP_MotorsTailsitter::set_update_rate(uint16_t speed_hz)
{
    // record requested speed
    _speed_hz = speed_hz;

    SRV_Channels::set_rc_frequency(SRV_Channel::k_throttleLeft, speed_hz);
    SRV_Channels::set_rc_frequency(SRV_Channel::k_throttleRight, speed_hz);
}

void AP_MotorsTailsitter::output_to_motors()
{
    if (!initialised_ok()) {
        return;
    }

    switch (_spool_state) {
        case SpoolState::SHUT_DOWN:
            _actuator[0] = 0.0f;
            _actuator[1] = 0.0f;
            _actuator[2] = 0.0f;
            _external_min_throttle = 0.0;
            break;
        case SpoolState::GROUND_IDLE:
            set_actuator_with_slew(_actuator[0], actuator_spin_up_to_ground_idle());
            set_actuator_with_slew(_actuator[1], actuator_spin_up_to_ground_idle());
            set_actuator_with_slew(_actuator[2], actuator_spin_up_to_ground_idle());
            _external_min_throttle = 0.0;
            break;
        case SpoolState::SPOOLING_UP:
        case SpoolState::THROTTLE_UNLIMITED:
        case SpoolState::SPOOLING_DOWN:
            set_actuator_with_slew(_actuator[0], thr_lin.thrust_to_actuator(_thrust_left));
            set_actuator_with_slew(_actuator[1], thr_lin.thrust_to_actuator(_thrust_right));
            set_actuator_with_slew(_actuator[2], thr_lin.thrust_to_actuator(_throttle));
            break;
    }

    SRV_Channels::set_output_pwm(SRV_Channel::k_throttleLeft, output_to_pwm(_actuator[0]));
    SRV_Channels::set_output_pwm(SRV_Channel::k_throttleRight, output_to_pwm(_actuator[1]));

    // use set scaled to allow a different PWM range on plane forward throttle, throttle range is 0 to 100
    SRV_Channels::set_output_scaled(SRV_Channel::k_throttle, _actuator[2]*100);

    SRV_Channels::set_output_scaled(SRV_Channel::k_tiltMotorLeft, _tilt_left*SERVO_OUTPUT_RANGE);
    SRV_Channels::set_output_scaled(SRV_Channel::k_tiltMotorRight, _tilt_right*SERVO_OUTPUT_RANGE);

}

// get_motor_mask - returns a bitmask of which outputs are being used for motors (1 means being used)
//  this can be used to ensure other pwm outputs (i.e. for servos) do not conflict
uint32_t AP_MotorsTailsitter::get_motor_mask()
{
    uint32_t motor_mask = 0;
    uint8_t chan;
    if (SRV_Channels::find_channel(SRV_Channel::k_throttleLeft, chan)) {
        motor_mask |= 1U << chan;
    }
    if (SRV_Channels::find_channel(SRV_Channel::k_throttleRight, chan)) {
        motor_mask |= 1U << chan;
    }

    // add parent's mask
    motor_mask |= AP_MotorsMulticopter::get_motor_mask();

    return motor_mask;
}

// calculate outputs to the motors
void AP_MotorsTailsitter::output_armed_stabilizing()
{
    float   roll_thrust;                // roll thrust input value, +/- 1.0
    float   pitch_thrust;               // pitch thrust input value, +/- 1.0
    float   yaw_thrust;                 // yaw thrust input value, +/- 1.0
    float   throttle_thrust;            // throttle thrust input value, 0.0 - 1.0
    float   thrust_max;                 // highest motor value
    float   thrust_min;                 // lowest motor value
    float   thr_adj = 0.0f;             // the difference between the pilot's desired throttle and throttle_thrust_best_rpy

    // apply voltage and air pressure compensation
    const float compensation_gain = thr_lin.get_compensation_gain();
    roll_thrust = (_roll_in + _roll_in_ff) * compensation_gain;
    pitch_thrust = _pitch_in + _pitch_in_ff;
    yaw_thrust = _yaw_in + _yaw_in_ff;
    throttle_thrust = get_throttle() * compensation_gain;
    const float max_boost_throttle = _throttle_avg_max * compensation_gain;

    // never boost above max, derived from throttle mix params
    const float min_throttle_out = MIN(_external_min_throttle, max_boost_throttle);
    const float max_throttle_out = _throttle_thrust_max * compensation_gain;

    // sanity check throttle is above min and below current limited throttle
    if (throttle_thrust <= min_throttle_out) {
        throttle_thrust = min_throttle_out;
        limit.throttle_lower = true;
    }
    if (throttle_thrust >= max_throttle_out) {
        throttle_thrust = max_throttle_out;
        limit.throttle_upper = true;
    }

    if (roll_thrust >= 1.0) {
        // cannot split motor outputs by more than 1
        roll_thrust = 1;
        limit.roll = true;
    }

    // calculate left and right throttle outputs
    _thrust_left  = throttle_thrust + roll_thrust * 0.5f;
    _thrust_right = throttle_thrust - roll_thrust * 0.5f;

    thrust_max = MAX(_thrust_right,_thrust_left);
    thrust_min = MIN(_thrust_right,_thrust_left);
    if (thrust_max > 1.0f) {
        // if max thrust is more than one reduce average throttle
        thr_adj = 1.0f - thrust_max;
        limit.throttle_upper = true;
    } else if (thrust_min < 0.0) {
        // if min thrust is less than 0 increase average throttle
        // but never above max boost
        thr_adj = -thrust_min;
        if ((throttle_thrust + thr_adj) > max_boost_throttle) {
            thr_adj = MAX(max_boost_throttle - throttle_thrust, 0.0);
            // in this case we throw away some roll output, it will be uneven
            // constraining the lower motor more than the upper
            // this unbalances torque, but motor torque should have significantly less control power than tilts / control surfaces
            // so its worth keeping the higher roll control power at a minor cost to yaw
            limit.roll = true;
        }
        limit.throttle_lower = true;
    }

    // Add adjustment to reduce average throttle
    _thrust_left  = constrain_float(_thrust_left  + thr_adj, 0.0f, 1.0f);
    _thrust_right = constrain_float(_thrust_right + thr_adj, 0.0f, 1.0f);

    _throttle = throttle_thrust;

    // compensation_gain can never be zero
    // ensure accurate representation of average throttle output, this value is used for notch tracking and control surface scaling
    if (_has_diff_thrust) {
        _throttle_out = (throttle_thrust + thr_adj) / compensation_gain;
    } else {
        _throttle_out = throttle_thrust / compensation_gain;
    }

    // thrust vectoring
    _tilt_left  = pitch_thrust - yaw_thrust;
    _tilt_right = pitch_thrust + yaw_thrust;
}

// output_test_seq - spin a motor at the pwm value specified
//  motor_seq is the motor's sequence number from 1 to the number of motors on the frame
//  pwm value is an actual pwm value that will be output, normally in the range of 1000 ~ 2000
void AP_MotorsTailsitter::_output_test_seq(uint8_t motor_seq, int16_t pwm)
{
    // output to motors and servos
    switch (motor_seq) {
        case 1:
            // right throttle
            SRV_Channels::set_output_pwm(SRV_Channel::k_throttleRight, pwm);
            break;
        case 2:
            // right tilt servo
            SRV_Channels::set_output_pwm(SRV_Channel::k_tiltMotorRight, pwm);
            break;
        case 3:
            // left throttle
            SRV_Channels::set_output_pwm(SRV_Channel::k_throttleLeft, pwm);
            break;
        case 4:
            // left tilt servo
            SRV_Channels::set_output_pwm(SRV_Channel::k_tiltMotorLeft, pwm);
            break;
        default:
            // do nothing
            break;
    }
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      /// @file	AP_MotorsTailsitter.h
/// @brief	Motor control class for tailsitters and bicopters
#pragma once

#include <AP_Common/AP_Common.h>
#include <AP_Math/AP_Math.h>
#include "AP_MotorsMulticopter.h"

/// @class      AP_MotorsTailsitter
class AP_MotorsTailsitter : public AP_MotorsMulticopter {
public:

    /// Constructor
    AP_MotorsTailsitter(uint16_t speed_hz = AP_MOTORS_SPEED_DEFAULT);

    // init
    void init(motor_frame_class frame_class, motor_frame_type frame_type) override;

    // set frame class (i.e. quad, hexa, heli) and type (i.e. x, plus)
    void set_frame_class_and_type(motor_frame_class frame_class, motor_frame_type frame_type) override {}

    // set update rate to motors - a value in hertz
    void set_update_rate( uint16_t speed_hz ) override;

    // output_to_motors - sends output to named servos
    void output_to_motors() override;

    // get_motor_mask - returns a bitmask of which outputs are being used for motors or servos (1 means being used)
    //  this can be used to ensure other pwm outputs (i.e. for servos) do not conflict
    uint32_t get_motor_mask() override;

    // Set by tailsitters using diskloading minumum outflow velocity limit
    void set_min_throttle(float val) {_external_min_throttle = val;}

protected:
    // calculate motor outputs
    void output_armed_stabilizing() override;

    const char* _get_frame_string() const override { return "TAILSITTER"; }

    // spin a motor at the pwm value specified
    void _output_test_seq(uint8_t motor_seq, int16_t pwm) override;

    // calculated outputs
    float _throttle; // 0..1
    float _tilt_left;  // -1..1
    float _tilt_right;  // -1..1
    float _thrust_left;  // 0..1
    float _thrust_right;  // 0..1

    // Set by tailsitters using diskloading minumum outflow velocity limit
    float _external_min_throttle;

    // true if differential thrust is available
    bool _has_diff_thrust;

};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include <AP_HAL/AP_HAL.h>
#include <AP_Vehicle/AP_Vehicle_Type.h>

#include <AP_Math/AP_Math.h>
#include <GCS_MAVLink/GCS.h>
#include <SRV_Channel/SRV_Channel.h>

#include "AP_MotorsTri.h"

extern const AP_HAL::HAL& hal;

// init
void AP_MotorsTri::init(motor_frame_class frame_class, motor_frame_type frame_type)
{
    add_motor_num(AP_MOTORS_MOT_1);
    add_motor_num(AP_MOTORS_MOT_2);
    add_motor_num(AP_MOTORS_MOT_4);

    // set update rate for the 3 motors (but not the servo on channel 7)
    set_update_rate(_speed_hz);

    // set the motor_enabled flag so that the ESCs can be calibrated like other frame types
    motor_enabled[AP_MOTORS_MOT_1] = true;
    motor_enabled[AP_MOTORS_MOT_2] = true;
    motor_enabled[AP_MOTORS_MOT_4] = true;

    // allow mapping of motor7
    add_motor_num(AP_MOTORS_CH_TRI_YAW);

    // Check for tail servo
    _have_tail_servo = SRV_Channels::function_assigned(SRV_Channel::k_motor7);

    SRV_Channels::set_angle(SRV_Channels::get_motor_function(AP_MOTORS_CH_TRI_YAW), _yaw_servo_angle_max_deg*100);

    // check for reverse tricopter
    _pitch_reversed = frame_type == MOTOR_FRAME_TYPE_PLUSREV;

    _mav_type = MAV_TYPE_TRICOPTER;

    // record successful initialisation if what we setup was the desired frame_class
    set_initialised_ok(frame_class == MOTOR_FRAME_TRI);
}

// set frame class (i.e. quad, hexa, heli) and type (i.e. x, plus)
void AP_MotorsTri::set_frame_class_and_type(motor_frame_class frame_class, motor_frame_type frame_type)
{
    // check for reverse tricopter
    _pitch_reversed = frame_type == MOTOR_FRAME_TYPE_PLUSREV;

    set_initialised_ok((frame_class == MOTOR_FRAME_TRI) && SRV_Channels::function_assigned(SRV_Channel::k_motor7));
}

// set update rate to motors - a value in hertz
void AP_MotorsTri::set_update_rate(uint16_t speed_hz)
{
    // record requested speed
    _speed_hz = speed_hz;

    // set update rate for the 3 motors (but not the servo on channel 7)
    uint32_t mask = 
	    1U << AP_MOTORS_MOT_1 |
	    1U << AP_MOTORS_MOT_2 |
	    1U << AP_MOTORS_MOT_4;
    rc_set_freq(mask, _speed_hz);
}

void AP_MotorsTri::output_to_motors()
{
    switch (_spool_state) {
        case SpoolState::SHUT_DOWN:
            // sends minimum values out to the motors
            for (uint8_t i = 0; i < AP_MOTORS_MAX_NUM_MOTORS; i++) {
                if (motor_enabled_mask(i)) {
                    _actuator[AP_MOTORS_MOT_1+i] = 0;
                }
            }
            rc_write_angle(AP_MOTORS_CH_TRI_YAW, 0);
            break;
        case SpoolState::GROUND_IDLE:
            // sends output to motors when armed but not flying
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_1], actuator_spin_up_to_ground_idle());
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_2], actuator_spin_up_to_ground_idle());
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_4], actuator_spin_up_to_ground_idle());
            rc_write_angle(AP_MOTORS_CH_TRI_YAW, 0);
            break;
        case SpoolState::SPOOLING_UP:
        case SpoolState::THROTTLE_UNLIMITED:
        case SpoolState::SPOOLING_DOWN:
            // set motor output based on thrust requests
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_1], thr_lin.thrust_to_actuator(_thrust_right));
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_2], thr_lin.thrust_to_actuator(_thrust_left));
            set_actuator_with_slew(_actuator[AP_MOTORS_MOT_4], thr_lin.thrust_to_actuator(_thrust_rear));
            rc_write_angle(AP_MOTORS_CH_TRI_YAW, degrees(_pivot_angle)*100);
            break;
    }

    rc_write(AP_MOTORS_MOT_1, output_to_pwm(_actuator[AP_MOTORS_MOT_1]));
    rc_write(AP_MOTORS_MOT_2, output_to_pwm(_actuator[AP_MOTORS_MOT_2]));
    rc_write(AP_MOTORS_MOT_4, output_to_pwm(_actuator[AP_MOTORS_MOT_4]));
}

// get_motor_mask - returns a bitmask of which outputs are being used for motors or servos (1 means being used)
//  this can be used to ensure other pwm outputs (i.e. for servos) do not conflict
uint32_t AP_MotorsTri::get_motor_mask()
{
    // tri copter uses channels 1,2,4 and 7
    uint32_t motor_mask = (1U << AP_MOTORS_MOT_1) |
                          (1U << AP_MOTORS_MOT_2) |
                          (1U << AP_MOTORS_MOT_4);
    uint32_t mask = motor_mask_to_srv_channel_mask(motor_mask);

    // add parent's mask
    mask |= AP_MotorsMulticopter::get_motor_mask();

    return mask;
}

// output_armed - sends commands to the motors
// includes new scaling stability patch
void AP_MotorsTri::output_armed_stabilizing()
{
    float   roll_thrust;                // roll thrust input value, +/- 1.0
    float   pitch_thrust;               // pitch thrust input value, +/- 1.0
    float   yaw_thrust;                 // yaw thrust input value, +/- 1.0
    float   throttle_thrust;            // throttle thrust input value, 0.0 - 1.0
    float   throttle_avg_max;           // throttle thrust average maximum value, 0.0 - 1.0
    float   throttle_thrust_best_rpy;   // throttle providing maximum roll, pitch and yaw range without climbing
    float   rpy_scale = 1.0f;           // this is used to scale the roll, pitch and yaw to fit within the motor limits
    float   rpy_low = 0.0f;             // lowest motor value
    float   rpy_high = 0.0f;            // highest motor value
    float   thr_adj;                    // the difference between the pilot's desired throttle and throttle_thrust_best_rpy

    SRV_Channels::set_angle(SRV_Channels::get_motor_function(AP_MOTORS_CH_TRI_YAW), _yaw_servo_angle_max_deg*100);

    // sanity check YAW_SV_ANGLE parameter value to avoid divide by zero
    _yaw_servo_angle_max_deg.set(constrain_float(_yaw_servo_angle_max_deg, AP_MOTORS_TRI_SERVO_RANGE_DEG_MIN, AP_MOTORS_TRI_SERVO_RANGE_DEG_MAX));

    // apply voltage and air pressure compensation
    const float compensation_gain = thr_lin.get_compensation_gain();
    roll_thrust = (_roll_in + _roll_in_ff) * compensation_gain;
    pitch_thrust = (_pitch_in + _pitch_in_ff) * compensation_gain;
    yaw_thrust = (_yaw_in + _yaw_in_ff) * compensation_gain * sinf(radians(_yaw_servo_angle_max_deg)); // we scale this so a thrust request of 1.0f will ask for full servo deflection at full rear throttle
    throttle_thrust = get_throttle() * compensation_gain;
    throttle_avg_max = _throttle_avg_max * compensation_gain;

    // check for reversed pitch
    if (_pitch_reversed) {
        pitch_thrust *= -1.0f;
    }

    // VTOL plane may not have tail servo
    if (!_have_tail_servo) {
        _pivot_angle = 0.0;
    } else {
        // calculate angle of yaw pivot
        _pivot_angle = safe_asin(yaw_thrust);
        if (fabsf(_pivot_angle) > radians(_yaw_servo_angle_max_deg)) {
            limit.yaw = true;
            _pivot_angle = constrain_float(_pivot_angle, -radians(_yaw_servo_angle_max_deg), radians(_yaw_servo_angle_max_deg));
        }
    }

    float pivot_thrust_max = cosf(_pivot_angle);
    float thrust_max = 1.0f;

    // sanity check throttle is above zero and below current limited throttle
    if (throttle_thrust <= 0.0f) {
        throttle_thrust = 0.0f;
        limit.throttle_lower = true;
    }
    if (throttle_thrust >= _throttle_thrust_max) {
        throttle_thrust = _throttle_thrust_max;
        limit.throttle_upper = true;
    }

    throttle_avg_max = constrain_float(throttle_avg_max, throttle_thrust, _throttle_thrust_max);

    // The following mix may be offer less coupling between axis but needs testing
    //_thrust_right = roll_thrust * -0.5f + pitch_thrust * 1.0f;
    //_thrust_left = roll_thrust * 0.5f + pitch_thrust * 1.0f;
    //_thrust_rear = 0;

    _thrust_right = roll_thrust * -0.5f + pitch_thrust * 0.5f;
    _thrust_left = roll_thrust * 0.5f + pitch_thrust * 0.5f;
    _thrust_rear = pitch_thrust * -0.5f;

    // calculate roll and pitch for each motor
    // set rpy_low and rpy_high to the lowest and highest values of the motors

    // record lowest roll pitch command
    rpy_low = MIN(_thrust_right, _thrust_left);
    rpy_high = MAX(_thrust_right, _thrust_left);
    if (rpy_low > _thrust_rear) {
        rpy_low = _thrust_rear;
    }
    // check to see if the rear motor will reach maximum thrust before the front two motors
    if ((1.0f - rpy_high) > (pivot_thrust_max - _thrust_rear)) {
        thrust_max = pivot_thrust_max;
        rpy_high = _thrust_rear;
    }

    // calculate throttle that gives most possible room for yaw (range 1000 ~ 2000) which is the lower of:
    //      1. 0.5f - (rpy_low+rpy_high)/2.0 - this would give the maximum possible room margin above the highest motor and below the lowest
    //      2. the higher of:
    //            a) the pilot's throttle input
    //            b) the point _throttle_rpy_mix between the pilot's input throttle and hover-throttle
    //      Situation #2 ensure we never increase the throttle above hover throttle unless the pilot has commanded this.
    //      Situation #2b allows us to raise the throttle above what the pilot commanded but not so far that it would actually cause the copter to rise.
    //      We will choose #1 (the best throttle for yaw control) if that means reducing throttle to the motors (i.e. we favor reducing throttle *because* it provides better yaw control)
    //      We will choose #2 (a mix of pilot and hover throttle) only when the throttle is quite low.  We favor reducing throttle instead of better yaw control because the pilot has commanded it

    // check everything fits
    throttle_thrust_best_rpy = MIN(0.5f * thrust_max - (rpy_low + rpy_high) / 2.0, throttle_avg_max);
    if (is_zero(rpy_low)) {
        rpy_scale = 1.0f;
    } else {
        rpy_scale = constrain_float(-throttle_thrust_best_rpy / rpy_low, 0.0f, 1.0f);
    }

    // calculate how close the motors can come to the desired throttle
    thr_adj = throttle_thrust - throttle_thrust_best_rpy;
    if (rpy_scale < 1.0f) {
        // Full range is being used by roll, pitch, and yaw.
        limit.roll = true;
        limit.pitch = true;
        if (thr_adj > 0.0f) {
            limit.throttle_upper = true;
        }
        thr_adj = 0.0f;
    } else {
        if (thr_adj < -(throttle_thrust_best_rpy + rpy_low)) {
            // Throttle can't be reduced to desired value
            thr_adj = -(throttle_thrust_best_rpy + rpy_low);
        } else if (thr_adj > thrust_max - (throttle_thrust_best_rpy + rpy_high)) {
            // Throttle can't be increased to desired value
            thr_adj = thrust_max - (throttle_thrust_best_rpy + rpy_high);
            limit.throttle_upper = true;
        }
    }

    // determine throttle thrust for harmonic notch
    const float throttle_thrust_best_plus_adj = throttle_thrust_best_rpy + thr_adj;
    // compensation_gain can never be zero
    _throttle_out = throttle_thrust_best_plus_adj / compensation_gain;

    // add scaled roll, pitch, constrained yaw and throttle for each motor
    _thrust_right = throttle_thrust_best_plus_adj + rpy_scale * _thrust_right;
    _thrust_left = throttle_thrust_best_plus_adj + rpy_scale * _thrust_left;
    _thrust_rear = throttle_thrust_best_plus_adj + rpy_scale * _thrust_rear;

    // scale pivot thrust to account for pivot angle
    // we should not need to check for divide by zero as _pivot_angle is constrained to the 5deg ~ 80 deg range
    _thrust_rear = _thrust_rear / cosf(_pivot_angle);

    // constrain all outputs to 0.0f to 1.0f
    // test code should be run with these lines commented out as they should not do anything
    _thrust_right = constrain_float(_thrust_right, 0.0f, 1.0f);
    _thrust_left = constrain_float(_thrust_left, 0.0f, 1.0f);
    _thrust_rear = constrain_float(_thrust_rear, 0.0f, 1.0f);
}

// output_test_seq - spin a motor at the pwm value specified
//  motor_seq is the motor's sequence number from 1 to the number of motors on the frame
//  pwm value is an actual pwm value that will be output, normally in the range of 1000 ~ 2000
void AP_MotorsTri::_output_test_seq(uint8_t motor_seq, int16_t pwm)
{
    // output to motors and servos
    if (!_pitch_reversed) {
        switch (motor_seq) {
        case 1:
            // front right motor
            rc_write(AP_MOTORS_MOT_1, pwm);
            break;
        case 2:
            // back motor
            rc_write(AP_MOTORS_MOT_4, pwm);
            break;
        case 3:
            // back servo
            rc_write(AP_MOTORS_CH_TRI_YAW, pwm);
            break;
        case 4:
            // front left motor
            rc_write(AP_MOTORS_MOT_2, pwm);
            break;
        default:
            // do nothing
            break;
        }
    } else {
        switch (motor_seq) {
        case 1:
            // front motor
            rc_write(AP_MOTORS_MOT_4, pwm);
            break;
        case 2:
            // front servo
            rc_write(AP_MOTORS_CH_TRI_YAW, pwm);
            break;
        case 3:
            // back right motor
            rc_write(AP_MOTORS_MOT_1, pwm);
            break;
        case 4:
            // back left motor
            rc_write(AP_MOTORS_MOT_2, pwm);
            break;
        default:
            // do nothing
            break;
        }
    }
}

/*
  call vehicle supplied thrust compensation if set. This allows for
  vehicle specific thrust compensation for motor arrangements such as
  the forward motors tilting
*/
void AP_MotorsTri::thrust_compensation(void)
{
    if (_thrust_compensation_callback) {
        // convert 3 thrust values into an array indexed by motor number
        float thrust[4] { _thrust_right, _thrust_left, 0, _thrust_rear };

        // apply vehicle supplied compensation function
        _thrust_compensation_callback(thrust, 4);

        // extract compensated thrust values
        _thrust_right = thrust[0];
        _thrust_left = thrust[1];
        _thrust_rear = thrust[3];
    }
}

/*
  override tricopter tail servo output in output_motor_mask
 */
void AP_MotorsTri::output_motor_mask(float thrust, uint16_t mask, float rudder_dt)
{
    // normal multicopter output
    AP_MotorsMulticopter::output_motor_mask(thrust, mask, rudder_dt);

    // and override yaw servo
    rc_write_angle(AP_MOTORS_CH_TRI_YAW, 0);
}

float AP_MotorsTri::get_roll_factor(uint8_t i)
{
    float ret = 0.0f;

    switch (i) {
        // right motor
        case AP_MOTORS_MOT_1:
            ret = -1.0f;
            break;
            // left motor
        case AP_MOTORS_MOT_2:
            ret = 1.0f;
            break;
    }

    return ret;
}

// This function is currently only used by AP_Motors_test
#if APM_BUILD_TYPE(APM_BUILD_UNKNOWN)
float AP_MotorsTri::get_pitch_factor_json(uint8_t i)
{
    float ret = 0.0f;

    switch (i) {
    case AP_MOTORS_MOT_1: // front motors
    case AP_MOTORS_MOT_2:
        ret = 0.5f;
        break;
    case AP_MOTORS_MOT_4: // rear motor
        ret = -1.0f;
        break;
    }

    if (_pitch_reversed) {
        ret *= -1.0f;
    }

    return ret;
}
#endif // APM_BUILD_TYPE(APM_BUILD_UNKNOWN)

// Run arming checks
bool AP_MotorsTri::arming_checks(size_t buflen, char *buffer) const
{
#if !APM_BUILD_TYPE(APM_BUILD_ArduPlane) // Tilt Rotors do not need a yaw servo
    // Check for yaw servo
    if (!_have_tail_servo) {
        hal.util->snprintf(buffer, buflen, "no SERVOx_FUNCTION set to Motor7 for tail servo");
        return false;
    }
#endif

    // run base class checks
    return AP_MotorsMulticopter::arming_checks(buflen, buffer);
}

// This function is currently only used by AP_Motors_test
#if APM_BUILD_TYPE(APM_BUILD_UNKNOWN)
// Get the testing order for the motors
uint8_t AP_MotorsTri::get_motor_test_order(uint8_t i)
{
    if (!_pitch_reversed) {
        switch (i) {
        case AP_MOTORS_MOT_1: // front right motor
            return 1;
        case AP_MOTORS_MOT_4: // back motor
            return 2;
        case AP_MOTORS_CH_TRI_YAW: // back servo
            return 3;
        case AP_MOTORS_MOT_2: // front left motor
            return 4;
        default:
            return 0;
        }
    } else {
        switch (i) {
        case AP_MOTORS_MOT_4: // front motor
            return 1;
        case AP_MOTORS_CH_TRI_YAW: // front servo
            return 2;
        case AP_MOTORS_MOT_1: // back right motor
            return 3;
        case AP_MOTORS_MOT_2: // back left motor
            return 4;
        default:
            return 0;
        }
    }
}
#endif // APM_BUILD_TYPE(APM_BUILD_UNKNOWN)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 PNG

   IHDR  @  `   A   	pHYs       
OiCCPPhotoshop ICC profile  xSgTS=BKKoR RB&*!	J!QEEQ,
!{k>H3Q5B.@
$p d!s# ~<<+" x M0B\t8K @zB @F&S  `cb P- `' { [!  eD h; VE X0 fK9 - 0IWfH    0Q) { `##x  FW<+*  x<$9E[-qWW.(I+6aa@.y24  x6_-"bbp@  t~,/;m%h^uf@ Wp~<<EJB[aW}g_Wl~<$2]GL	bG"IbX*QqD2"B)%d,>5 j>{-]cK'Xt  o(hw?G% fIq  ^D$.T?  D*A,`6B$BB
dr`)B(*`/@4Qhp.U=pa(	Aa!bX#!H$ Q"K5H1RT UH=r9\F; 2G1Q=C7Fdt1r=6h>C03l0.B8,	c"VcwE	6wB aAHXLXNH $4	7	Q'"K&b21XH,#/{C7$C2'ITFnR#,4H#dk9, +3![
b@qS(RjJ4e2AURT5ZBRQ4u9IKhhitNWGwg(gwLT071oUX**|
J&*/TUUT^S}FU3S	UPSSg;goT?~YYLOCQ_ cx,!ku5&|v*=9C3J3WRf?qtN	(~))4L1e\kXHQG6EYAJ'\'GgSS
M=:.kDwn^Loy}/TmGX$<5qo</QC]@Caa<FFi\$mm&&!&KMMRM);L;L5=12`ZxZ,eIZYnZ9YXUZ]F%NNgm}agbg}}=Z~sr:V:?}/gX3)iSGggsK.>.Jtq]z6i4)Y3sCQ?0k~OCOg#/c/Wwa>>r><72Y_7Oo_C#dz %gA[z|!?:eAAA!h!iP~aa~'W?pX15wCsDDDg1O9-J5*>.j<74?.fYXXIlK9.*6nl{/]py.,:@LN8A*%w%
yg"/6C\*NH*Mz5y$3,'LL:v m2=:1qB!Mggfven/kY-
BTZ(*geWf9+7KW-Xj9<qy
+V<*mOW~&zMk^kU
}]OX/Ya>(xodff-[nVE/(C<e;?TTTT6an{4[>UUMfeI?m]Nmq#=TR+Gw-6U#pDy	:v{vg/jBFS[b[O>zG4<YyJTig}~.`{cjotE;;\tWW:_mt<O\kz{f7y9=zo~r'w'O_@AC?[jwGC8>99?rCd&/~m|x31^VwwO| (hSc3-   gAMA  |Q    cHRM  z%        u0  `  :  o_F IDATxyXToVt\pe@%RRV".fhi~424wqEATf\rA~04a;>|gR-KG5>5j{)O<lBdD*J|QP(%?/c$$$$$$J-[Jbji$^
HHH7#G( Cq*RHBB@e;{{"##qww IHHBBBB>( 		I IHHHHi$!	-!!!!!!!	 								I IHHHHHHHHHBBBBBBB|SSSS\r$Gff&*TN:XYYoKD@7n`l=<|oR@P_?u&WY+:[{{{&SBi$$$$TX{7msttm4kbii1ykqPjvM}t2h4]&1w	W~4lFQr\qYiSU&K;,cn[$&&br\T*GF~jYb(%H>|HV"z__'O;Czr}L&nn3fpEoj5bbxP?DDDkqy
oA16JW ,,P*UI<$Jq]fVa{|n_;9s&[{mgm(jP	`Gj:9mM68;;3sv;b4i[8sp._5
4@&cnIll,(bdX<xpb4"#"8p >kSNi__ ,YD|\.9w.#annKdd$W^?\/7(ILL_~'tZjH)-!Q^{7 /GE>n=;y_~a<jG{a`i(% 1A\w]{quvU6.0aRSS9qnJdd$:aMMYhyCbbj={Xz5O|=W G}o;nm{q222pqqA&BC8q|e[o3_{YlfILVs^|7=zDF:%$ jquue!~hVz*<|T^[[[ZhA^cffSRzu[63>0[$!>kw	9vodriRR?T^q~IJJ"(0Grs}}#MeU\zkW~	:vd ]vcG~iii9ruc{xy{SB?2<}{V$k<`9r/[O<iF?wy3g<y cDB\
_U?c/;##{.BBB^x<Qpqq3zh*j*6mDUn/!! bcc{OF&r2thTY'OMB
x{y{nQaee%+WIZymmhS>yECxxxw+T:^^P(pqq:p5J|\jk];bbbHx*
Z6R
_/\9zK,a9X[[X7od|R1 2vgxcXTXV%!!J~~3QGT}<l_k`ggK< 00UT \\pvvf;	BTUDFDR$Y4E8z(/ rp>C]L H~pY_fL3.^ @'''Zly .ju!..@xy...HC4h	9vL6{RDn v{ ^3giO+1s&7.u/p-:tOOKGB@B@WWj%>5k{q\psFF]'''j'gMl	ywc2v,f]1j9p )))d2xzfm( {J.mAAx{{s!dNIIgwYp!?#[|oZMPPscfjJ5i]~Khn:6+Vq*E
*JWt!h4%

BP\.`J%2 j|@~:6|mv?y_~RdL1#_"())_6oF#_Ouq)-fu@@TTnWT>t +G=z{jz__9vvvLpw/bL
 O@@  Sa/<	&};s#n]}}[q\j9/<sfFV3kLK)7m,\M7gG1m49t3J"((\YlO<p+VgY8W*-B:~~(
69@/Yd{_[_~pY]i?Wu-Fbb"ms\!pG\\GsUL,@d/x*_F 11D=wz^>|oWS	}m7k}|]mZ&a>>SQvRbJYdft(N>zd<ydFO6}Vbg} _r9?o:{.EG1yrpQHNNYQooBO?F)SAeKys6mJ5III\th022"%%/NXYYqzM=q0VKVtw-$ZV?>VL&3y
$>77n',|jS"Wt-~WeKxzI-Glcduj??%KDQQ 8qx"~L>DQ|oGZ-
|}d'00J	 aEo^~W<#>L|gYU?5kx-FyF``9Y5			#PAOgg{{V2y2CPv	=? WWWL7_PbEA]ZRBjGcVVVt	}FDDu__[Q*U<|y8vo#$>/5ob5|>u?lg4o\:q# |kP(Xt)g"88{'<gggT*dj9{l>CK}d%2<\2;;;ip1\ &yxG?oy7|___?F?;nnn$$c]c{z$
\3 MVk*9gsIRPd%H{{-(-&&HT4+>u+r)&CAf6GP[IL$--jIn1s&?^z$%%y(rTQQ\t	7ZIw+lI"!!>Oex7EfHSA1se7o3iVgT,&gg
	h4nFZ#TUBV>YK'%%%_A*JBoUU/:$o @+ xwhm61c>qbqc=w{lr.^H}K;m/l_Px+hA 4j^D%KLpppy{yR2y2K?4k+W;4 ln<&M_
:A];}1?]M|u>>" FzIII@Jay/_IH`]$$$`mmMs[[\.7B||xW\t)_Iez*L)7dj-ZDTT!!!|GDFDO-;oTonF,LAAAD8Uj
[ bpG(g_h\IH IENYNC[5+_2
QF9? a*~Ktt4##I}zM% dffw^vSNJMF1;wu%t?L1S<kvQLm1diiYlK09x~-" 	YGhx"J]{///[7&{xQFY3fKh,w[oEDDn011)~^+V4Yz:t1n:)"{2<u_#"?l&;wp%r9K.}dVBVH<U+>V-Woeco9WT9:"N888KB|<=zpIbcb 4)g &ktp6kVH$?A94r[&$$|@sU~~z	UGYME3LTcUB%;^^^]iO&3Ba Tqimm@WfYNukvZf9',FTOun	DEEIN>}G*h-:}vnh4Mlx?O:u;oPTl>}bffVv122b'7f%g\H'Kj>K.qmk]ve	e]hZ;gG0[~~V5?+h4c{	N=fsCBiniEj!F5E1+m___maeUbxH}![e[n]2,kK}!/9v<s\>P<Q`aa Ao>juDHH>|x#V:<	5wni
0FZj/_~7G&M;v`_k--P"/~s~d2~{ c)	, [V^z{t6Vs(*}AwbM=f< %9+[V-1?kFwg1c7qacc<{;K5WsA9"<KOg8@FFyKp"!2QdXyxEwdbcbq|||N?rckk+FPdjZ-vvvT*f- =D{{{1$-L~AAAcgo/
h5BV3 7F@KMAnMttt'22<ls$R\FUP,F*
[fM[76E#7"d2m!$$\vMLs	..Ltw'94n\\AY(h4/| ^^ #9gg^eEK#J{cdffRvmn
!CJ+}hD7g&|1n8t"n'$BpppV/ZjF:c'EG>q"'2.pMx77#Fdh46mAyW,_c077s\UfgXXXxb<B5]!66pR
0			uKGny]ZhtaQ(Y8g4Ama1L< 	Yp\B6Nbb"j x6lP6)S^$hq>M?77n++nEse 	^atvvf/xOaPv<<<;11	W>^}h@{2."\!!!~Fud'88o//s\ s\fELll DgvHYJjbiy\]]svO>?C Y?o~[EE9TP4TV-zNDx-Su}K9CddcI,];wys_y	5k]Fcb*Ws_h|^GdzOo9pC

"22RfiVKQDP'uPEE09f-xL$f7Xv}*T+Q/|n~n*E^DZnMZh^yZ/VDPiXr\.zr|Fc%"			sPuy:Ap~GxnQD?C}!q&F1BSLtwc8_k\n5'V2ex85(EB9r$|={,fbbRQK ] m7"##c
zY<x?+Wm_??sQ|	7n :Z'N,r6o//N<_/\HnwC
XW;Fzz:s{ME'exr C6/aCoi9VU*__!I@Zee>@u>'..eK2h4pd[P8j4	Zfh4@ n!NeywN,~QLv1D7iak[c5fA05NNN}nA+kv6]]EoQ:6g^r.])w`O?RLCEZnyyTQQZl6l`T*,1HZoX+4k3f}VZE?NU_QQQddd}{'NNhBN<I5XbE@Y|9W',4o AE4WW8y~WVQRY3>sF\8~\EXtv
;;&O#v:2kkkf"bc+Ogz+hh4b[.a?CsPgrnm+7~n*Uy266VZes~cTvmN*<GDD`dd/Fpg\\_8;;_wL6Mnnn}~Hpp02>{w>p *k899Otqa1Z;wlr_O@` of?[m6j/gE?|7:uZjdR):t`XZZW:;U7V<22l]/U9d#W\a7.\Syc[.}1M4x{{sUi6Ef~}XXnDyp>0y_~~zqKI&y L%KDSV\v{~V+7oQej8::f}$&67sU5jKINN|:n>[o1l05jTKn<JIay9skz"GQYjj7'O+z)@B9!!wjbTqm[n~?_LHKKfgiy M5hg7yHS5$p\*C'$Tu	 v3"h)A gg..ddd5kruxxxpH7z4(|lM>4a"n2NNN7Ge8:r5U2OeZ[oXp!fii P}W_qyr9r'|MV\I`yEPz)@n%A\\d)"Q >}V5c4,ZWTbCEZHHM,]*OP)2zzE@@ g9G[oUf>~hD>klYb_A0eLtw]["m0rChqcf/^D.cbjR%KC&MV]K.aii)y3sab
nwr\?t	{oWS%h4^:	pQF%>scqCv04lX /F:u|$''K+Q,E-AX)jDT/Z`?g 222o~ /|+p6U{	&]E?*>t2&D}>c,]ZbPMXX,ZZ Vr9pXd	o9>>>?_4mEDDPBg{rpF\O5{nSN|y8`Dn,
Y[[8D>
BTp^g<x_}EHHVVV9VVV9KKK9WK"A.E>oFV.}B7:|g}1?PWM>TT,Z$Wia$$$_?Vf?9C?Y}JF]#SqB`8m}G.cR> O>e= |(p0O,]]/	7o:MMiFu>>\Y7ok0/W*b=`oTI8CN8vA\c1XVr7h`pUU *V$==Bu5{vA:|63e|y
 <Nv/eqqql
B1w.jZ4/bA<d}}Q09[+oQj}

2?$Wvrr\}meKs3{6_FabeY/IVa	$11;;;U~:(155e%ktur
wj*4jq>s5YjdYMff&fff9@=CO>I055w$FU\\\4aBIf%n;
ozuiU'};J5k2gEQi#Fd:t3fPNjAUx|||z|[DZBwQv$(( JKZjLpw'00UT~~9:]bkN`*f75	mC5nSe#4|p4nFTeg[Pbc_g9}xy{s)sBB,vv3r9CagG5HJJ"44SNaUdRRSS4i<x0W\S7(;vl@)2T,%%El m3eZjL1f4ja*K0B.y7xwYn]	BAkkx.]d \V-zmM8;6d_q?V3+		:|x}4ybWw0((Q\7
ns_PPXi<;I !tJVD=gl..XfMX=N]4y"n}M,--7vXeff+3aaawOph4qrVu 9}w;;;,]J`@=Vvr[;CJ*jQn]>:PA.]-g I>|[mQd]$$$U3j(X[[3SS$i1K.-3c8r{Jo]^@[]>IpppQWcm2rZ-VVV:NJ K4hog\,\[upqa]166&M3...d2i4m9+SNeycN$$$ V+6/E<4).2^QDD]?yD#eER/r#qc|||DR0OWjnkKdd$	X[7*ULct}m&OR>T^, 88=h/k=233>xT^:q 7n W/|5gabr@WrmZMsg[caaQb{eYwQ_f"mJSn3fgX( ?0KKKF?K.msI&s	
nz j>~[+W-F1O/[~5kNm<xpN:u!!!J*amcS z(?9W//k<zy8u;Jn%%Y1dbbo2p@74q(Cz;SjEAZ*n2('IHHHHHSN'3{vVs.TR	=	&YlsIII<~S33jEMiSxo=F.C*B~2<_>g*.$$$$$$JPbE>?c|>e
DEEQ^=9}4beeEvh@+z){+WoT*b++VP(,]Y3g [[[	9v<MRk"!!!QT>Y>Kyu?wr9#$55G}:u`mcCpj&]_#4>e}|D[.Og'$`cmT}%$$ORR>$3v4j2uGT_45j"{DFFJ?Zd-DFDa`'!!	 rG
DRuD^J3Yl$$$$!!!#G(vbq $$$$$$^-a)`/UJHHBBBBUChc  IHHBBBBA=K@y-Xg0QF6m`\#=\OO<y*W>zvB
xy{#?H#4>/&MT*u;{{ZlY&em| =su>>)7}w%Y
X[[[_(bn*FB,VOuaKt)F$$$zmkkkJ6IIIW/sH||<w}a[woi4<O:E@@mQvK+RXaj6cV`jfW>8{l}sEPAG=KFFollLz*}}}c+s_m|<x+III=Mn ~z]jbz+}vc1m(d?166_~XYYKwL4 kbElP(dX<4*GRBD= 777&yx jiSNqYr9,APs&O=\[hDHHW^m\JjB/$HJJ
,^ oook.ckP(Xd	rVQ*xqtt;__ch(zo~|1m29r0YF'O.QJ~D$j$#(222"Ih4qFfa:= wvv3DTtiZ(~;\Q4` {{[zL)E:
$o3ihZj5(~ d2,aB" s\8&!!G0QhgNt)SMJ*xN-wX%$$"7 r<<d;5VjxU\{axYw(
]9>|JDaZq:d2
\EHQd8::p^$11wP(=z__Qt/"Uc<J*q!V,_.EJhqPX[[-ZHg})qnM%dQ4i$vp(V~fG' J%~~(J-&Dwwjy"O\ +$&&h #jX[s ZkWZVARd=}{g~<Yjlg;t#	??nPLHH;n$JIeJX`$$reJ2 hZfb.N||xl9::P(P$&&AbX~Zdbb"J`]:B';Y^I>Rj'??>&&&3U*yI !! 3O6n!! *vwC I(JBE%RwsNk{Rq#btY U`4iuV%11Qoj+		y
&}4i"%g)iOuZj3x/|kt&&X7iB:u$W`h1#|}}mKMQ]rj~~C^#!r9bK:OHH!!!X[[]v>}o//)88ZMFJ$Ehu 2/hd2Z\R4xL,/$Ft+QT^'''BCCW;C*UX\x)'dR*UnJxxx7oH7\_ZWbP~FJ9r$EA5e@*V>cpp0WxF%<#F#/||P$E2jR}viMy^qhPm*d24 11Zm X	&R] <}y?FEEC	4n/qLs,Y?<UVo|d$&mGpJ{{{6kFDDF+8iR^N uq\XSw5<))iz:t\{8{		L8TnPVhxzT*Q*b66XXX$`vttm3]v}J
#,jZl<"FXn RXDPvJ]ib7'M[nz}-;w.k!	+&'J=fC.sr
'NDk)L.Di=W8V	)SznYyf?O53gr}:w{\{qZcdMXXXW$N>_&F.sNw:}rgN.8yP(6~~DH__q/~N9c ^G<*mXj-[$!!.3?4mgw111a}~'Oc'###i3/?f%Udj ]<wzX"}{r!9I^GZj34HNN:u Y`-#Fd\rR#\. 	u-FI_Gf
59.fFF1]>svm[]ezy{hBN:$''3tP^Z+++L'O8|{uF#rmjee?jFg2 IH,kgEi-s}GZZ$&&=333	VZ1Q;//SfM>3d29raJR)z,037g4jZ%ff[P_;E&		_jlmm,~MG*gzd%#?O'''?#iiiz%1f
9J~]3uHBfIfni9WW_222[.5SSSvA`@ S>H+4VzY$VX!~GFw$IHH
RJX[[Oo#l	=J!WCh)-FU;tFP?fL	amE":cVpq#xsDb9sXbGg0Rs_wm9Bzz:.2vX,,,^~UVeUVCJ_W"fIf
~%u|:nQQQdff"Yf4a2p 6!1T*RSS\2ddddy|}%X3# wN:4m!C/
]~cXc
B
+	
"VZTZ1[New@=^EH.J@h*3mtLLL8t<j<y2jg<y}RbE\]]IOOS`nn.	 ~~\\$M3/KKK f#=-Nu7;v@E`@ 2T/iem<{d+W$p222HIIba1H*T[oo	ex8/_fL>D5d0\qk]hKuYt)\rruy4w$}!<
H9F)|>u*&&&8p{SsDxZ-kauwoO$<<+W`kk+	MA\~\\$M3kjIMMdffo_>6?ZcvX"]v=={PTW/&O+z*iZ<H-7KXl^L	I7oItxzi0Vu+{vfL>r9>;oWbu8v`W8g%Kj5w[[[ym)y)
>|(>OVY&Ms}S<cRGetSR5j~ f)QT$Fk
j_cIS .>4G>lCt	baff&<"0_uo,Y=z>>pWx
*m[RSS			!55UK3uZjL8SF.]'OeKLBnx}mwNF?XA 2228p nEelLLAi[eP'xY	9WWS8q"}!##gpB<HBBW&003mtQ6"@DA\~\\(QQQ8qUTyEoVk>d9vSMKKiCJJ
ubU7y7V'jm<3gp-[W_}E={6'6KtedAb_v0zlmmg~$GTT~3KtIL%q08s8w.#F#%EN 5Cagq
>yFgb.]bEZj3cbP!)qA-QE_=CU>|8bIO_%D[no^nd}=z;_l]vel-dRd}h<wwg$*UcG ndykne9\TtX~5k2dP6uUX%]1` }r9?oA93#r7?Bd#..83
''{.Okk*U$~3)l3&L`;vr5{6M6-3339x }}IKKcGK%THWbsuuKYfjj*RJ4}B$55EZZvbYGVM6,FwCvBOz	GlwC<
*KZZ5ma\vRfMvI/6"#"P*,6
+N\.O#u^{(]j5&N$1ZUL&K7:w}cmc**>(Sv122b;v\4oHcX{U1C, oP-KAxysxB|Y33#==0Kg3gVs\rY o~4kV)"""&$&`Q
b+V<g-#Mpw':::0a;i!<dVYdI'hooo1B4d"M:D.z:;-(UTT-UE 	AROGjm8gdd+}6o&#HTo_~)i333 >}+Wr
yDRSSy={>`rr233Ln?UT>V+{G||<[~=211N 	6m"**
333033[gKCHm=Ql#SR
3{6==IHTV	J=zFU, 4dllyTZ;;;T*sf.tKVb(8 r810;88p`~J%||\`qsNKE,?m2"33NbrnB`%$
R-t_~)i={s8qM7iBuXXXI:u8KuhtMrJ
W\n9:?~gbaaG;GQ(n:k	:x@ldVZ>\]'%%Au%GfK2t(5r?wc;E{;s==a!X(Iuel1QGSn]	Cn:s6i"E<BkW-sl2_9j}/
R-H%CALKI.wgia[*;T_XnjjKIhh(.c,Z+1cp1u+\l9DQlLr7nf9@13^:j8(trTR}{[vvvtu}1nYWV1cp%!*UWkkkvvX[dqc:c'p!q,G&L4]v.]J7r-
j~i3**%Kp{=|oW}D*TPAJ ~$^'^33,33{~f&FBPed&&&W@JJ*4nXXr%t ud=9 dX:uG'###G$H(7]6UVq=
(^0s{MtG	%4G-Yv6,&I7rHFF=cYL`<`4j(_|2K.JBg>krVX$bM/ *LT]:X[[]"DRbx%^||c</'Pc2rHvUu*E5*2}c$}1/<gj@b	4n$5!!(i<xIII!##KKKW)))U*&'~{qh<`p+,YUTca1M6K]K,k:u@W@)JKCW 7K"4!3g[Ueff CQlH'BLML;o'.. ^h	&&&@V
?;adcjjJWj=O :tAUb!bK'wI^tN8OGPV166SSSLLLx:u
o//>:6mz-s|<lc30Z-f	###A nn){ QIdQXsE1B666{{0h!u%../q222Rz-KpE^$W(3kV_v.|a[;?vmc$<^bQJ*QEgc?p==J*UpppZjZg+!Y&>tH4}UT,]&L[nb7od(0` \QU&c,#CA+5$QE$V!**O9)	2q{{d~-N>cDsIHH3r_'@r>)tue>^PGncbb"60NKK^zLkPbE/&=)JRRR|2+/8uDz
8<<D?]6&ML-[8}>\@eOLJ:t(H-?<IK#CSRT*T*)N||<s==Y4l8|fzSKHHKzP0KY7|SBhx{3331Bopu0i/Mc(JoS
+r8U4Ed2GU#91zS O2+}^(Gytw)_vM~~K/^o~p<TMy7bv&!!<%l	_4+Wp-QT055J~P([.nQ#~m waZ +5j`yBko<kVPZj|DEE@1LJ_5<WwqaOJJJgddXZZbddF?k'1l2<Dm&RHBRi<h@giSd'muYo~N;cQ2ucL	9vORfMU){c<&O)jXf111] *dW5<WwJ*{w>MiSDON]3fk}N>M\x7<~>}j'q| $(fWIH[;PR%7oNMDkh	fff/rWk?uj&&&oy=dLMLC0el/QZR
K.r
&NDEQq1#%q////zC}#SZ5nIII4n*l;ZXXa,^Ogq3xBjj*.\ ))	jXS'qU)'G1G8r7nm9ZUp/^\3[sMVXa`F
b'.q/]UV>m111GLs>}T*=!CD<[W+!ajj;%::Z'{`8-[2Xqc=wpwOgrs*U6}:||pK,a||8q5OkT?t(kxA:GLLmm\~	}C4t-1J)	ZBa t<$$$p]>}d:u0l0uFtt4{.DFD/w333~}GXG
m@		@zL0OTO|rJ	5=m87Z4o%]Y
 (&Jwq9yx=x"oUlEhnn5{>c;u@]*`i74V,_-[ 66c`r_/m$Y{888\tH u1SWrV.M\ds1(nGz
%$2%xk95kG:t=7qmKFFwu8wETPccc177J* <zT2v863~gy&7EE>5d(!QF177`cV,--qT6m*/bmm
!`>|]6O};5jg]&A^=^f?CDEE/0q$UFb4LMMw/iii<~#~$s4kTPT9-[8}4?7n0v|jL:uoVI I643)Sq*1GnbgXfz*,BVe?bjjj?|=bE|JHPT}e=lz1\2Wg4hmq-222HII#;z333GJDgEtGabjJ<I[###." *f~\^]if~)-s	Xo_~mzC9t[ xy{eB1:u",,,WFccc0"SN(Lpw_$##}i&+T+SB|	olIrYIOO'334]fp~A899{|	uebKEjI $_j\^)if~)-s3o<r={eK>6b <ygx.$33S=w={3*cG7g	HYt48iO9t }{x0j	#9}'Or9nO ##Cw&L(R\.g_0la+WSN? *f
~\^]+1/C?__R1S_-X79v(QQQ$''SNy^$RJ'X[<OBB?`v:GiSB:wsgnAywHy)2zL>?ZcBP1Rca,faY~}Z7zvIBBW\[SJ		3y{b7$::L:uDU+++h@N:W]ZTdX'O]v=%T7
cYc{$!kvv[os[={;N;Sn]d2YHpJDq,zrI Qe#f:xXz)PPs^cmmMBBBZH#Qzu,X	$E/__Pfh!J*hr$TsuuKYIbtue>.OBq];.?sINN3?*URvmUFJHJJ"MLoV%"[]U^-KH<e^zz\;>EeV_Oy)=>za^FCM'~[_'a'!Q5;m)#Q4&	;<jekk2+~+
R_?5+-S?	%KG122333*WLZS ;HKAJOB(k&vcb.y70:|pJ-S4>H#4>Hj1 d#!>iHHHHHHHYQxeKip$$$$$$$S021"df???IIHH{.BCCuGB)!tAisG$		B/~ -:P1q]ZN||<i.M<y	NPx~`gQFip%$
I\\aDFF988f8`RN2SSS	E&oQ~}!Qnztssr *-BCVpSN{XXsQFm l1bqm6#Rh	g9PAPV_lL}GPjUB  11Q:9$-]5
0aS ?31\Is[loh{$,,..YLjb\23616S*Ue#))	FYzHHL'n3y3kVRJ:E* ,[=z 9 5kJ'De  7o{gO =y	&psM>a")ofysG]177g??!fAQ>iiabl(21FaSY_F[F(~  ''_DFD@=`9dddf++FRklLATCZ- tu+VN2' pvv@spxL,Fex8K,aE~G4}=fAiZbH:5`llLELffwbjlJVol\|[nQn]x.\ 44Bh4tNNN8n2<ex8: JPPnJ)hk.TZVL&CC+Ub
sNNN	"998d2+p@jXd2#xr9K,> ::{wR-x_&'SLM122Y322300$odr;4nNp'	 	| WWW,,,AA tP773f6mb=L64w!44\s^ $'` 42N IDxA9_/gd^zH':ws W>**
..G@&RnZ~7.IKK[ZMD233yOHy=M#5-t/131+ffX[[Kg8r11 4hHK'F'ND.o^K4fc3f2L\gggG{?g^ ))'e  jVN
EAb+
*S;dddcGLMMyeK.^pa`D|h\\PtKH0>ONE:~'((HLK5
TSIL$(( ,,,p8/:|XCM>}LV ]V@C *)]]
o%55;p1c@F&Oj<DCH_Dj5~~"vvv8nM-zURw>t]2's...Vt#OK}K%'''BCCdtptCbG&qMqk[PZ]rt.!QZjQTR@ * W^^;IMM]v<Xty,QF[cgZUwpdi/bacGU**];w2/sD p77n0x :W@V0=;uk"#"_Ve@ZlIdd$'O9V ;JU`#-GT*R+!U^]|,66VGLMMDxg[L6m"b?nnn:}Z;__j9SCg/7nSO%t[eDbcbP(y(RdRmmq4+W:h kI?={d70=zHGLS? +A<.rC[Urg~}GDml:ttkN ~Iz*b%snK-%^^Gh[LHXi
J<4y174BCCquu5]\?$$5^? &Db
5Vfffwt'C8p`Q$"##..a[P>'nnd2J%*`6#9h4m4ev3 ZyKYf4kZ#rA=VZO]]]q5>7o"U`s(D&9@BJ#@r8.EG*VZK(JJe\)I9%j5aaa${666lv<oEu`t`T*tm#o//Z-]~;|!Gbb"(ICBqdDE{uIhh(\M6Y._>YPu&He?S? 3<uQD#A8|A?y&7o,]Fc4m={^%Ky?B$A`  UufJr2jZRzeqn	ByP,QM9q8j: ##"K ~(~j1??f#FPSh<GIHhR&;Wj"-[~?r
\]]Eg-^?mqe._Lmo	;v,Fzzz)og'$)RRR~s}|</$P(jbhS vs_!suk0e/S(wr	 aZOwE;A@@ b^GdeX{vf:2.QD$D]Ey%0iH&oeeE-fxyyTtURH!-[2`+?sFgV^D:qP{/b9BAna{T*rVT^RJ# L\rx trr{b%Tcu#R:uE1Z-&G;ak*w+8L*U>cFV\cbee9sfff$P(4JBS?Koj5gBQ 5mHjo,'H8.dy	F&1]Q-!_S'bGu.*VX:lYD|DY$''+j+#oDoBXc]VqD'Nd_2mEX~N<zbO?iXreh:f1j>@bIjP*h4PTJ2t((i!R2t?%-(c>KiF`%gnqkE4kKu"29^@cXQNMoJTT&N66Q3g	AQ9|\z&!9DV3/X793gic>b+++J%|| 2iF5R'['Nl~A|#Kl-O$>>+cmmmT'%**Ucqd{+?!(7\]]soyfQkIJJbW(2H&-<VuS?	?yXbc}~nIM]o*Y5={r!|	~?DTTsTR\OOnF+fnn?gVQ(tv&Zr,322!z	3Z-r=J%gefs {]]cDQ'Dr"J:$SrQIIItZR %99GV{h;Y|9=z-b 8^TZ5_n%t44<I]roddDFFGX7iIwtr1zp3g`_(#|5>)))/B`eYZhD~GT2EB Q#G1iDj56l(GD;L&c/j1|8	rXJ@ z8~<C 	
wyw> ;t06mz-DuWI2H(Z h4Yd
?yN:10h!}N"z"6svmF_~!9?'sOnxyy#Z/+
R8ujMR^=*T~@&1I':(xC"#$ ZS^/:r LQMnF@+#=9Zs<sD;woaaapqw1v.'>|8FFF;{E)=lx{y[oBsssZnMkw+s<=djEB@PV+PreZ[g:Z*]~c{n#]Pq#$97%u$^Lf'gYF]d'&j_hX"@% BGV&5kHMMV
bxG(---2-?a011Sxyy\noWo>?n([_.*"##H0 %% (Q$%%t0d`LML^=ydLM}tM]~OnNB^'ThG},O^EJ @j}>5Q%XYL>
*)trrnEddf	mq2um5fT*Yb&,_L;:2ds`C!Q6j^p>$'1637gGy*TS9UreH!2sGmqr+v+V\,-[eV9V	+5W2)WJ 	b#:V^i:_;:2gr' Vm":gS*!C011!,,sUZnss,X
?~u=n}ar9!<fH(:&P?cR%22R|-NNNlT?KY4.\ 44T1YNNN.WJ 	GP%ZYYYFF}}y&?:u1oh;#VAVU&-gQ@WWedgo :t(krgGoCtdyH9fe`u<	 KsGax<6&_l:8EFFYjT? s^|USRR8zs<=d?pUx^zEOqi+u<6mkh1666%p)qKhw/vz]s	JFAVSn2D9nBzbbb|GsF O+WgnpvW_\?7y3kVfC3,q*WF [P(xxx!`P].?Q#^NI[3:t+w5kTCqvcE[cll qvv"fBA6BEP kuZ+W777\TJHp5*#>~~{y^5bt[^SCEJ!@jHEqttd={B0T%\jZ$$(/.222?YKrr2oA#QTd27:Z-]~ Oa|2v,~9gH77R*T*'r59f <{*Pr2SRIy AeO-!k	"J,W?L&W/* RX"d*VDNr BJIMM6m6lt-V*6<]CO>:?fnVVV.^PR%2< iR%sJ|}JJ3hM${J~1r$x^|m[MOO=4h@$Qbo0Axzy{)`Of **J,uk4e bcb6@2N?Nrr29](T(8;ub]aX%]1XP9y$gc%.Z6HWW^ 		>pEeQb-<*Z)RtzEEEQJik5|9o4x@ 'AAA38Q(iST={,Z \]]E!$i,	''' N<m<3gX@
z;5nH_dX6mJb_lr5k&{tY=sy9_<({\@@b??"##%u 9Rj(8}AV	Pimr\ 'A4&LS'nJfQJ]6g('|b5T\###BCqqq)P;		{w< \]](~nsAAAY2eToK('mmKUC%M5~~Auu 6nd^8g4jhfItt(z`%OJprrB<5B9ta9~Ut~Q-Q89?_O&88KK-({R{.#Gdce:uw'x		o~grvv'O{-))a
0`#A#2{fK!EB@-,6}:			dffIIHHsN&6jT)rDt)")))]Kpp0;v`HH(X"K%$3{K o@tuqq@'OX %''bA`K)S1d	epIHHBBBSbEu+\.Gr\\\

t1*FkV_a$6prr{QC$I IHHH;t 11P^-11@'t_Ws}lJ2X|JU_ x5'<@L;w&...qiD WB@Z_nTr'MBBB@eCGs		!jKHHHHHHvd#4>H#4>z#E$$$$$$$^;$$!!!!!!!	 								I IHHHHHHHHHBBBBBBBB@ $$$$$$$$$$$!!!!!!!QjHP%`Y]'L @qqqDFDp	q6w>TR}.JlL*U?ouk5kV'11bbcM5mM{7@=wJjjj^Dwb8q8DFDYftD8BC,u'''b''>!=wl*U_?M>}JMMMdX9LX/F8{p|o~Qr}6Kw[n1P" G/CNNN>>pBCCILL---DnJd|^4v>k0eALLl
b;>As;992p`OA]o_ZjUFUJF3x`;t(l=wbh~'K*x}&''o^SR/u? m?n@PHOgg
VUlL}W^:DlL=1sLBCCK,
#hHJ%DFDVk8C{Mh4{NE6rN? ""#mEChh(3v7o~b[PVr9;v,Z~8rgg\3Z`J%'<@}noPT~5kdw.(G``86rR~\gl
[qFD8r; LhPk{QCZ~o5x\~asgW yggg?4D$ B@VHJL8::J=a	"  =wSJ"Ob'?~X<} JMkK&BXpq)MH?r<qGPZ5ZY7mO?Dbb"TT ~{~3U 
U0zumI"o^8!nAbXGK?}cWO@7/>0T*@WW>*M\C#G@WW,,,UZG}H77ipp01pqU1\3sV5mOE'JvT^ *UTS7o'7a(i0lJA#@h 4lX,c`U*l
'>bUe2Y?nss6oNlLa9+hZ,--,~__<<kah{"F===116&  HSpm)
u*r?9@{wVDKtL.]${1/]Dj5,ZDZpwwVK@@ %V*rBJXh8q7o0}4||PLb{`)Y{Z o__@6X_nnpAu^+?8p@EkIJjj*2L.	cV-uyq3RRx>jY={0qB}NNNw"\Ss:>>^ts ZMLL?kl]Ymf?FEE-LS9A%CRR!0%k&F&*}G~8p+=f_dD\\njJYf4H	r5<<cT5[. ~:wBnB!nyAIo=|(~\2\6mQW;y?%Z_-rL?}X)S*~ZO,,44Ljw/nnnX}
 hXf5uo".
UD4Z4XBtu_uZElVm3YJFj.DH\VyOON	IHp"XPT

X_DEG#&&SH!# 5Q^^|Bzh!rT#$m  wwwdPT(QJ\!.x%sAqQM2-QIL\O@&%ARhg{cO Y`\bbcM:"-A.S;d2YS5vJa62beED"T*$%%0hoooJU*%}BP^^J&k</,h<,^w9skZMl<jA$AX|E\eE:#jk
i|7n =-x(CSv+$n!p`Pp^c\m-r9.ZD=g2%9^+`& Ld+?nBBB()=vn!99Wnv,MkH\dmmmU*Oe'0H[mQ^0"MbS<d[4k%TVT@ FcR@@ kP3Ae=,?/WcPdePPPvd2s"#hL> )&_tTD!&&}9BB9s&g|4Nb9RXXjGN=!??[c52b9Yb1jG
qd;voT2{k,/+ s6l <[ZZlH HC\l$Ly%%&---&;o+LT@{{Ix^E{n@zz:t:$	v}#f[lEEw{5[lakIa_`Vx  %2`DFCG *
vY=z%j5u1eJ?)W}Vrx{{[#`\z$w^il  nflq?&p
D)4}"@DKt#C[ti!=zYekk+3w\SOoAS4o+h4"% 8H$&UV!K.GeEZZZdU^j#/?!B)amO.}hd81U*P [RJ'B&ALCC  1c8/1)"T*jkaV|Bh1P$Hbu+g?y8_jm8 1]` #4)I*N1aQ[[   ,_...U*5.kT-z {zz:T*U{xxzCzz:**+/XNgf437DyYs*
}R)<}q/[(J3f=	A}+Wb&iHOOH$\HJoI;4w_;@8 ]NzoL_)=YMu5z=BCCMAAApssqoJEKO?FlL/1=*p{{;U7bJC7fDV9V(((@PPfc FF~^j3#Q3W7B{G"s^XP*~f&Auuu5I&c{. 1[@-TU/Quo#T>;H%b{NS!s+j5:w^^^(3,*:pOeR~B!%:HKs k!Y9s;HtjiDZ%m-z
#z%!^030 JEtXC%~O=|7N}^l?  }b!2+x9
 ;GlF
!DYYY6{p|*--H$2)H,pH8dt1"2#YV(XCJ@H6QlQxFH$VECCECA"	1SX}X-XCvv@rT&Q
rA6)0bY`e2d3bop"44kczz+k6{zbtj5z ZW^1[o`okDLAIdWG.2ed ?V5jdh4"	BX3f8  )'sf+$w73'B4eYV(z8{{Q!	7kc^bukZH8?nI!Df-"f=.{3X<9533-0qI_9{3gI]g6rPUTTS3l EVQY"EV3$@\7xQzxggg:jjm\pbh(/ q
	d&!p6+W(BUfS9 ,c`" pGEMu5R{;A5$rJ* /$$Xle|}o'"==9997~<[TCe257Q5=maQT!\oUl>j;tWi5eeZtH2B4t!q 1[*	T9x{FiJj9fK+@&/dI}	 jtSBV3g:<;[ gdXF
yx0)05?5B!P$^+c@" kVk*(..6qd2P GTdC
rtYb1<_WhB`CF@@ br$<q$,;6A$QjEpF\.GZX9((,#G3<i_tG#N* ut&[aBH!_	B?MxX,FEJ~b};0UZ^5^3A8*VfE&%D"BCC9Z-}(Y=[S17r=Mz=3T2Qh$]\\ry 96#G\TK&QZZ`j	p&0.pstukRhj4l<J?LIAJE)vlMHQON!~nv:i4$[c'{wC}S;Jl}:WSgZy	[3c.Nt2LW =~,WpEjL>T/q-Y0KBVS0k1cbc6uzW)eT(B$Aa5@ ['5/u?-{&NJQ'?FFh7rbG^xJ%f*$v|tvvB.&fNd$+	s &^1o<7"="*DBifVvrq,Xl""_(@ >ilv8wwwdiiM(++$X,+[PYQWjYhX]QYYra \8i
vDu.2: 5sj0k{rg{:22OetrT XGwy`)L%Y(*D
#f+Tw6Q{)Ifh<|p['UN`gz
={kW\
lVVTP1 gLd2!K\}:{RS /*++MZ Lk+AL| 3g@)7vTVVRN|}}^*pY2:&l^{@wk%pwwZdO
DPPuxo@rbb"YKPI?nL#V+"TPNIdQA"?lD@lLLwpY5VfUjg'gNZk"D"k3\<ooR)GGjfX8 ;!k!KIS&
q
FqQbG:{5HR@,S#&d'zO1l0_qQQYQSRaJY]MHHU~X$@lMcert:py)Sm4deE&IP3j ;:UWW


0{-tHs$)Z	PGGY5l2fydoX5FMppVY2dn[ayylg3EdlU~5##"a?FT=94= N6y{ Y;>x=>555 ~HL*++1Kpk	[xDvlXTWWSDeFij5&R[jl]jB
fS QAl*EJ-$	f*"Ujh4rg2 Ihoowx#@w%H$ZAZ	5T*05!T*$-HaJ
8q86AuN'?Wpjc___zh4dV(z,wyl_@6
d3*!aML7Nrhabnnn6bhL_\T9L	DYl'
10psssxD"y[[[fmTRBoo@@!f./+C{{;$;9)=NBG^OF
$$$tKh4j}_`-fA?".\.:Nw	QQTPT[r'Y3\?)la}q@)qqq}]br3KKmfkh9'25P3W#kprhf1o"##}f]gh4v:T&F1
i!ey-1D\
khXBBBw\f`F7Eko4fP"`?ojj M6QT4G*do lLl,c?
i111|$Xb"r+AJ27#^3B?RvzM2M
<Tqij#,jUFb'W)SbGef!''*JM& ZN5RsVZZJUB=w;djabG:r$b4N_BqQ
7oRZ~7gh}||LZa{gdI?X h~I$jM$/Gu@2*Ue)0 11yyhim}
1/R1ajv-1'2Zl; $#
EeED"kKLFUyIvsss!
^j5k zc#;w]^^^9s&JKKk.6SHH([ZZJC~iD0yfD}bVhLk,Y@@CF=Gf'![IFANoF}||}}Fc
	FK!3*$$ hoo &"HH=B),UVA4eIc`nQ1sE=v_gcjwZBRaT*EjV344GV3MZ,:	"U|
dggSU(V|BO'5FZ8LL]etEYUp^
<111\ i"2yr{3>^\XnD&sg>`=!DaI#kv`@PpppHl"G+PY<24zhrL&C`` gwz+g9;^Q		AiI	WY<OS^d3gX,9N+bw/`0'Zrr6s#113N ZOvJ8BM8y9z|}Cs3E.z2xvEs:5,iE0K,Fee%oVkV5o,`qp:--8zYYkWf+HNNooo,Y&IX?2dc|hWhnn#EVZ-d2kJO
?ttt_
AkV<-[ !\~b{#=={0 #G  O>$O22PUU(L:Gcog}MM{?FtQnsJ'f|Gs_C
ou_`0wO?M)UUUI&9dqAA]c#fy566"=-GqNEKKbJeNQft;&	&W% uxzzb!8~8
T*qmDEEaAN?}_8sZm/f~)]`3 qkR[Xjj0+Rqrt1@RRU5)(srl*N5C*XQ[j.k~*W,%gk(:h;::PPP#x5);H=!xws,@EVwY bPp0mD'AZL#W4[cR=SS]1I4	3{:[:>(QqV2 b1v*gD|B!O[{;'QQd|jQ[[Kc09k1.vQ:x PPX]8CO	?~| }0E$W^ lz^@<xPZZ
ZMe	b1#a)OxS@&%;oJX,vh<x<PS][1d<x<x<9s&R?v <x)<x y<x<x <x|&~|~| <xO<<x<x'@<x<<x	<xOx<x<x <x <x\my+WP__+:`???N&#<xx0	PUUS?\]]%\]xDbcb0})CKKF!<"  t:J%ZZZ^XssaGD^ bH'VQc$;>q*QEeE1z~\sJjb1v_/;;J%bZYb1f^7nBj DFee%DFbk&g;{#Gtq|}=rrrLT*p "=
Zj >("""3=K.EBB\yYj5f-b1FYbM-sUdeeqN.#6&byI4	 lb8\,DGE!(8TuC=C^H-	rF3KEVu :l{Ye77 e3u=0JoV>e*.*B^~]tTt4;/  PTezT* $%%A %%eeo:tM&!q2Pem'4<lFNNS,RFBT*P(4ymkk+047Cu0*+*PYQauYj8qEI;B!^jgZBy  2Z_t466B.rEE(.*ySsHT=\BB!fi :4r+G)hmmE6lV!
@HH;TjL>l ---?T*1}:#"lB {NCCj5D"^{u;n_V1fH0A+VpOC,NB~d2;
!VeD+V`&~+1C  'FJE=yyCTt4bbbo;OP edDDkT*]K*GlTVT@*b]ra}6(ssBkH0pCV>}zP"qwwmRR(Af"`7nm2SZViu:&(7DU$OV#4,+V@HHHcx7V777Te2^|,#%'CRAPWt:bDYBiI	g8y2BP(PS]mjhh^H$$.[FZ|;V^Mm Rw!!!8}P]Scc}fyRPT\lb#?_QYi"
D"1R)))(--6J%rJkh}ir
jl^5Nm339+8

$m/Zr6 *H Jf uP(V(s==.\G `]f:VBSO =-=vVQ7hdfCBBB(v[ k^pKNC C"HR-6DFFb]Xb `Oj*^R. aaHJJd|dEEfI-@kE55 PO1GK6*H$Ga]rUdd2"e>|FVW!y=UO,^{1\ 0o6wD{[;==sVg#LxO&r}Gowg hb5hbH$*H$CDeZ %{BqhLE'?+VgaT*E'=.o(s.RTHOKFx`K,4,]cFPst:HyYII"nGbr_2-x;V`09BgEjj}6IME6(KNH$,vG- 5
}g!8bIf&alKN@ !o eO
jt|b),,DJJ
  **};tD"T*;gQ%#F"8-r}ynQ[ogE\  o`B~]kY-7CRQD"D"J2'|yb=H EEhY*=xwVp[]t	eeY]m YYYJEM0Lf2	\*W=#H e_x1x7QPP alZ+W85,YA;~bM/K v	\nQ^V2(
,1Zz5r9zBOq0 %;&EKKD"QkMLf+^aOj*Y{X/fQ(''J&LsU(/+3j$:jQxhB[  iT*vP(bBadIHOKC~^9eAyYUyhZU*-- UD5k8'7mrXyyi&UBB.]j<4>`A"@d{(227nMPVczBOY`Gl'aX
KJTbmh65U*y{?&yXF<hP[[K`08WXjj*:5[ rsst\.FR}!=]N?UOC U!\- (;[6o6}*
eeP(DhXXw]u5NjQ Cs'RSSkl4 ; L
/R\jVj&-6RP7Dkk+E~bbc@xD=mD"	J	P~~H'_J4JD_x14r9:fi9l73 l.l4>>>=n<~_7;HH~^x|B0h4TVTs(D'?sepET*Phf0]Xj#{OTTrss)T}AEa[aMNkdL@jjIQ	8s&f	i|<[~	B!x"/:$~r/d{4`$haNd$^ )5l2@AACX4o+<"IIIV)im>{df8|	a];wRgbH@!:
r:-Y 8t .pg?xO,_sI'p@:
:!9tP_P^VF}}CgzLJ`$zfQHpX @jnn E	cATFo`T*dddm "7!AL/[A/p)hyy};RRRwnFAxD)E~ K'6lYEEhii1&0*+Hg XhgP(
aC	 Erf}"@5PTT0efRH}6"&h|gBvK!PnnnVde2+$c tdZ-$&38JO{$$$ &6
Ndxg}
t>lK!kI:_tL3GbgHII1QW^DR=z@X->c$uB":d]MbkoogUZ
\\\W_52snW`#"VkvO4&#pI e"s"1fiZy)* Rq`JJp!Xr%6mDZW%j5oF3\.GPp04 `0USbfiRB\allz88e+I%n)TZXp!&Qn,Nb#uOkm	L,GeET*dHOKo(T'RY*FlejK<C{]D~$ix/*++hL/j.kecj7dq1{xxUE	^o?P5URQkAeeH$HOKCqq1:rD"*(HxQa?D4	\spKq?6% fQ*]^ke.+/tGD`P(x5)7?bo:.fcA	VXVZ5#Qk}}j$
!N='q6 j5oH!,N7I*rV7Tg'3&=`a..7
]z5Q
'   &%c-CJbCU\(2GHU\IAd3DEG#?/*0I$(
; Y{pD"8jd}O;RW(D9
NgKNfIuT9{"+Q	&4'3zoNI~[,VP*@,n}JE50&x	
vJ6X,ZF&Kd	T*<I6{4!1>91RJ#..4A{Et777*IZYdAL)U-2>IIIh4T:&mA~sG"22BzJycjS2AR7Twv7B!8@nJKyX`LgkA)':DFr`
s4f'?~*HPZoa=&XI,U~
OGGJ\_C$L 7	Z.BhZ:Z/H?Jc?Df8b D"*V5^~BjA^vN#Gl\nYa$.^l JF\$
hjMJnn555Tp3=Hk*YgVFoooxhdV(L(R:?/PpJ1VZurmV3x{CA`"'Nn{Gl7]aaf+@\.GeEBb,5L|0[D@&aM ?
Qa*@B_gbhVf+^ 1<X$b3hO IADB~	o`Rzj<y2z)W3H'k9jK'Bo%'_vh{,pN}?,,{>#i[\+\[D:P{
CG<y}~o@~wgbOj*r95OSSS)0!V
)D|,Mz1hR!,+7l2\Td!E'6LOK3!A2o
gkeLB~T*11  p
~~,vnwh"	kz8m	B__{mZc5A4t;5n=hiilec&!8zqj@H9\o&,KGR$>M,mpUTT?Booo#YGyy0z=, e&Jl`cxn:xLV90{11  :do9TwX HVbUf%%mU[[[AFF0L$92l0HF]rcl			
1MJ%@ @KK*8>  s>s5K&g<l4orJ$Yc&<b8v8:0~S!!LdyXYaaa%} 3gBRG2oRWJnr(UDJZreeXpdMOKnZNRaXp!B(uH"bCTK,?p L.K\~#1>l=R7F$#22IUSuMR`ve7dM&8xxd	BJ!	Y7reeM-IB6WXHHcjrdR[@
-e{5D"] `x"
(9!O=0mo\/))	III?	{Q/(HRa<L 1Hg_Bl2;gxxx (8*lFr<q#}#]dO+/+7k1GcefV&L2B"##k.cPXz5}=R6!TJP(4&a0&$pB46](%???o~?FJ;wgg'D"vM]'%%*Dozj`/H x6CDH$5n	D"B+3_'$ 	~Ae2J `% ?	2>,B+aNd2ab

buyel!AD'OL&NQ%6r9.o ][to~HRtvv/>S*+723>:M.\hQ
~s'"1QywVVN
GDW9QB@lK/\3lll6aymbd2!%%&%/d/qt%%fE{{Y}[G+T\zTz?Lg1gf
CRwh<q)))(.*L&c=3`M$	~~Tw4Z
Z 7l@#T%HR$%%T`k)b7XR3ia+rKHA2S


L$?:l%t_/=s^{&T~^{=IMXI~(9[tttHa!2><w\f7!A6lYU6d{7.X{?`dsrrLZ*m]c'W=5>++z[AK,ELS;w.c/VkKH,ajaf%KQ2FHN?KRID@E~_bL*IGEGc
l
yRPT\LIs.!*@[PTpssZCuu5
Fa%YerEE(.*I2f];wQBu\.U<]My
A!W#LHm*@ \NedLH$H3[c?[&Ha!M6}PHuw/JYC}jKR}22~i*F\\\>}3gee&Mf,]~
wHyx*HMMpFHD"xfOnn^h o ++}

%&&&r)d
:m#XKD`l(/+3	$H miKoT)"g\z11(.*LPT8f)Jedd Yn2!O?zi%:
 ,_k@sYz5-<3Z5]&/`@Ll0)0Q^VUWcHDea.&imm{q<$qwwL&CyYrJ	-4JKKqr$	*.*Byy9w?%mCXhhoOj*o&a	/BlAd^;&gWl,us/s"#QZRz444PJ[0|{T6fsyYl#Bmm-
hn
AAA6U3fLfH$H$V;	fMQ~n]	Hwaf#\.1"-5pGgX	Vr7ol;2gK`? &p5^7g)^b5.b;P^VXqr"hP[[kzXmA(.*Fa%@;^rK/isDVW<Lr.4fG]}=?:L???N/jpWPt4P([T=Khwk8xxx e@\o<@b/	\J8LB=<<T`_+CQVR=^X6v'DINpx&$3C,CVcOj*3='((.e3Qp\\._< h4Y$@^|r5=Yb5#"XbIUcn["+naZMHHRT*+(Edbbc-]61	6tp)fddd@P   Wbbc)+Q%=#(999P>iL,(hn6qN
X,Uy=fjY \R{!8<"11>curnPP(9k]hRl0P///mV~LzZZHJ1[AAA8RXJi?;v9xzj*TtT_6<+LMTk\3gBNNs>{$&jllDw lo`TVT ##			hmmR] uJJJ .3
\n0K,#{E<`rLL\bqI_
b',\wj-c-e5dm2;Fy0BcK;q`0 ij!`DsWdimi1qmZ9#]D[[K:Jw^{fjFQ1EVUQ_Zen>a\TRY\X,FVpOFFIo3G#*:5(<NdikkCR|},pN=qaei^S\DV1WlkQ^VZF{NE.Em|[hkMe2dR%gPOW"++\c5Fkm;y`iYZ
(E~I-$((811'ffu96e{6hUw5EF`l'O'/6l]ZKGQVC} 9 AzY;TAh>lCGB|D.~	zu QGe%z$_\sa*T9{xrBiE&	IMg1}^~),5{-bmU*Yk T?><xx<x	<xOx<x<x <x <xgu,~|~|yWx?9<x <x <x<x+?<xYr
rrrP_WvxG~}*+*PUU :u*VZ{(-)A}}!((<wQcE0uT$.[HPM^NN7T>m @{{;N;nxUUUeO? @}}=_#2fkz<+WJx5)	[6oJBVVVXtk Z
eeHOOK/'cr}) `J_Rc=,~yy4dx{~
<xp8j)~ :}  H( III  ,Uez$?w}S#P(dD?*Ox: 0!='HD"FSSGPDVY Oe'Hr L444PD[~~~6lCcb@  * } P(l&ND cpz>1@(-)AGGj5k/  b:'	UVVIGuMj8b92jjC;z[5vU*ooo"..WP D"+jU*uXueNj5 gegg#WNbbc`;   17oMEZJ7:yjZ\j/9N*H$JFADD??<_O?ef3gK1T
B,w'*QEeEFTT<<<fn =Y!31s,z361Fud|b1
6n[[T:m#6&b^Ts=zd^OMFaOj*ZZZ:n73HwssHLihh{gs>QPP a,9N------XrcNmm-Rv@KKHOKy:FRgO6(//D"Q
RR4 
&-[BG"^&q.{NCzz: `VYZbtL&UThmi\.Gii)JKK{u37VGwzCGD^D'EXh(\n6>X&? PYQ
,_". g!P(0V(3m& qF,ZHOK\.#1'2U*!H [!!!(,,[o{#77 b
Z~FefIzjBl  2j5'jhhZH$k6m777TWCV#4,7nDyY6m t:*
xBIMER	oooQ9Wzr#!!d|m%Z;vP>}:&;;;{RS,]j7!&M"Q4H!Bd]n'a1U3TAvZ NGrp
VBf
J%._lAC /HD%'CP [@ii){#mCT*B!>>Gd2$.[J
!%'c6[yyU*!J|?^rP
yN'#4,
56JzH$,ZEC. wy DeHOKC~^KK jj~^|rf Q!HRPYYI1N*hb>}
XM>+4ThZzxyyNR,226m=>^JLfru:-^GMu5B!E|||lN>Z___VXA]/$$%%%(/+CCCC;cmWL6@RBCRpO`t0[6Z"@PG?pZeB("))	7lC PYQen.N8ab
Jd2J?z'c#7W>FGH$U*es
G1q#%'S$)))Xp!BzYvm@ZZ=wE~!&
3b$"&aLc%6X$a&48(Lil\h X*(	X=X]x1U&++5k+LHBcc#Z-<<<z$? 777hZ4662#T"0(--H$*Ay9/
N~gzHd<, @BJe0= 9>>>XlB=)))3_jRRRL6/ux 4#+&d2rJ5f-HOKV5yJU&\f'Rx;Jt1$O":b*1	AQo%BvU 3D9dbH`@FFH	\f}?q}s5AbZ-g.Z2ZFGG>eEY*M}3CV}NePK,?
2{z{?j!f
-Ywww3	B>s6JiidXlw"Coj3z0TCwww$.[c!_ZZ
^TjF~oFm?=PYYRr7
!d:56%K,CTt4P(zLrY;~bQHOOGBAAFG"n$L@1- HWX,)Xwl{@ @ `@{{IP{{;XC~g<33!HyLF@Mb
L\_
f%n9(((@zZ}'2\L
|vzd2=sQ=i6md\d[PR$	CW~
3"4,BUUU8r*@ZJP %%2gO37V(wyM,wn5S',[RQ)geE1&kf& `\a T{YhEAbbUD.5>t<<<`&'SkJbkT@vss/EH@DWRQVkEZ3NwORsk6X"pd\UPhvxddd@P ((jB5k&\cbbc3Ez@E!lZeecT[^[~ ooof[~^TbM3ls]jQZZ
Ph"F4)01sLjjcZ?tKn9VYb,"TTVRj=#fVVT ,$lVV  <`<\nr/v6lV\i1U9K.w& "<EEP>lb
+9"s***^^^hhhVP(`^7!($>:*&.9I>2]S]\Hdb U <H$"ee9{l\x
7!			8}T*=jF8%&`:kkRyleD/Q!Q_#"$bz@E!J^L6^^^2YRii~~TATt4V\%KrZm[76'CX-X r#,)DxDV^`(
3p(Nm|=i=nnnP((`D)3*f\Vm_Ku}r1)`G[aQ\.7B6$r}1A.W;!)m3SJg:x7nQR*QS]TjX]_}n5kLF2?cWzR1Me\*$@t+!ANxQZZ
G7}U(hSCRXjj*g6@b.c,F[@b M~/ eNN$
zM[[6o,}*0e36[`\2hZ[c#@lq@ld$%.FI*@dF1s%$$@*$UXJy~qt`L.$$J nZII
:q}nD"Ae&QH5XL1^S82`B^^EiD@ J2K $ilZ+2 lYwS&F0}6G;1%.[LZCYl1U*
0w\L>g.RG`---=fTp5#XMK 4tiZ3- n^D6 \nSHEqQR+=-!F	

BPSTBq}zAH+VV{p&|eT8z~QF%y'e\@_|9OcO 7~g;i)[k(A7@HaM_llz.#   h4f!4h"jkkQ[[kRf1V-Ma#1DAnz=!
m c+,pd|J*q$ZGg-05}_ZZdcK.uA|&xh4(/+cM2Ik"
wAR(Y
p\^+fHA,7nDeERYP4Pkk	Z!q2*++[oEVu"GU BDb)dV)E6IW'l5\7pa8y2o`466R1*N,qqeGKWZ; t"=-
2*DMJuO/  
	1,0uTEV'|N,H8|[[[wsP\TD`L<lRV"ECC4&mo`6,QMd'B,Cmj|[^W@u0Z-j5j50K,GU4"TT(.*bUrzrYK}}}QYYiReH%