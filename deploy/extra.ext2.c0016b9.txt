                if x.height() > self.tg.path.height() and x not in lst:
                                lst.append(x)
                                add(x.parent)
                for x in self.source:
                        add(x.parent)
                return lst

        def write(self):
                Logs.debug('codelite: creating %r', self.path)
                #print "self.name:",self.name

                # first write the project file
                template1 = compile_template(PROJECT_TEMPLATE)
                proj_str = template1(self)
                proj_str = rm_blank_lines(proj_str)
                self.path.stealth_write(proj_str)

                # then write the filter
                #template2 = compile_template(FILTER_TEMPLATE)
                #filter_str = template2(self)
                #filter_str = rm_blank_lines(filter_str)
                #tmp = self.path.parent.make_node(self.path.name + '.filters')
                #tmp.stealth_write(filter_str)

        def get_key(self, node):
                """
                required for writing the source files
                """
                name = node.name
                if name.endswith(('.cpp', '.c')):
                        return 'sourcefile'
                return 'headerfile'

        def collect_properties(self):
                """
                Returns a list of triplet (configuration, platform, output_directory)
                """
                ret = []
                for c in self.ctx.configurations:
                        for p in self.ctx.platforms:
                                x = build_property()
                                x.outdir = ''

                                x.configuration = c
                                x.platform = p

                                x.preprocessor_definitions = ''
                                x.includes_search_path = ''

                                # can specify "deploy_dir" too
                                ret.append(x)
                self.build_properties = ret

        def get_build_params(self, props):
                opt = ''
                return (self.get_waf(), opt)

        def get_build_command(self, props):
                return "%s build %s" % self.get_build_params(props)

        def get_clean_command(self, props):
                return "%s clean %s" % self.get_build_params(props)

        def get_rebuild_command(self, props):
                return "%s clean build %s" % self.get_build_params(props)
                
        def get_install_command(self, props):
                return "%s install %s" % self.get_build_params(props)
        def get_build_and_install_command(self, props):
                return "%s build install %s" % self.get_build_params(props)
                
        def get_build_and_install_all_command(self, props):
                return "%s build install" % self.get_build_params(props)[0]
                
        def get_clean_all_command(self, props):
                return "%s clean" % self.get_build_params(props)[0]
        
        def get_build_all_command(self, props):
                return "%s build" % self.get_build_params(props)[0]
                
        def get_rebuild_all_command(self, props):
                return "%s clean build" % self.get_build_params(props)[0]

        def get_filter_name(self, node):
                lst = diff(node, self.tg.path)
                return '\\'.join(lst) or '.'

class vsnode_alias(vsnode_project):
        def __init__(self, ctx, node, name):
                vsnode_project.__init__(self, ctx, node)
                self.name = name
                self.output_file = ''

class vsnode_build_all(vsnode_alias):
        """
        Fake target used to emulate the behaviour of "make all" (starting one process by target is slow)
        This is the only alias enabled by default
        """
        def __init__(self, ctx, node, name='build_all_projects'):
                vsnode_alias.__init__(self, ctx, node, name)
                self.is_active = True

class vsnode_install_all(vsnode_alias):
        """
        Fake target used to emulate the behaviour of "make install"
        """
        def __init__(self, ctx, node, name='install_all_projects'):
                vsnode_alias.__init__(self, ctx, node, name)

        def get_build_command(self, props):
                return "%s build install %s" % self.get_build_params(props)

        def get_clean_command(self, props):
                return "%s clean %s" % self.get_build_params(props)

        def get_rebuild_command(self, props):
                return "%s clean build install %s" % self.get_build_params(props)

class vsnode_project_view(vsnode_alias):
        """
        Fake target used to emulate a file system view
        """
        def __init__(self, ctx, node, name='project_view'):
                vsnode_alias.__init__(self, ctx, node, name)
                self.tg = self.ctx() # fake one, cannot remove
                self.exclude_files = Node.exclude_regs + '''
waf-2*
waf3-2*/**
.waf-2*
.waf3-2*/**
**/*.sdf
**/*.suo
**/*.ncb
**/%s
                ''' % Options.lockfile

        def collect_source(self):
                # this is likely to be slow
                self.source = self.ctx.srcnode.ant_glob('**', excl=self.exclude_files)

        def get_build_command(self, props):
                params = self.get_build_params(props) + (self.ctx.cmd,)
                return "%s %s %s" % params

        def get_clean_command(self, props):
                return ""

        def get_rebuild_command(self, props):
                return self.get_build_command(props)

class vsnode_target(vsnode_project):
        """
        CodeLite project representing a targets (programs, libraries, etc) and bound
        to a task generator
        """
        def __init__(self, ctx, tg):
                """
                A project is more or less equivalent to a file/folder
                """
                base = getattr(ctx, 'projects_dir', None) or tg.path
                node = base.make_node(quote(tg.name) + ctx.project_extension) # the project file as a Node
                vsnode_project.__init__(self, ctx, node)
                self.name = quote(tg.name)
                self.tg     = tg  # task generator

        def get_build_params(self, props):
                """
                Override the default to add the target name
                """
                opt = ''
                if getattr(self, 'tg', None):
                        opt += " --targets=%s" % self.tg.name
                return (self.get_waf(), opt)

        def collect_source(self):
                tg = self.tg
                source_files = tg.to_nodes(getattr(tg, 'source', []))
                include_dirs = Utils.to_list(getattr(tg, 'codelite_includes', []))
                include_files = []
                for x in include_dirs:
                        if isinstance(x, str):
                                x = tg.path.find_node(x)
                        if x:
                                lst = [y for y in x.ant_glob(HEADERS_GLOB, flat=False)]
                                include_files.extend(lst)

                # remove duplicates
                self.source.extend(list(set(source_files + include_files)))
                self.source.sort(key=lambda x: x.abspath())

        def collect_properties(self):
                """
                CodeLite projects are associated with platforms and configurations (for building especially)
                """
                super(vsnode_target, self).collect_properties()
                for x in self.build_properties:
                        x.outdir = self.path.parent.abspath()
                        x.preprocessor_definitions = ''
                        x.includes_search_path = ''

                        try:
                                tsk = self.tg.link_task
                        except AttributeError:
                                pass
                        else:                                
                                x.output_file = tsk.outputs[0].abspath()
                                x.preprocessor_definitions = ';'.join(tsk.env.DEFINES)
                                x.includes_search_path = ';'.join(self.tg.env.INCPATHS)

class codelite_generator(BuildContext):
        '''generates a CodeLite workspace'''
        cmd = 'codelite'
        fun = 'build'

        def init(self):
                """
                Some data that needs to be present
                """
                if not getattr(self, 'configurations', None):
                        self.configurations = ['Release'] # LocalRelease, RemoteDebug, etc
                if not getattr(self, 'platforms', None):
                        self.platforms = ['Win32']
                if not getattr(self, 'all_projects', None):
                        self.all_projects = []
                if not getattr(self, 'project_extension', None):
                        self.project_extension = '.project'
                if not getattr(self, 'projects_dir', None):
                        self.projects_dir = self.srcnode.make_node('')
                        self.projects_dir.mkdir()

                # bind the classes to the object, so that subclass can provide custom generators
                if not getattr(self, 'vsnode_vsdir', None):
                        self.vsnode_vsdir = vsnode_vsdir
                if not getattr(self, 'vsnode_target', None):
                        self.vsnode_target = vsnode_target
                if not getattr(self, 'vsnode_build_all', None):
                        self.vsnode_build_all = vsnode_build_all
                if not getattr(self, 'vsnode_install_all', None):
                        self.vsnode_install_all = vsnode_install_all
                if not getattr(self, 'vsnode_project_view', None):
                        self.vsnode_project_view = vsnode_project_view

                self.numver = '11.00'
                self.vsver  = '2010'

        def execute(self):
                """
                Entry point
                """
                self.restore()
                if not self.all_envs:
                        self.load_envs()
                self.recurse([self.run_dir])

                # user initialization
                self.init()

                # two phases for creating the solution
                self.collect_projects() # add project objects into "self.all_projects"
                self.write_files() # write the corresponding project and solution files

        def collect_projects(self):
                """
                Fill the list self.all_projects with project objects
                Fill the list of build targets
                """
                self.collect_targets()
                #self.add_aliases()
                #self.collect_dirs()
                default_project = getattr(self, 'default_project', None)
                def sortfun(x):
                        if x.name == default_project:
                                return ''
                        return getattr(x, 'path', None) and x.path.abspath() or x.name
                self.all_projects.sort(key=sortfun)

        def write_files(self):
                """
                Write the project and solution files from the data collected
                so far. It is unlikely that you will want to change this
                """
                for p in self.all_projects:
                        p.write()

                # and finally write the solution file
                node = self.get_solution_node()
                node.parent.mkdir()
                Logs.warn('Creating %r', node)
                #a = dir(self.root)
                #for b in a:
                #        print b
                #print self.group_names
                #print "Hallo2:   ",self.root.listdir()
                #print getattr(self, 'codelite_solution_name', None)
                template1 = compile_template(SOLUTION_TEMPLATE)
                sln_str = template1(self)
                sln_str = rm_blank_lines(sln_str)
                node.stealth_write(sln_str)

        def get_solution_node(self):
                """
                The solution filename is required when writing the .vcproj files
                return self.solution_node and if it does not exist, make one
                """
                try:
                        return self.solution_node
                except:
                        pass

                codelite_solution_name = getattr(self, 'codelite_solution_name', None)
                if not codelite_solution_name:
                        codelite_solution_name = getattr(Context.g_module, Context.APPNAME, 'project') + '.workspace'
                        setattr(self, 'codelite_solution_name', codelite_solution_name)
                if os.path.isabs(codelite_solution_name):
                        self.solution_node = self.root.make_node(codelite_solution_name)
                else:
                        self.solution_node = self.srcnode.make_node(codelite_solution_name)
                return self.solution_node

        def project_configurations(self):
                """
                Helper that returns all the pairs (config,platform)
                """
                ret = []
                for c in self.configurations:
                        for p in self.platforms:
                                ret.append((c, p))
                return ret

        def collect_targets(self):
                """
                Process the list of task generators
                """
                for g in self.groups:
                        for tg in g:
                                if not isinstance(tg, TaskGen.task_gen):
                                        continue

                                if not hasattr(tg, 'codelite_includes'):
                                        tg.codelite_includes = tg.to_list(getattr(tg, 'includes', [])) + tg.to_list(getattr(tg, 'export_includes', []))
                                tg.post()
                                if not getattr(tg, 'link_task', None):
                                        continue

                                p = self.vsnode_target(self, tg)
                                p.collect_source() # delegate this processing
                                p.collect_properties()                               
                                self.all_projects.append(p)

        def add_aliases(self):
                """
                Add a specific target that emulates the "make all" necessary for Visual studio when pressing F7
                We also add an alias for "make install" (disabled by default)
                """
                base = getattr(self, 'projects_dir', None) or self.tg.path

                node_project = base.make_node('build_all_projects' + self.project_extension) # Node
                p_build = self.vsnode_build_all(self, node_project)
                p_build.collect_properties()
                self.all_projects.append(p_build)

                node_project = base.make_node('install_all_projects' + self.project_extension) # Node
                p_install = self.vsnode_install_all(self, node_project)
                p_install.collect_properties()
                self.all_projects.append(p_install)

                node_project = base.make_node('project_view' + self.project_extension) # Node
                p_view = self.vsnode_project_view(self, node_project)
                p_view.collect_source()
                p_view.collect_properties()
                self.all_projects.append(p_view)

                n = self.vsnode_vsdir(self, make_uuid(self.srcnode.abspath() + 'build_aliases'), "build_aliases")
                p_build.parent = p_install.parent = p_view.parent = n
                self.all_projects.append(n)

        def collect_dirs(self):
                """
                Create the folder structure in the CodeLite project view
                """
                seen = {}
                def make_parents(proj):
                        # look at a project, try to make a parent
                        if getattr(proj, 'parent', None):
                                # aliases already have parents
                                return
                        x = proj.iter_path
                        if x in seen:
                                proj.parent = seen[x]
                                return

                        # There is not vsnode_vsdir for x.
                        # So create a project representing the folder "x"
                        n = proj.parent = seen[x] = self.vsnode_vsdir(self, make_uuid(x.abspath()), x.name)
                        n.iter_path = x.parent
                        self.all_projects.append(n)

                        # recurse up to the project directory
                        if x.height() > self.srcnode.height() + 1:
                                make_parents(n)

                for p in self.all_projects[:]: # iterate over a copy of all projects
                        if not getattr(p, 'tg', None):
                                # but only projects that have a task generator
                                continue

                        # make a folder for each task generator
                        p.iter_path = p.tg.path
                        make_parents(p)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                