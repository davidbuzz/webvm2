52, 409, 451, 207, -47, -189, -270, -225, 10, 309, 485, 415, 161, -71, -224, -179, 80, 234, 151, 2, -78, -133, -141, 20, 260, 355, 233, 32, -60, -90, -95, -2, 90, 45, -42, -35, 21, 7, -9, 29, 36, -26, -31, 141, 305, 214, -41, -225, -288, -265, -104, 137, 248, 135, -74, -236, -291, -156, 195, 534, 465, -28, -473, -567, -370, -17, 310, 411, 194, -154, -373, -372, -116, 342, 688, 474, -198, -682, -664, -305, 157, 493, 517, 176, -258, -457, -342, 33, 503, 689, 318, -318, -667, -569, -198, 239, 520, 491, 155, -235, -407, -240, 137, 411, 312, -87, -453, -514, -265, 86, 307, 303, 155, 35, -33, 8, 232, 413, 243, -174, -440, -407, -190, 83, 316, 407, 292, 106, -68, -186, -49, 354, 537, 237, -158, -296, -230, -109, 36, 209, 314, 271, 143, 134, 354, 599, 545, 194, -98, -118, 30, 179, 271, 314, 316, 277, 263, 378, 523, 431, 90, -213, -244, 10, 354, 494, 398, 271, 211, 105, -55, -9, 286, 447, 295, 134, 110, 109, 19, -17, 207, 520, 619, 477, 298, 237, 215, 84, -61, 14, 265, 411, 334, 185, 198, 423, 673, 793, 750 },
        { 211, 369, 207, -113, -345, -269, 82, 378, 345, 91, -96, -70, 42, 39, -79, -178, -164, -41, 163, 335, 288, 20, -226, -234, -47, 131, 173, 82, -82, -185, -87, 161, 283, 124, -84, -77, 55, 48, -90, -146, -56, 69, 144, 166, 120, -14, -156, -166, -38, 93, 118, 75, 38, -13, -32, 74, 207, 136, -125, -291, -159, 122, 235, 112, -34, -48, 60, 221, 323, 180, -214, -533, -449, -18, 364, 401, 181, -55, -167, -105, 117, 326, 219, -189, -483, -347, 79, 380, 354, 136, -66, -118, -10, 172, 252, 40, -333, -483, -232, 175, 377, 275, 43, -135, -118, 116, 395, 427, 28, -514, -707, -383, 140, 464, 465, 240, -18, -106, 36, 231, 211, -133, -529, -572, -196, 268, 486, 407, 144, -129, -184, 49, 329, 304, -103, -563, -673, -333, 197, 567, 608, 365, 29, -165, -143, -22, -25, -246, -446, -341, 35, 370, 449, 291, 15, -192, -144, 109, 258, 78, -278, -480, -377, -72, 228, 398, 417, 321, 195, 74, -61, -214, -373, -461, -352, -42, 263, 329, 186, 58, 36, 69, 171, 293, 210, -155, -525, -590, -348, 14, 295, 387, 322, 234, 175, 121, 92, 18, -246, -569, -606, -249, 236, 451, 292, 17, -91, 58, 314, 458, 319, -179, -746, -890, -454, 222, 630, 551, 164, -202, -296, -63, 293, 455, 183, -368, -710, -518, 43, 502, 535, 205, -213, -402, -223, 175, 469, 342, -129, -513, -476, -79, 324, 430, 214, -103, -270, -150, 180, 435, 291, -201, -588, -492, -9, 428, 529, 346, 38, -243, -326, -159, 68, 107, -31, -133, -55, 121, 171, 62, -30, -21, 22, 100, 219, 184, -125, -452, -455, -94, 344, 512, 303, -53, -235, -110, 174, 353, 249, -153, -529, -489, -55, 375, 435, 168, -116, -208, -50, 277, 540, 497, 64, -530, -826, -566, 50, 574, 703, 439, -3, -325, -287, 45, 323, 211, -203, -480, -325, 96, 402, 436, 243, -33, -162, -24, 215, 281, 104, -202, -440, -404, -88, 281, 512, 564, 400, 50, -281, -360, -216, -37, 101, 144, 78, -58, -143, -42, 206, 381, 325, 144, -32, -178, -246, -148, 64, 204, 142, -71, -187, -29, 282, 488, 452, 212, -153, -451, -413, -49, 327, 395, 95, -274, -338, -24, 404, 672, 679, 424, -129, -725, -859, -415, 171, 461, 357, 69, -118, -19, 299, 556, 532, 167, -357, -683, -574, -134, 274, 357, 162, -6, 61, 313, 522, 461, 14, -578, -795, -447, 130, 510, 494, 140, -298, -467, -205, 278, 628, 621, 217, -352, -668, -492, -3, 362, 328, 11, -261, -230, 93, 440, 459, 54, -427, -544, -234, 188, 434, 374, 39, -337, -449, -193, 245, 588, 578, 142, -397, -605, -375, 20, 286, 305, 101, -164, -238, -27, 268, 331, 85, -244, -398, -270, 57, 385, 460, 166, -289, -550, -429, -18, 425, 580, 301, -142, -378, -296, -51, 197, 320, 159, -185, -385, -238, 129, 441, 452, 127, -256, -392, -248, -13, 175, 232, 85, -135, -188, -5, 212, 246, 71, -182, -299, -166, 118, 397, 549, 417, -47, -568, -720, -348, 250, 610, 520, 137, -204, -294, -173, 30, 194, 206, 44, -132, -150, 5, 188, 250, 164, 22, -46, -18, 14, 22, 24, 0, -16, 84, 266, 321, 154, -103, -269, -249, -11, 320, 502, 442, 227, -75, -360, -420, -136, 305, 539, 437, 193, -5, -84, -37, 83, 177, 176, 85, -14, -19, 83, 192, 218, 168, 144, 190, 227, 157, 2, -112, -123, 1, 256, 484, 476, 206, -120, -280, -201, 66, 421, 662, 592, 268, -117, -392, -404, -96, 358, 618, 516, 209, -6, -26, 83, 216, 284, 239, 111, -9, -43, 40, 214, 330, 273, 120, 39, 97, 206, 251, 184, 61, -5, 71, 258, 388, 327, 88, -158, -224, -63, 247, 527, 588, 386, 72, -198, -342, -262, 69, 457, 614, 438, 101, -163, -223, -49, 269, 505, 469, 203, -110, -296, -218, 120, 478, 552, 319, 6, -184, -194, -34, 227, 421, 411, 240, 20, -171, -203, -1, 270, 370, 287, 155, 51, -32, -57, 23, 149, 201, 167, 86, -19, -77, -12, 122, 206, 227, 251, 232, 83, -130, -241, -150, 57, 234, 268, 131, -46, -109, -38, 66, 141, 185, 156, 31, -106, -146, -40, 125, 222, 172, -13, -188, -196, -48, 115, 195, 208, 162, 29, -130, -213, -164, -22, 108, 152, 70, -78, -160, -108, 4, 80, 104, 91, 5, -126, -200, -158, -42, 71, 133, 93, -64, -233, -246, -76, 100, 142, 84, -28, -179, -285, -248, -65, 122, 174, 77, -117, -310, -342, -141, 126, 210, 80, -100, -239, -307, -252, -70, 110, 119, -20, -160, -251, -278, -162, 75, 209, 71, -190, -330, -313, -213, -59, 100, 129, -27, -207, -266, -262, -232, -84, 142, 209, -8, -283, -363, -287, -176, -29, 122, 113, -88, -266, -281, -235, -182, -30, 165, 166, -93, -348, -387, -301, -184, -3, 161, 115, -119, -282, -274, -236, -186, -48, 112, 95, -132, -321, -319, -242, -146, 10, 136, 33, -236, -384, -325, -188, -32, 144, 257, 121, -200, -424, -471, -404, -214, 54, 169, 0, -229, -289, -218, -117, 20, 163, 130, -133, -385, -427, -319, -151, 38, 132, 12, -197, -268, -206, -150, -86, 50, 142, 24, -214, -333, -298, -212, -99, 18, 36, -84, -189, -172, -116, -67, 20, 132, 96, -126, -320, -350, -269, -134, 25, 109, 35, -92, -149, -162, -146, -24, 154, 165, -53, -280, -375, -351, -188, 79, 268, 216, 9, -196, -333, -303, -41, 252, 268, 0, -270, -403, -389, -194, 138, 392, 373, 109, -242, -470, -401, -58, 285, 342, 86, -283, -509, -425, -92, 263, 451, 397, 103, -228, -347, -260, -140, -47, 30, 12, -114, -214, -176, -27, 172, 354, 333, 90, -156, -279, -366, -400, -232, 64, 261, 222, -9, -246, -304, -147, 77, 244, 312, 218, -75, -417, -558, -410, -96, 178, 252, 137, -26, -146, -147, 28, 244, 220, -89, -407, -507, -374, -100, 141, 208, 158, 109, 73, 62, 77, 15, -237, -489, -406, -66, 202, 163, -132, -385, -347, -22, 365, 596, 565, 217, -418, -977, -970, -415, 197, 433, 236, -75, -204, -102, 144, 397 },
    },
    {
        { -702, -580, 67, 598, 528, 85, -95, -3, -48, -185, -159, -133, -285, -346, -63, 269, 257, -42, -234, -37, 267, 316, 111, -145, -397, -655, -561, 99, 710, 572, -84, -437, -265, 17, 251, 437, 389, 50, -417, -700, -469, 90, 433, 340, 58, -200, -296, -47, 354, 403, 2, -397, -448, -115, 250, 210, -136, -212, 30, 197, 212, 236, 115, -338, -708, -446, 265, 662, 322, -293, -512, -223, 216, 475, 457, 168, -294, -607, -450, -24, 273, 316, 193, -26, -229, -179, 129, 388, 355, 117, -106, -189, -181, -231, -225, 33, 392, 442, 144, -104, -47, 115, 130, 142, 262, 216, -178, -515, -353, 118, 418, 443, 349, 163, -12, -116, -90, 91, 272, 248, 37, -90, -95, -93, -12, 283, 491, 271, -91, -54, 306, 371, -55, -472, -268, 356, 563, 191, -132, -45, 164, 168, 95, 228, 402, 208, -305, -566, -233, 336, 574, 401, 170, -4, -171, -178, 65, 308, 292, 90, -110, -222, -249, -105, 247, 516, 424, 98, -67, 50, 154, -2, -217, -166, 99, 220, 60, -45, 141, 311, 138, -42, 147, 440, 361, -86, -474, -475, -110, 304, 454, 319, 106, -145, -297, -2, 525, 633, 149, -366, -482, -312, -94, 154, 364, 313, 57, -169, -144, 127, 250, 53, -145, -99, -36, -127, -191, -9, 242, 197, -78, -147, 72, 233, 118, -141, -303, -207, -51, -28, -9, 110, 138, -107, -241, 90, 428, 177, -364, -518, -258, -24, 97, 218, 182, -90, -313, -201, 170, 421, 273, -132, -438, -502, -395, -123, 332, 620, 388, -149, -522, -397, 74, 411, 307, -72, -379, -506, -455, -146, 244, 348, 102, -137, -33, 215, 203, -90, -303, -220, -76, -66, -95, -15, -5, -222, -334, 41, 630, 719, 133, -541, -741, -474, -50, 330, 462, 153, -465, -800, -374, 432, 765, 441, 13, -222, -462, -630, -335, 237, 430, 72, -326, -255, 196, 467, 175, -338, -378, 0, 166, 7, -89, -110, -296, -422, 2, 686, 835, 266, -428, -676, -531, -205, 277, 655, 489, -211, -869, -720, 200, 979, 949, 297, -373, -739, -739, -307, 392, 734, 367, -270, -546, -188, 396, 601, 318, -54, -272, -330, -142, 178, 203, -208, -506, -149, 463, 654, 416, 110, -113, -273, -280, -20, 350, 440, 12, -580, -597, 65, 711, 778, 464, 116, -245, -483, -301, 216, 554, 398, -91, -463, -355, 71, 473, 664, 613, 182, -416, -548, -101, 290, 226, -5, -37, 149, 257, 96, -75, 110, 417, 331, -89, -253, -15, 113, -105, -173, 128, 396, 292, 101, 172, 275, 65, -196, -159, 61, 168, 89, -13, -28, 27, 119, 267, 445, 449, 177, -150, -280, -265, -196, 28, 358, 465, 206, -154, -320, -37, 503, 725, 415, -35, -309, -495, -517, -53, 589, 670, 150, -244, -111, 249, 406, 332, 188, 45, -129, -270, -192, 61, 222, 168, 37, -8, 118, 346, 521, 443, 52, -409, -507, -70, 485, 535, -10, -490, -328, 151, 407, 476, 559, 415, -208, -872, -711, 270, 936, 545, -299, -578, -164, 285, 395, 351, 239, -29, -340, -400, -80, 368, 490, 124, -315, -369, -60, 320, 575, 510, -23, -657, -696, -12, 620, 540, -86, -523, -381, 13, 327, 583, 598, 82, -627, -791, -249, 393, 546, 170, -319, -439, -111, 299, 472, 383, 105, -261, -441, -286, -28, 114, 115, -16, -185, -189, 103, 485, 527, 126, -330, -406, -88, 138, 25, -134, -53, 0, -202, -257, 170, 716, 692, 25, -581, -541, -35, 300, 175, -106, -142, -130, -311, -301, 215, 761, 645, 7, -408, -368, -228, -124, 107, 333, 182, -214, -348, -122, 106, 173, 252, 357, 218, -168, -447, -313, 75, 228, 33, -115, 6, 158, 96, -50, 13, 209, 185, -80, -255, -126, 84, 80, -70, -58, 92, 123, 158, 292, 211, -165, -405, -193, 197, 299, 78, -90, -88, -88, -112, 57, 481, 658, 254, -336, -549, -368, -70, 216, 448, 462, 89, -451, -556, 61, 813, 862, 148, -541, -571, -264, -55, 192, 535, 501, -127, -705, -391, 532, 976, 556, -173, -527, -413, -164, 67, 300, 362, 42, -386, -332, 249, 733, 610, 99, -311, -381, -206, 95, 367, 342, -53, -518, -499, 132, 767, 808, 320, -230, -500, -346, 153, 619, 538, -133, -766, -736, -40, 720, 964, 549, -67, -431, -426, -108, 390, 679, 368, -415, -867, -413, 366, 623, 420, 281, 239, -12, -263, -177, 126, 300, 154, -117, -181, -8, 135, 119, 137, 254, 234, 94, 43, -4, -196, -306, -115, 274, 519, 316, -208, -412, -8, 432, 366, 95, 84, 82, -268, -566, -243, 383, 589, 296, 31, 108, 196, -3, -208, -109, 138, 218, 64, -127, -156, -38, 117, 210, 281, 340, 257, 28, -141, -156, -138, -58, 151, 316, 150, -234, -369, -34, 408, 565, 447, 179, -193, -555, -628, -196, 445, 690, 278, -305, -446, -53, 401, 545, 421, 129, -201, -403, -336, 0, 339, 325, -4, -223, -75, 258, 459, 496, 345, -50, -434, -363, 170, 509, 245, -244, -304, 89, 362, 348, 348, 409, 246, -176, -411, -96, 499, 658, 122, -527, -453, 286, 762, 557, 217, 149, 71, -179, -193, 188, 519, 409, 36, -207, -149, 82, 433, 747, 654, 140, -384, -426, 42, 478, 504, 243, 11, -88, -66, 74, 354, 651, 662, 263, -245, -351, 6, 366, 361, 117, 2, 50, 157, 308, 396, 288, 69, 4, 209, 421, 284, -83, -243, -49, 188, 259, 315, 403, 333, 66, -139, -43, 277, 487, 364, 32, -164, -140, -113, -84, 169, 588, 734, 335, -207, -308, 27, 244, 136, 24, 142, 233, -53, -387, -232, 297, 614, 451, 101, -37, 45, 31, -139, -197, 29, 264, 167, -74, -138, -34, 53, 126, 326, 505, 334, -147, -479, -382, -49, 149, 134, 183, 266, 70, -330, -430, 4, 536, 593, 146, -317, -424, -262, -95, 0, 108, 173, 77, -109, -170, -23, 183, 227, 20, -229, -230, -66, -38, -105, -71, -27, -143, -271, -65, 345, 405, 24, -366, -432, -231, -45, 8, 79, 127, -107, -482, -479, 18, 423, 308, -83, -296, -300, -333, -306, -88, 221, 282, -49, -426, -460, -112, 186, 91, -234, -338, -171, -84, -139, -110, -3, -109, -420 },
        { 447, 495, 116, -314, -428, -225, 62, 304, 456, 396, 98, -208, -263, -33, 230, 350, 398, 432, 313, 27, -150, -44, 189, 298, 257, 170, 31, -138, -157, 77, 404, 508, 361, 184, 96, 57, 9, 50, 193, 266, 129, -122, -271, -207, 25, 345, 615, 614, 299, -68, -182, -5, 234, 341, 358, 363, 245, -11, -134, 50, 352, 523, 516, 405, 210, -56, -204, -15, 410, 676, 538, 182, -75, -107, 38, 250, 422, 461, 341, 147, 6, 35, 225, 422, 535, 477, 213, -116, -278, -188, 48, 307, 496, 589, 525, 289, 36, 5, 197, 350, 286, 89, -41, -94, -118, -10, 295, 614, 678, 472, 204, 14, -94, -79, 75, 276, 331, 185, 30, 27, 131, 258, 383, 421, 301, 93, -61, -78, 12, 106, 169, 234, 329, 354, 186, -6, 31, 202, 271, 206, 133, 126, 119, 15, -86, 19, 289, 462, 407, 241, 69, -93, -190, -123, 75, 182, 137, 81, 140, 263, 329, 355, 399, 360, 135, -119, -204, -87, 90, 174, 218, 314, 393, 326, 175, 143, 246, 268, 151, 71, 104, 111, 4, -85, 10, 267, 447, 407, 285, 244, 252, 214, 116, 52, 38, 1, -22, 62, 260, 385, 322, 222, 236, 269, 186, 48, -22, 10, 58, 32, 15, 85, 167, 207, 281, 421, 462, 231, -95, -202, -72, 89, 139, 102, 59, 38, 47, 149, 421, 688, 609, 147, -311, -420, -218, 39, 246, 438, 487, 266, -48, -110, 133, 427, 494, 294, 12, -208, -323, -312, -116, 224, 506, 588, 507, 296, -15, -272, -329, -164, 99, 251, 190, -23, -225, -264, -62, 384, 856, 951, 470, -295, -824, -844, -409, 229, 752, 871, 478, -115, -396, -184, 288, 646, 644, 280, -289, -763, -772, -261, 425, 852, 843, 542, 119, -277, -437, -280, 26, 212, 152, -87, -275, -275, -164, 20, 325, 637, 633, 199, -373, -719, -721, -436, 64, 545, 747, 475, -149, -601, -514, -13, 516, 728, 471, -138, -717, -857, -476, 154, 597, 574, 208, -195, -414, -329, -15, 327, 405, 20, -515, -725, -486, -29, 371, 584, 530, 178, -297, -523, -398, -159, -31, -65, -122, -105, -32, 35, 120, 226, 238, 131, 41, 39, -19, -214, -352, -254, 0, 190, 221, 149, 10, -157, -205, -11, 332, 505, 201, -364, -669, -508, -96, 276, 515, 525, 197, -290, -554, -375, 23, 242, 111, -163, -313, -331, -243, 35, 432, 578, 268, -224, -479, -373, -186, -113, -62, 62, 134, 22, -89, -23, 81, 10, -131, -44, 260, 385, 102, -338, -558, -425, -82, 287, 571, 551, 159, -331, -543, -330, 67, 299, 239, 12, -202, -317, -223, 81, 358, 358, 88, -223, -373, -304, -79, 146, 219, 135, -8, -93, -18, 111, 107, -33, -113, -1, 205, 347, 356, 165, -212, -508, -389, 99, 498, 500, 210, -94, -244, -231, -61, 192, 337, 235, -42, -275, -266, -40, 182, 290, 310, 209, -23, -197, -120, 93, 150, 22, -43, 25, 53, -21, -61, 15, 146, 153, 57, 111, 323, 327, -67, -455, -342, 127, 396, 260, -22, -171, -135, -9, 158, 411, 605, 447, -50, -504, -507, -80, 361, 518, 383, 18, -349, -384, -40, 367, 484, 252, -72, -257, -255, -114, 84, 231, 219, 52, -105, -96, 65, 186, 127, 7, -20, 11, 5, -15, -14, -26, -42, 24, 179, 301, 272, 89, -149, -300, -261, -34, 239, 343, 184, -108, -287, -219, 36, 324, 500, 440, 88, -395, -671, -499, 60, 541, 530, 162, -172, -255, -107, 156, 416, 479, 175, -317, -632, -550, -116, 332, 500, 401, 132, -148, -217, -5, 242, 246, 45, -151, -229, -228, -185, -92, 24, 102, 120, 123, 191, 243, 79, -264, -484, -380, -49, 167, 102, -62, -173, -205, -111, 139, 402, 394, 16, -441, -604, -401, -4, 339, 448, 246, -155, -448, -361, 27, 345, 312, -1, -331, -485, -430, -201, 126, 376, 350, 87, -164, -247, -194, -127, -101, -108, -155, -212, -193, -65, 104, 180, 102, 18, 18, -16, -153, -324, -380, -279, -167, -96, 29, 205, 245, 131, 19, 19, 79, 72, -37, -209, -364, -435, -297, 2, 272, 366, 250, 55, -90, -151, -74, 113, 259, 194, -143, -520, -525, -130, 293, 480, 420, 189, -114, -316, -249, 62, 357, 324, -34, -352, -328, -55, 216, 371, 386, 193, -160, -415, -349, 14, 364, 375, 135, -83, -233, -331, -276, -12, 267, 327, 157, -53, -135, -111, -148, -267, -239, 24, 225, 185, 90, 40, -42, -127, -76, 105, 239, 140, -121, -306, -271, -95, 84, 241, 335, 181, -231, -506, -319, 152, 439, 357, 78, -242, -483, -479, -146, 314, 511, 300, -131, -436, -405, -131, 124, 195, 91, -83, -256, -355, -283, -71, 97, 111, 49, -16, -73, -97, -108, -192, -325, -343, -193, 7, 104, 56, -74, -178, -161, -56, 81, 229, 256, 13, -388, -558, -311, 62, 208, 112, -79, -248, -302, -212, 7, 282, 390, 146, -327, -643, -545, -188, 104, 233, 214, -14, -332, -434, -245, 2, 66, -40, -114, -126, -220, -366, -373, -171, 48, 55, -65, -47, 95, 56, -285, -574, -446, -73, 118, 0, -174, -216, -244, -329, -283, 34, 352, 287, -164, -622, -743, -514, -65, 354, 487, 210, -336, -745, -713, -297, 202, 467, 363, -35, -499, -740, -594, -156, 257, 350, 111, -226, -420, -395, -216, 17, 168, 130, -64, -281, -384, -313, -150, 9, 176, 277, 150, -131, -283, -240, -173, -152, -93, 24, 67, -58, -261, -346, -211, 60, 272, 296, 223, 75, -248, -614, -730, -417, 90, 339, 220, -24, -230, -337, -259, 37, 436, 613, 291, -323, -726, -616, -151, 233, 329, 247, 72, -195, -410, -301, 139, 517, 479, 84, -305, -427, -313, -137, 24, 168, 215, 93, -112, -202, -104, 35, 102, 94, 47, -87, -312, -453, -370, -110, 130, 223, 191, 114, 49, -75, -269, -414, -365, -172, -35, -1, -7, -20, -79, -130, -42, 145, 232, 103, -128, -273, -249, -169, -122, -45, 65, 88, -15, -124, -91, 42, 104, 58, 8, -16, -77, -174, -218, -166, -50, 43, 85, 123, 110, 0, -117, -103, -1, 44, -55, -214, -221, -58, 75, 30, -90, -78, 35, 101, 122, 197, 256 },
        { 298, 102, -206, -339, -192, 72, 216, 192, 104, 13, -69, -71, 82, 256, 215, -8, -159, -153, -117, -105, -14, 153, 240, 183, 80, 42, 0, -138, -235, -115, 135, 257, 154, -52, -201, -187, 22, 330, 516, 423, 18, -491, -719, -466, 49, 470, 573, 313, -121, -378, -248, 95, 286, 151, -145, -325, -249, -14, 191, 243, 119, -63, -131, -1, 168, 116, -168, -392, -316, -17, 261, 361, 239, -54, -309, -290, -17, 234, 225, -25, -293, -357, -185, 116, 383, 410, 134, -239, -425, -314, -41, 153, 145, 13, -102, -134, -69, 88, 216, 142, -87, -243, -198, -33, 102, 111, 8, -110, -180, -146, 28, 233, 256, 46, -216, -301, -169, 48, 206, 196, 8, -224, -311, -172, 87, 255, 236, 111, -49, -216, -301, -211, 18, 221, 213, 18, -139, -124, -14, 40, 24, 27, 55, 18, -80, -142, -127, -67, 5, 82, 153, 201, 149, -35, -217, -262, -139, 75, 229, 185, -45, -248, -241, -69, 129, 260, 265, 124, -116, -316, -310, -89, 161, 225, 81, -65, -68, 8, 60, 64, 61, 55, -5, -109, -147, -70, 32, 77, 86, 93, 86, 61, 13, -37, -70, -89, -61, 46, 180, 182, 14, -148, -156, -60, 50, 159, 210, 136, -52, -222, -197, 4, 164, 135, 22, -9, 20, 6, -17, 37, 153, 192, 52, -173, -274, -157, 54, 182, 208, 200, 136, -5, -129, -130, -64, -31, 0, 79, 138, 88, -31, -95, -76, -22, 68, 198, 289, 199, -88, -362, -367, -109, 177, 336, 327, 126, -197, -399, -256, 134, 446, 423, 65, -348, -482, -260, 106, 372, 421, 237, -80, -318, -294, -67, 109, 132, 84, 19, -56, -93, -36, 48, 64, 28, 14, 70, 113, -11, -264, -366, -141, 223, 427, 393, 162, -211, -518, -474, -69, 341, 434, 194, -161, -360, -269, 9, 290, 418, 281, -78, -399, -411, -149, 102, 186, 145, 69, -25, -131, -156, -36, 135, 191, 106, 3, -68, -161, -228, -154, 46, 219, 223, 91, -56, -160, -182, -69, 168, 350, 216, -177, -464, -397, -55, 301, 461, 354, 41, -288, -391, -181, 159, 330, 158, -186, -357, -206, 109, 358, 386, 151, -193, -354, -178, 122, 217, 69, -109, -177, -116, 42, 209, 253, 111, -102, -186, -51, 177, 228, 9, -260, -318, -149, 99, 308, 356, 168, -121, -217, -45, 154, 173, -4, -254, -360, -194, 126, 396, 483, 299, -94, -397, -327, 4, 201, 100, -122, -240, -158, 52, 280, 407, 308, -20, -355, -384, -95, 197, 247, 91, -125, -280, -265, -43, 265, 420, 290, 5, -170, -156, -85, -61, -68, -76, -62, -1, 99, 175, 165, 64, -67, -96, 16, 103, 30, -139, -244, -196, -34, 159, 306, 295, 75, -201, -286, -139, 46, 133, 144, 85, -72, -237, -243, -45, 218, 372, 309, 83, -152, -281, -259, -124, 40, 134, 99, -2, -55, -32, 52, 180, 268, 206, -26, -281, -352, -180, 71, 186, 140, 76, 35, -43, -94, 13, 198, 208, 8, -172, -173, -53, 32, 29, 15, 51, 103, 107, 60, 11, -30, -83, -92, -1, 126, 175, 97, -71, -213, -215, -45, 246, 456, 336, -80, -444, -450, -116, 246, 361, 206, -66, -265, -238, 34, 355, 419, 122, -272, -435, -275, 58, 315, 323, 106, -126, -201, -96, 98, 217, 144, -51, -173, -133, -8, 106, 148, 60, -105, -147, 28, 241, 259, 58, -191, -303, -201, 26, 223, 291, 186, -92, -358, -339, 0, 361, 416, 144, -208, -360, -223, 46, 247, 272, 95, -188, -340, -192, 137, 345, 292, 65, -185, -317, -232, 22, 231, 205, -1, -155, -113, 24, 99, 77, 0, -97, -159, -96, 89, 235, 180, -54, -270, -273, -61, 160, 226, 125, -62, -197, -174, 8, 230, 280, 63, -234, -344, -222, -1, 213, 323, 205, -102, -333, -278, -26, 182, 210, 97, -37, -138, -203, -163, 23, 218, 237, 87, -78, -173, -197, -140, 13, 198, 239, 46, -211, -285, -96, 168, 243, 122, -9, -89, -172, -185, -6, 208, 161, -79, -206, -126, 47, 174, 159, 21, -108, -123, -46, 78, 170, 60, -210, -332, -133, 198, 382, 308, 35, -284, -423, -245, 134, 432, 379, -36, -464, -518, -160, 320, 589, 464, 7, -468, -588, -263, 215, 457, 298, -103, -409, -368, -46, 314, 476, 318, -68, -389, -371, -51, 235, 234, 46, -105, -151, -127, -54, 70, 166, 153, 87, 104, 204, 193, -50, -390, -539, -330, 89, 423, 473, 228, -143, -364, -257, 78, 328, 232, -116, -379, -335, -62, 205, 359, 382, 183, -203, -457, -323, 51, 298, 274, 101, -114, -290, -308, -104, 214, 437, 405, 121, -188, -314, -258, -130, 15, 145, 191, 118, -6, -94, -104, -32, 93, 238, 339, 263, -18, -330, -443, -298, -19, 229, 337, 243, 4, -182, -153, 32, 157, 120, 7, -83, -127, -139, -97, 34, 193, 264, 182, -13, -173, -193, -100, 28, 146, 194, 104, -96, -247, -211, -31, 184, 367, 387, 134, -246, -449, -338, -38, 202, 234, 119, -5, -96, -146, -81, 119, 278, 180, -99, -269, -190, 16, 130, 76, -26, -43, 8, 34, 26, 35, 35, -23, -79, -26, 59, 38, -64, -135, -147, -92, 79, 295, 352, 131, -234, -459, -383, -78, 218, 302, 168, -43, -212, -249, -108, 149, 356, 302, -16, -347, -425, -219, 69, 233, 192, 21, -134, -157, -49, 88, 131, 44, -63, -93, -93, -133, -142, -43, 78, 114, 86, 41, -29, -120, -163, -119, -12, 99, 143, 70, -52, -132, -160, -157, -85, 95, 237, 148, -94, -241, -183, -9, 104, 74, 1, -29, -64, -125, -120, 3, 133, 112, -39, -145, -122, -35, 11, -7, -41, -56, -32, 26, 85, 67, -54, -178, -170, -18, 133, 134, -16, -179, -223, -154, -21, 158, 338, 318, 0, -383, -506, -283, 88, 332, 281, 6, -236, -296, -189, 31, 284, 364, 115, -275, -465, -315, 10, 260, 295, 130, -106, -257, -235, -46, 163, 176, -24, -214, -204, -24, 148, 175, 63, -100, -221, -200, -14, 198, 231, 36, -196, -268, -134, 83, 221, 210, 54, -173, -336, -284, 10, 370, 482, 200, -241, -487, -386, -61, 250, 359, 168, -182, -374, -230, 116 },
    },
    {
        { 363, 272, -59, -204, 33, 329, 261, -80, -318, -226, 2, 86, 166, 330, 372, 136, -163, -128, 190, 349, 184, -72, -210, -231, -170, 19, 336, 521, 322, -124, -332, 11, 528, 523, -47, -491, -312, 118, 206, 53, 97, 235, 112, -122, -46, 301, 486, 283, -171, -459, -294, 89, 261, 192, 126, 94, -56, -175, 71, 429, 401, 49, -241, -307, -181, 62, 248, 284, 155, -111, -279, -86, 377, 574, 218, -284, -375, -99, 103, 132, 113, 75, -14, -116, -60, 217, 467, 345, -78, -413, -323, 16, 181, 144, 134, 131, -62, -292, -131, 379, 623, 298, -171, -400, -367, -169, 142, 376, 259, -169, -483, -225, 442, 809, 427, -300, -589, -302, -12, 32, 130, 255, 69, -347, -496, -59, 633, 894, 368, -467, -781, -397, 103, 268, 221, 88, -173, -412, -270, 232, 578, 407, -48, -296, -246, -127, -43, 66, 88, -136, -394, -309, 151, 534, 464, 20, -350, -341, -126, 73, 230, 235, -147, -638, -621, -11, 571, 652, 297, -189, -413, -320, -154, 21, 211, 215, -148, -497, -282, 269, 432, 109, -171, -139, 12, 3, -64, -2, 0, -272, -487, -132, 507, 624, 62, -495, -418, 3, 173, 129, 179, 181, -207, -740, -668, 107, 758, 654, 104, -249, -203, -91, -144, -170, -24, 90, -45, -228, -122, 62, 27, -97, 22, 310, 353, 77, -169, -197, -217, -324, -310, 31, 389, 286, -157, -353, -137, 103, 241, 386, 368, -3, -547, -715, -280, 245, 301, -5, -170, 41, 231, 111, -29, 55, 127, -9, -160, -130, -57, -119, -270, -238, 44, 330, 356, 170, -13, -140, -283, -318, -49, 296, 274, -140, -440, -234, 125, 180, 76, 177, 284, 50, -348, -415, -81, 198, 103, -162, -183, 86, 275, 166, 0, -3, 22, -99, -215, -97, 32, -35, -137, -106, 21, 165, 274, 242, 74, -66, -119, -149, -135, -57, -67, -215, -202, 80, 279, 226, 149, 119, 0, -174, -126, 157, 251, -89, -546, -565, -57, 441, 459, 165, -15, -10, -16, -98, -63, 125, 162, -126, -423, -359, -27, 228, 298, 286, 122, -179, -267, 35, 366, 241, -236, -555, -294, 214, 287, 24, -54, 67, 9, -196, -65, 406, 600, 159, -531, -825, -413, 327, 710, 493, 3, -418, -528, -189, 346, 593, 331, -252, -685, -550, 39, 541, 637, 359, -118, -503, -399, 205, 591, 258, -328, -467, -203, 14, 123, 286, 372, 152, -186, -225, 173, 518, 305, -296, -669, -442, 78, 417, 432, 251, 7, -259, -336, 47, 628, 753, 225, -479, -791, -557, 1, 570, 778, 465, -118, -563, -379, 293, 700, 452, -56, -371, -506, -428, 24, 546, 593, 147, -342, -417, 78, 657,#include <AP_HAL/AP_HAL.h>

struct GyroFrame {
    float x[1024];
    float y[1024];
    float z[1024];
};

extern const GyroFrame gyro_frames[];
extern const uint32_t NUM_FRAMES;
extern const uint16_t SAMPLE_RATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #!/usr/bin/env python

'''
extract ISBH and ISBD messages from AP_Logging files and produce C++ arrays for consumption by the DSP subsystem
'''
from __future__ import print_function

import os
import sys
import time
import copy
import numpy

from argparse import ArgumentParser

parser = ArgumentParser(description=__doc__)
parser.add_argument("--condition", default=None, help="select packets by condition")
parser.add_argument("logs", metavar="LOG", nargs="+")

args = parser.parse_args()

from pymavlink import mavutil

def isb_parser(logfile):
    '''display fft for raw ACC data in logfile'''

    '''object to store data about a single FFT plot'''
    class ISBData(object):
        def __init__(self, ffth):
            self.seqno = -1
            self.fftnum = ffth.N
            self.sensor_type = ffth.type
            self.instance = ffth.instance
            self.sample_rate_hz = ffth.smp_rate
            self.multiplier = ffth.mul
            self.data = {}
            self.data["X"] = []
            self.data["Y"] = []
            self.data["Z"] = []
            self.holes = False
            self.freq = None

        def add_isb(self, fftd):
            if fftd.N != self.fftnum:
                print("Skipping ISBD with wrong fftnum (%u vs %u)\n" % (fftd.fftnum, self.fftnum), file=sys.stderr)
                return
            if self.holes:
                print("Skipping ISBD(%u) for ISBH(%u) with holes in it" % (fftd.seqno, self.fftnum), file=sys.stderr)
                return
            if fftd.seqno != self.seqno+1:
                print("ISBH(%u) has holes in it" % fftd.N, file=sys.stderr)
                self.holes = True
                return
            self.seqno += 1
            self.data["X"].extend(fftd.x)
            self.data["Y"].extend(fftd.y)
            self.data["Z"].extend(fftd.z)

        def prefix(self):
            if self.sensor_type == 0:
                return "Accel"
            elif self.sensor_type == 1:
                return "Gyro"
            else:
                return "?Unknown Sensor Type?"

        def tag(self):
            return str(self)

        def __str__(self):
            return "%s[%u]" % (self.prefix(), self.instance)

    mlog = mavutil.mavlink_connection(logfile)

    isb_frames = []
    isbdata = None
    msgcount = 0
    start_time = time.time()
    while True:
        m = mlog.recv_match(condition=args.condition)
        if m is None:
            break
        msgcount += 1
        if msgcount % 1000 == 0:
            sys.stderr.write(".")
        msg_type = m.get_type()
        if msg_type == "ISBH":
            if isbdata is not None:
                sensor = isbdata.tag()
                isb_frames.append(isbdata)
            isbdata = ISBData(m)
            continue

        if msg_type == "ISBD":
            if isbdata is None:
                sys.stderr.write("?(fftnum=%u)" % m.N)
                continue
            isbdata.add_isb(m)

    print("", file=sys.stderr)
    time_delta = time.time() - start_time
    print("Extracted %u fft data sets" % len(isb_frames), file=sys.stderr)

    sample_rates = {}
    counts = {}

    print("#include \"GyroFrame.h\"")
    print("const uint32_t NUM_FRAMES = %d;" % len(isb_frames))
    print("const GyroFrame gyro_frames[] = {")

    sample_rate = None
    for isb_frame in isb_frames:
        if isb_frame.sensor_type == 1 and isb_frame.instance == 0:  # gyro data
            print("    {")

            for axis in [ "X","Y","Z" ]:
                # normalize data
                d = numpy.array(isb_frame.data[axis]) # / float(isb_frame.multiplier)
                print("        { " + ", ".join(d.astype(numpy.dtype(str))) + " },")

                if len(d) == 0:
                    print("No data?!?!?!", file=sys.stderr)
            if sample_rate is None:
                sample_rate = isb_frame.sample_rate_hz
            print("    },")

    print("};")
    print("const uint16_t SAMPLE_RATE = %d;" % sample_rate)    



for filename in args.logs:
    isb_parser(filename)
                                                #!/usr/bin/env python
# encoding: utf-8

def build(bld):
    bld.ap_example(
        use='ap',
    )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
/*
    Printf.cpp: We demonstrate the use of the printf() and snprintf() functions
*/
#include <AP_Common/AP_Common.h>
#include <AP_HAL/AP_HAL.h>

void setup();    // declaration of the setup() function
void loop();     // declaration of the loop() function

const AP_HAL::HAL& hal = AP_HAL::get_HAL();    // create a reference to AP_HAL::HAL object to get access to hardware specific functions. For more info see <https://ardupilot.org/dev/docs/learning-ardupilot-the-example-sketches.html/>

// the setup function runs once when the board powers up
void setup(void) {
    hal.console->printf("Starting Printf test\n");    // print a starting message
}

//create a struct array float_tests
static const struct {
    // holds the char sequence representing the format specifier
    const char *fmt;
    // holds a float value    
    float v;    
    // holds the char sequence that would be printed in accordance with the format specifier defined(fmt)  
    const char *result; 
} float_tests[] = {
    { "%f", 3.71f, "3.710000" },
    { "%.1f", 3.71f, "3.7" },
    { "%.1f", 3.75f, "3.8" },
    { "%.2f", 3.75f, "3.75" },
    { "%.7f", 3.75f, "3.750000" },
    { "%f", 10.4f, "10.40000" },
    { "%f", 10.6f, "10.60000" },
    { "%f", 1020.4f, "1020.400" },
    { "%f", 1030.6f, "1030.600" },
    { "%f", 10.123456f, "10.12346" },
    { "%f", 102.123456f, "102.1235" },
    { "%f", 1020.123456f, "1020.123" },
    { "%.6f", 10.123456f, "10.12346" },
    { "%.6f", 102.123456f, "102.1235" },
    { "%.6f", 1020.123456f, "1020.123" },
    { "%f", 10304052.6f, "1.030405e+07" },
    { "%f", 103040501.6f, "1.030405e+08" },
    { "%f", 1030405023.6f, "1.030405e+09" },
    { "%f", -1030.6f, "-1030.600" },
    { "%f", -10304052.6f, "-1.030405e+07" },
    { "%f", -103040501.6f, "-1.030405e+08" },
    { "%f", -1030405023.6f, "-1.030405e+09" },
    { "%e", 103040501.6f, "1.030405e+08" },
    { "%g", 103040501.6f, "1.03041e+08" },
    { "%e", -103040501.6f, "-1.030405e+08" },
    { "%g", -103040501.6f, "-1.03041e+08" },
    { "%.0f", 10.4f, "10" },
    { "%.0f", 10.6f, "11" },
    { "%.1f", 10.4f, "10.4" },
    { "%.1f", 10.6f, "10.6" },
};

// test_printf_floats(void) : tests the printf() and snprintf() function against the float numbers defined in float_tests
static void test_printf_floats(void)
{
    hal.console->printf("Starting Printf floats test\n");
    uint8_t i;
    // 30 bytes long char buffer(Expected length of string : 29)
    char buf[30];
    uint8_t failures = 0;
    hal.console->printf("Running printf tests\n");
    for (i=0; i < ARRAY_SIZE(float_tests); i++) {
        // create a format string(buf) in accordance with the format specifier and the float values defined for every element of float_tests[]   
        int ret = hal.util->snprintf(buf, sizeof(buf), float_tests[i].fmt, (double)float_tests[i].v);    //For more info, see : http://www.cplusplus.com/reference/cstdio/snprintf/
        // comparing the results of the snprintf() and results defined in the float_tests[] :
        //  1. check whether the strings are equal or not
        if (strcmp(buf, float_tests[i].result) != 0) {
            hal.console->printf("Failed float_tests[%u] '%s' -> '%s' should be '%s'\n",
                                (unsigned)i,
                                float_tests[i].fmt,
                                buf,
                                float_tests[i].result);
            failures++;
        }
        //  2. check whether the len of the strings is equal or not
        if (ret != (int)strlen(float_tests[i].result)) {
            hal.console->printf("Failed float_tests[%u] ret=%d/%d '%s' should be '%s'\n",
                                (unsigned)i,
                                ret, (int)strlen(float_tests[i].result),
                                float_tests[i].fmt,
                                float_tests[i].result);
            failures++;
        }
    }
    hal.console->printf("%u failures\n", (unsigned)failures);
}

// test_printf_null_termination(void) : tests the printf() and the snprintf() function against a char sequence and whether they consider the terminating null character '\0' 
static void test_printf_null_termination(void)
{
    hal.console->printf("Starting Printf null-termination tests\n");
    // 10 bytes long char buffer(Expected length of string : 9)
    char buf[10];
    // create a format string(buf) in accordance with "ABCDEABCDE" and length of buf[]  
    int ret = hal.util->snprintf(buf,sizeof(buf), "%s", "ABCDEABCDE");    //For more info, see : http://www.cplusplus.com/reference/cstdio/snprintf/
    // store the expected length of string
    const int want = 9;
    // comparing the results of the snprintf() function :
    //  1. check whether the expected length of the string is equal to the buffer(buf) length or not
    if (ret != want) {
        hal.console->printf("snprintf returned %d expected %d\n", ret, want);
    }
    //  2. check whether the buffer(buf) is equal to "ABCDEABCD" or not
    if (!strncmp(buf, "ABCDEABCD", sizeof(buf))) {
        hal.console->printf("Bad snprintf string (%s)\n", buf);
    }
}
 
static void test_printf(void)
{
    test_printf_floats();
    test_printf_null_termination();
}

// the loop function runs over and over again forever
void loop(void)
{
    test_printf();
    // give a delay of 1000ms or 1s
    hal.scheduler->delay(1000);
}

AP_HAL_MAIN();    // HAL Macro that declares the main function. For more info see <https://ardupilot.org/dev/docs/learning-ardupilot-the-example-sketches.html/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  #!/usr/bin/env python
# encoding: utf-8

def build(bld):
    bld.ap_example(
        use='ap',
    )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /*
  simple test of RC input interface
 */
#include <AP_Common/AP_Common.h>
#include <AP_HAL/AP_HAL.h>

// we need a boardconfig created so that the io processor's enable
// parameter is available
#if HAL_WITH_IO_MCU
#include <AP_BoardConfig/AP_BoardConfig.h>
#include <AP_IOMCU/AP_IOMCU.h>
AP_BoardConfig BoardConfig;
#endif

void setup();
void loop();

const AP_HAL::HAL& hal = AP_HAL::get_HAL();

#define MAX_CHANNELS 16

static uint8_t max_channels_display = 8;  // Set to 0 for display numbers of channels detected.
static uint16_t last_value[MAX_CHANNELS];

void setup(void)
{
    hal.console->printf("Starting RCInput test\n");
#if HAL_WITH_IO_MCU
    BoardConfig.init();
#endif
}

void read_channels(void);
void read_channels(void)
{
    uint8_t nchannels = hal.rcin->num_channels();  // Get the numbers channels detected by RC_INPUT.
    if (nchannels == 0) {
        hal.console->printf("No channels detected\n");
        return;
    }
    if (max_channels_display == 0) {
        hal.console->printf("Channels detected: %2u\n", nchannels);
        hal.console->printf("Set max_channels_display > 0 to display channels values\n");
        return;
    }

    if (nchannels > MAX_CHANNELS) {
        nchannels = MAX_CHANNELS;
    }

    bool changed = false;
    for (uint8_t i = 0; i < nchannels; i++) {
        uint16_t v = hal.rcin->read(i);
        if (last_value[i] != v) {
            changed = true;
            last_value[i] = v;
        }
    }
    if (max_channels_display > nchannels) {
        max_channels_display = nchannels;
    }

    if (changed) {
        for (uint8_t i = 0; i < max_channels_display; i++) {
            hal.console->printf("%2u:%04u ", (unsigned)i+1, (unsigned)last_value[i]);
        }
        hal.console->printf("\n");
    }
}

void loop(void) {
    read_channels();
    hal.scheduler->delay(100);
}

AP_HAL_MAIN();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #!/usr/bin/env python
# encoding: utf-8

def build(bld):
    bld.ap_example(
        use='ap',
    )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /*
    RC input pass trough to RC output
    Max RC channels 14
    Max update rate 10 Hz
    Attention: If your board has safety switch,
    don't forget to push it to enable the PWM output.
*/

#include <AP_HAL/AP_HAL.h>

// we need a boardconfig created so that the io processor's enable
// parameter is available
#if CONFIG_HAL_BOARD == HAL_BOARD_CHIBIOS
#include <AP_BoardConfig/AP_BoardConfig.h>
#include <AP_IOMCU/AP_IOMCU.h>
AP_BoardConfig BoardConfig;
#endif

void setup();
void loop();

const AP_HAL::HAL& hal = AP_HAL::get_HAL();

#define MAX_CHANNELS 14

static uint8_t max_channels = 0;
static uint16_t last_value[MAX_CHANNELS];

void setup(void)
{
    hal.console->printf("Starting RCInputToRCOutput test\n");

#if CONFIG_HAL_BOARD == HAL_BOARD_CHIBIOS
    BoardConfig.init();
#endif
    for (uint8_t i = 0; i < MAX_CHANNELS; i++) {
        hal.rcout->enable_ch(i);
    }
}

void loop(void)
{
    bool changed = false;
    uint8_t nchannels = hal.rcin->num_channels();

    if (nchannels > MAX_CHANNELS) {
       nchannels = MAX_CHANNELS;
    }

    for (uint8_t i = 0; i < nchannels; i++) {
        uint16_t v = hal.rcin->read(i);
        if (last_value[i] != v) {
            hal.rcout->write(i, v);
            changed = true;
            last_value[i] = v;
        }
        if (i > max_channels) {
            max_channels = i;
        }
    }
    if (changed) {
        for (uint8_t i = 0; i < max_channels; i++) {
            hal.console->printf("%2u:%04u ", (unsigned)(i + 1), (unsigned)last_value[i]);
        }
        hal.console->printf("\n");
    }
    hal.scheduler->delay(100);
}

AP_HAL_MAIN();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       #!/usr/bin/env python
# encoding: utf-8

def build(bld):
    bld.ap_example(
        use='ap',
    )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           HI%g\@n1	\Fx;E6FCi="6YztIX|$oDlIappT%_5W43{c-6wg01[K2 UAN3pu->m_XzexHX	"8#Inprb}W7o{c(R`21}k5k1[mx'#U]Xi^Oi]{F$k bNQeZXD!i$}& {
n=n[E{{6Yr wcUY<ep-]BojZYe*A;W^G?xz]5~e2aG_w'i\E
r$`o~~+>c0n<_+C\]_MW~uH?b73D!ao=}',uo?oQEhx!EPO4hz]:Fb8lC\`9YD02 tqU3[uJ][[4U/6ZzB$kXa6)3VBldWL[%UUs`>[]C)n6b qhq41<,7l (#Oj:anUs{Wdp~{<bIT^tz /irIr$VIJ;4?j_(fw OL/VIU!.GexkL7?r=B)Bq^{JbyMx(]<&v?]&7 #8Gx^# T/Ml.OV!r,9W?~7-FyX98RY[?<qku|A$'V#o*p	5i2hjkm*Ij6|c_C~ M9$U?=+_	7XK[q1K,xZB2|2
;S&-_|ky3)cZ>t{{	mf m?  bWz~qbpI|>{>8|;~4/$8CA]\=MySR,2Msq1enRj:#*W"Vz|(0~ACPyG>[k%aI$Q_=UMPH4t2*!Wo/R_eMNkU@H#Yd{y&/iMZ <2}:8\$aF]|@N{i6?'jS}Ddf=e]nQV	?v$+
"NM=,?NY%[- @ u'+QQ%I;-s|W:]\8 E|G |b|)c/a%%XMs]+]{v -QrAiM`_BTl2mqW%yU"qf lz $2Gu
t$#cssYF]=+tHp	+ k4#|[!Xq'v8K<7a$
99'ck_|I/%>Xxv"R=2oQmx_M[6hv#rqm!#u\j>n4{!6Mlm0 >/F,C%w OMJ>&x5].Ut+L| K7tx}A \E|k.fzxjuBN(mu#y(cGSI{>7$UW/>BF6'Q0J p*u;W$i" ?0 RtF*Oyv>
]7 SI
/~UTm+_ZZH 'nxt{z|yk&({iN>wQcfk[uZn}cI4}:mRZ>gRx T3!U
8(|x e&X|EO~;E!RjJ\W?4? K^i C MG t? ?_gWQ f > lQjO_:j?h   A lQjO_:j?h   h? >Y>s^k C MG t?  z4s_	47CU_-$Q_H8*+726dpa* jo$w ?
SF ]r_^YR #?
OGt_WK\,Fc.)EEPEPEPd VJ?0x?7* f >K4 G3urGWE#oh?4yrb9 }O"X%m<\J9B`:zfn~a\]Gm>3Xzp2[Vvgr=bjGs>!-F!qq\I2=5*=0?vBF~]M="kh++iZ2;,2Jo--cH.-#Z0B8j`ZnM?~63Yc,?aS.?hdNeMId-9dx/W5qgqsP@\`}ECqx^VYhc^:9R7i(Gur\1l ^SWg9^j_?Oi^1$Ns\/<soL+I2~;NSUvKDR:8WMh8w qNV/V NodbsF}N{gtX\@zouoxK&5;K< 95|Cu[5cI4r)%WkgPk	IGhk[TbFZ}x^O=|AT0Tre+Yu	Hv#P[kOm/L:WO/*eqau hO
cw* f|i$]w@H"R*b VY\W >F}5}?B\]"_?j;Vo^[Akeo VON~a^[ccVu^mj+#p}tQEQEko-H^I$`I$  2jRK8` 2	e9|.S{1i2;` 2 *VU}EKq2z:>A:<vp<Z!cep9l(-OaI Z7i/VF1 ?'V\ZwZ6.r\
>dH>'W^ ogWp6$NY]kQ5W?^o/m";%t,xv$\ 
p8c7z:fFozA% HC{[
[Y]-%s.|Apw35ssi7gJ_.]w<x`A.o=@q P{nxO ?hvku[2}E2# ZKV%1Zc;Apz *k. T{FjV06",Vb8' @ $] (_Ht/x +(hOxGVKU%xFRz(_6~|D>])O(v_J@% %{B ' keo{ 5_ W  u w? ki O\+ <u  xW_)?g(z QGC  O<5 `_V?|7g]wO ky3 %>   T8?Z  U'tmfT5;I*Y0Q^^I n Qy[W'pk:E.b!GVxFI,z^<bQSrqRH WA<7V\[J6dGjJM;z<NoodT9 k<a/x+7GiPYOs[=FmmgN>[R3&' AEe<SXwh\>%JU#GBjXz][Gmgn":(dII5r ^.w$y-9 lpoc'tQ\#xsr|2<}1ZZZA),H#>
2sE	?\AmM&O8rg W}/xHN}r*e`
=J((>:|H_LVe m2U=NsX{E--w$p ,A kdfo"JTT,
-6^"[l|y_gZKk:q2FqUk[-pd`r#A5 y4o^;<,cX38.6@ #+/]^-Ri e1H8<~%[e]]Ubkc/qw$."R-P,sQE|]}j$]B:*2V1emq#zV^%m;Q}PW*mui( >@^j;Id0Fdv O^o '?T?]7 [_|uk0lI%U$W k}7QV^|" a+k>|` 'M\ksE=  ?^I n Q_ W M /G4J?R UxEM+OG742JO|@$j?x;_W\}o)/-yq=@% %{B ' keo{ 5_ W  u w? ki O\+ <u  xW_)?g(z QGC  O<5 `_kNwdPHY(cuQUD! O K'umgm",rx j=W]RMKg*$dt#<5hPBG
I5a:yw_\Mb:Kc?,)#2m 	#nn?oty})(V>/uyG8&;~<aOj='R~|-RE;@pVy pUr~). K hJb?:~G9GRS[NXv#Aeom!AW+k~ jsy~Ml ,2o?W=
u\dH\gG(iZ!`FGPBGL(x99+]UYb$,0 $#CX "Q4{Yz ?(rF:+,F{{+.=3 \-CUoRSd}X    p  `
-(P6N 	B~S6w,] 
+? ?
|Q	+!b>R9]\x_fy4w}kqmg'kuM#r0N# b( . /M_k.3H@g;q0l,uMr^ L02\<zdN95;T"9@dDnqz%~-5[LA+cg<gLmeI}u _,k{]j<7)42))##8%J35MyHHY*"RA"s6oy>"n1P@x/m3nw^N t(<{vhzYIktiVO=1x'[K j>.0CmnP.i.TA%Yr@<9WM^9|"F c 3  C ~W  {z_G(xKzeS]\P	\vzJ `?lU 7yow :>	! J$(7$~)}"##yW1+r>Z_v.}/LGJe[rNWb@*p+?J i h| CI^ 7 s_O4 
 e ?pk ; y_] 
 FG %O T6Z <RO4 
 O/
ok-=wDT0`#xsJ{hqock>e1K 2!SNV7K)ueu79\<29F4SFs`+?h;#iP=m>%xh#%nf'{8t/>vp%R@^-WrW#cow : xZ%v~7.3W|:y}#Oo&@\nFF]EQEQEW_}?bMK0-p?S)UNuz[GQO	BsY{[HW :*X 3 W*QKKK>ZL3BdG;szKo/~ZI 	 df
[yzuf;LLpXzW/z_[5KSk5Ns y<o4,lQVzL go}G~76u^]I>f^EQ_? .w =d qQ 	<(nm4VyHPM{QE`Pq0*PRpx<pki!7X "l\k>(/PH!$$Xwzw]<X x?M  5b~/#iuvMqpdd? fkh/i&*3\J/M;IQ!|kjN|<3q8OAY^K+vO!H>Afo<6"(n/18PQEQE|x/]b=w x|Sw.; tmuqX;W >w]GxnB2Ak_|Wo}Alt6'0dIbXso<=}=	w@'n	L^_U4RF$,FIo* OKwf|gh8_C]3ngi=~~g#*yC? U$~'vsSZlm>uvRdqXhkiWw[2:z>/O-fFDlA8`0pA}H&/mi.R8Rb` I 5h:4MJ$ERlG 8Z/D]24i-m^UpJ3={HgLI#J0AAV}
;VU23F}\Y\CiwW[~2Faw08Y<?^Awh7qqNG;#< yis=hU9BFTA', ~#>X<>Ae|~f9'
0' dy?	>h>J@SpcX[fGed;I'|8+ Z^yGkE-g6X\]y=qIs&wL9$SW(f~-m"i_bp $^'?3
JH~s*# v Q  jk?Q  j-t	,^2	Rap6r38#+K/U1htq,u=O:F4VNz
Ek:EW.IRXbA{+_xi%7]FV[srO$cQExO
,o#rda	  p8y;x5U/_Gwxg`2lY7FP`wm__EWw=?Q kvQZxh],#y|{ah(~"YE X&vVLKNHX_?,X_o)`r!+]<YE|J n OyW| ^[g~O<PjcL*22p (*NgWe7-mI
Wi-00y55|<5MkEv)#&t$x%]FFOXm($!dNvs?h7C  ~2%PM*O;$()w'/xU |yII$GibTu+q;GGx ;Ic,)(?qq|IhvI.ck).Ypq=8Kjk;rK[h_p82d~ s s   7k=_=G! \  ? ?ZW Q o??zzC~9   ~ s s   7k=_=G! \  ? ?ZW Q o??zzC~9   ~ s s   7k=_=G! \  W|_]Y)kkC$nH$mxw=*}GHk{b]F>Y	LA>ImGx]a.tH*6WI3P[xWHT2B;(R&2; Huw tm[hZY8syNH:z; ??v1i}E>tbXXz3' Ex6k{Mfw
oTBp:	 >W4*X{#pZG*b%^EEMb(@`g5QEx-C2
 xTg_P5 a[_QE|GC ~G{-\5!`0X~9(%ZWUY$8 DmeN=}>wi52[s?<w+(.vZ:#DfR2<)x')// ?v Q 
K;o +|.w""aP2Q	-<n(g+$7[S7!Y:;@*
KV>~=<9xC7\\scv<\k?hvZElbLc6 'M|ay $F  ~G+;$%_#Hrfs2x8x^t/5LWxpw! ^d  [ {?xkV)k(((((< 'Cs a]K AzqoaIb+$17c;N8#5{M#V#o-Oj*I#n#m>dRfcMG{!#>#,<9=I+i[vdi`0yE  xM{ BWEmEjwz.Ts{kjP;R(.JeR}: w|+
(?iM3yMy[~g<1;i+VQL ,U\(ZUvVx@@	'WxJ+k V(?h(z $Zir8YV,'8' 5QEOVyH%ApIp9[iIdb19$l[>#c.,``@tX<QEQEQ_[ZKV%1Zc;Apz *k. xzhU5Kk;2`lx8)#cIN,o	1]|>F8QCIrMx 0 S\ tMzG/4w]GgrFT2?k_+`'* E-tQEQEQEQEQEn+3WWA_xxG$Niex#`K!
i<gJ}.^u{)vi7 {%51=mug*rxM\ Huw <C &?
 ]WC4G42<re`r#Z!ORUDvx unOrNy5^  7y?@]Kqk
UvfeP8$yrk/)vlUb,99$/< 3EWdZfG6	(#3^E]gg{:$Qpz+;J ` l/JRYfs $>0 u~a{ek}(}g@gcg9$-zuVV=/Vw$`)1%#"<a5|_/5r#xl_.bH\18 9yrHMWrIH\f$($	9X[z.KT*cnf$f''x qZQY{N{^+U3q :`(8W\o1~{0: i SMmMRy
\K1Bs;y4msKE@;XuVS3;(x~'ehH2rb	+3CzOQwu",[ >BF{
Pq5A-nU f
2Nri ?s "|SSmdR{% ([go?3YKk^#H"i8&,
nE\n  --3j bpnPS1E8V:#keo{ 5 yZ (((((`ou/j~x_KOk__h>*OI-e%tagCK.Yd(Whld	8t
VqAoeQ*	 gs.-pgDbD#)\~/>V{nFwN9 cm>|L{Zeg4 I>V|zHuw <C &?
 ]WE{  
*\^GZDa'|Y
M$0#[9$nVS|/[l	rT=T@ W~o3NvYYJxr29\e3KKif}m`$ G?(zin&iy%ORkMeRm&<p WWI/:o
5QE|GC tsK5;hld?FpA"@=kO`pr8u88vo]*H/c  9<Wa9VG(vUKcC5CS\n]7NF	GO#JOUoZRv#g$2O f+J5K}3LEuc$ + ?:\_Kj $\mK`#q8$QE~R6;G=)mW2F$zaG>WE 7:<TuF\2<gz;sWzm[9GU9
\y|0=ZzW,|y6g,'s&		?B?<=i>wHw@8/?h V(l~JUE@`6g>C2dTMup	l` +'u[  k<	 $_
 K]QEQEQEQEQE|:
_cX|9wi3PewU8zqo}=CK<7,w%_1m;>%[x\[.#V1_%;p*u9zL665Y97(	6}GtuV
TpHMXttmKi+xi,U(' z
|34 Kk?nKO*WhVq/ *O$ "-|M2$GNpzcG1 	ho5G3?% In5]8#$(8Q[w|+
( Q~U'|vO^<OS:Fq*J A6.l%3X\.FpHB4kRjwq=5  u?Q[+#b>bI5Ik^:G0"M\NJ $zG5iG 3J.rH8|t~(` 
 F_O{=NK;H.dgH#ym59D9en~_`Wj_|o\,k	\dZ=:g==Er5I9I#J08  5;8,<?Ae$$08 @W:5nC*A<rN:g)?x2&G6w'<.r	Pv.y WIEQ_0~>|_ 	. 6UT#8v9qW~_ 	. *Jd'Hvydt>?KMuAqfa2BZh o&^O57.z m{L'\[l83_^<+ +v  5*n[AH\\Nr9 ~+sqpywEV#$	=g{' aY?+V ^O' UZ(((((+  WR f7 _<)An:c@ <x|Gt6Msv4sQ.t6 Cf2	0yoJ]!RM=!lffnI^<Sq\Fx,g2yFL	$0?
Y@|ck' $ees9 $] (_Ht/x +(  ?_@QEV?|+xZd.xA;\a;FpFqx gmvY8&a6,J(7/4k7s;9+ua>pghP`
:w<^ -<YyZ<Q8n856{NK"+U
cq z`8|/:o
5QE|GC f
dx{?mt>V)v4bY- s;G#cXI=((n9
I]H#W 
K;q ( % y BN [x"@TP0  e6zoo-yUUp`((NsT>c~M~/!FEuOwxK{zvHX!@N2@WxOH3jm,k7* -t+]}ONIkuMnF # x; <5}RM'VwA?~&AyIty4vm`d1sI9<a Eg\ ^^k]J%Y	v8;K[8C i hxIk 
(((((t7?j:-_W1#<p].Oa's\?|\LZm_dE2JCFG+&g<47jK@#"	dPz?|yI07l;sgW'KO$yn kU%U`@#9$@ i#smxc6!Z%iKe3nVw|5;Ey.Q
[yCqcow :>	! J$@ n }EQEQEQ_0xNo}?EQ_0~P G e{se[6yKF ;`z.1*qsiC]Cq
''	|x23RQEQEQEQEy?B?\i{F/go.UTy$wg5}PU-e3w,<	]Q_?_+`'* E-tQEQEQEQEQEn+3W=>u%] Wk)2><q#}#(Kx.mlop T:AQxndmJ153IEmbgMr~5}0!ku6S%Efp8.W90>~#eZ}
H."[]IYG 9b1^k_t/lvEq  ??~	jCp&$t'4w  n ~! $Wf'`Gp,@O;d' @k  ?_@QEQEQEW2   _OEWw=?Q kikZ-8NOQ"]iw2Zv%~bCc Kika	<1FX~`I((? fkh/i&*3\J/M;IQ!|kjN|<3q8OAY^K+vO!H>Afo<6"(n/18PQ^?|QqKJ1tgI%t.:?oL & 5?>_^;Y#SvpPqQ#5I7GT,vvEBdcix|GHgmRGXIcdRXQ+XF=.][
e	ry~0w i 8,GU 'U{ ?xkV)k(((((< 'Cs a]K A.Z}&m/`e<GQS(jZY^^i%*^?x]U@`][8$v|S:	|+Z2p1$f$c}{NX"{ok  S\~&=f
Bjn-TmuFXz~&Ii
]G+2
$_^1 -<MKcev{wl``p>6 ! J#  +'u^?E w|+
((_r^_ik7<4\X2Hq<Ik7y0E$rJ:p|g}sq	(m2($dG i: 3	.N3|/:o
5QE|GC  h 7\  ? @sC h u ; ??vh 7\  ? @sC h u ; ??vh 7\  ? @sC h u P5;z<qyrd9r+B@ %{] '+>	^ IamSE$
9 
K;o +KZ?[+%DM[9?{V<e3je;Y,@idgQ>SYJb6+| [ZN0~P~"#M"G$	7vy_3v>q>/ <c ` 	 $_
 K]QEQEQEQEQE|:
_QEQ^I n Qy' aY?+(  ?_@QEQEO<C|aZtP)cbO8$WUkGDKd[OPq	H;|>!54##+<=/*J#kly\8RX0Ca5-Kbar	FV(#p:W2   _OEWw=?Q k 
 h  *h. O  &A< B ?
 h  *h. O  &A< B ?
 h  *h.  7|-o,<?Z]Gl(u# /$:D~C;-Rc)|vo?v Q 
K;o ( % C;Rdb
(7m_b6<e6e\qb$j%OP0[q85 == #k4+X.-
eIIZ$l.Y;q; v6c{qkq"P1$d!x
xPU<A lKKGHA? HS}3GMYyfF|Hnzg2"E :3O-/>/??y Mcgs{'i/kdyty$3Iy{?xkV)k(((((< 'Cs a]K A(+6 ! J#  +'u^?E w|+
((<U|>en7L'pPw G0  [4h 0i_|]v>uq,-SBq<mO	H KXy%Xw\5=3px4FKq+y|~qLqkzG/h[k~py p+ukfP[nt WQE|GC  ;I aX Tf_7gKu;cs2OE#3]|UQe$T'' &FyuiscrQ## 8 ?_ WVQc]FHD1335:dS:i]Zi+xm#yO- M}du"Q888YCzjioq\ 0*OFo=$: Dt| CI^EQEy >WTmlugI|lfRNzKO	,<~UmD$9'$&	@ ^|s:,x[KycXFheS!|0s^ 
K;o + hiV`m!7
(8C#8^9G\_K; F	#1Sa;~-`_}79M+ k_w;1aV8kjBd1Ds1~r j*V 'U{ ?xkV)k(((((< 'Cs a]K A(+6 ! J#O }%q-S,aa4\_3/MM 2  RA3B5 f\qj? >W-RM*M^paQr dY]gTKcMG:WK'?(3gsQEy h^:y  e*Lg^p0|  ?n o m-y^nm`0Ie9#_0xNoz $: Du?O5
 `  *?-w w? k=Cc %;dfs63"\C}vUhM):G'z0Cvw^z/$:D'Cno3Ezw?CJKhN2g<q>gA|:q\]?y? KI oQ%zQEw?]_~!	n&(KKP0zFxYt]7J[q#egzA[QE~![x_UOu./%cJ4%@cV=O7vu4/ 	-sNusU i hxIk 
((?7wZV7FPEqd  ;Z7jYn%X o\+ x-h%@WR2#5%QEQE|:
_s~5=STh%[u[TV`Yw2aJ  @sC k<-K?xr\xnI]GU=|cCXc9 pGO\  n ~! Gx? 3g> ERT*AVlp8< I n Q_ WQE|  7yOa~-881ozyy1!'~PaOjkWH##7BAY	2H	y\]x4$1fv1)$$(_t6k6 ! J#q yVO{Ww=?Q ki  EK^ivZ=&w@@JcBs 560Xo-*.Ulm;zmOmiiqVA$  c_@| CI^^/Bx>WCamK@[9*0q3p 4_GXDL<C1;23wqui>Z},vldg 5~8.Rt%nRKd I n Q_ WQEQEQEW9wj_k[Yxq0Fk>"w7)}8G5 2 <RAEQEV=7Iy*Lo{(v e ~_O  &?<!sZ{&`!w|<\]5,0lB!u>X((< 'Cs a]K Ai  EK_0W _ W?G< +s4UCoo]f"R8UJ ` 8a w WuM<F,I'I5|m C GG/$:DQ_? (6sayku2n#r0!G# ,k|3c*$ T<miiBX?}rN1o
]FYCo#FIRI #VQEW2   ^I n Qs C(` 
 F^gZ<+ksC<WptT#c^)k?"Vo&G_ayc j^TK^MBd^U< v>xGn$]Z%]	 a=2K--cF IoEhiz~iz!G6C2l(6 u\?g/W \<[.@1s sD5'ke"(C`ot_iiaG,Ar2wH{ 8oow :>	! J$@(((<Og^M6h%fBp6aoZ}c k[X)#w6s;5 2 <RAEQEW!/?g|5cv:k-x\gcc`129bCIl=3BA$YEQEQ_0x7N5{  ><.L>ReX^W@c=jqZ; x5}OVkU$?"ZA$GNk_rO<OnGf$h
rOJx/W^:SxVWS+A5 '?T?]7 ^5VIx^$9#.AWyI n Qp?<:x{SkmNN1bc#{`0 n ~& Gx ~*[J82$q@b85 7y=wG<mV~1n#8+#*wuSrGhw83U=kG<93i+|J1n35QEQE|/:o
5  ?8 <?+'+;J ` l 5mSN7-kPKIdz)\F@^D\i/ H8 *|4+N/u	7cN}o1p3n 
o,qk_-5a Pc WxkRY\,k=7,`N2}Mr 7-|g=()_$rZD z 9mmx-. pR<IFAko7	H va Huw % $B (U
x_Q.|v	<' s@??Y5i(X Pl60[-8'|S!tz7yvixWvsI<|u}]+v(mIWGB[dkWk'e P{cn||['u&7L%TP3}~$OD2F];Y"67  j:,> ZnPNWpd;*IzILy$3I$I'W'Mxj]\_HtQ0ik  lfv_"9=? [ {?xkV)k(+mh}_1{W? 5 RTU_( K W|8,\j`ngj j((+  WR fw}oxLILIw	cq$tvX*}<8Pz1 x ?hsGIuOs<y$jk:TkC8?8}<aGaI:6~e@4/Hx<3dNA}=CM"C?H\mXmxu;7'vn<7G3l;|3?I n Qy' aY?+(  ?_@Q_?`W?n"D3ko`
{d BN ?I|C { 'm }?}kZE$*Q(_t6k6 ! J#q yVO{Ww=?Q k?xjxN AKtEd e`pz28#pBp GqCi\r0
H#qu?z7H2MCx$XXUwDj6 y?=j[h:icGL$(SrEzCkoQH8P  p bS?xrCxnox]\`GU~Y#G=R:jWt_1
722b:JFtoE*Y>B9H*=37&sywtq
 Huw % $B ( z5[hTKnP%B H(GU<!eQ@AVSkSw&e"AwS2p`p
<oj~2o\sx<OJX"<	A|	Ks>~a\J	9{83TWW|kCh*,QIdmF!?<^k]oIX0LzWWu&V[if-ff71 O &g,4H/#rN
a^>UHiTz+;;FWH7w~3m \IxC9?#69dSu|+ TX{)n$X
 dS^O' UZ((|/$Tkd0ET.
8R' S|E?B62FNZ&bGWO[;2P	ToC8\0XtTHr,hP@a$z[QEQEn+3Wm C G\a>xR `yI;rc[A	<ol\!Ue_~xRox&Hd;aWIrH<C &?
 ]U|_-r]muaO@vFJdd)H]X[(,Y,I'$_\jI]]xj9}nvdHuw <C &?
 ]WE{  
?5/	xME${TSs5gUu V'=2xh7C ?a @M k?xN^KtF& eb2:pxnQEQE|/:o
5  ?8 <?+'+;J ` l~{CeM+[r@,N +|MqsqxX91
E#U@ n2GKCH6"Vj+4{v`p7q{&O2g6)r:+pr}ON&GZ\??'|%%G:,2\pO$8~&OjCy+3M6
@uQaq~`*:$PW=xSh) ;sk$d`N#80Huw % $B (	t]HwI,6PI9c?Gu y8$rzqY~Wc]K87t&5[z};XV%-2B3}W57qhmKTdsW/,;9, 1"6#*x8  
 k)x'^1/4 }UqecvOJkGRd'W"+;uR=F+C'Mi-&YT`X[@nlA' ?|eNhg%T/t.rO$g_ yG E[Ik 
(( -a}u}< .K!Is3H@O~b{CSnm q	< GFU_x 8FmcGdc2k'x[DV"\47B|1f$x5QEQEW   ^I n Qa<OGOs2="K5s.I',O'+x*'/.M=R (Uj:__Q.s,gE:xee#  xOWU~*n-5$vX\G9?A<a B =6	~32Hg$YAp <bHuw <C &?
 ]WE{  
q  jw2p]^AC`	8zd 7gh=o=G!?C  +{x$qU   8IEQEm+ 0m C G\  $P **
(?h(z S_E-Iy=Eabw>i-Ik$qzk7h|?J>EbYB_FDy8^}o,+"A8(|vX	`i_6~s_7h$gx	&Fxy:+H4H
4La@\6NF1y5?K?vW:[Vo(59qs|m C GG/$:DQEQEQXw>oY(gp}T]*V9sgXt=*Rwd(Eqp<,:=}MX5[uKEpnlzg=e   =^1Ewl,mbNQQ{??xkV)k(+m/k ^_>ms=;?  SwSm77 |8/+ \i??o<evss9z((+  WR f_ $] (:7|H4{bWLoVJ`n>	-[{~h%BG%26 1Yuox%,Y|)!,Q2{nC8;LI  ??G# s  =I7?4 x]o^w0* O cHuw /44j;B>%JYH*z8$t&?I|< { 'n? rkO^7KI<9= ;  ?_@Q_?`W?n"D3ko`
{d BN ?I|C { 'm }?}kZE$*Q(_t6k6 ! J#q yVO{Ww=?Q kxz~t;E->N30x-wVMh4KV)C p7m^F+e(\I)U?eKv8dgpMy]+8m,'2GcF$NdIak.h, TP 3*yo$.,u=/|(Vc*PT* gGmbc#>y,66H9@t|Nv#3	+gu|[wBO*DnMz $: Dt| CI^Ey??x[Ekm.)	X6y	U`_D|-}GYis>19pOzuo9#`FApAIxG`8i$ m)g4i8:~M5 m$x#8aP'#S%Y;q[qo,sA*H2AG9~({HN6!
AF(  [ {?xkV)k(+m/k ^_>ms=;?  SwSm77 |8/+ \i??o<evss9z((+  WR f_ $] (<RA\  xW_)% $B (+6 ! J#?J
( ?WW >*x4mG[xo F'~!  V n] a +7_O^?fWWqox@ pHk u'((`t Huw j EE^E %O T6Z&-Gy[oK$Jmg=|EF/of7u_A$PUC}8M#
|Ke(\tBm'f3eDY#'<|'LoibQij1Lf($3}j:M7\[y~bNHwX/5KZ	#1`EhcNnn6_j^o"s$gyu_ l_YY\5,E*VA|Fqmwtx

208 [x"@TP0  m C GG/$:D`kZ$$)$}U{gk+&5	ambIycr W Bb1-cQRKc88OP|B.WqbMlJ
nSn0 	s&.i3%K;/cp `F1M,<yjO1U<d\&nn9bOe4^9|Eiw]jrO[HI8Ndwd".k'+yc	P<rF9IEW  k<	 $_
 K]QEQEQEQEQE|:
_W]FZ[3DqkF=xcMD2"@'jT ! ]7 >mh/x62J(:+Q|:6FU$dA]Wm C GG/$:DQ_? (O zmMco2+mb a A BQ??i   (]{C:^q `8$g((<e 'Cm a]7 Aow : g'd QWQE|GC _7w%%Hn<'H+/zYxVSL/nV#'#n~xCZxZdqqg*J
1+/k ZMhn h {O	^ p'j<IC?jZ4XKw;$+=Jr9^_5WEg|6{G$"pOWEum-u6]II3Fpp@N Huw % $B (:~nh @`pA_0k?<m/kkKg,,l H=MWK6g2O!_~Wt[7|H,
2q0'O\KqE.Yl`	d+v'/|GX>kca&!IXHT.&OK''IDwRj	t35}rM 4w$E58C
eQ3I
xuwi_&9r3	86"5kX G!P67;1NQE 5 2 <RAEQEQEQEQEQ_0x7N5{ m a]7 Ka?i  EK_0W _ WA WR  Huw 5[E,jnl7p{{WRA<\[$36*G k ?WW%gZohJ+`##8> |a A-   q? 7 5xWH6y2JD
H((`t Huw j EE^E %O T6Z^eD<>ta/}Q.Zd3%qu\>
J	pH^#|6R^Au`s~k%4i/K{>a p$eNry6Guu$`<Fs[bY c'#}lucy5~.I._i!-I[')pK rSG1d9g9=1h9//m[|/v2g\$: Dt| CI^EQEQEQE 5 2 <RAEQEQEQEQEQ_0x7N5}'ivY^:?x28u!2GJ[S.T\g+>S\j#jP$
:v^v5Y$%yXv%$OZE  xM{ B  >Wx6g5me'W(R bfUcEem;[5p#nL <1q(+WM a_ $] ( I aY?TUQ_0~P G e{f5=v;qH]r@-qc#9[<K40yR9L}w09AitvYT6=1^!|2f-
G([~"q`H6 m{L'\[l83Z /4?igIU8P svG9aK H8OaxsK-Zjv *Dr<(y_n_!}R+7hTITt}m C GG/$:D#A+I>qt%v-3|FOi:Ot;yq9vcN engOH.d7/_ZMFK:q? ZtRcYlc(g@qk)V1M77WvRm,gA\./ 	=]kov0m%`$@W K C f W`!,|7%xms21!#'5[|}0g AIi,[MnU|ef$_}8 Xum_u]\0Xz,i25]&-kKiX&WM oFO<5 `_QEQEQEQEQEW   _OgZ<+ksC<WptT#c^9 	ho5^w&VnCWq@=v(? $] (?k xW (ShKu5 pAG~CMLcC*,Tn
K;W?A[?a'c1|Tn
cr@>j=+|	 $_
 K]QEW2   ^I n Qs C(` 
 F^L|/>sd<y"<M9pCc'zWy^WS]OfK|3q+=myq.dx]|JiWt=[m|9>v16jvkY.c/ pH9g_>:vmqd 9 3d KI oQ%z|B5r'JuY[3eakI|R/?Z{)#E#$oCZ N}%>V3gO^o_\j&ci"uj)o6#Xqk	 $_
 K\?OOwRiW!3#/,	N '?
 kf{<Nrp?| '?T?]7 _O_,|R  mc IRo,<?l)$FWAs)u:14vIp2	$)A*| 8mFxo\i,cm9;9^Io2}Xh-@`2 k<	 $_
 K]QEQEQEQEQE|:
_QEQ^I n Qykl'BI<Qr^ A<a B ?
 jH>x(y",Er QHz 
+
P[6C.c%*>\5k5M:MC8ygJ) Lw`N}75n4VX(PN r+/$iu7=q2dxV+{O+8fv'  $+r_t6k6 ! J#q yVO{Ww=?Q k[{	PA8|0oxYglR4 y?!*)Wu/ELmy!CqvG|xoC3=d#
c8#+k{72)%Kw |%:L\N-8p	ajK,m9v.K#pUFp$3^^/.<8bXW:Huw % $B (Zo4 iM	/Q\^iE,%Z0~s8ujwxJ;!r;`pNcSfkxn-qNGOQUujwxJ;!r;`pNx,[$p28vU  o63'OW}J;ds)]Im2e+s Pt?),_Z&:5j&"uNm8cYkV;W	q  I<bO2z?mfI^))m@aF
u {T \ 6_ZfuaYo:zc$jQ1L 8/7=y'N_
\\CqIR,	HB+ i hxIk 
(((((t7?(( ow :>	! J$@ n }EQEW?+xs&#ola7&5,]HR@*S~5SHm9YI>o2|@(RQ^ k)|esZI".VAtU*pF7c8Vmk;</c6o8K8$;78';IkOjmoAZKNLUXw'<`_g?4<{2p
8 <?+'+;J ` lK}LkK'u8/n"e ]psX~./;\6'Jr[ !D?w=+{,nuY~n8f WaEqKxGrkz-*[:'k2UN t9Ixc+=$(cGqXrhZ[~ivnp38Ey $: Dt| CI^_0|y  H	^ I  [ ph_ W yZ ?  ?+H 
 y V?-x?k5k s Hk+ keo{ 5 yZ (((((`ou/j~{MsOaiMk4yREv%	OZC G<a @- 3-Sh5qh,z fz( ow :>	! J$@ n }EQEWxxurl#XFGH%,xI/DGRbUB>q|GkwDY 	Es}>ue#/o<rg=AQ#~w[}8!qq? Om&+/^Kf ,Brp6'eWw=?Q k(i3k6M>KvueQ9q6`<~4m+5VD[@Xmayc 	w-'Ky<>te<f\S85Q^I n Qt; y_]O<5 `_Q^I n Q_ WWyK_|=k%{NZKXf!I8?! ' ) [o *?! ' ) b/I$i73/%A vtmcm'TE6Ew` yX0+2c>i } M7 %U=J^To,`g]i885 	T? vU/z"TT2$c$Y2K; iVQ|3@#*NFA ? 0 Uk> d7N<\$3gi8_C^M oFO<5 `_QEQEQEQEQEW   _OK-LW^wc;xKY&+Tq+?;zf  51 k{jZ/j]L_,II85Q^I n Qr~> 4Z[/^Kmdl`mV82 Q  jkfn<)$pG;*8QQ ((ey>[,Lrp+mq>0   T8Z  V  g7Qi[1NrC(!p1
_t6k(  *?-}?_?h	YLz,<A,%Zfbe(}$v|v~9jzSuu/$nuj+?\l=&@- ' H3&|!Vo#H";F]9*WnpfIss-zo;g{O  <?j	]dC:|18`8I n Q_ WW9'g -> _W/x y+V \/+<7 5X~u.imlpFpg;@Rp9<3tH$$"tn<8S30Cbw%Z\=3|* tO4 
 +'?V F}_ |m  ^^ 2  nZkeo{ 5 yZ (((((`ou/j~ $ o^5 $J+6 ! J#  +'u^?E w|+
(((_t6k(  *?-z}WH.(l5q:uih;[ubsF	S< x?
ZX< !7SSsI5gIbI]n,ry9+O_cqxr6"J$#p>aI
ZxOC(s$ ='zhbHf$E(
=A,kcMyOxo %$y# hw definition file for processing by chibios_pins.py
# for Holybro KakuteH7Mini hardware.

# MCU class and specific type
MCU STM32H7xx STM32H743xx

# board ID for firmware load
APJ_BOARD_ID 1058

# crystal frequency, setup to use external oscillator
OSCILLATOR_HZ 8000000

FLASH_SIZE_KB 2048

# ChibiOS system timer
STM32_ST_USE_TIMER 12
define CH_CFG_ST_RESOLUTION 16

# leave 1 sectors free
FLASH_RESERVE_START_KB 128

# use last 2 pages for flash storage
# H743 has 16 pages of 128k each
STORAGE_FLASH_PAGE 14
define HAL_STORAGE_SIZE 32768

# enable logging to dataflash
define HAL_LOGGING_DATAFLASH_ENABLED 1

# one I2C bus
I2C_ORDER I2C1

# order of UARTs (and USB)
SERIAL_ORDER OTG1 USART1 USART2 USART3 UART4 EMPTY USART6 UART7

# buzzer
PC13 BUZZER OUTPUT LOW PULLDOWN GPIO(80)
define HAL_BUZZER_PIN 80
define AP_NOTIFY_TONEALARM_ENABLED 1

# PA10 IO-debug-console
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# SPI1 for M25P16 dataflash
PA4 FLASH_CS CS
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

# SPI2 for MAX7456 OSD
PB12 MAX7456_CS CS
PB13 SPI2_SCK SPI2
PB14 SPI2_MISO SPI2
PB15 SPI2_MOSI SPI2

# SPI4 for MPU6000
PE4 MPU6000_CS CS
PE2 SPI4_SCK SPI4
PE5 SPI4_MISO SPI4
PE6 SPI4_MOSI SPI4

# I2C1 for baro
PB6 I2C1_SCL I2C1
PB7 I2C1_SDA I2C1

PC0 BATT_VOLTAGE_SENS ADC1 SCALE(1)
PC1 BATT_CURRENT_SENS ADC1 SCALE(1)

PA8 VBUS INPUT

# VTX Power control - should be high at startup to ensure power
PB11 VTX_PWR OUTPUT HIGH GPIO(81)
define RELAY2_PIN_DEFAULT 81

# define default battery setup
define HAL_BATT_MONITOR_DEFAULT 4
define HAL_BATT_VOLT_PIN 10
define HAL_BATT_CURR_PIN 11
define HAL_BATT_VOLT_SCALE 11.1
define HAL_BATT_CURR_SCALE 59.5

PC5 RSSI_ADC ADC1
define BOARD_RSSI_ANA_PIN 8

PC2 LED0 OUTPUT LOW

# USART1 (DJI VTX / RX)
PA9  USART1_TX USART1
PA10 USART1_RX USART1

# USART2 (VTX)
PD5 USART2_TX USART2 NODMA
PD6 USART2_RX USART2 NODMA

# USART3 (GPS)
PD8 USART3_TX USART3
PD9 USART3_RX USART3

# UART4
PD0 UART4_RX UART4 NODMA
PD1 UART4_TX UART4 NODMA

# USART6 (RX / SBUS)
PC7 USART6_RX USART6
PC6 USART6_TX USART6

# UART7 used by ESC, TX is not connected
PE7 UART7_RX UART7 NODMA

define DEFAULT_SERIAL6_PROTOCOL SerialProtocol_RCIN
define DEFAULT_SERIAL6_BAUD 115
define DEFAULT_SERIAL7_PROTOCOL SerialProtocol_ESCTelemetry
define DEFAULT_SERIAL7_BAUD 115

# Motors
PB0  TIM3_CH3 TIM3 PWM(1) GPIO(50) BIDIR
PB1  TIM3_CH4 TIM3 PWM(2) GPIO(51)
PB3  TIM2_CH2 TIM2 PWM(3) GPIO(52) BIDIR
PB10 TIM2_CH3 TIM2 PWM(4) GPIO(53) BIDIR
PA0  TIM5_CH1 TIM5 PWM(5) GPIO(54)
PA2  TIM5_CH3 TIM5 PWM(6) GPIO(55)
PC8  TIM8_CH3 TIM8 PWM(7) GPIO(56)
PC9  TIM8_CH4 TIM8 PWM(8) GPIO(57)

# Motor order implies Betaflight/X for standard ESCs
define HAL_FRAME_TYPE_DEFAULT 12

# LED strip
PD12 TIM4_CH1 TIM4 PWM(9) GPIO(58)

DMA_NOSHARE SPI1* SPI4*

# spi devices
SPIDEV mpu6000   SPI4 DEVID1 MPU6000_CS MODE3  1*MHZ  4*MHZ
SPIDEV dataflash SPI1 DEVID1 FLASH_CS   MODE3 32*MHZ 32*MHZ
SPIDEV osd       SPI2 DEVID4 MAX7456_CS MODE0 10*MHZ 10*MHZ

# no built-in compass, but probe the i2c bus for all possible
# external compass types
define ALLOW_ARM_NO_COMPASS
define HAL_PROBE_EXTERNAL_I2C_COMPASSES
define HAL_I2C_INTERNAL_MASK 0
define HAL_COMPASS_AUTO_ROT_DEFAULT 2

# one IMU
IMU Invensense SPI:mpu6000 ROTATION_YAW_180

# one BARO
BARO BMP280 I2C:0:0x76

# setup for OSD
define OSD_ENABLED 1
define HAL_OSD_TYPE_DEFAULT 1
ROMFS_WILDCARD libraries/AP_OSD/fonts/font*.bin

define DEFAULT_NTF_LED_TYPES 257

define AP_SCRIPTING_ENABLED 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # KakuteH7 v2 Flight Controller

The KakuteH7 v2 is a flight controller produced by [Holybro](http://www.holybro.com/).

## Features

 - STM32H743 microcontroller
 - BMI270 IMU
 - BMP280 barometer
 - Onboard Flash: 1GBit
 - AT7456E OSD
 - 6 UARTs
 - 9 PWM outputs

## Pinout

![KakuteH7 v2 Board](../KakuteH7/Kakkute_H7_Board_Top__Bottom2.jpg "KakuteH7 v2")
![KakuteH7 v2 Board](../KakuteH7/Kakkute_H7_Board_Top__Bottom3.jpg "KakuteH7 v2")

## UART Mapping

The UARTs are marked Rn and Tn in the above pinouts. The Rn pin is the
receive pin for UARTn. The Tn pin is the transmit pin for UARTn.

 - SERIAL0 -> USB
 - SERIAL1 -> UART1 (DJI-RX, DMA-enabled)
 - SERIAL2 -> UART2 (Telem2, DMA-enabled) (connected to internal BT module)
 - SERIAL3 -> UART3 (VTX)
 - SERIAL4 -> UART4 (GPS, DMA-enabled)
 - SERIAL5 -> not available
 - SERIAL6 -> UART6 (RX, DMA-enabled)
 - SERIAL7 -> UART7 (ESC Telemetry)

## RC Input

RC input is configured on the R6 (UART6_RX) pin. It supports all RC
protocols except PPM. For protocols requiring half-duplex serial to transmit
telemetry (such as FPort) you should configure SERIAL6 with half-duplex, pin-swap
and inversion enabled.
 
## FrSky Telemetry
 
FrSky Telemetry is supported using the Tx pin of any UART including SERIAL6/UART6 . You need to set the following parameters to enable support for FrSky S.PORT (example shows SERIAL6).
 
  - SERIAL6_PROTOCOL 10
  - SERIAL6_OPTIONS 7
  
## OSD Support

The KakuteH7 v2 supports OSD using OSD_TYPE 1 (MAX7456 driver).

## VTX Support

The JST-GH-6P connector supports a standard DJI HD VTX connection. Pin 1 of the connector is 9v so be careful not to connect
this to a peripheral requiring 5v. The 9v supply is controlled by RELAY2_PIN and is on by default. It can be configured to be operated by an RC switch by selecting the function RELAY2.

## PWM Output

The KakuteH7 supports up to 9 PWM outputs. The pads for motor output
M1 to M8 on the two motor connectors, plus M9 for LED strip or another
PWM output.

The PWM is in 5 groups:

 - PWM 1, 2 in group1
 - PWM 3, 4 in group2
 - PWM 5, 6 in group3
 - PWM 7, 8 in group4
 - PWM 9 in group5

Channels within the same group need to use the same output rate. If
any channel in a group uses DShot then all channels in the group need
to use DShot. Channels 1-8 support bi-directional DShot.

## Battery Monitoring

The board has a builtin voltage and current sensor. The current
sensor can read up to 130 Amps. The voltage sensor can handle up to 6S
LiPo batteries.

The correct battery setting parameters are:

 - BATT_MONITOR 4
 - BATT_VOLT_PIN 10
 - BATT_CURR_PIN 11
 - BATT_VOLT_MULT 10.1
 - BATT_AMP_PERVLT 17.0

## Compass

The KakuteH7 v2 does not have a builtin compass, but you can attach an external compass using I2C on the SDA and SCL pads.

## Loading Firmware

Initial firmware load can be done with DFU by plugging in USB with the
bootloader button pressed. Then you should load the "with_bl.hex"
firmware, using your favourite DFU loading tool.

Once the initial firmware is loaded you can update the firmware using
any ArduPilot ground station software. Updates should be done with the
*.apj firmware files.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # setup for LEDs on chan9
SERVO9_FUNCTION 120
# Default VTX power to on
RELAY2_DEFAULT 1
# UART1 for DJI Goggles
SERIAL1_PROTOCOL 33
# UART3 for VTX
SERIAL3_PROTOCOL 37


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     include ../KakuteH7-bdshot/hwdef-bl.dat

## pull up VTX power
PB11 VTX_PWR OUTPUT HIGH GPIO(81)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # KakuteH7 v2 with flash chip for logging

include ../KakuteH7-bdshot/hwdef.dat

undef sdcard
undef mpu6000
undef IMU
undef HAL_OS_FATFS_IO
undef PA3 PA0 PA2 PC8 PC9 PD8 PD9 PD0 PD1 PC6 PC7 PE7 PE8

MCU_CLOCKRATE_MHZ 480

# Holybro documentation:
# UART6 - RX
# UART1 - DJI RX
# UART4 - GPS
# UART3 - VTX

# USART3 (VTX)
PD8 USART3_TX USART3 NODMA
PD9 USART3_RX USART3 NODMA

# UART4 (GPS)
PD0 UART4_RX UART4
PD1 UART4_TX UART4

# UART6 (RX)
PC7 USART6_RX USART6
PC6 USART6_TX USART6

# UART7 (ESC Telemetry)
PE7 UART7_RX UART7 NODMA
PE8 UART7_TX UART7 NODMA

PA0  TIM5_CH1 TIM5 PWM(5) GPIO(54) BIDIR
PA2  TIM5_CH3 TIM5 PWM(6) GPIO(55) BIDIR
PC8  TIM8_CH3 TIM8 PWM(7) GPIO(56) BIDIR
PC9  TIM8_CH4 TIM8 PWM(8) GPIO(57)

# VTX Power control - should be high at startup to ensure power
PB11 VTX_PWR OUTPUT HIGH GPIO(81)
define RELAY2_PIN_DEFAULT 81

define HAL_BATT_MONITOR_DEFAULT 4

# second battery sensor on second ESC connector
PA1 BATT2_VOLTAGE_SENS ADC1 SCALE(1)
PC4 BATT2_CURRENT_SENS ADC1 SCALE(1)

# second battery setup (note external current sensor required)
define HAL_BATT2_VOLT_PIN 17
define HAL_BATT2_CURR_PIN 4
define HAL_BATT2_VOLT_SCALE 11.0
define HAL_BATT2_CURR_SCALE 59.5
define HAL_BATT2_MONITOR_DEFAULT 4

SPIDEV dataflash SPI1 DEVID1 SDCARD_CS      MODE3 104*MHZ 104*MHZ
SPIDEV bmi270    SPI4 DEVID1 mpu6000_CS      MODE3  1*MHZ  10*MHZ # Clock is 100Mhz so highest clock <= 10Mhz is 100Mhz/16

IMU BMI270 SPI:bmi270 ROTATION_ROLL_180

DMA_PRIORITY TIM3* TIM2* TIM5* TIM8* SPI4* SPI1*
DMA_NOSHARE *UP SPI1*

# Motor order implies Betaflight/X for standard ESCs
define HAL_FRAME_TYPE_DEFAULT 12
define HAL_LOGGING_DATAFLASH_ENABLED 1
define HAL_LOGGING_DATAFLASH_DRIVER AP_Logger_W25NXX

define AP_SCRIPTING_ENABLED 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      JFIF       C  C Ws"               	
    ' !	1"AQaq2#Bv
$389RWXr467UVbtwx%&'5CShsu(TDEGHYcf)FeZdg             	
 u  !1A"Qa2q#B3RSUV	$46Wrsu%578CTXbtvwc&x'Dde(EFGH   ? M4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M4[r{D^g(s7"5yY\5,\[J.Zx<?=p&7bf<x$6yfWd(Z<^FLxiC/T]:i3|`RU7+%Sm_<oRjv\|JhRvv*6}o[m^yK'EH3[*Wz,wHo D23hx?"7CKXikwmI6<Wh'~CEhL8R<l.jv.T6IjL] ]]D"J'RatqaP#~jt0\MI.;d,_TB}
NVRs(8+6|S[4wm[g+W*{c^=q)|KNC7bH*YkFqXtscY	8{<{bZgili{DGX+pNpur[;5h+m`4h}	FB==hg;iTv[[UgiyW-dETF1#k|V->jf* ) 6 J|[5+>ml<Mdc5SE<WaJsXdYU9	qAJV|_9{{G+JGoju2#Xhr3GPMU>bSqgky#m}GC&9UNAB^Srj"kGATw60Cwu9=o'>.%u&F,i0hv5Wr(V0V5emaund4kV0M\ ^E^]7YR$0.!'G2*VhEMSTxTm:cg-k2&Li#TfXkd]B\q;GISlni01EKcc~&yb~[DvktXqgmi,3Y3XY@6Mf&xeOg7q>{KV^87dU]lm5Je7sH4fmQRi>6p.w:UPUD{Us4'2-Y3:vP1G4Q Y4M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M4Z,j{M	d>tl>R-6#!)i$^JtqO{lM)M4JSX~qX+7}[m,HbI[vL(M'`|k"QE]%aB-Ej>*`;gfApSpnr&w5,RDJ~5$Deg$D9ugn~Ra(%XJQ]xO=o|#T)gN?/{j
>bd1ikZ3{1os5
8o6>;IT
8?Xe$JINA<?dJDlV}.Ju:PMUs$[X;rP3*$'JVB_.wvQrak-lEy5TE{ Uk3Is!#'"kwoVeO/x;3<]jt R'z-]Wq:n61hp*xP1yLJVv7ov}1N3&oW'5&4#JG@"jent>M(G$*UMxx^\|53@m-p*%/X-mK@Nc"(&iNtj-oQ:Lp67na
eWBNey9WOJSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSM4M44M)M4JSVw,z4S@Ln+qZ"F&c[/z>EH8l_Pe)Ukm2fYdPbYdvbBnC,	(>DtMG,[eyCl2-+,
sRD9m}}
#(MJ=;VPk'IY 77 -bCl{"P|YFjM0[jZeXl3ah4wzT@CCmNkm*Q}Y 4$"
>zQS1f`P,*}$jTiR-u{a5>pL66]Zk.Sq/Z=2<1kcyEw=s[|/vSb	|oqU_^dq,&4FAj)w;/5DsUkCFA|<$64n)ix
Cml_48Hy1k([]1:W;UHe4+,v]S#|^*fM8mE&PVq3y5c1-5,)>rJ6;,	7wt TC