   AP_Float _ballisticCoef_y;      // ballistic coefficient measured for flow in Y body frame directions
    AP_Float _momentumDragCoef;     // lift rotor momentum drag coefficient
    AP_Int8 _betaMask;              // Bitmask controlling when sideslip angle fusion is used to estimate non wind states
    AP_Float _ognmTestScaleFactor;  // Scale factor applied to the thresholds used by the on ground not moving test
    AP_Float _baroGndEffectDeadZone;// Dead zone applied to positive baro height innovations when in ground effect (m)
    AP_Int8 _primary_core;          // initial core number
    AP_Enum<LogLevel> _log_level;   // log verbosity level
    AP_Float _gpsVAccThreshold;     // vertical accuracy threshold to use GPS as an altitude source
    AP_Int32 _options;              // bit mask of processing options

    // enum for processing options
    enum class Options {
        JammingExpected     = (1<<0),
    };

// Possible values for _flowUse
#define FLOW_USE_NONE    0
#define FLOW_USE_NAV     1
#define FLOW_USE_TERRAIN 2

    // Tuning parameters
    const float gpsNEVelVarAccScale = 0.05f;       // Scale factor applied to NE velocity measurement variance due to manoeuvre acceleration
    const float gpsDVelVarAccScale = 0.07f;        // Scale factor applied to vertical velocity measurement variance due to manoeuvre acceleration
    const float gpsPosVarAccScale = 0.05f;         // Scale factor applied to horizontal position measurement variance due to manoeuvre acceleration
    const float extNavVelVarAccScale = 0.05f;      // Scale factor applied to ext nav velocity measurement variance due to manoeuvre acceleration
    const uint16_t magDelay_ms = 60;               // Magnetometer measurement delay (msec)
    const uint16_t tasDelay_ms = 100;              // Airspeed measurement delay (msec)
    const uint16_t tiltDriftTimeMax_ms = 15000;    // Maximum number of ms allowed without any form of tilt aiding (GPS, flow, TAS, etc)
    const uint16_t posRetryTimeUseVel_ms = 10000;  // Position aiding retry time with velocity measurements (msec)
    const uint16_t posRetryTimeNoVel_ms = 7000;    // Position aiding retry time without velocity measurements (msec)
    const uint16_t hgtRetryTimeMode0_ms = 10000;   // Height retry time with vertical velocity measurement (msec)
    const uint16_t hgtRetryTimeMode12_ms = 5000;   // Height retry time without vertical velocity measurement (msec)
    const uint16_t tasRetryTime_ms = 5000;         // True airspeed timeout and retry interval (msec)
    const uint16_t dragFailTimeLimit_ms = 5000;    // Drag timeout (msec)
    const uint32_t magFailTimeLimit_ms = 10000;    // number of msec before a magnetometer failing innovation consistency checks is declared failed (msec)
    const float magVarRateScale = 0.005f;          // scale factor applied to magnetometer variance due to angular rate
    const float gyroBiasNoiseScaler = 2.0f;        // scale factor applied to gyro bias state process noise when on ground
    const uint16_t hgtAvg_ms = 100;                // average number of msec between height measurements
    const uint16_t betaAvg_ms = 100;               // average number of msec between synthetic sideslip measurements
    const float covTimeStepMax = 0.1f;             // maximum time (sec) between covariance prediction updates
    const float covDelAngMax = 0.05f;              // maximum delta angle between covariance prediction updates
    const float DCM33FlowMin = 0.71f;              // If Tbn(3,3) is less than this number, optical flow measurements will not be fused as tilt is too high.
    const float fScaleFactorPnoise = 1e-10f;       // Process noise added to focal length scale factor state variance at each time step
    const uint8_t flowTimeDeltaAvg_ms = 100;       // average interval between optical flow measurements (msec)
    const uint32_t flowIntervalMax_ms = 100;       // maximum allowable time between flow fusion events
    const float gndEffectBaroScaler = 4.0f;        // scaler applied to the barometer observation variance when ground effect mode is active
    const uint8_t gndGradientSigma = 50;           // RMS terrain gradient percentage assumed by the terrain height estimation
    const uint16_t fusionTimeStep_ms = 10;         // The minimum time interval between covariance predictions and measurement fusions in msec
    const uint8_t sensorIntervalMin_ms = 50;       // The minimum allowed time between measurements from any non-IMU sensor (msec)
    const uint8_t flowIntervalMin_ms = 20;         // The minimum allowed time between measurements from optical flow sensors (msec)
    const uint8_t extNavIntervalMin_ms = 20;       // The minimum allowed time between measurements from external navigation sensors (msec)
    const float maxYawEstVelInnov = 2.0f;          // Maximum acceptable length of the velocity innovation returned by the EKF-GSF yaw estimator (m/s)
    const uint16_t deadReckonDeclare_ms = 1000;    // Time without equivalent position or velocity observation to constrain drift before dead reckoning is declared (msec)
    const uint16_t gpsNoFixTimeout_ms = 2000;      // Time without a fix required to reset GPS alignment checks when EK3_OPTIONS bit 0 is set (msec)

    // time at start of current filter update
    uint64_t imuSampleTime_us;

    // time of last lane switch
    uint32_t lastLaneSwitch_ms;

    // last time of Log_Write
    uint64_t lastLogWrite_us;

    struct {
        uint32_t last_function_call;  // last time getLastYawResetAngle was called
        bool core_changed;            // true when a core change happened and hasn't been consumed, false otherwise
        uint32_t last_primary_change; // last time a primary has changed
        float core_delta;             // the amount of yaw change between cores when a change happened
    } yaw_reset_data;

    struct {
        uint32_t last_function_call;  // last time getLastPosNorthEastReset was called
        bool core_changed;            // true when a core change happened and hasn't been consumed, false otherwise
        uint32_t last_primary_change; // last time a primary has changed
        Vector2f core_delta;          // the amount of NE position change between cores when a change happened
    } pos_reset_data;

    struct {
        uint32_t last_function_call;  // last time getLastPosDownReset was called
        bool core_changed;            // true when a core change happened and hasn't been consumed, false otherwise
        uint32_t last_primary_change; // last time a primary has changed
        float core_delta;             // the amount of D position change between cores when a change happened
    } pos_down_reset_data;

#define MAX_EKF_CORES     3 // maximum allowed EKF Cores to be instantiated
#define CORE_ERR_LIM      1 // -LIM to LIM relative error range for a core
#define BETTER_THRESH   0.5 // a lane should have this much relative error difference to be considered for overriding a healthy primary core
    
    bool runCoreSelection;                          // true when the primary core has stabilised and the core selection logic can be started
    bool coreSetupRequired[MAX_EKF_CORES];          // true when this core index needs to be setup
    uint8_t coreImuIndex[MAX_EKF_CORES];            // IMU index used by this core
    float coreRelativeErrors[MAX_EKF_CORES];        // relative errors of cores with respect to primary
    float coreErrorScores[MAX_EKF_CORES];           // the instance error values used to update relative core error
    uint64_t coreLastTimePrimary_us[MAX_EKF_CORES]; // last time we were using this core as primary

    // origin set by one of the cores
    Location common_EKF_origin;
    bool common_origin_valid;
    
    // update the yaw reset data to capture changes due to a lane switch
    // new_primary - index of the ekf instance that we are about to switch to as the primary
    // old_primary - index of the ekf instance that we are currently using as the primary
    void updateLaneSwitchYawResetData(uint8_t new_primary, uint8_t old_primary);

    // update the position reset data to capture changes due to a lane switch
    // new_primary #pragma once

#include "AP_Networking_Config.h"

#if AP_NETWORKING_BACKEND_SITL
#include "AP_Networking_Backend.h"

class AP_Networking_SITL : public AP_Networking_Backend
{
public:
    using AP_Networking_Backend::AP_Networking_Backend;

    /* Do not allow copies */
    CLASS_NO_COPY(AP_Networking_SITL);

    bool init() override {
        return true;
    }
};

#endif // AP_NETWORKING_BACKEND_SITL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /*
  class for holding IPv4 address parameters
 */

#include "AP_Networking_Config.h"

#if AP_NETWORKING_ENABLED

#include <arpa/inet.h>
#include "AP_Networking.h"
#include <AP_HAL/utility/Socket.h>

const AP_Param::GroupInfo AP_Networking_IPV4::var_info[] = {
    // @Param: 0
    // @DisplayName: IPv4 Address 1st byte
    // @Description: IPv4 address. Example: 192.xxx.xxx.xxx
    // @Range: 0 255
    // @RebootRequired: True
    AP_GROUPINFO("0", 1,  AP_Networking_IPV4, addr[0], 0),

    // @Param: 1
    // @DisplayName: IPv4 Address 2nd byte
    // @Description: IPv4 address. Example: xxx.168.xxx.xxx
    // @Range: 0 255
    // @RebootRequired: True
    AP_GROUPINFO("1", 2,  AP_Networking_IPV4, addr[1], 0),

    // @Param: 2
    // @DisplayName: IPv4 Address 3rd byte
    // @Description: IPv4 address. Example: xxx.xxx.13.xxx
    // @Range: 0 255
    // @RebootRequired: True
    AP_GROUPINFO("2", 3,  AP_Networking_IPV4, addr[2], 0),

    // @Param: 3
    // @DisplayName: IPv4 Address 4th byte
    // @Description: IPv4 address. Example: xxx.xxx.xxx.14
    // @Range: 0 255
    // @RebootRequired: True
    AP_GROUPINFO("3", 4,  AP_Networking_IPV4, addr[3], 0),

    AP_GROUPEND
};


/*
  IPV4 address parameter class
 */
AP_Networking_IPV4::AP_Networking_IPV4(const char *default_addr)
{
    AP_Param::setup_object_defaults(this, var_info);
    set_default_uint32(SocketAPM::inet_str_to_addr(default_addr));
}

uint32_t AP_Networking_IPV4::get_uint32(void) const
{
    uint32_t v = 0;
    uint8_t *b = (uint8_t*)&v;
    for (uint8_t i=0; i<4; i++) {
        b[3-i] = uint8_t(addr[i].get());
    }
    return v;
}

void AP_Networking_IPV4::set_default_uint32(uint32_t v)
{
    uint8_t *b = (uint8_t*)&v;
    for (uint8_t i=0; i<ARRAY_SIZE(addr); i++) {
        addr[3-i].set_default(b[i]);
    }
}

const char* AP_Networking_IPV4::get_str()
{
    const auto ip = get_uint32();
    return SocketAPM::inet_addr_to_str(ip, strbuf, sizeof(strbuf));
}

#endif // AP_NETWORKING_ENABLED
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    #pragma once

#include <AP_Param/AP_Param.h>

/*
  class for an IPV4 address as a parameter
 */
class AP_Networking_IPV4
{
public:
    AP_Networking_IPV4(const char *default_addr);
    AP_Int16 addr[4];

    // return address as a uint32_t
    uint32_t get_uint32(void) const;

    // set address from a uint32_t
    void set_uint32(uint32_t addr);

    // return address as a null-terminated string
    const char* get_str();

    // set default address from a uint32
    void set_default_uint32(uint32_t addr);

    static const struct AP_Param::GroupInfo var_info[];

private:
    char strbuf[16];
};

/*
  class for an ethernet MAC address as a parameter
 */
class AP_Networking_MAC
{
public:
    AP_Networking_MAC(const char *default_addr);
    AP_Int16 addr[6];
    void get_address(uint8_t addr[6]) const;
    void set_default_address_byte(uint8_t idx, uint8_t b);
    static const struct AP_Param::GroupInfo var_info[];
};

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               UUU?????????UUU                                                                  ???                            ???                                                          NNN000/---D+++L---D///0NNN                                                      9991   ***Î333ï988ÿ=<<ÿ988ÿ433ğ(''Î—...1     U                                 FFF(&$$š.--úhhhÿ¡  ÿÊÉÉÿãããıîîîüãããıÌÌÌÿšššÿfeeÿ766ö&%%?HH                             ,))J%$$éeeeÿÅÅÅÿÿÿÿüÿÿÿüÿÿÿşÿÿÿşÿÿÿÿÿÿÿşÿÿÿşÿÿÿüÿÿÿüÊÊÊÿTSSÿ)((İ555d                      )))W877ò†††ÿùùùûÿÿÿÿÿÿÿÿÿÿÿÿ÷ø÷ÿæäæÿàŞàÿæäåÿ÷ø÷ÿÿÿÿÿÿÿÿÿÿÿÿşûûûü–––ÿ...ÿ111w           +((L<;;òºººÿÿÿÿüÿÿÿÿşÿşÿØÖØÿ~ÿ]RZÿLPLÿEJEÿLPLÿ\SZÿ†sƒÿÙÙÙÿÿÿÿÿÿÿÿÿÿÿÿü ŸŸü+))ÿ+++p       3332322ï¸¸¸ÿÿÿÿıÿÿÿÿëíëÿwkuÿ-5-ÿg(ÿ„$ÿ“&ÿš&ÿ’&ÿ‰#ÿj%ÿ645ÿˆz…ÿâåâÿÿÿÿÿÿÿÿş§§§ş988ÿ0++:    2223100è½¾½ıÿÿÿşàààÿ`T]ÿL#ÿ³-ÿ#ÿ _)ÿ,P0ÿ-M0ÿ,Q0ÿ!_*ÿ„%ÿ®+ÿUÿH;EÿÏĞÏÿÿÿÿÿ­­¬ş877ù///;        )&)i@:?ÿ¼»¼ıe\cÿ€!ÿ ,ÿ @$ÿZKWÿ™‰—ÿ¿·¾ÿÀ¹¿ÿ½¶¼ÿŸÿaR^ÿ*>,ÿ™.ÿh%ÿJ;Fÿ¬­¬ü:38ÿ&%&       8%/3:3½)J-ÿ;29ı‹,ÿx&ÿC/?ÿ£›¡ÿôöõÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ÷ú÷ÿ¢š ÿ3,1ÿ‰.ÿ i)ÿ:49ş0U4ÿ241Ô4++    1-1C564ÿÏ)üÍ&şx+ıI9FÿÇÉÇÿÿÿÿÿÿÿÿÿÿÿÿÿñòñÿßŞßÿïğïÿÿÿÿÿÿÿÿÿÿÿÿÿÊÊÊÿLBKÿ‹(şÒ(ÿÂ'ı3E5ÿ3&0O    $H$6&3Œ(g1ÿì'ú*,)ÿ{~ÿÿÿÿÿÿÿÿÿØÙØÿ‚rÿWJUÿHFGÿYJVÿtdqÿÕÙÖÿÿÿÿÿÿÿÿÿofmÿ";$ÿÜ)ú/S3ÿ6#3²3™3       .9.6(3å.Z4ÿ0<1Ü0+/ô±¶²ÿ¯®¯ÿ2)0ÿ_$ÿ¦$ÿ»'ÿ¤%ÿRÿ?-<ÿÁÁÁÿÉÍÊÿ<=;ù1+/è2V6ÿ241Ä000              1<1.7)3533…0-/ô;'8ı:-8ÿ¤%ÿä+ÿ‡#ÿY%ÿ…$ÿŞ+ÿ¡$ÿ?@>ÿG3Cÿ-,-ù464„5,3Š000%                    Ì35)2ü%w/ÿ!t,ş¤)ÿ¸+ı*:,şbM_ÿŒ~ŠÿiWfÿ2/1ÿÃ(ı›(ş})ü+e2ş6$2Ê                             *U*4+1©0N3ÿñ&üâ(ı0,ÿpjoÿüÿüÿÿÿÿÿÿÿÿÿŠ€ˆÿ,7,ÿï(ÿÿ%ı.T2ÿ5%2‰3f3UUU                           "U38!4¿.Q2ÿ-R2ÿ1)/×>A=ò×ÚØÿÿÿÿşÏÑÏÿHKHû1%/Ò(^0ù)h1ÿ5'3Û$[6                                      *?1$5.3ö4*1³6D;8,)âh]fÿËÎËıOEMÿ*'û6B:=4)2·7,4ì/:50                                              -<-(P(4,3ğ*Y0ş&R+ş7#3ÿ!d*ü(r2ş4)1½*U*$<0                                                       ª 4)3·,_2ÿ	à'üÄ'ÿç&û'u1ÿ4)2¿333                                                             .E.7 3Æ’-ÿ ÿ"ù$w/ÿ83è-A4'                                                                      0005322ı.Y3ÿ5-3ï262B                                                                              300O6$3Ÿ262B    UUU                                                                                                                                                                             ???                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      UUU                                                                                   U                                                                                      U          BBB,,,4                                                                    UUU     ///l,++Ø877õ111”                                                                      CCC&(''¨100ÿ ŸŸÿ•••ÿ%%%ø                                                                222V'&&çXXXÿÇÇÇıÿÿÿı¢¢¢ı$""ÿ                                                          KKK-++£0//ÿŠ‰‰ÿõõõüÿÿÿÿóòòüxwwÿ*))ÿ                                                       ;77I$##ÙNMMÿÀ¿¿şÿÿÿıÿÿÿşÅÅÅü^]]ÿ(''ã755i                                               CCC*((‘,++ÿ|{{ÿîîîüÿÿÿşèèèü†††ÿ211ÿ(&&¥AAA'                                              ===!.,,ÒKJJÿ±±±ÿÿÿÿıÿÿÿş´³³ÿLKKÿ'&&Ü444\                                            ???    &$$’YXXÿëëëúÿÿÿÿâââşuttÿ-,,ú*((—QQQ                                                  333    °~}}üÿÿÿûÃÃÃş877ş"!!Ô???L        ???                                                333    !  ¦kjjÿÿÿÿù÷÷÷ÿ¦¥¥şGFF÷%$$Æ555L      U                                                    222G433ı}}}ÿêêêüÿÿÿÿáááÿ|{{ÿ.,,ş)))›QQQ                                                          111H%$$ÓGFFÿµµµşÿÿÿıÿÿÿşµµµşTSSÿ%##è111\ªªª                                                       UUU-++‘,++ş€ÿòññüÿÿÿşìììü‹ŠŠÿ766ÿ'%%ª999,                                                           333T&%%àRPPÿÁÁÁşÿÿÿıÿÿÿşÊÉÉıUTTÿ.--â                                                              JJJ(((544ÿÿôôôıÿÿÿş ŸŸı&$$ÿ                                                                    222f'%%ãUTTÿÔÔÔş¢¢¢ı#""û                                                                          MEE!&%%³@??ÿWVVÿ---É                                                                        ???    ÿÿÿ)))O%""|===!                                                                                                                                                                                      ???                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   UUUUUU                                                                                                UUU                                                                                   ---D333@        UUU                                                                            :99ş433ü(&&ƒfff    ???                                                                        vttÿ¶¶¶şA??ÿ$$$Ë>>>1        UUU                                                                }||ıÿÿÿşÜİİükkkÿ)((î---|     UUU                                                            `__ÿãããıÿÿÿşÿÿÿıœœÿ><<ÿ(''¶>>>-                                                               *))ŞJIIÿ±°°ÿÿÿÿıÿÿÿşÛÚÚü`__ÿ&%%î///k                                                        EEE+**‘)((÷qppÿÛÛÛüÿÿÿıúúúı™˜˜ÿ:99ÿ)''³===!                                                            7;;E'%%Ã=<<ÿœœÿÿÿÿıÿÿÿşÍÍÍıWVVÿ.,,ã:::=                                               UUU    ÿÿÿ.,,*''ìbaaÿËËËÿÿÿÿÿøøøúvuuÿ'&&³ÿÿÿ                                                   ???       MMM+%%%À'''ş¨§§şÿÿÿı¡¢¢ı"!!Îÿÿÿ                                                UUU        >>>9'&&®988óŒŒŒşìììÿÿÿÿûş$##Äÿÿÿ                                                   ___+++z(&&ògeeÿÔÔÔÿÿÿÿÿúúúıÿ>==ÿ222k                                                999G"""ÍDCCÿ¢¢¢ÿııııÿÿÿıÕÕÕü_^^ÿ&%%ê---_                                                   ***.--ıwvvÿßŞŞüÿÿÿşÿÿÿı•••ÿ877ÿ)''³DDD)                                                       GFFÿ±±±ÿÿÿÿıÿÿÿşÔÔÔıihhÿ)''ì...r     UUU                                                    |{{üÿÿÿşÿÿÿı¥¥¥ÿ=<<ÿ&$$ÂBBB*        UUU                                                        |{{üæææünmmÿ'&&ö0..tªªª    ???                                                                POOÿSRRÿ#""Ê<<<C        UUU                                                                    ******‹ªªª    UUU                                                                                                                                                                       UUUUUU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ???                   ???                                                  UUU            ÿÿÿ555333#777                    -<<                                     ÿÿÿ3//F”"  Â***Ù.--ä*))×"!!¿ Ÿ3//@ (CC5-+9+)Ò5..                             666A"!!Ç655şrrrÿ£££ÿ»»»ÿÃÃÃÿºººÿ   ÿnnnÿ422ş#&'­7*&».MVÿ‘«ÿ3BEÿ5&%$Hm             ...ˆ+**ú€€€ÿÒÒÒÿÉÉÉüümmmıjjjıoooıüÇÇÆüÍÏÏÿrkiÿ*=Bÿ®×ü
°ÔıÃü3BFÿ3,)n       ™™™+++—;::ÿ¸¸¸şÍÌÌı^]]ÿKJJÿwwwÿ“““ÿÿ“’’ÿpnnÿGIJÿypnÿ‚’ı«ÖıtŠÿ3..ÿÅôû(apü6#§         .,,y544ÿÍÍÍû©¨¨ş0//ÿ‘‘‘ÿÛÛÛÿ¹¸¸ÿ‰ˆˆÿuttÿ‡††ÿ»½¾ÿÈÀ¾ÿCPTÿ ¤Ğÿ|”ÿ<ÿˆ£ÿš»ı7-+ÿ.55G        911,++øµµµş²²²ş/..ÿÈÈÈÿ¿¿¿ÿ?>>ÿ766ÿ[[[şgffÿY\]ÿ;31ÿ@NRÿ¼çş{“ÿ:ÿ%\kÿ¹åı0CHÿ3+%”         -++’IHHÿüEDDüÇÇÇü£¢¢ı%$$ÿ‹‹‹ÿ×××şÅÅÅÿµ·¸ÿÇ¾»ÿetyÿ¤ÎşuŒÿ9$ÿ0;=ÿ·ãü%fwÿ7&!Ô_      """100ØŒŒŒÿKKKşEEEÿ’’’ÿ&%%ÿƒ‚‚ÿÎÍÍÿXXXÿ023è.%#ü1CHÿ´àşz’ÿ6'#ï5*(÷¯ÿ“²ı7(%õ2::=           111¡MLLÿ@==ó+))”"!!ª///¶LJJı888ï&''Ï6&"á,EMü	«Õşy‘ş7(%ç8"Õ#fwü´ßü3:<ÿ3--w    UUU            $$$!D($$8        "(+X0,,6-*è$hzÿÍşÿ›½ÿ;ÿ3.,û'Vbÿ½ëû']kÿ7'#Â.\sUUU                               $HH4)'‡9('Ä411ö!mÿ	±Üıoÿ¢Æÿ¯ÿŸÃş¹æü v‹ÿ5*(î/;;+                           UUU?  $mm4.+¼2IOÿˆ ÿ«ÓÿÁêş–¶ÿ8&#ÿÃş
­Õÿ%fwÿ1<?ÿ6.-ß333P    ***UUU                   UUU    3+)‡3=?ÿµàúš¸ÿ&Zfÿ.?Eÿ Äÿ¿ãşÂÿ343ş;#«741S??                                       269B7,*ÿ˜»ü’²ÿ7%"ì8"ü0AEÿ®Øş–ÿ732ò542¿#''É(((»BBB*(((,333()))c'''mEEE      U  (GQ7$ Ò"lş³Şı178÷7(#ã+HPü°İşdyş+ï#""İ$$%çƒ‚‚ÿtssÿ%$$ó766ê100éNMMÿWVVÿ+++€       U      5,)•2DHÿ¶âü&Ygÿ8"ş.EKÿ	²ŞÿJ•¨ÿ{lhÿeggüvvvÿ¿¿¿ÿ×××şFEEı\[[ÿÂÂÂÿ-,,ÿkkkùvvvü'''½         252Q5-+û¡Æü‡£ÿ9 ÿ-HNÿ	²ŞÿYkÿ]OKÿ³¶¶ÿÁÁÁÿ´³³ÿ~}}ş,++ÿa``ÿéèèşhhhıuttü¡¡¡ü(&&ô588H    1?F$7% ázÿ³Üı7)%ÿ.CHÿ ¬Ùÿ:‰ÿ ’ÿacdÿ?>>ÿ;::ÿBAAÿWWWÿ¯°°ÿàààÿ[ZZÿSRRÿëììújiiÿ*((µ       7("‹+Wbÿ·âü.@Eÿ.?Cÿ
´áş5“ÿA2.ÿ‹ÿÁÁÂÿÈÈÈÿÆÅÅÿËÊÊÿÅÄÄÿŒŒŒÿ=<<ÿzyyÿåååûnmmÿ$##ØAAA          6'#¶$hyÿµàú'[gÿ	°Ûı"m€ÿ£“ÿÈËÌühggıNNMÿHHHÿMMMÿIGGÿPOOÿqppıËËËüÍÍÍşXXXÿ&$$ÖBBB.               37:J7*'õ rˆÿ Ìÿù!r†ÿ4%"ò:;<ı€ÿÅÅÅÿÏÏÏüÂÂÂú¼¼¼úÂÁÁûÓÓÓüÅÅÅÿ}||ÿ100ÿ(''¨KKK    UUU                3//P6-,å5:;ÿ6.-ë522G+++G!  µ.--ëBAAÿJIIÿKJJÿJIIÿA@@ÿ---è!ª3//K                               3::#5,(Q066*         111)&&&I"""Q"""Q%""Q&&&I444'                                                                                                                                    ???U                ???????????????                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  UUU                                                                                                                                                                                  333;   v-**U\\\                                                                  UUUÿÿÿ0..211ıYXXÿ@??ÿ+++ÈJJJ    UUU                                                           100/..ÿ   ÿóóóıËÌÌıHHHÿ)((ÌLLL    UUU                                         ÿÿÿ...“322ÿ¦¦¦ıÿÿÿşÿÿÿÿÿÿÿÿÕÔÔüKJJÿ*))ÌKKK    UUU                                        ...•533ÿ®­­üÿÿÿşıııÿşşşÿüüüÿÿÿÿÿÜÛÛüPOOÿ(&&ÒEEE!    UUU                           ™™™-,,œ888ÿ¶¶¶üÿÿÿÿıııÿÿÿÿÿÿÿÿÿÿÿÿÿüüüÿÿÿÿÿßßßüVUUÿ)''ÓLLL    UUU                         ,,,Ÿ;::ÿ½½½üÿÿÿşıııÿşşşÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿüüüÿÿÿÿÿæææü[ZZÿ'&&ÙCCC&                  \\\*((ª;99ÿÄÃÃûÿÿÿÿùùùÿüüüÿüüüÿüüüÿüüüÿüüüÿüüüÿüüüÿúúúÿÿÿÿÿçççü\ZZÿ&%%Ù;55+                  -++{MLLÿÙØØûÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşÿÿÿşıÿÿúpooÿ-**¿UUU	          (((·mllÿ¼¼¼ÿ°°°ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ²²²ÿ°°°ÿ¼¼¼ÿÿ/..ê888              :559***¹é"!!æ"!!ç"!!ç"!!ç"!!ç"!!ç"!!ç"!!ç"!!ç"!!ç"!!ç"!!ç"!!åê'%%Ñ533_                       	ŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸŸª	¿¿¿                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                       
ÿÿÿ                                               ÿÿÿ///"!!ñ%$$ç533h          ?__0//#  ğ'&&É333E                                           )))J=<<ÿ­­­ÿ™˜˜ÿ.--ù666/        )))nDCCÿ±±±ÿƒ‚‚ÿ)((Ö\\\                                       !!!zZYYşÿÿÿıÿÿÿû]\\ÿ$##˜    OOO%$$ÑŠŠŠüÿÿÿûÒÒÒı211ş999,                                       2228433üÊÊÊÿÿÿÿüş(''İUUU	2--3544úÓÓÓÿÿÿÿü•••ş$##×ªªª                                        ÿÿÿ"  Éÿÿÿÿüàßßş;::ÿ622B'''{_^^ÿÿÿÿüôôôıMLLÿ)''u                                       UUU    +++pEDDÿïïïüÿÿÿılllÿ*))§#%%Õœœÿÿÿÿü³²²ÿ+**ë666!                                       UUU    =FF)))æ¦¦¦şÿÿÿı­­­ÿ$##ë=<<üÛÛÛÿüüüüfeeÿ#!!­ÿÿÿ                                          UUU   ###™eddÿûüüıèççÿ:99ÿ`__ÿüûûÿÏÎÎş211ı622B                                                     444:0//øÊËËÿÿÿÿÿlkkşÿÿÿÿı‡††ÿ#!!Ä                                                          #!!Ä„„„şÿÿÿıÃÃÃÿçççÿòòòüFEEÿ***k    UUU                                                       .,,hA??ÿóóóúÿÿÿÿÿÿÿü¦¦¦ü)((è===    UUU                                                      J??*))ä€€€ÿûûûùÜÜÜúPOOÿ))) UUU                                                            ///P000ä?>>ÿ988ÿ/..¼???                                                                          3::#***N/,,K_??                                                                                                                                                                                ??????                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ???333???                                                                                                                                                                       ???*((¬$$$“:::'                                                             UUU   ???,**¸POOÿxwwÿ\\\ÿ///Ş999                  ™™™
™™™ÌÌÌ™™™
	    Ì™™™™™
	       111]766ÿİİİùÿÿÿû÷÷÷ùXWWÿ'%%    UUU    ?33.,,±#""ô&$$Ö#""×!  õ"!!í+)) %$$Ô!  õ!  ë)((«444'    #""²zyyşÿÿÿüùùùÿÿÿÿü£££ş)((ß???      ***ySSSÿ½½½ÿ‡‡‡ÿ–••ÿÀÀÀÿ²±±ÿWVVÿÿ¿¿¿ÿ·¶¶ÿihhÿ-,,Ö:66O.--îÁÁÁÿÿÿÿÿ°°°ÿöööÿğğğüEDDÿ/,,g    U  $##§zyyıÿÿÿüÿÿÿşüüüşÿÿÿşÿÿÿşıııüÿÿÿşÿÿÿşÿÿÿşğğğüONNÿ%##ãZYYú÷÷÷ÿîîîÿNMMÿÉÉÉÿÿÿÿı‡‡‡ş!  ÕŸ    $##¦xxxÿıııııııÿkkkÿƒƒƒÿüüüÿÿÿÿÿ‘‘‘ÿiiiÿúúúÿÿÿÿÿqppş#""ÿ¢¡¡ÿÿÿÿÿ½½½ÿ(&&ÿ“’’ÿıııÿÔÓÓş877ÿ/,,Q    $##¦xxxÿÿÿÿıíííÿ,++ÿWWWÿÿÿÿÿüüüÿJIIÿ0//ÿøøøÿşşşÿlkkÿ877şğğğÿÿÿÿÿÿÿÿşÿÿÿüÿÿÿşÿÿÿÿÿÿÿüuuuş$##§$##¦xwwÿÿÿÿıæææÿ433ÿ\\\ÿÿÿÿÿûûûÿJIIÿ988ÿ÷÷÷ÿÿÿÿÿbaaÿ{{{ÿÿÿÿÿïïïÿ´´´ÿ···ÿ¯¯¯ÿŞŞŞÿÿÿÿşºººÿ,++ğ:550%##¥yxxşÿÿÿıéééÿ211ı\\\şÿÿÿÿüüüÿKJJş766şùùùÿşşşÿsrrÿÆÆÆÿÿÿÿş¦¦¦ş(''÷211Õ#!!é~~~şÿÿÿşúúúıWWWÿ(&&Š&$$­vuuÿÿÿÿúâââû211ÿUUUÿÿÿÿüûûûüEDDÿ766ÿóóóşÿÿÿü}||ûßßßüÿÿÿúhggş#""£PPP---eBBBÿğğğùÿÿÿùuttÿ$$$§111W988ø{||ÿ]\\ÿ/..Ñ555âwvvÿjiiÿ433È655Ähhhÿ{{{ÿ433ÿfffÿvvvÿ877ÿ1-->    666...Ûbaaÿ{zzÿ766ø.11M    0--T&%%¤*((„999000E&&&š)((Œ+**µ"!!Õ%%%Ê$$$›333x'''”$$$™000I           555&(((ƒ&%%¤0--T                         ---QPPÿwvvÿKJJö111†                                                          HHH***İ®­­ÿÿÿÿú¤££ÿ&%%Û¥¥¥ŸŸŸ                                                           333///Ş°°°ÿüüüı¨¨¨ÿÿ$##õ"!!ä-++’<<<                                                     666...İ±±±ÿÿÿÿı¹¹¹ÿŸŸŸÿÀÀÀÿ«ªªÿSSSÿ***µªªª                                                  666...İ³³³ÿÿÿÿıÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿşÑÑÑü766ÿ111C                                                  666...İ²²²ÿÿÿÿıåååÿVUUÿzyyÿüüüÿõôôıZYYşt    UUU                                           666...İ°°°ÿÿÿÿı°°°ÿòPPPüñññÿÿÿÿı`__ÿ‚    ???                                           666...İ°°°ÿÿÿÿü«««ÿéXWWûğïïÿÿÿÿı`__ÿ    ???                                           666...Û°°°ÿÿÿÿü­­­ÿêXWWúñññÿÿÿÿıa``ş‚    ???                                           888---æ±±±üÿÿÿù¦¦¦ûéQPPûïïïüÿÿÿú[ZZÿ       UUU                                          ªªª+++™POOÿÿNLLÿ/--–211êmmmÿqppÿ544ı---8                                                      UUU+))###¤,**m888	333<(&&—&&&—000E                                                                                                                                                             UUUUUU      UUU                                                                                                                                                                    ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ                                                                    ÿÿÿ    ÿÿÿ8ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ9    ÿÿÿ                                                            ÿÿÿ    ÿÿÿÿÿÿTÿÿÿVÿÿÿSÿÿÿ    ÿÿÿ                                                                                                                                                                    ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ???333333333333333???                                                                                                                                                              111#!!ˆ¬¬¬¬¬›+++G                                                    ***100Ò___ÿ{{{ÿ{zzÿ{{{ÿ{zzÿ{{{ÿpooÿ>==ü.++L    UUU                                           111)655ÿ···ıÿÿÿöÿÿÿöÿÿÿöÿÿÿöÿÿÿöïïïõWVVÿ)''z    UUU                                           ???333Ÿ766ı<;;ÿ<;;ÿ<;;ÿ<;;ÿ<;;ÿ988ÿ433Ò000*                                                      +++;+++S+++S+++S+++R+++S***H***                                                                                                                                                             UUU??????????????????                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ÿÿÿÿÿÿÿÿÿ                                                                                                                                                                                ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ                                                                    ÿÿÿ    ÿÿÿ8ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ9    ÿÿÿ                                                            ÿÿÿ    ÿÿÿÿÿÿTÿÿÿVÿÿÿSÿÿÿ    ÿÿÿ                                                                                                                                                                    ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     444M)''³---offf                                                                         000/..ĞqppÿECCÿ*((‘                                                               UUU    666/$""ïÔÔÔıÆÆÆú533ÿ---‹                                                           UUU    888-$##íÄÃÃÿÿÿÿü²±±ü544ÿ.,,…                                                       UUU    888-$##îÆÅÅÿÿÿÿıÿÿÿş«ªªş100ÿ///€                                                   UUU    888-$##îÆÅÅÿÿÿÿıüüüÿÿÿÿş£¢¢ı/--ÿ/--|                                               UUU    888-$##îÆÅÅÿÿÿÿııııÿşşşÿÿÿÿş›ššş-,,ÿ200z                                            UUU    888-$##îÆÅÅÿÿÿÿııııÿşşşÿşşşÿÿÿÿş”““ı+**ı0..t                                         UUU    888-$##îÆÅÅÿÿÿÿııııÿÿÿÿÿşşşÿşşşÿÿÿÿıÿ...è811$                                        UUU    888-$##îÆÅÅÿÿÿÿııııÿÿÿÿÿÿÿÿÿıııÿÿıışéêêşKKKúE                                        UUU    888-$##îÆÅÅÿÿÿÿııııÿÿÿÿÿÿÿÿÿıııÿÿÿÿş¹ººı877ó-((3                                        UUU    888-$##îÆÅÅÿÿÿÿııııÿÿÿÿÿıııÿÿÿÿÿÅÆÆûA??ÿ+**ª__                                        UUU    888-$##îÆÅÅÿÿÿÿııııÿıııÿÿÿÿÿÊÉÉıA@@ÿ(((¶PPP                                            UUU    888-$##îÆÅÅÿÿÿÿıûûûÿÿÿÿÿÓÓÓûFEEÿ)''ºZZZ                                               UUU    888-$##îÆÅÅÿÿÿÿıÿÿÿÿÖ××ıJIIÿ(((½HHH                                                   UUU    999,$##íÂÁÁÿÿÿÿıÜÜÜüNNNÿ'''À]]]                                                       UUU    5550#""ğÕÔÔıíííùPOOÿ(''ÃJJJ                                                                  ...!*))â™˜˜ÿbaaÿ&%%ÇMMM                                                                         633v0..à-,,²?77                                                                                   911                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        UUU                                                                                                                                                                                        955>*((/--qUUU                                                                          ...L0//ökjjÿBAAúD                                                                      888H'&&ğ„„„ÿúúúùNMMşu    UUU                                                           888D'&&î{{{ÿúúúüöööıIHHÿp    UUU                                                       999B'''êvvvÿõõõşÿÿÿÿòòòıKJJÿq    UUU                                                   <<<?%%%ëonnÿöööüÿÿÿÿşşşÿôôôıKJJÿq    UUU                                                ;;;<(''çjhhÿïïïıÿÿÿÿıııÿÿÿÿÿôôôıKJJÿq    UUU                                            888?'$$äbbbÿîííüÿÿÿÿıııÿşşşÿÿÿÿÿôôôıKJJÿq    UUU                                            +**¶___ÿêêêüÿÿÿÿşşşÿÿÿÿÿşşşÿÿÿÿÿôôôıKJJÿq    UUU                                            .--â¸¸¸ıÿÿÿşüüüÿÿÿÿÿÿÿÿÿşşşÿÿÿÿÿôôôıKJJÿq    UUU                                            ***ËƒƒƒÿÿÿÿışşşÿşşşÿÿÿÿÿşşşÿÿÿÿÿôôôıKJJÿq    UUU                                            111m-,,ş’’’şÿÿÿşşÿÿÿşşşÿşşşÿÿÿÿÿôôôıKJJÿq    UUU                                             ///v,++ş™™™ıÿÿÿşıııÿıııÿÿÿÿÿôôôıKJJÿq    UUU                                                111|.--ÿ ŸŸşÿÿÿşıüüÿÿÿÿÿôôôıKJJÿq    UUU                                                   ...~0//ÿ©¨¨ıÿÿÿşşşşÿôôôıKJJÿq    UUU                                                       ...ƒ433ÿ°°°ıÿÿÿşñññıJIIÿp    UUU                                                           ---ˆ433ÿ¸¸¸ûÿÿÿûKJJşu    UUU                                                              ÿÿÿ)''A??ÿ¥¥¥ÿKKKÿ_                                                                          ÿÿÿ...ˆ/..å333»5**                                                                                  888$***                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ªªª‹‹‹	                                                                         ???222z'%%Ş$##ô%$$ï///Œ???                                                          UUU    ---3644ÿš™™ÿ¶¶¶û¢¢¢ÿEEEÿ)))P    UUU                                                          ,,,422ºGFFÿNMMÿJIIÿ555Î111$                                                                      333!!!D!!!S#  O***                                                                                                                                                                             ?????????                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ªªª‹‹‹	                                                                         ???222z'%%Ş$##ô%$$ï///Œ???                                                          UUU    ---3644ÿš™™ÿ¶¶¶û¢¢¢ÿEEEÿ)))P    UUU                                                          ,,,422ºGFFÿNMMÿJIIÿ555Î111$                                                                      333!!!D!!!S#  O***                                                                                                                                                                             ?????????                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ªªª‹‹‹	                                                                         ???222z'%%Ş$##ô%$$ï///Œ???                                                          UUU    ---3644ÿš™™ÿ¶¶¶û¢¢¢ÿEEEÿ)))P    UUU                                                          ,,,422ºGFFÿNMMÿJIIÿ555Î111$                                                                      333!!!D!!!S#  O***                                                                                                                                                                             ?????????                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ???UUU   ??????UUU      ??????UUU                                                                                                                                            111,))P777.A::',))P+++S///;ÿÿÿ666!-**N.++S3//A                                        3336222à?>>ÿ/..ğ(''è:99ÿ>==ÿ322ü%$$¼,++á988ÿ?>>ÿ433ÿ(''©???                          ???    "  –cccÿûûûø¦¥¥ÿ›ššÿÿÿÿùÿÿÿúÎÎÎÿmmmÿ±°°ÿÿÿÿûÿÿÿúÈÇÇûRQQÿ+++«                        333    ®{zzıÿÿÿûÿÿÿşºººşqppÿĞĞĞÿÿÿÿşÿÿÿüÈÇÇşuuuÿĞÏÏÿÿÿÿşÃÃÃü)((ğGGG                       333    «wvvÿÿÿÿûáááÿFDDúãÿııışôôôÿCCCüü|{{ÿıııÿĞĞĞÿ988ş...7                       333    ¬vvvÿÿÿÿûĞĞĞÿ;;;ï(''¢yxxÿÿÿÿüİİİÿ988ë$##ësrrÿÿÿÿşÎÎÎÿ877û///6                       333    ¬vvvÿÿÿÿûĞĞĞÿ:::ğ#""«yyyÿÿÿÿüÕÕÕÿ:99ä!  ätttÿÿÿÿşÏÏÏÿ877ü///6                       333    «uuuÿÿÿÿûĞĞĞÿ:::ï$""¨xxxÿÿÿÿüÔÔÔÿ977ä!  ãsssÿÿÿÿşÎÎÎÿ877û0005                       333    ¯yyyıÿÿÿûÒÒÒş999ò#!!­}||ıÿÿÿüÛÛÛş988å êxxxüÿÿÿşÔÔÔş:99ı+++:                       ???    &$$’YXXÿğğğ÷«ªªÿ(''Ú-,,‹ZXXÿ÷öö÷«««ş...Û*((¶WWWÿïïïù­¬¬ÿ*))î???                              666!///Ğ=;;ÿ655ù...t444"0//Ö>==ÿ655ÿ///pBBB0..Ô=;;ÿ544ø/--|                                       888,))P...7    :::,,,P2..Bÿÿÿ    888,))P...7                                                                                                                                       ???UUU          ???UUU          ???UUU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ??????U                 ?????????                                                                                                                                              EEE,,,P)))O666*            ;;;+++L+++S-**N8//                                        222Q+**Ø:99ÿ:99ÿ/..ë.,,„ ,,,P...à;::ÿ=<<ÿ988ÿ0//Ü5//+                                  9991-,,ò€€ÿùùùùÿÿÿû²±±ÿ>==ÿ000211íÿïîîûÿÿÿúÿÿÿøhggÿ#""–    ???                           '%%€\[[ÿÿÿÿù¥¥¥ÿ}}}ÿüııüıÛZZZøúúúıüııÿ’’’ÿvuuüPOOı,**    ???                           €€€üôôôüAAAÿÿÕÕÕÿÍÌÌÿÿ]]]ÿşşşÿÙÙÙÿ%$$şÿ/..µ???                           UUU    ,))hGFFÿèééùâââşÕÕÕşÿÿÿıqppü………şÚÚÚÿıııÿõôôÿÓÒÒı†……ş'&&»                                   ===*))ÇLKKÿº¹¹ÿËÊÊÿxwwÿ.--ÿ“““ÿÙØØÿıııÿõõõÿĞÏÏşˆ‡‡ÿ'&&Ö¿¿¿                                       9EE-,,– ññ&$$®<<<wáYYYÿÿÿÿşÚÙÙÿ0//ş#  Ó=::O                                                  
™™™
ÿÿÿ    ###—nmmÿÿÿÿûŞİİÿGFFÿ+++L                                                             ???   —kjjÿÿÿÿûİÜÜÿCBBÿ%%%J                                                            ???    —kjjÿÿÿÿûÜÛÛÿCBBÿ%%%K                                                               ???    ˜mllşÿÿÿûİÜÜÿDCCş$$$M                                                               ???    "  †\[[ÿÿÿÿù×××ü655ÿ...7                                                                      0005544ùonnÿ\[[ÿ+++Ìfff                                                                           ///@¨%##‰===                                                                                                                                                                                 333???                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ??????U                                                                                                                                                                               EEE,,,P)))O666*                                                                        222Q+**Ø:99ÿ:99ÿ/..ë.,,ƒ                                                               9991-,,ò€€ÿùùùùÿÿÿû²±±ÿ?>>ÿ1..m    333                   UUU                               '%%\[[ÿÿÿÿù¥¥¥ÿ}}}ÿüüüüœœœı"!!Ôÿÿÿ     ª	™™™
ªªª                                    !!€€€üôôôüAAAÿÿÕÕÕşÊÊÊıêÆÆÆ	1..b%##¹ìõ Û)''“8336                       UUU    +))iGFFÿèééùâââşÔÔÔÿÿÿÿûywwÿ'&&¹0..£755ÿƒƒƒÿÂÂÂÿÌÌÌÿ¬««ÿ`__ÿ,++ò222Q                      ===*))ÇLKKÿº¹¹ÿÊÊÊÿyyyÿ0//é---´EDDÿÎÎÎüÿÿÿıİİİÿÉÉÉÿüûûıÿÿÿú‡††ÿ,++ä===                          9EE-,,– ñğ(''°;;;R*((Ô¢¢¢şÿÿÿü¿¿¿ÿ(((ÿú]\\ÿòòòÿïïïü;::ÿ---I    ???                           
‰‰‰ --->:99ÿæææıÿÿÿünnnÿ#""¤SSS+)((Ñ```ÿhggÿ322Õ111$                                        +++W@??ÿÿÿÿúÿÿÿû^^^ÿ-**w    877‹-,,ÿ.--ÿ/..¼??                                     ???    ///@666üİİİıÿÿÿü}}}ÿÁ444o"!!ò§§§ÿÛÛÛı=;;ÿ.++M    UUU                                       FFF)''ÙşÿÿÿüßßßÿRQQÿ544ÿ‡††ÿÿÿÿşëëëü?>>ÿ-**N    UUU                                    UUU    ///`988ÿÿôõõüÿÿÿùÿÿÿ÷ÿÿÿü×××ıcbbÿ)))ËFFF                                                     1..r(&&òUTTÿzyyÿ|{{ÿjiiÿ=<<ÿ'''Ê>>>%                                                              AAA#%%%‡¬¬“---Osss                                                                                                                                                                    ???333333???                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ?????????          ???UUU                                                                              U                                                                          <<<&,,,P+++S-))O?66    666!+++S///A                                                       .,,h/..è=<<ÿ?>>ÿ=<<ÿ,,,Ô2//[0//Û@??ÿ644ÿ///u                                          1..S655ÿšššÿôôôûúúúúñññûpppÿ%$$üa``ÿûûûù¨¨¨ş-,,í:::#                                      &&&®yyyşÿÿÿúÿÿÿÿüüüÿüüüÿš™™ÿ!  üıÿÿÿşæææı<<<ş333E    ???                           UUU333†ú}||şÿÿÿş×××ÿ:99ÿ.,,ÿ:99ñç~~ÿÿÿÿşâââş(''ş'&&Ü944:                       UUU    &&&PEDDÿ£££ÿÔÔÔÿşşşÿëëëÿ···ÿzyyÿ&%%õxxxÿÖÖÖÿıııÿôôôÿ½¼¼üxwwÿ,**ÅHHH                  ???    """}VUUşÿÿÿüÿÿÿÿıııÿÿÿÿÿÿÿÿÿÈÇÇş$##ÿÆÆÆÿÿÿÿÿüüüÿÿÿÿÿÿÿÿı½½½ı-,,ì888$    U                     111)755ñ\\\ÿª©©şşşşÿİİİÿuuuşQPPÿ-,,ìGGGü­­­ÿşşşÿìììÿvuuüLKKÿ.,,›UUUUUU                          <<<?å|{{ÿÿÿÿıÌÌÌÿ*))ş%##LLL2Æÿÿÿÿıãââş*))ÿ'%%›H66                                     '%%¶‰ˆˆÿÿÿÿûÑÑÑÿ;::ı5;;+    &##´ŒŒŒÿÿÿÿüåååı<<<ÿ111>   333                              #!!¼‡††ÿÿÿÿûĞĞĞÿ877ı1,,9ÿÿÿ$!!¶ŠŠŠÿÿÿÿüåååı<<<ÿ;;;8                                     #""»‡††ÿÿÿÿûĞĞĞÿ877ı///6 $!!·ŠŠŠÿÿÿÿıäääş,,,şÂ'''s:NN                              #""»‡††ÿÿÿÿûÏÏÏÿ988ı...7 #""²ˆ‰‰şÿÿÿıñññÿ€€ÿsrrÿQPPÿ,,,Š                           #!!¼ˆ‡‡üÿÿÿúÓÒÒı211û000/    '''‡[ZZÿÿÿÿùÿÿÿşÿÿÿÿÿÿÿøû#""º                         UUU    (%%yNNNÿ¸¸¸ÿ€ÿ'&&Ï    333(/..òyxxÿ¸¸¸ÿºººÿ”””ÿ?>>ÿ000t                                 ???-++"  î'''Ê666F        844?'%%¶!  ì"!!ô%##Ü/--u$$$                                          ªªª	ªÿÿ                    ªªª	™™™
ªªª                                                                                                                                                                                                                                                                                                                                                                                                                                      ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ                                                                                                                                       ÿÿÿÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ
ÿÿÿ                           ÿÿÿ)))²feeşº¹¹õ¸··ø¸¸¸ø¸¸¸ø¸¸¸ø¸¸¸ø¸¸¸ø¸¸¸ø¸¸¸ø¸¸¸ø¸··øº¹¹õfeeş)))²ÿÿÿ                          5550-,,¿$##ö$##÷#""ø#""ø#""ø#""ø#""ø#""ø#""ø#""ø$##÷$##ö-,,¿5550                                    ™™™










™™™
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          333333333333333333                                                                                                                                                                  .++L §¬¬¬¬ §.++L                                                          ---I988ÿmkkÿvuuÿuttÿuttÿvuuÿmkkÿ988ÿ---I                                               333    !¢kkküÿÿÿ÷ÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿ÷kkkü!¢    333                                        ???    (((pMLLÿ­­­ÿ¹¹¹ÿ¹¸¸ÿ¹¸¸ÿ¹¹¹ÿ­­­ÿMLLÿ(((p    ???                                               ???,,,•"!!ï!  õ!  ô!  ô!  õ"!!ï,,,•???                                                               	™™™
™™™
™™™
™™™
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              UUU333333333333333333333333333333333333UUU                                                                                                                                   ???(((q««¬¬¬¬¬¬¬¬««(((q???                           ---“MLLÿ{{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ|{{ÿ{{{ÿMLLÿ---“                       ¶‘‘#""Ş¬««óÿÿÿïÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿñÿÿÿï¬««ó#""Ş¶‘‘                          ÿÿÿ
™™™
™™™
²™™
²™™
²™™
²™™
²™™
²™™
²™™
²™™
™™™
™™™
ÿÿÿ
                                                                                                                                                                                                                                  ‹‹‹™™™
™™™
™™™
™™™
™™™
™™™
™™™
™™™
™™™
™™™
‹‹‹                                    666**))º!  ó!  ô!  õ!  õ!  õ!  õ!  õ!  õ!  õ!  õ!  ô!  ó*))º666*                          ÿÿÿ(((¼onnÿ¹¹¹ÿ¹¸¸ÿº¹¹ÿº¹¹ÿº¹¹ÿº¹¹ÿº¹¹ÿº¹¹ÿº¹¹ÿº¹¹ÿ¹¸¸ÿ¹¹¹ÿonnÿ(((¼ÿÿÿ                      ¶¶¶#!!é°°°ûÿÿÿùÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿù°°°û#!!é¶¶¶                       ---‘KJJÿuttÿuuuÿuuuÿuuuÿuuuÿuuuÿuuuÿuuuÿuuuÿuuuÿuuuÿuttÿKJJÿ---‘                           LLL
*''s¬¬¬¬¬¬¬¬¬¬¬¬*''sLLL
                                                                                                                                  UUU333333333333333333333333333333333333UUU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             	™™™
™™™
™™™
™™™
	                                                               EEE.,,”"  ğ!  õ!  ô!  ô!  õ"  ğ.,,”EEE                                               ???    )''oLKKÿ­¬¬ÿ¹¹¹ÿ¹¸¸ÿ¹¸¸ÿ¹¹¹ÿ­¬¬ÿLKKÿ)''o    ???                                        333    !¢lkküÿÿÿ÷ÿÿÿúÿÿÿúÿÿÿúÿÿÿúÿÿÿ÷lkkü!¢    333                                               000J:99ÿmllÿvuuÿuttÿuttÿvuuÿmllÿ:99ÿ000J                                                          ...M §¬¬¬¬ §...M                                                                                                                                                                  333333333333333333                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       UUU????????????????????????????????????UUU                                                                                                                                      333-.++S+++R+++S+++S+++S+++S+++S+++S+++S+++S+++R.++S333-                                   222[322ï?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ322ï222[                           ÌÌÌ%$$Û•””ÿÿÿÿøúúúúüüüúüüüúüüüúüüüúüüüúüüüúüüüúüüüúúúúúÿÿÿø•””ÿ%$$ÛÌÌÌ                        ÌÌÌ%$$Û•••ÿÿÿÿøúúúúüüüúüüüúüüüúüüüúüüüúüüüúüüüúüüüúúúúúÿÿÿø•••ÿ%$$ÛÌÌÌ                           444]322ï?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ322ï444]                                   111..++S+++R+++S+++S+++S+++S+++S+++S+++S+++S+++R.++S111.                                                                                                                                      UUU????????????????????????????????????UUU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ??????????????????                                                                                                                                                                 <00---O+++S+++R+++R+++S---O<00                                                           777%1//Õ;::ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ;::ÿ1//Õ777%                                               ???    #!!^^^ÿñññøûûûúûûûúûûûúûûûúñññø^^^ÿ#!!    ???                                        ???    #!!_^^ÿñññøûûûúûûûúûûûúûûûúñññø_^^ÿ#!!    ???                                               555&0//Ö;::ÿ?>>ÿ?>>ÿ?>>ÿ?>>ÿ;::ÿ0//Ö555&                                                           777,,,P.++S.++S.++S.++S,,,P777                                                                                                # NMEA 2000 EFI driver

This driver implements support for marine EFI systems using NMEA 2000
CAN messages.

# Parameters

The script used the following parameters:

## EFI_2K_ENABLE

this must be set to 1 to enable the driver

## EFI_2K_OPTIONS

This sets options for the driver. Currently the only option is to set
EFI_2K_OPTIONS to 1 to enable logging of the raw CAN frames for
debugging purposes.

# Operation

This driver should be loaded by placing the lua script in the
APM/SCRIPTS directory on the microSD card, which can be done either
directly or via MAVFTP. The NMEA_2000.lua module from
AP_Scripting/modules/ also needs to be put in the APM/SCRIPTS/MODULES directory.

The following key parameters should be set:

 - SCR_ENABLE should be set to 1
 - EFI_TYPE should be set to 7
 - EFI_2K_ENABLE should be set to 1
 - EFI_2K_CANDRV needs to be set to the CAN driver number
 - CAN_Pn_BITRATE needs to be set to 250000
 - CAN_Dn_PROTOOCOL needs to be set to 10 for scripting

then the flight controller should rebooted and parameters should be
refreshed.

Once loaded the EFI_2K_ENABLE parameters will appear and should be set
according to the parameter list above.

The GCS will receive EFI_STATUS MAVLink messages which includes RPM,
cylinder head temperature, exhaust gas temperature, injection timing,
engine load, fuel consumption rate, throttle position atmospheric
pressure and ignition voltage.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "AP_TemperatureSensor.h"

#if AP_TEMPERATURE_SENSOR_ENABLED

#include <AP_Vehicle/AP_Vehicle_Type.h>

#define AP_TEMPERATURE_SENSOR_DUMMY_METHODS_ENABLED (!(APM_BUILD_TYPE(APM_BUILD_ArduSub) || (AP_TEMPERATURE_SENSOR_ENABLED == 1)))


#if !AP_TEMPERATURE_SENSOR_DUMMY_METHODS_ENABLED

#include "AP_TemperatureSensor_TSYS01.h"
#include "AP_TemperatureSensor_TSYS03.h"
#include "AP_TemperatureSensor_MCP9600.h"
#include "AP_TemperatureSensor_MAX31865.h"
#include "AP_TemperatureSensor_Analog.h"
#include "AP_TemperatureSensor_DroneCAN.h"

#include <AP_Logger/AP_Logger.h>
#include <AP_Vehicle/AP_Vehicle_Type.h>

extern const AP_HAL::HAL& hal;

const AP_Param::GroupInfo AP_TemperatureSensor::var_info[] = {

    // SKIP INDEX 0

#if HAL_LOGGING_ENABLED
    // @Param: _LOG
    // @DisplayName: Logging
    // @Description: Enables temperature sensor logging
    // @Values: 0:Disabled, 1:Log all instances, 2: Log only instances with sensor source set to None
    // @User: Standard
    AP_GROUPINFO("_LOG", 1, AP_TemperatureSensor, _logging_type, 0),
#endif

    // SKIP Index 2-9 to be for parameters that apply to every sensor

    // @Group: 1_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[0], "1_", 10, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 1_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[0], "1_", 19, AP_TemperatureSensor, backend_var_info[0]),

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 2
    // @Group: 2_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[1], "2_", 11, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 2_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[1], "2_", 20, AP_TemperatureSensor, backend_var_info[1]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 3
    // @Group: 3_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[2], "3_", 12, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 3_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[2], "3_", 21, AP_TemperatureSensor, backend_var_info[2]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 4
    // @Group: 4_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[3], "4_", 13, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 4_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[3], "4_", 22, AP_TemperatureSensor, backend_var_info[3]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 5
    // @Group: 5_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[4], "5_", 14, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 5_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[4], "5_", 23, AP_TemperatureSensor, backend_var_info[4]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 6
    // @Group: 6_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[5], "6_", 15, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 6_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[5], "6_", 24, AP_TemperatureSensor, backend_var_info[5]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 7
    // @Group: 7_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[6], "7_", 16, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 7_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[6], "7_", 25, AP_TemperatureSensor, backend_var_info[6]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 8
    // @Group: 8_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[7], "8_", 17, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 8_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[7], "8_", 26, AP_TemperatureSensor, backend_var_info[7]),
#endif

#if AP_TEMPERATURE_SENSOR_MAX_INSTANCES >= 9
    // @Group: 9_
    // @Path: AP_TemperatureSensor_Params.cpp
    AP_SUBGROUPINFO(_params[8], "9_", 18, AP_TemperatureSensor, AP_TemperatureSensor_Params),

    // @Group: 9_
    // @Path: AP_TemperatureSensor_Analog.cpp
    AP_SUBGROUPVARPTR(drivers[8], "9_", 26, AP_TemperatureSensor, backend_var_info[8]),
#endif

    AP_GROUPEND
};

const AP_Param::GroupInfo *AP_TemperatureSensor::backend_var_info[AP_TEMPERATURE_SENSOR_MAX_INSTANCES];

// Default Constructor
AP_TemperatureSensor::AP_TemperatureSensor()
{
    AP_Param::setup_object_defaults(this, var_info);

    if (_singleton != nullptr) {
        AP_HAL::panic("AP_TemperatureSensor must be singleton");
    }
    _singleton = this;
}

// init - instantiate the temperature sensors
void AP_TemperatureSensor::init()
{
    // check init has not been called before
    if (_num_instances != 0) {
        return;
    }

 // For Sub set the Default: Type to TSYS01 and I2C_ADDR of 0x77
#if APM_BUILD_TYPE(APM_BUILD_ArduSub) && AP_TEMPERATURE_SENSOR_TSYS01_ENABLED
    AP_Param::set_default_by_name("TEMP1_TYPE", (float)AP_TemperatureSensor_Params::Type::TSYS01);
    AP_Param::set_default_by_name("TEMP1_ADDR", TSYS01_ADDR_CSB0);
#endif

    // create each instance
    for (uint8_t instance = 0; instance < AP_TEMPERATURE_SENSOR_MAX_INSTANCES; instance++) {
        _state[instance].instance = instance;

        switch (get_type(instance)) {
#if AP_TEMPERATURE_SENSOR_TSYS01_ENABLED
            case AP_TemperatureSensor_Params::Type::TSYS01:
                drivers[instance] = NEW_NOTHROW AP_TemperatureSensor_TSYS01(*this, _state[instance], _params[instance]);
                break;
#endif
#if AP_TEMPERATURE_SENSOR_MCP9600_ENABLED
            case AP_TemperatureSensor_Params::Type::MCP9600:
                drivers[instance] = NEW_NOTHROW AP_TemperatureSensor_MCP9600(*this, _state[instance], _params[instance]);
                break;
#endif
#if AP_TEMPERATURE_SENSOR_MAX31865_ENABLED
            case AP_TemperatureSensor_Params::Type::MAX31865:
                drivers[instance] = NEW_NOTHROW AP_TemperatureSensor_MAX31865(*this, _state[instance], _params[instance]);
                break;
#endif
#if AP_TEMPERATURE_SENSOR_TSYS03_ENABLED
            case AP_TemperatureSensor_Params::Type::TSYS03:
                drivers[instance] = NEW_NOTHROW AP_TemperatureSensor_TSYS03(*this, _state[instance], _params[instance]);
                break;
#endif
#if AP_TEMPERATURE_SENSOR_ANALOG_ENABLED
            case AP_TemperatureSensor_Params::Type::ANALOG:
                drivers[instance] = NEW_NOTHROW AP_TemperatureSensor_Analog(*this, _state[instance], _params[instance]);
                break;
#endif
#if AP_TEMPERATURE_SENSOR_DRONECAN_ENABLED
            case AP_TemperatureSensor_Params::Type::DRONECAN:
                drivers[instance] = NEW_NOTHROW AP_TemperatureSensor_DroneCAN(*this, _state[instance], _params[instance]);
                break;
#endif
            case AP_TemperatureSensor_Params::Type::NONE:
            default:
                break;
        }

        // call init function for each backend
        if (drivers[instance] != nullptr) {
            if (_state[instance].var_info != nullptr) {
                // Load backend specific params
                backend_var_info[instance] = _state[instance].var_info;
                AP_Param::load_object_from_eeprom(drivers[instance], backend_var_info[instance]);
            }

            drivers[instance]->init();
            // _num_instances is actually the index for looping over instances
            // the user may have TEMP_TYPE=0 and TEMP2_TYPE=7, in which case
            // there will be a gap, but as we always check for drivers[instances] being nullptr
            // this is safe
            _num_instances = instance + 1;
        }
    }
    
    if (_num_instances > 0) {
        // param count could have changed
        AP_Param::invalidate_count();
    }
}

// update: - For all active instances update temperature and log TEMP
void AP_TemperatureSensor::update()
{
    for (uint8_t i=0; i<_num_instances; i++) {
        if (drivers[i] != nullptr && get_type(i) != AP_TemperatureSensor_Params::Type::NONE) {
            drivers[i]->update();

#if HAL_LOGGING_ENABLED
            const AP_Logger *logger = AP_Logger::get_singleton();
            const bool should_log = (_logging_type == LoggingType::All) ||
                                    ((_logging_type == LoggingType::SourceNone) && (_params[i].source == AP_TemperatureSensor_Params::Source::None));
            if (logger != nullptr && should_log) {
                drivers[i]->Log_Write_TEMP();
            }
#endif
        }
    }
}

AP_TemperatureSensor_Params::Type AP_TemperatureSensor::get_type(const uint8_t instance) const
{
    if (instance >= AP_TEMPERATURE_SENSOR_MAX_INSTANCES) {
        return AP_TemperatureSensor_Params::Type::NONE;
    }
    return (AP_TemperatureSensor_Params::Type)_params[instance].type.get();
}

// returns true if there is a temperature reading
bool AP_TemperatureSensor::get_temperature(float &temp, const uint8_t instance) const
{
    if (!healthy(instance)) {
        return false;
    }

    temp = _state[instance].temperature;
    return true;
}

bool AP_TemperatureSensor::healthy(const uint8_t instance) const
{
    return instance < _num_instances && drivers[instance] != nullptr && drivers[instance]->healthy();
}

AP_TemperatureSensor_Params::Source AP_TemperatureSensor::get_source(const uint8_t instance) const
{
    return healthy(instance) ? (AP_TemperatureSensor_Params::Source)_params[instance].source.get() : AP_TemperatureSensor_Params::Source::None;
}

int32_t AP_TemperatureSensor::get_source_id(const uint8_t instance) const
{
    return healthy(instance) ? _params[instance].source_id.get() : 0;
}
#else
const AP_Param::GroupInfo AP_TemperatureSensor::var_info[] = { AP_GROUPEND };

void AP_TemperatureSensor::init() { };
void AP_TemperatureSensor::update() { };
bool AP_TemperatureSensor::get_temperature(float &temp, const uint8_t instance) const { return false; };
bool AP_TemperatureSensor::healthy(const uint8_t instance) const { return false; };
AP_TemperatureSensor_Params::Type AP_TemperatureSensor::get_type(const uint8_t instance) const { return AP_TemperatureSensor_Params::Type::NONE; };
AP_TemperatureSensor_Params::Source AP_TemperatureSensor::get_source(const uint8_t instance) const { return AP_TemperatureSensor_Params::Source::None; };
int32_t AP_TemperatureSensor::get_source_id(const uint8_t instance) const { return false; };

AP_TemperatureSensor::AP_TemperatureSensor() {}

#endif // AP_TEMPERATURE_SENSOR_DUMMY_METHODS_ENABLED

AP_TemperatureSensor *AP_TemperatureSensor::_singleton;

namespace AP {
AP_TemperatureSensor &temperature_sensor() {
    return *AP_TemperatureSensor::get_singleton();
}
};

#endif // AP_TEMPERATURE_SENSOR_ENABLED
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
#pragma once

#include "AP_TemperatureSensor_config.h"

#if AP_TEMPERATURE_SENSOR_ENABLED

#include "AP_TemperatureSensor_Params.h"

// declare backend class
class AP_TemperatureSensor_Backend;
class AP_TemperatureSensor_TSYS01;
class AP_TemperatureSensor_MCP9600;
class AP_TemperatureSensor_MAX31865;
class AP_TemperatureSensor_TSYS03;
class AP_TemperatureSensor_Analog;

class AP_TemperatureSensor
{
    friend class AP_TemperatureSensor_Backend;
    friend class AP_TemperatureSensor_TSYS01;
    friend class AP_TemperatureSensor_MCP9600;
    friend class AP_TemperatureSensor_MAX31865;
    friend class AP_TemperatureSensor_TSYS03;
    friend class AP_TemperatureSensor_Analog;
    friend class AP_TemperatureSensor_DroneCAN;

public:

    // Constructor
    AP_TemperatureSensor();

    CLASS_NO_COPY(AP_TemperatureSensor);

    static AP_TemperatureSensor *get_singleton() { return _singleton; }

    // Return the number of temperature sensors instances
    uint8_t num_instances(void) const { return _num_instances; }

    // detect and initialise any available temperature sensors
    void init();

    // Update the temperature for all temperature sensors
    void update();

    bool get_temperature(float &temp, const uint8_t instance = AP_TEMPERATURE_SENSOR_PRIMARY_INSTANCE) const;

    bool healthy(const uint8_t instance = AP_TEMPERATURE_SENSOR_PRIMARY_INSTANCE) const;

    // accessors to params
    AP_TemperatureSensor_Params::Type get_type(const uint8_t instance = AP_TEMPERATURE_SENSOR_PRIMARY_INSTANCE) const;
    AP_TemperatureSensor_Params::Source get_source(const uint8_t instance = AP_TEMPERATURE_SENSOR_PRIMARY_INSTANCE) const;
    int32_t get_source_id(const uint8_t instance = AP_TEMPERATURE_SENSOR_PRIMARY_INSTANCE) const;

    static const struct AP_Param::GroupInfo var_info[];
    static const struct AP_Param::GroupInfo *backend_var_info[AP_TEMPERATURE_SENSOR_MAX_INSTANCES];

protected:
    // parameters
    AP_TemperatureSensor_Params _params[AP_TEMPERATURE_SENSOR_MAX_INSTANCES];

private:
    static AP_TemperatureSensor *_singleton;

    // The TemperatureSensor_State structure is filled in by the backend driver
    struct TemperatureSensor_State {
        uint32_t    last_time_ms;              // time when the sensor was last read in milliseconds
        float       temperature;               // temperature (deg C)
        uint8_t     instance;                  // instance number
        const struct AP_Param::GroupInfo *var_info; 
    };

    TemperatureSensor_State _state[AP_TEMPERATURE_SENSOR_MAX_INSTANCES];
    AP_TemperatureSensor_Backend *drivers[AP_TEMPERATURE_SENSOR_MAX_INSTANCES];

    uint8_t     _num_instances;         // number of temperature sensors

#if HAL_LOGGING_ENABLED
    enum class LoggingType : uint8_t {
        All = 1,
        SourceNone = 2,
    };
    AP_Enum<LoggingType> _logging_type;
#endif

};

namespace AP {
    AP_TemperatureSensor &temperature_sensor();
};

#endif // AP_TEMPERATURE_SENSOR_ENABLED
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "AP_TemperatureSensor_config.h"

#if AP_TEMPERATURE_SENSOR_ANALOG_ENABLED

#include "AP_TemperatureSensor_Analog.h"


extern const AP_HAL::HAL &hal;

const AP_Param::GroupInfo AP_TemperatureSensor_Analog::var_info[] = {

    // @Param: PIN
    // @DisplayName: Temperature sensor analog voltage sensing pin
    // @Description: Sets the analog input pin that should be used for temprature monitoring. Values for some autopilots are given as examples. Search wiki for "Analog pins".
    // @Values: -1:Disabled, 2:Pixhawk/Pixracer/Navio2/Pixhawk2_PM1, 5:Navigator, 13:Pixhawk2_PM2/CubeOrange_PM2, 14:CubeOrange, 16:Durandal, 100:PX4-v1
    // @User: Standard
    AP_GROUPINFO("PIN", 1, AP_TemperatureSensor_Analog, _pin, -1),

    // @Param: A0
    // @DisplayName: Temperature sensor analog 0th polynomial coefficient
    // @Description: a0 in polynomial of form temperature in deg = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    AP_GROUPINFO("A0", 2, AP_TemperatureSensor_Analog, _a[0], 0),

    // @Param: A1
    // @DisplayName: Temperature sensor analog 1st polynomial coefficient
    // @Description: a1 in polynomial of form temperature in deg = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    AP_GROUPINFO("A1", 3, AP_TemperatureSensor_Analog, _a[1], 0),

    // @Param: A2
    // @DisplayName: Temperature sensor analog 2nd polynomial coefficient
    // @Description: a2 in polynomial of form temperature in deg = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    AP_GROUPINFO("A2", 4, AP_TemperatureSensor_Analog, _a[2], 0),

    // @Param: A3
    // @DisplayName: Temperature sensor analog 3rd polynomial coefficient
    // @Description: a3 in polynomial of form temperature in deg = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    AP_GROUPINFO("A3", 5, AP_TemperatureSensor_Analog, _a[3], 0),

    // @Param: A4
    // @DisplayName: Temperature sensor analog 4th polynomial coefficient
    // @Description: a4 in polynomial of form temperature in deg = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    AP_GROUPINFO("A4", 6, AP_TemperatureSensor_Analog, _a[4], 0),

    // @Param: A5
    // @DisplayName: Temperature sensor analog 5th polynomial coefficient
    // @Description: a5 in polynomial of form temperature in deg = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    AP_GROUPINFO("A5", 7, AP_TemperatureSensor_Analog, _a[5], 0),

    AP_GROUPEND
};

AP_TemperatureSensor_Analog::AP_TemperatureSensor_Analog(AP_TemperatureSensor &front,
                                                         AP_TemperatureSensor::TemperatureSensor_State &state,
                                                         AP_TemperatureSensor_Params &params) :
    AP_TemperatureSensor_Backend(front, state, params)
{
    AP_Param::setup_object_defaults(this, var_info);
    _state.var_info = var_info;
    _analog_source = hal.analogin->channel(_pin);
}

// Update function called at 5Hz
void AP_TemperatureSensor_Analog::update()
{
    if ((_analog_source == nullptr) || !_analog_source->set_pin(_pin)) {
        // Invalid pln
        return;
    }

    // Use ratiometric voltage, measured voltage is relative to supply
    const float voltage = _analog_source->voltage_average_ratiometric();

    // Evaluate polynomial
    // temperature (deg) = a0 + a1*voltage + a2*voltage^2 + a3*voltage^3 + a4*voltage^4 + a5*voltage^5
    float temp = 0.0;
    float poly = 1.0;
    for (uint8_t i = 0; i < ARRAY_SIZE(_a); i++) {
        temp += _a[i] * poly;
        poly *= voltage;
    }

    // update state
    set_temperature(temp);
}

#endif // AP_TEMPERATURE_SENSOR_ANALOG_ENABLED

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#pragma once

#include "AP_TemperatureSensor_config.h"

#if AP_TEMPERATURE_SENSOR_ANALOG_ENABLED

#include "AP_TemperatureSensor_Backend.h"
#include <AP_Param/AP_Param.h>

class AP_TemperatureSensor_Analog : public AP_TemperatureSensor_Backend {
public:
    AP_TemperatureSensor_Analog(AP_TemperatureSensor &front, AP_TemperatureSensor::TemperatureSensor_State &state, AP_TemperatureSensor_Params &params);

    void update(void) override;

    static const struct AP_Param::GroupInfo var_info[];

private:

    AP_HAL::AnalogSource *_analog_source;

    // Pin used to measure voltage
    AP_Int8  _pin;

    // Polynomial coefficients to calculate temperature from voltage
    AP_Float _a[6];

};

#endif // AP_TEMPERATURE_SENSOR_ANALOG_ENABLED
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "AP_TemperatureSensor.h"

#if AP_TEMPERATURE_SENSOR_ENABLED
#include "AP_TemperatureSensor_Backend.h"

#include <AP_Logger/AP_Logger.h>
#include <AP_BattMonitor/AP_BattMonitor.h>

/*
    base class constructor.
    This incorporates initialisation as well.
*/
AP_TemperatureSensor_Backend::AP_TemperatureSensor_Backend(AP_TemperatureSensor &front,
                                                            AP_TemperatureSensor::TemperatureSensor_State &state,
                                                            AP_TemperatureSensor_Params &params):
    _front(front),
    _state(state),
    _params(params)
{
}

// returns true if a temperature has been recently updated
bool AP_TemperatureSensor_Backend::healthy(void) const
{
    return (_state.last_time_ms > 0) && (AP_HAL::millis() - _state.last_time_ms < 5000);
}

#if HAL_LOGGING_ENABLED
void AP_TemperatureSensor_Backend::Log_Write_TEMP() const
{
    AP::logger().Write("TEMP",
            "TimeUS,"     "Instance,"       "Temp" , // labels
            "s"               "#"           "O"    , // units
            "F"               "-"           "0"    , // multipliers
            "Q"               "B"           "f"    , // types
     AP_HAL::micros64(), _state.instance, _state.temperature);
}
#endif

void AP_TemperatureSensor_Backend::set_temperature(const float temperature)
{
    {
        WITH_SEMAPHORE(_sem);
        _state.temperature = temperature;
        _state.last_time_ms = AP_HAL::millis();
    }

    update_external_libraries(temperature);
}

void AP_TemperatureSensor_Backend::update_external_libraries(const float temperature)
{
#if HAL_WITH_ESC_TELEM
    AP_ESC_Telem_Backend::TelemetryData t;
#endif

    switch ((AP_TemperatureSensor_Params::Source)_params.source.get()) {
#if HAL_WITH_ESC_TELEM
        case AP_TemperatureSensor_Params::Source::ESC:
            t.temperature_cdeg = temperature * 100;
            update_telem_data(_params.source_id-1, t, AP_ESC_Telem_Backend::TelemetryType::TEMPERATURE_EXTERNAL);
            break;

        case AP_TemperatureSensor_Params::Source::Motor:
            t.motor_temp_cdeg = temperature * 100;
            update_telem_data(_params.source_id-1, t, AP_ESC_Telem_Backend::TelemetryType::MOTOR_TEMPERATURE_EXTERNAL);
            break;
#endif

#if AP_BATTERY_ENABLED
        case AP_TemperatureSensor_Params::Source::Battery_Index:
            AP::battery().set_temperature(temperature, _params.source_id-1);
            break;
        case AP_TemperatureSensor_Params::Source::Battery_ID_SerialNumber:
            AP::battery().set_temperature_by_serial_number(temperature, _params.source_id);
            break;
#endif
        case AP_TemperatureSensor_Params::Source::DroneCAN:
            // Label only, used by AP_Periph
            break;

        case AP_TemperatureSensor_Params::Source::None:
        case AP_TemperatureSensor_Params::Source::Pitot_tube:
        default:
            break;
    }

}

#endif // AP_TEMPERATURE_SENSOR_ENABLED
                                                                                                                                                                                                                                                                                                                                                                                                                                                             /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
#pragma once

#include "AP_TemperatureSensor.h"

#if AP_TEMPERATURE_SENSOR_ENABLED
#include <AP_HAL/Semaphores.h>
#include <AP_ESC_Telem/AP_ESC_Telem.h>

class AP_TemperatureSensor_Backend
#if HAL_WITH_ESC_TELEM
 : public AP_ESC_Telem_Backend
#endif
{
public:
    // constructor. This incorporates initialisation as well.
    AP_TemperatureSensor_Backend(AP_TemperatureSensor &front, AP_TemperatureSensor::TemperatureSensor_State &state, AP_TemperatureSensor_Params &params);

    // initialise
    virtual void init() {};

    // update the latest temperature
    virtual void update() = 0;

    // do we have a valid temperature reading?
    virtual bool healthy(void) const;

    // logging functions
    void Log_Write_TEMP() const;

    AP_HAL::OwnPtr<AP_HAL::Device> _dev;


protected:

    void set_temperature(const float temperature);
    void update_external_libraries(const float temperature);

    AP_TemperatureSensor                            &_front;    // reference to front-end
    AP_TemperatureSensor::TemperatureSensor_State   &_state;    // reference to this instance's state (held in the front-end)
    AP_TemperatureSensor_Params                     &_params;   // reference to this instance's parameters (held in the front-end)

private:
    HAL_Semaphore _sem; // used to copy from backend to frontend
};

#endif // AP_TEMPERATURE_SENSOR_ENABLED
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           /*
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "AP_TemperatureSensor_config.h"

#if AP_TEMPERATURE_SENSOR_DRONECAN_ENABLED

#include "AP_TemperatureSensor_DroneCAN.h"
#include <AP_BoardConfig/AP_BoardConfig.h>
#include <AP_Math/AP_Math.h>

AP_TemperatureSensor_DroneCAN* AP_TemperatureSensor_DroneCAN::_drivers[];
uint8_t AP_TemperatureSensor_DroneCAN::_driver_instance;
HAL_Semaphore AP_TemperatureSensor_DroneCAN::_driver_sem;

extern const AP_HAL::HAL &hal;

const AP_Param::GroupInfo AP_TemperatureSensor_DroneCAN::var_info[] = {

    // @Param: MSG_ID
    // @DisplayName: Temperature sensor DroneCAN message ID
    // @Description: Sets the message device ID this backend listens for
    // @Range: 0 65535
    AP_GROUPINFO("MSG_ID", 1, AP_TemperatureSensor_DroneCAN, _ID, 0),

    AP_GROUPEND
};

AP_TemperatureSensor_DroneCAN::AP_TemperatureSensor_DroneCAN(AP_TemperatureSensor &front,
                                                             AP_TemperatureSensor::TemperatureSensor_State &state,
                                                             AP_TemperatureSensor_Params &params) :
    AP_TemperatureSensor_Backend(front, state, params)
{
    AP_Param::setup_object_defaults(this, var_info);
    _state.var_info = var_info;

    // Register self in static driver list
    WITH_SEMAPHORE(_driver_sem);
    _drivers[_driver_instance] = this;
    _driver_instance++;
}

// Subscript to incoming temperature messages
void AP_TemperatureSensor_DroneCAN::subscribe_msgs(AP_DroneCAN* ap_dronecan)
{
    if (ap_dronecan == nullptr) {
        return;
    }

    if (Canard::allocate_sub_arg_callback(ap_dronecan, &handle_temperature, ap_dronecan->get_driver_index()) == nullptr) {
        AP_BoardConfig::allocation_error("temp_sub");
    }
}

void AP_TemperatureSensor_DroneCAN::handle_temperature(AP_DroneCAN *ap_dronecan, const CanardRxTransfer& transfer, const uavcan_equipment_device_Temperature &msg)
{
    WITH_SEMAPHORE(_driver_sem);

    for (uint8_t i = 0; i < _driver_instance; i++) {
        if ((_drivers[i] != nullptr) && (_drivers[i]->_ID.get() == msg.device_id)) {
            // Driver loaded and looking for this ID, set temp
            _drivers[i]->set_temperature(KELVIN_TO_C(msg.temperature));
        }
    }
}

#endif // AP_TEMPERATURE_SENSOR_DRONECAN_ENABLED

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             