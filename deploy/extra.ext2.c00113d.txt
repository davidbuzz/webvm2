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</xmpGImg:image>
               </rdf:li>
            </rdf:Alt>
         </xmp:Thumbnails>
      </rdf:Description>
      <rdf:Description rdf:about=""
            xmlns:dc="http://purl.org/dc/elements/1.1/">
         <dc:format>image/jpeg</dc:format>
         <dc:title>
            <rdf:Alt>
               <rdf:li xml:lang="x-default">A6 SE BOM V1‰∏ä‰º†Á≥ªÁªüÁ´ØÂè£Á§∫ÊÑèÂõæ-</rdf:li>
            </rdf:Alt>
         </dc:title>
      </rdf:Description>
      <rdf:Description rdf:about=""
            xmlns:xmpMM="http://ns.adobe.com/xap/1.0/mm/"
            xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#"
            xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#">
         <xmpMM:RenditionClass>proof:pdf</xmpMM:RenditionClass>
         <xmpMM:DocumentID>xmp.did:86777F8DF235EE118D43CBC7A6F489FC</xmpMM:DocumentID>
         <xmpMM:InstanceID>xmp.iid:86777F8DF235EE118D43CBC7A6F489FC</xmpMM:InstanceID>
         <xmpMM:OriginalDocumentID>uuid:7d1787b3-bfa3-49e5-b79d-66d0192b9782</xmpMM:OriginalDocumentID>
         <xmpMM:DerivedFrom rdf:parseType="Resource">
            <stRef:instanceID>uuid:772f60d6-09df-45f5-9502-71af9b543ea6</stRef:instanceID>
            <stRef:documentID>uuid:7d1787b3-bfa3-49e5-b79d-66d0192b9782</stRef:documentID>
            <stRef:originalDocumentID>uuid:7d1787b3-bfa3-49e5-b79d-66d0192b9782</stRef:originalDocumentID>
            <stRef:renditionClass>proof:pdf</stRef:renditionClass>
         </xmpMM:DerivedFrom>
         <xmpMM:History>
            <rdf:Seq>
               <rdf:li rdf:parseType="Resource">
                  <stEvt:action>saved</stEvt:action>
                  <stEvt:instanceID>xmp.iid:86777F8DF235EE118D43CBC7A6F489FC</stEvt:instanceID>
                  <stEvt:when>2023-08-08T21:50:36+08:00</stEvt:when>
                  <stEvt:softwareAgent>Adobe Illustrator CS6 (Windows)</stEvt:softwareAgent>
                  <stEvt:changed>/</stEvt:changed>
               </rdf:li>
            </rdf:Seq>
         </xmpMM:History>
      </rdf:Description>
      <rdf:Description rdf:about=""
            xmlns:pdf="http://ns.adobe.com/pdf/1.3/">
         <pdf:Producer>Adobe PDF library 10.01</pdf:Producer>
      </rdf:Description>
   </rdf:RDF>
</x:xmpmeta>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                           
<?xpacket end="w"?>ˇÓ Adobe d¿   ˇ€ Ñ ˇ¿ Å? ˇƒ ©          	
                      ÿ	Vñ7Wó◊Xò!∂÷ßx∏"‘Ü¶á∑8Y1#Âgw(h
A2$≈’GH”îUï•«à®»yâŸQaB3Ö6…R4'CS%&F                ˇ⁄   ? ˝¸                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ãv.Ì‘öëÃ~«ÿUzú≈¨ŒÀTØII£õEßÀ«7ïV≥VkÓãÅº1Â⁄ÂÚ¨€,õ◊"ãô2»˙Rhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèË•&â¯ı¸Ÿ∏˛è zRhüè_ÕõèËé¨–mÆÈ≈Û…†Ÿ\.ß¡{ô¸DQ!îP˛)+¶9ºR9cŒ‡¿	jï|§Ïò-Z˙›[ª÷ú∏xÕ⁄¨‘|ÙQüG9Qúì=åpÂ‰#§t†cafÎ…®Rúπ.¨                                                                                                                                       éæt¶uW_Ù&≥ÿî˙ÖM;5Q˛ƒºI◊LÓÕ_Z“z’SùhñÈÂ§uéµñª^¨sìo‚û##ü|›∑è#72N%P˚¨ı«)Îªo3ÎvzÆ°@ö‹{:ÊŸ‚∫ÉèËªr„%G°içâgù"1eÁÌ…≈≠»’ø.·H‰ú™xâ)ÑÚøÄ)ÜÙ“T9ãﬁ∑”˙µI∏JÆœäEñ“≥lû’ööÛ]íÈŒC‘G6ë∂ Òæ®âÖæI@Ó©f H¨¥≤±åî:ÏŸ'!Ürq¡¢Ã}õöV9ì8ˆsM£≠Ÿ5L¸˘√ù6ÌR"À∏‰ïWX≈Hò∆NsÊœÂŒsü@{_˚∫tÔ˛ˇ ’ﬂÑΩQ@?˜tÈﬂ¸7ˇ ´ø	z¢ÄÓÈ”ø¯oˇ W~ıE»ﬁ∏ßòuuaÌ€fméª¶F:Üc#nΩiøgÕF±ˆ«7YØ3{=? QÒMNÿÊG≤MEJwOù"ÇX2™ê¶∑Ã◊≥€Ôeœˇ '=ôæ≠ fΩûﬂ{.˘9ÏÕıi Û5Ïˆ˚Ÿsˇ …œfo´HôØg∑ﬁÀü˛N{3}Z@<Õ{=æˆ\ˇ ÚsŸõÍ“¿ÁR{;Y∑Y€ŒπÁÜç[$uú9sÏ A∫¶\ôEVY^j*i$ôq·1çúcˇ ˇ ªßNˇ ·ø˝]¯K’ˇ wNùˇ √˙ªó™(˛Óù;ˇ Üˇ ıw·/TPΩÀà9ß\◊‹v ´—*1JG•)iπiogÌ^π¨¥õ8X§ﬂŒMÚÉ∆jIÃH∑hﬂ
*\¨Ât“'ÑÁ)r?ôØg∑ﬁÀü˛N{3}Z@<Õ{=æˆ\ˇ ÚsŸõÍ“ÊkŸÌ˜≤Áˇ ìûÃﬂVê3^œoΩó?¸úˆf˙¥Äyöˆ{}Ïπˇ ‰Á≥7’§£%´}úê±ÔeÊ;úbb£Z¨ˆFNJŸå¬=É&…ôWﬁΩuÕâ6j’ãìER∏Œsú`éˇ ›”ßﬂ˛Æ¸%Íäˇ ªßNˇ ·ø˝]¯K’ˇ wNùˇ √˙ªó™(˛Óù;ˇ Üˇ ıw·/TP„´˝ú∫ï∑;Ìªd]≤ZÀ¨Ë∂çØKñá“\a¥}”[@»€´?=ñ°‹MWïïäMHá*û:f5EŸ=If´™ëÇ2”öáTYj2Ó74]çé É⁄õ÷âdCB˚6©s:|Ÿ÷ªªak∏áT'Ú¸5≥Â˛Æ’|$‚…>´eT:&ë{î˝–†Yûo–\ç÷|gßÓ/tŒ≤zÎbÍ ælóx›U‘˜ñ˚ºìxªÑÀXÔ7ıïô∏çè ÏÿHë®G*t|n´0EËqÌj>ÉΩ6ΩV©Ø)«R¶H+…5çF2âYø€u=Órπ∂S†õ0ÇØ›-TÀCfìEA5¸Æc¶UÚ’´TQ+                                                                                                                                       ü˙k˚vuóÚs˙ùÊê`¿XlΩ”Ï◊ãÄª_uÒèû≈Y’íå”WΩ:8GN÷åãY$6UFÓûpÔ¯eG,ÿ8˛ï9?≈‰•–t[ESwËGS€õel‘5ÇnÑmﬁ/O∞e©{ÀŸŒ¶_2S[Íç}"££êπO8p∫Ë¯ôœÅ<¿l¿∂t≈2´∏dÙZUmëlÿP˙÷•∂_«”™~¸¥Nôt¥^©Òv§É?u8Bo^Ω#ƒ“)˝∆Uö\ó›H‡¡Ìy˛ˇ 2Ωıq˛Y Û˝˛ezÍ„¸≤1‹}√≠Ù∫±Ì]±ØwÖFìWlö“oµﬁr´ßnñ#H®8f)Ã‰›ézEd⁄G«µ"Æﬂ;Y4Q!‘9KêÔz∫&¡©#†g‚„¶‡Ê∑è,≈LCK≤m%-!‘y´¯Ÿ8Á©,Õ˚≠U2k"©öâõ%63åÁ <\√	VÆÏ å4¨’7v≈É™¡´#"˛:Ø^EÃ{¶5ä€ynÀUÜ3≥•”»«∆∂Ò[µED X   i˜∫Ín*.Ë“ë yJ^ß–˜ù·ªû6xR{¢z>•gí–ZπD“)U2í∂⁄˙◊	<§πUf“≥’“
≥∞¿4∞  ZÏ™}oah•Ë7(¥ß*7mªÕ+L*Î:nåµz«“∫é"j5Gólıπ«<Q<®ä©™O∆!älc8∑Œóÿ+ßÿ≤´KÌ≠,ﬁçqôxñ[ªΩ◊ïfYg∑äL†’%Ÿ¥ì7s&£DÛŒ‘ﬁf-ÃjÜbÄ   g|’´◊≥ˆ∏ññ8™˜v˝˙h¶íÄa|´°°Z’/	¿;2∞«∏‘õŒø$L°–3Ë≤øsÜ™£ÓÖºp∏„wRy”WOm˝ãâøÅ’π*|l∫µ¯ïf§öÎuÆ—#_(…%ÚQ1Úˆdêtsë,Y ¶¬i8aøC7x›m4Ê˙t’“)8lÂæΩ"Ì‹7\ÖU–Y)≥&≤+&l¶.rS8Œ3‡ÊÛ˝˛ezÍ„¸≤Á˚¸ Ù’«˘d≥zçº9”∫´UXÎÑLˆö‘ª6°|å∑WïÇZ>zkKI⁄⁄≤h¶\:m db%˜FR>}Œπ≤äû*Ñ9p˛à’∑âöù“R;§7EMãﬁàÎ5õW  π›Ã4ByÍm«å4é^”°l∂[ó8„.ﬂ∫W√ú¯Oúx1Ä‚}í	H!Ï˜ÁÙ%\œ<~â∂¬Kº≥ñÆY∑XOwÏ¢"Â·ià5≠î´°Çô,7I<·ì î´yL`>ˆÅ˛‘˚´˙G˛±aÄh                                                                                                                                        ˇ ”_€≥¨øìü‘Ô4ÄtGˆÏˆtˇ Èu˝N¬ u◊œ;ˇ ˘ì˜ÌˆtÄ‚:[^◊l˝`∑:Z◊	m™¡{>™–V∫-˛˚≠lÌ*ªc∞∂•+c’ï∞kÀ-^]˝b„^XÑ{ÂeY®Â´GxOŸ4]∂˛çÎ„@~,∫üÌî—£]|cË≈óS˝≤Ä§]e£®ß÷ç}≤/√]ÁgÇGdmÌπ∂#´÷¶êb®÷€\à⁄ã|Uz⁄⁄©vöäNQí(H2aÛL-ÜÓ‹&†]ﬁó˘∫Æ~–õ˚”È†™—ÙÀÑ÷Ùûñö€Ì;ﬂ˚
°VËM˘GÖ&$*e˜-nï≤Îı÷Y…q¸,¢’<úﬂîﬁÁ¬_Ùh◊_˙Òe‘ˇ l†çÎ„@~,∫üÌî—£]|cË≈óS˝≤Äz4kØå}¯≤Í∂P2º=œÎƒlﬁ."ˆ´âá[ªé≤Íıœr^zº¬°&§ÎµwYﬁ<Úï(¶ëIc*`≠£Y∑jéAì w>çÎ„@~,∫üÌî—£]|cË≈óS˝≤Äz4kØå}¯≤Í∂PëÙ˝°ä≥Ú{ÍMãi™›âÀıüVâÕT,Qv ‹ÅrñËLﬁZ&≈’“xŒ|\®âplæ‰<E‰4ù•{≤O˜∫6ßpjœf—Î´E‹Ö~>E‰¥\\óí›JI¥<åõ≈ò˘r®fF|Ô»e<:qÖCÔ˙4kØå}¯≤Í∂PFçuÒè†?]Oˆ Ë—Ææ1Ù‚À©˛Ÿ@=5◊∆>Ä¸Yu?€(
y”ö¬∑Øÿä¿Il9J˚?;≈7XºÌ›±≥”H¨ÕœK1©lª≠µ(cü.MÂLÃ®|`∏S'¡	‚Ö√Èõ™ÁÌ…øΩ>öhÓx◊é–⁄Ãëî‹0ê∑aA÷ÎU.ãËZUB´_lÂÉ¶5 ï:£¥!*’J‘Yﬁ®Fq—Ã€2dépí	&ëBÑ„Ë—Ææ1Ù‚À©˛Ÿ@C}£j¥ﬁ|ﬁ÷˙Õœ°"lïM7≥Ïï˘Dz∑®V6n
ì9) íN∑ÌïQõˆ©®R®C¶ló¿bÁ åmÙ
Æ∞‘û—*]-É®ËÌbêM9	©À$´…[&•ÿv{‘’éœ%3c∞œXls.ﬂø~˝€óè9Qeî:á1≤Àö>n¨¥Y~Ù˚îˆ[ˇ a=˝&ˇ \[@ˇ j}’˝#ˇ X∞¿4                                                                                                                                        ÈØÌŸ÷_…œÍwö@:#˚v{:Ù∫˛ßa :ÎÁãùˇ ¸…˚ˆ˚:@7üœ¡ˇ Âo˚ˆÏ–b#]Ï›Í∂≥€ˆj“tV õBXœ'∞tΩÇhÁôD¢,ö≤Br1(sB]“¯î´?ÆM*∫Ñ˜cß≠R√3•\ËÇDŒƒ–w˝L⁄7`M>B"∏ÒÏŒ,zocÀ;> ?Xm¸∆@«IOH∆"ÈÊ5ÀcÉ7p´xßí+’BÌ_ˇ ‹ø¯˜ﬂ˛Œ ,K¸›W?hM˝ÈÙ–Åˇ ÆØ⁄cˇ Ã¿,              ˇ Ì_ˇ ‹ø¯˜ﬂ˛Œ ,K¸›W?hM˝ÈÙ–Åˇ ÆØ⁄cˇ Ã¿, 
ˇ ÷_Ÿc•ˇ g˝À˝]X¿W˝›ˇ Ëw¥ãˆq˝D‹@Xh˘∫±˛–e˚”ÓPˇ Ÿo˝ÑÙgÙõ˝ql˝©˜WÙè˝b√ –                                                                                                                                        ˇ ¶ø∑gY'?©ﬁi ËèÌŸÏÈˇ “Î˙ùÑ ÎØû.wˇ Û'Ô€ÏÈ ﬁ<[ˇ ïøÔ€≥@{UÌÊ ≠πz◊]—jV-π∑ï›’y®u2$“6ºÕ˜+sÅbÊ∂}˛W»‘5•u⁄®ÈÂ‚ÍÃ»7EsD∆J,Å€ÄìÁ˘›¶·)Œ£∞Fﬂ⁄¶˝)(}X+∆z
≤dnÍ=;s‰õMÔâ¯∑i`˛¯Y»HC8Eå+—.ì Üœ∞˘«lo´Œ¢V®≠&WOF“w=k{-ÚÀ≠‰∂›_`Li©xZ≠UÌg≥G\ÃØÆ›ßkdö,]K∞2QﬁËÀr(™≠ßìõ€ _A8·û'Ä3Ør∏ac£Ì€ÔWôåzﬁV’JºTxÚ’M∏V&Ÿ7+Ì≥ËÁÌ“pÇ§U2õ>r.µ›öªXÃBÙû•rŸ˚Âfyfß∏rÂºº,õ∂Ë◊ÿR°B`≠’xvIiHËh»•§r™¨ö4nt⁄¢ê             	Ï>q€ÍÛ®ï™+Iï”—¥ùœGﬂ⁄ﬁÀ|≤Îy-∑Wÿj^ÄkU{YÏ≈—◊3+Î∑i⁄Ÿ&ãRÏîw∫2≈‹ä*á=9À^˝∆™¿ú9ƒµ«xYã¯´-+kŒRÓuyÿáÌ•‡-˚Ögé#,U[]jmãw—“,\"Ìì∆È¨ë rc ,,kÌ√ÆıÙÛÎ1Nüÿs€„j}1I|ˆB6B.UÀd†›…ÆÍüCo•ƒc$œ+Ó(ñ1¶|e—ÌÃõtB ÄØ˝e˝ñ:_ˆ‹ø’’å›ﬂ˛á{Høg˜‘MƒÄÊèõ´Ì÷_Ω>Â_˝ñˇ ÿOFIø◊¡ –?⁄üuHˇ ÷,0                                                                                                                                        ü˙k˚vuóÚs˙ùÊêà˛›ûŒü˝.ø©ÿ@∫˘‚Áˇ 2~˝æŒêÁÛ≈∞˘[˛˝ª4Ä                       Ø˝e˝ñ:_ˆ‹ø’’å›ﬂ˛á{Høg˜‘MƒÄÊèõ´Ì÷_Ω>Â_˝ñˇ ÿOFIø◊¡ –?⁄üuHˇ ÷,0                                                                                                                                        ü˙k˚vuóÚs˙ùÊêà˛›ûŒü˝.ø©ÿ@∫˘‚Áˇ 2~˝æŒêÁÛ≈∞˘[˛˝ª4Ä                       Ø˝e˝ñ:_ˆ‹ø’’å›ﬂ˛á{Høg˜‘MƒÄÊèõ´Ì÷_Ω>Â_˝ñˇ ÿOFIø◊¡ –?⁄üuHˇ ÷,0                                                                                                                                        ü˙k˚vuóÚs˙ùÊêéÜ ˝›ÏﬂüRπ ı∑]uù•:‹ãË®ÛöIÉƒ"⁄Qè^.ª!dc_t£fÆ∑VI8ÂÚâ√e|òy∫ÎÁãùˇ ¸…˚ˆ˚:@7üœ¡ˇ Âo˚ˆÏ– Ëµ≤É™ÊÊ()√f˘37C◊tgñVÂÎwMµ∞*⁄Æ©iµB«À◊‰Á™µ˚ìyI8ˆíø`—VË9n≤ÑXÅEµÓ÷¨ñ∑Í.„ÿ:†*dAKE:Ì)∆µ ›Æ%La£ô§Ál<’^=ÔRZls∑s‚F!ÊVåîM≥Ê«G(yÕ”øﬁë˙¡·/∞¿9∫w˚“?X<%ˆÁ7Nˇ zGÎÑæ√ <ÊÈﬂÔH˝`óÿ`ú›;˝È¨˚ ÛõßΩ#ıÉ¬_aÄstÔ˜§~∞xKÏ0Œnù˛Ùè÷	}Ü yÕ”øﬁë˙¡·/∞¿9∫w˚“?X<%ˆÁ7Nˇ zGÎÑæ√ <ÊÈﬂÔH˝`óÿ`ú›;˝È¨˚ ÛõßΩ#ıÉ¬_aÄstÔ˜§~∞xKÏ0Œnù˛Ùè÷	}Ü yÕ”øﬁë˙¡·/∞¿9∫w˚“?X<%ˆ ΩÓ=ò÷2·≤9®Ï=V–UÎ√‹í¶úÌ`—rë‘ö‘ç¢GHFY¥˛úßZﬂn{§Rd*J∆Œï•)%JÃ7zU@ŒÜØÄØ˝e˝ñ:_ˆ‹ø’’å›ﬂ˛á{Høg˜‘MƒÄÊèõ´Ì÷_Ω>Â^}ïŸÇ‡Ω
«‡‰ÖU5ëŸÌ‚dÎr57'ga€˚}î“p“±ÒnÛgi&I6è0èëíjÌ7àùTWMSáõ@ˇ j}’˝#ˇ X∞¿4                                                                                                                                        ÈØÌŸ÷_…œÍwö@XÀÛã…ø¥è˜XÈ`ˇ Ææxπﬂˇ Ãüøo≥§´–Oÿ≈Ì]ô%&Ò§tsﬁÀ◊èüæpãFLö7Óùû´áN›8:h6lÇD…ésò•)qúÁ8¿ITóI%–U5êY2*ä…™$™JMTî&rEPô∆Jlg8Œ3·¿•˛n´ü¥&˛Ù˙h√øŸÎUé¢“kŸ,0u‰h>ôE≤”íÃ"Rp©6&úÈ £˜»≤Ö'Â…KúÁ¸†%œ;:ØÈ/_¸≤Æ“@vu_“^ø˘e\ˇ §Ä<ÏÍø§ΩÚ πˇ I yŸ’Izˇ Âïs˛í Û≥™˛íıˇ À*Á˝$ÁgU˝%Îˇ ñUœ˙HŒŒ´˙K◊ˇ ,´üÙêùùWÙóØ˛YW?È ;:ØÈ/_¸≤Æ“@vu_“^ø˘e\ˇ §Ä<ÏÍø§ΩÚ πˇ I yŸ’Izˇ Âïs˛í Û≥™˛íıˇ À*Á˝$ÁgU˝%Îˇ ñUœ˙HŒŒ´˙K◊ˇ ,´üÙêùùWÙóØ˛YW?È ;:ØÈ/_¸≤Æ“@vu_“^ø˘e\ˇ §ÄS¨\ﬂ%˜‹î4î|ºsèJ‹†˛1„wÏó¡u€≤õ(∫j¢®)‚õ¯¶œÉ 4<sÎ˘ú°“Œ‰ü3èkÊlµ˜KÁ(¥oÓ©
,‰{ﬁY¡”OÀæ~È$'á∆Ue
B„&61êÇ˜wˇ °ﬁ“/Ÿ˝«ıq`9£ÊÍ«˚@uóÔOπ@97˚,sGÏˇ ¶ø´™‡
ˇ †µ>Í˛ëˇ ¨X`                                                                                                                                        ?Ù◊ˆÏÎ/‰Áı;Õ ,Â˘≈‰ﬂ⁄«˚¨t∞
£€HäﬂBq˝rWÀ"ÁaK'^Æ9∆	ñŒ,1è¿#C©úü
ï”∫≈nQ⁄y¡r_=L8ŒK·„z ∆E]zêíïGwüÑ\„ î8jÉ’Á.Ï6ÌèπznÅGåD∂…X:“qr≤∞∆\>xŸªR¯V:Ö¡< .∂ã}Æ®0≤å≥'K´E»«FãÉË¯6-≤2Ãt≈\µpâì…ëUDç‚¯Hc¡úÑO’çü∫”/1Í5µ≠Æ∆—2tgH±≠Ãl∏}Ì≠•uï^›+=1K∑lQ±s2M#‰FEºpÈÆTD®(^6RO^TØ{ª£˘nl-ê¬≠)f⁄;˘9Bz&"µTäu`wR‘∞Ø∫>FZ∑©ÍhëŒ"£0ô$_-Â_»{¶Q„ßKÑ°‚´ø‡/†^ƒ¯Io·g∏˝Ë„œ%Ô'æ~Û˚ß›~ê>ÊÚûÔ˛ìÒºßÉ¯^Â“{±è‹`ﬁkÎ
Ó∆?p-Åˇ xqØ¨(ﬁ—π5’;Œ?ø‹)≤˘®÷Ïv≈€…◊˘œΩ‘âáû‰íoÓ}¸ßæ.Ê⁄_¬Ÿr˘¯K˛5?$èv1˚Ål˚√ç}a@=ÿ«Ó∞?Ô5ıÖÕ€ØZ5zB”c‡Ωà“/‹ûÏpîG;Q?væmﬂ≈n€†TYO”≤>)s‡∆|9¸ò»[≈UÂæräﬂÇˆ!¨ï ›VŸ,œ1xTêÑ∫I‹°ÎÓHÏ›ÜÀ®È˝
L¶LÜ âaò¯∆&L'ª˝¿∂˝·∆æ∞†Ïc˜ÿ˜á˙¬ÄçÂ∑&∫ÑÉ€ñ)Ÿ	EhÔ|º„.Zˇ !™xèz5Âi>˜*	Ô„+-‰©ñÜn1Ól)„(¶R«ÖB∏	#›å~‡[˛„_XPv1˚Ål˚√ç}a@sv´≈Vó÷b¡¡{´ñJmM∫©Dq„£n˚oÉ¢÷[e&˝¢ÖMÂí∆—©úy4H|®|îÖ1∞À≈V^√g´0‡Ωà¨Õ?ﬁ_õö#èMØ¬*H≈˘7
t	QsÂö•ìg…òﬁ&!º“{±è‹`ﬁkÎ
Ó∆?p-Åˇ xqØ¨(›ˆ‰◊Qﬂ
=◊¬õ ü∂ESœxµ˛C?πn˚'Õ«¡‘¸M˝üt∑Á^«rüåÇÈ?î1|äæ(W^á°ÏHhù±a“⁄`s¶ø⁄⁄ÓÛ÷•∂<–>i\Î’5‰‰eÉxW*˙´u›n›-A™Gë•„‡◊crnFêÛ«IÒìU‡Ÿ ≤2õn∞ÿ’]ahwm+¥Ìµ÷DÆ¨È≈RÓ˝u≥6ÙZ•°!dÇ§‘ﬂø˜)‹w^ÊÚ-»´É§â¬›ﬂ˛á{Høg˜‘Mƒ©∆(çÉ§‹ÎÊQj˝É~u”ÿ«Ò<úƒ'•¶ÓB"}ñS9¸hªz)æhcx™´ÑÚrê˘1pg&ˇ eéh˝üÙ◊ıu\_Ùˆß›_“?ıã@                                                                                                                                        g˛ö˛›ùe¸ú˛ßy§aøo2ë˝U¡∫’ºlz±€∆˝º…À¨Â¡$X∫◊ú˜rÄåç`Ãà≤ÌÂq≥◊UuTPÜK,”)
(lê!NÏ◊®lﬂ kFœk»Å¨S≥Óù|æÀ∂ûó]~„XÙáÕﬁ ñúkdêf•üXj)QèyÑæAU…	ê»ﬁ7õ˙«m◊µGp69Oe‘	.˙/gπ›ı∫úÍù—±Tàc±Q[_k´a•à ®õWÌòIG7U/ıŸT®l∏
”÷êVùC]≥¬ƒXÎÛﬂîYKAOF≥óáîfØSÈØ*“F2AûµS¡¸$’!âü¯pÊ^xìîÔ4´Ö%mß´h‹j÷
≤∂*¶ß÷Q∂à¨.‚Tö≠»ª®Hµa?Wy]ö 7]4ú&C3„.C«ËÉÆlWø8[¢Qˇ HM∂©|Émº(Zv.≥yè/ﬁ©¶©éø|Ô*«YU…î…å`Öœá9∑—7ñ>Ìˇ ı5ÆøG =ycÓ—œˇ SZÎÙpWp·}]4]¶√_Ÿ,⁄Ø∫u[E≤©:Fõ†+ı[5}Ü6*8ñrŒ—§ÓOë≥:èŸØ⁄,Â7$LÌël\%É%ì%ODﬁX˚¥sˇ ‘÷∫˝ ÙMÂèªG?˝MkØ—¿•ﬂâ˘ä·XíØ∞”:ø_»ª3∑j™’QW:ƒî\ì9hÈä‰å≠r9úõ7¨S1≥E…èÀ¸¯p|™Â/-ã∏±éë∑N’)¥¶≤{”_Ë…ÛUÎîô{‹Ï{
∫U=GKMñ$dˆ’ô|9 ﬁM…·3x·’˙&Ú«›£ü˛¶µ◊Ë‡¢o,}⁄9ˇ Ík]~é ã&¯w^∫ÆÓ™.Ìu‘Z´ñXª#Rk
ó>D–$1b÷uΩKf˜Ìdôè¯GO´6#ºˆpeÚ¢Ñ¡2SÙMÂèªG?˝MkØ—¿DﬁX˚¥sˇ ‘÷∫˝À\8ªúlq-÷ı^æ’HãMÁ[ÿöªWÍh[’Z≈ØÆµ˚‹¯))™ä-©-\E%YíÂY¢™ß‡.OÉî<p¸qßµ\o[V*;¢.∑OÉ…<¥Ôs£Á•¢c´1™F∆DAû©™)çö∆·5é° ™k®eMú‡¯«@uæâº±˜hÁˇ ©≠u˙8ËõÀvé˙ö◊_£Ä"π.’ŒÒmÄâ≤Y™zÜıµ5∆›¥Ûıbõ†i©k∂6≠U¨J∞ØÙúïô:Õ•∆£çVe±%ä£•uîïC ó	á9‘‹≥Ãq‹«—í¸Á¢øc¢6Û∆OYÍ|Ÿ€7mµıÖfŒöπFºEõπn±
rÜ¡àlc8Œ3Ä‹qÏI±ç‘Úœå±YEÛéÔëxfÌøpV¨µïùÀÉ ≈Ç_=[•ü$SQU‡)
cg»g˝«aÓ}¬∑s–k4Ì1ß÷€ö≤õGq—[ŸÌa¬°q‘vJÕ~Îp’U˝I}F™Óû‚E(ïß1)à¸§úÇQ“r¡ò\n©Tuˇ 1VhÚ¥∫»Ë∫=bE´‘$ìyPË˝≥]dπü∂Ut]∏:Q∏Ú `Ê…ïÒ≥úÁ>∑≥∫Û-∞¯´ûßÊ££¢ﬂ∞§´G˜,[á.öé±ûô÷±O¸´¥ê[•¢™h∫pOƒM¬«!3íπ»r˚SÓØÈ˙≈Ü†                                                                                                                                        2Ú•∑u>≤Ô§GdÏ˝yØUì$ë©^.µ∫öí	£ß˘†™®ƒì“lÏâÚ)‡ÿ.¬‘⁄õ∑Llé¸ˆwƒÎΩπ¨/≤≠êÎß.c)wÍ≠¶Aª3–ÿ˜BÏ‡Âü9I	s¸3¸ô¸†>∑s‘Töﬁ|ßiÖ¯.ﬁÔImnoR}s™ÔS"[_¢∏≥F\Z*HŒVŸ!ú“∂cıëjY&XJa´æ>NÕ2‰+∆ﬁ’ªs^Ùˆ/HOÎ…Xd§˝ôîçÖH’∫kUW•)◊éÈº.Ï‚∂¶¡ÿ≈∞ﬁıı‚
7»>pÈ´h˙¨§˜äôñ:y»m¯
ˇ “ˇ 7Uœ⁄ìz}4VΩ]Í∫ŒërŸ©ñı⁄Fø™ÿn˜¥‹™“
´Tày=aôtì4\ªUº\Có9RMERg)ç‡∆B	—˝üÃ›jù£Èç§ Âm≠W⁄⁄Ê†3]∏◊$ZWHû!º¡∂W`ΩÿÀ2dÚ&2S…©í‡˛/å_Z  ~˜Ø%rı•ı/{n4,eÜ—íésUæNb>Å)#näaf|˙ØVõéh≈√˙∫x*ã\{ÖCdò.Jcæ ¿m-•A“ö˛—¥ˆçïùBÅLèƒ•ñ∆˝Æ[F2;ñÏíPÕcZΩêt™Ô$íi ä™™™Ö)ìgËé¥Áæôrã“µﬁK_¥´H\c…_∂◊ûA±∫≠goUxªk\À∂öqLî"'G
«d¶íÁÖã L∂«¥'é¥u÷€Ø6¶Îä©[hE`k§sä≈ÓIµ\≤u∏´É3MÕB’§†ò’y∆èœï„»∂pC©‚„ .h ◊ono°µÙ÷”€VvÙÍy’yåΩÅ”)Y$⁄º∂Y°È’∆•a¬NU”â{=Åõ4Hä
*∏/á/á8'Cı6ÑÈ¥-ÀË›Ü ˜äådM¡aÏ∞/†_ÕGÊV%'±÷òX7˛NF<¶QHôí>
l`ﬁ1MåÄ PmùÎ…Tm»ø?Z∑ç∫÷˝Æusöíï[„ú7øÌ¥i+Î™ ÛÏjŒk	>¥%±‡Úâå˜	'ô∞©”ŒÇá}÷_Ÿc•ˇ g˝À˝]X¿X ∑≤‰s»Y-Ü2ôãÊ›Á#à»ñ∆{+#ñZ¬–Ácì83π~K…¢ñ3å®°∞_¯@gc]{øµ¥/qÏ…˚=X∂;H"Ùe±∂…–“ªQÃ%›ÓÜçYM[R∫4€ö¸ß’Z˝ææiá'xfÂQÀÉ™™Á∆ı÷æÑ’Ì≠´™<qI€ù9]h˙HË+--òﬁú‹(9úõr›…=ûùvU?qÑ…óQ\„¬|Ä©~ÃÓôÊ˙ˇ H”Ûå£…÷"?	Ω—‰»·´5»ƒ˘ˆÁOÈwÛ9à                      ªs´&rZ∫›"—≥¯˜˚ﬂÆY>bıù3zÕ◊Qnt¥vŸr(ÉñŒPPƒQ3ó$93úg∆@UyhRPtÔ≠G¨ıHéﬂ–ó≠k$TüûbX“°5wK9°√·[∏ƒ-kPl©}p…j,gf‰l°VYU—8ià                                                                                      
ˇ ‘ü17Ø‰œÁçxw-®u6œÍÕ¶æ ’˙ÔaØœ|‚åJ◊öUj⁄¨ZO6?V‚Q O∆Häné›<®T≤\)ó&¯∏¨˚Ji≠k–¸˚/Æu&±†K<i∑ò<ì§–™µYLsSé[,‹ΩÇä`ÂvôY"ü…òŸ'å\g¡·∆ v›k_Åµj⁄Ì¢"…_óﬁ¸†ŒZ
z5úƒ4£5:£LÂFí1í∏dı±Ú\xSTÜ.|ó >ø¢o,}⁄9ˇ Ík]~é z&Ú«›£ü˛¶µ◊Ë‡‹Èùa≈TMëΩ™ñyÀîŸÈΩ K“´s5-O^óó}#º∫.Ujº;ÿˆo_ª~ìvÕ‹¢g:•M4œ·¡Kåë˙&Ú«›£ü˛¶µ◊Ë‡¢o,}⁄9ˇ Ík]~é ÕkÊµ‚(´ûı÷Ôh<≠∞◊Óû5a^°:™ÍFw5†e“·◊OôCUñ`ú‚ëhªëQT–C(¨U\ÿ6ÆrSËõÀvé˙ö◊_£Äâº±˜hÁˇ ©≠u˙86hZ”â¶.Z7\±†rÃÆ¬i‹›ê∆…DiU‘ØÆM´∞ÈˆÚ±ÃÁ*Ë∞VmX¥õF‹!Ñ*mr\K¿MËõÀvé˙ö◊_£Äâº±˜hÁˇ ©≠u˙85πOZÒ≈ô„8
ÕïØvﬁπ?æ¬¡Uu%ûeÑÚ∏˘ñ^€„£ÿ>z÷]Æû•Âê´U/á∆2ò»iO¢o,}⁄9ˇ Ík]~é ‡6ø+ÚÀ-[≤ûóútC4†\]ﬁ5∫oñπo]ëW0æ+ƒ 9G$Òº<_á√è 
µÀzõävñ«¥©J÷ú∑±c°yoëΩı=^õ©≠Ã¢l≤SΩ(i_| É…∑Àè)‚8Tàß„¯pB¯Úz&Ú«›£ü˛¶µ◊Ë‡
Û’ºﬂ >ÿñ7zûkL‚¡;{<ÁVÎhf—lãjÇ+«.•Çlì&•lsaSúÂ&	ú¯Ÿx@|^q“]≤≠G;I‘<ø¨4ËXò…öµTZ†[ydÁèc»DƒøèG»»?UUQL¯ÒVXÊ6<cÁ9AËõÀvé˙ö◊_£Ä8M• úº◊YlW-πªB7rﬁân]ªÑ4ˆºItJø ¢K"™u“®í©(\¶.qíÁ û5i£©ıÇI&DíK^RìI$ R&öd≠∆îâ¶B„!\c∆1‡∆ UΩŒÒm™],ñΩ¶,ˆ)~áÎ'R≥÷]GööìsÈI∏ì˜DÑ§îóœWÚiîæ:äﬁ)qèÉ 8	˙U6Å†˝®U™J≥IÆ∑[d∏oQÅä≠¬†·ﬂË’ù.åT3VLRY ∆…‘1S¡él¯sú‰ì                           Ø˝IÛz˛L˛x◊ÄGr⁄áSl˛¨⁄kÏ≠_Æˆ¸˜Œ(ƒ≠y•V≠™≈§Ûcıaﬁ%§¸dÅÿ¶ËÌ” ÖK%¡Úôroãè zœ¥¶ö÷Ωœ≤˙ÁRk≥∆õyÉ…:M
´Uêt«58Â≤ÕÀÿ(¶Wiïí)¸ôçíx≈∆|`m÷µ¯V°çÆ⁄!",ï˘}Ô Â†ß£YÃCJ3S™4ŒTi# ãÜO[%«Ö5HbÁ¡˘pÎ˙&Ú«›£ü˛¶µ◊Ë‡¢o,}⁄9ˇ Ík]~é ÕŒô÷UDŸ⁄©`◊úπMûõ—\§Ω*∑3R‘ıÈyw“;À°"ÂV´√Ωèfı˚∑È7l›¡ö&s™T”L˛∏¿i¢o,}⁄9ˇ Ík]~é z&Ú«›£ü˛¶µ◊Ë‡÷æk^"äπÔ]nˆÉ —ª~È„VÍ™Æ§gsZ].t˘î5Yf	Œ)&ãπM2ä≈U¡çÉ` Á!•>âº±˜hÁˇ ©≠u˙8ËõÀvé˙ö◊_£Ä3fÖ≠8öbÂ£uÀ, Ï&ùÕŸlîFï]J˙‰⁄ªüo+ŒrÆãf—ÖãI¥aëM¬A¶◊%¡pTº§ﬁâº±˜hÁˇ ©≠u˙8ËõÀvé˙ö◊_£Ä3[îıØlYû3Ä¨–yZ˜`ç·kì˚Ï,WRYÊXO ÎèôeÌæ:=ÉÁ≠e—zÈÍ^QÈ
±UQr¯|c)åÜî˙&Ú«›£ü˛¶µ◊Ë‡kÚø,≤’ª)Èy«@43J≈—]„Pk¶˘kñıŸp„‚ºL£îrO«„≈x|8 ´\∑©∏ßil{Jî≠iÀ{:ñ˘ﬂS’È∫ö‹ &À%;“Üï˜¿—1≤1úêAã|∏Úû#ÖHä~?á/Ä/'¢o,}⁄9ˇ Ík]~é Ø=[Õ¸°SÁ˝âcw°yÊ¥Œ!¨∑≥Œun∂Üm»∂®"ºrÍQX&…2jV«69ŒR`ôœçüÑ≈Á!≈€*—‘s¥ùCÀ˜˙√NÄÖâåô´P5E™∑êÊNqxˆ1åÑLK¯Ù|åÉıUUœèeécc∆>sê¥âº±˜hÁˇ ©≠u˙8Ñ⁄\©ÀÕuñ≈r€õ¥#w-ËñÂ€∏COkƒóAt´Ú
$≤*ß]*â*íÖ¡äbÁ.q·¿	„Q&ö:üX$ídI$µÂ)4íL•"i¶J‹iHöd.0RÖ∆1åc`[—<·œ⁄•“…k–⁄bœbóË~≤u+=a’‘y©©7>îõâ?tHJIAπ|ı&ôK„®°ç‚ó¯0Äü•Sh⁄ÖZ°‘´4öÎu∂KÜ™‹*æçY“Ë≈C5d≈%ú¨lùC<Êœá9Œ@i0                                                                                      
ˇ ‘ü17Ø‰œÁçxπ˝©˜/Ïˇ Õ÷/Y lOünt˛ó3òÄtøÕ’sˆÄ‰ﬂﬁüM ∞   ≠Ö“üWY›T.Æ©MG¡T¨≤ÜÆÍ-ΩxÑÖÉΩXÏ5:£˘ÎMãc´¡Zz´ éÒ‚
"FŸUR¶âà°Çu ÃÙ∂§Ä∫J–§ûﬁã9z£ÎIóÃ¥ﬁ‰ï•≈ﬁ6:4ïÈê/ˆ<UÓºj¥π64&2©Â0›©ﬂêéHÂP§	Ë 	“öö√rç¢F=ºnfÒw÷—üiÌ≈MïªÎÑÓä\†#v4ΩéΩ|‚ ∫Ók¿¢RÜA—£‘+s™lì	‡ ≠:[Rm…äÙ%ÌÈW∂⁄+˝óUZ—¶˜&Ωá≤Q„T=ûÅ∞Ï^YïæDg	 ÂG
$Ù™ë3&U@ûÄ|…©à˙Ù4¥¸∫«m˛bM¬mù<Q¯∆™Ωz≤lÿ¢ÂÎ≥§Ÿ	¢öä©úx§)çúc!jÌÒÆ7Ÿà⁄;ãóª‡Î¥Îkˆw-Wµ5ãÉVØÍŸ–®Ã«%≥iuM1óZõ$\ü∫<ÅõxÚ~:^8L@9ÌÓ≥¨Íó´ãßÏ´U÷…ªîs`¥Hë%ù …≤ØUbÊ¨RÓVtÂ2çXŸ7‰.(ç≠ˆ≈3l7¥ØN=†¶•Z1M≥∞∑ÎÌÅ≠¶b¨G´÷.i≥<«´‘Êú∑Z≥rçtõ§[®—L8Ò
ÆUMR&@ˇ l¸’ÏøÙr¸‹í ‘ﬂ5z”˝”7#@G¸—Ûuc˝†:À˜ß‹†+˛Õ˘ùˆ§H?∏ñå†                           +ˇ R|ƒﬁøì?û5‡
Áˆß‹ø≥ˇ 4XΩd±>}π”˙]¸Œb“ˇ 7Uœ⁄ìz}4¿  Ç∂Hj}]guP∏>∫•5R≤ ª®∂ı‚ıc∞‘ÍèÁ≠4z-éØIiÍ¨Ç8#«à(âeUJö&"Ü	‘ 3“⁄íÈ+Bí{z,‰Íè≠&_2”{íVóxÿË“W¶@øÿÒT∫Ò™“‰ÿ–ò ßî√vß~B8Q#ïBê'† <'Jjk 6âˆiπõ≈ﬂ[D>}ß∑E6VÔÆ∫)rÄçÿ“Ù6:ıÛàÇÎπØâJFèP≠Œ©≤L'Ä .¥ÈmI∑&+–tó∑•^€hØˆ]UkFõ‹öˆ…GåuPhˆz√∞h5x	dRV˘ú$Éï(ì“™DÃôT9zÛ&¶#Î–“”ÚÎ¥Tc˘â7	∂tÒD#„™ıÍ…≥bãóÆŒìdl&äj*¶q‚ê¶6qåÑa´∑∆∏‹Of#hÓ.^ÔÉÆ”≠ØŸ‹µ^‘÷.Zø´gB£3ñÕ•‘4∆]jlëpf~ËÚm‡[…¯Èx·1 ‰/∑∫Œ≥®N^Æ.ü≤≠W[&ÓQÃ\Ç—"DñtÉ$J ΩUãö±KπY”î»DZ4]cdﬂêπ¸†>6∑€Õ∞ﬁ“Ω8ˆÇöïh≈6Œ¬ﬂØ∂∂ôä±ØXπ¶Ã;ØSör›jÕ 5“nën£E0„ƒ*πU5HòI #˝≥ÛW≤ˇ —˝ÀÛrHS|’ÎOÙM¸‹çÛGÕ’èˆÄÎ/ﬁürÄØ˚7Êw⁄ë˝ ˛‚Z0Ä                                                                                       Ø˝IÛz˛L˛x◊Ä+ü⁄ür˛œ¸—˝bıêƒ˘ˆÁOÈwÛ9àK¸›W?hM˝ÈÙ–  %ª°u™‹€è]ﬁÏÓ·Ó[3AÚJ4hfı;úÊl6ﬂ›’¬-ﬂ◊´“±mñAg)¯‰p∫F)NSg.qê“ #6_IÈä˛Áﬁ˜-lt€oŸ˚œâd`j®›ùÊF=V|-!á©O3Æ8¨&’6pÓé™ä=!Q√s‡˘.Kú ◊0 %´˙+OŸ∑&òÁ¯KC«õrô›Ω±5g©•tiÔDIÓ%q"ºÛ⁄Îj å’%âéR:oNUΩ‘û	„d¿5¥ FqIÈçÀo‰
π∂:ü∂kºG_"W®›†3\êBOé!ïdÈÌíπª¢…F∏K	†≤¶œë9±åîπ0sn'	4‘{M⁄ﬁS»µ◊á
˘r∑íF≥(¢ûI≥d÷r·OπÒ# hw definition file for processing by chibios_hwdef.py
# for the ZeroOneX6 hardware

# MCU class and specific type
MCU STM32H7xx STM32H743xx

# crystal frequency
OSCILLATOR_HZ 16000000

# board ID for firmware load
APJ_BOARD_ID 5600

# bootloader is installed at zero offset
FLASH_RESERVE_START_KB 0

# the location where the bootloader will put the firmware
FLASH_BOOTLOADER_LOAD_KB 128

# flash size
FLASH_SIZE_KB 2048

env OPTIMIZE -Os

# order of UARTs (and USB)
SERIAL_ORDER OTG1 UART7 UART5 USART3

# Pin for PWM Voltage Selection
PG6 PWM_VOLT_SEL OUTPUT HIGH GPIO(3)

# USB
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1
PA9 VBUS INPUT OPENDRAIN

# pins for SWD debugging
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# CS pins
PI9 IMU1_CS CS
PH5 ICM42688_CS CS
PI4 BMI088_A_CS CS
PI8 BMI088_G_CS CS
PH15 BMM150_CS CS
PG7  FRAM_CS CS
PI10 EXT1_CS CS

# telem1
PE8 UART7_TX UART7
PF6 UART7_RX UART7

# telem2
PC12 UART5_TX UART5
PD2 UART5_RX UART5

# debug uart
PD8 USART3_TX USART3
PD9 USART3_RX USART3

# armed indication
PE6 nARMED OUTPUT HIGH

# start peripheral power off
PF12 nVDD_5V_HIPOWER_EN OUTPUT HIGH
PG4  nVDD_5V_PERIPH_EN OUTPUT HIGH

# LEDs
PE3 LED_ACTIVITY OUTPUT OPENDRAIN HIGH # red
PE5 LED_BOOTLOADER OUTPUT OPENDRAIN HIGH # blue
define HAL_LED_ON 0

define HAL_USE_EMPTY_STORAGE 1
define HAL_STORAGE_SIZE 16384

# enable DFU by default
ENABLE_DFU_BOOT 1

# support flashing from SD card:
# power enable pins
PC13 VDD_3V3_SD_CARD_EN OUTPUT HIGH

# FATFS support:
define CH_CFG_USE_MEMCORE 1
define CH_CFG_USE_HEAP 1
define CH_CFG_USE_SEMAPHORES 0
define CH_CFG_USE_MUTEXES 1
define CH_CFG_USE_DYNAMIC 1
define CH_CFG_USE_WAITEXIT 1
define CH_CFG_USE_REGISTRY 1

# microSD support
PD6  SDMMC2_CK SDMMC2
PD7  SDMMC2_CMD SDMMC2
PB14 SDMMC2_D0 SDMMC2
PB15 SDMMC2_D1 SDMMC2
PG11 SDMMC2_D2 SDMMC2
PB4  SDMMC2_D3 SDMMC2
define FATFS_HAL_DEVICE SDCD2

DMA_PRIORITY SDMMC* USART6* ADC* UART* USART* SPI* TIM*

# enable FAT filesystem support (needs a microSD defined via SDMMC)
define HAL_OS_FATFS_IO 1

define AP_BOOTLOADER_FLASH_FROM_SD_ENABLED 1

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # hw definition file for Zubax GNSS

# MCU class and specific type
MCU STM32F105 STM32F105xC

define STM32F107_MCUCONF

define HAL_BOARD_AP_PERIPH_ZUBAXGNSS

# bootloader starts firmware at 34k
FLASH_RESERVE_START_KB 34

# store parameters in last 2 pages
STORAGE_FLASH_PAGE 126
define HAL_STORAGE_SIZE 800

# board ID for firmware load
APJ_BOARD_ID 1005

# setup build for a peripheral firmware
env AP_PERIPH 1

# crystal frequency
OSCILLATOR_HZ 16000000

define CH_CFG_ST_FREQUENCY 1000

FLASH_SIZE_KB 256

# USART3 for debug
STDOUT_SERIAL SD3
STDOUT_BAUDRATE 115200


# enable pin for GPS
PB7 GPS_ENABLE OUTPUT HIGH

PA15 BARO_CS CS
PD2  MAG_CS CS
PB6  MAG_DRDY INPUT

PC1 HWID_BIT0 INPUT
PC2 HWID_BIT1_INV INPUT
PC3 HWID_BIT2 INPUT

PB3 LED OUTPUT
PB5 LED_CAN1 OUTPUT
PB4 LED_CAN2 OUTPUT

# USART2 for GPS
PA2 USART2_TX USART2 SPEED_HIGH NODMA
PA3 USART2_RX USART2 SPEED_HIGH NODMA

# USART3 for debug
PB10 USART3_TX USART3 SPEED_HIGH NODMA
PB11 USART3_RX USART3 SPEED_HIGH NODMA

# PA13 XPA13 OUTPUT HIGH
# PA1 XPA1 INPUT FLOATING

# don't enable DMA in UART driver
define HAL_UART_NODMA

# enable watchdog

# enable CAN support
PA11 CAN_RX CAN
PB9 CAN_TX CAN



# no I2C buses
# I2C_ORDER

# spi bus for baro/mag
PC10 SPI3_SCK SPI3 SPEED_HIGH
PC11 SPI3_MISO SPI3 SPEED_HIGH
PC12 SPI3_MOSI SPI3 SPEED_HIGH

#########################
# order of UARTs
SERIAL_ORDER USART3 EMPTY EMPTY USART2

SPIDEV ms5611  SPI3 DEVID1 BARO_CS MODE3 8*MHZ 8*MHZ
SPIDEV lis3mdl SPI3 DEVID2 MAG_CS MODE3 500*KHZ 500*KHZ

define HAL_USE_ADC FALSE
define STM32_ADC_USE_ADC1 FALSE
define HAL_DISABLE_ADC_DRIVER TRUE

define HAL_NO_GPIO_IRQ

define CH_CFG_ST_TIMEDELTA 0
define SERIAL_BUFFERS_SIZE 512
define PORT_INT_REQUIRED_STACK 64

#defined to turn off undef warnings
define __FPU_PRESENT 0

define HAL_USE_RTC FALSE

define DMA_RESERVE_SIZE 0

MAIN_STACK 0x200
PROCESS_STACK 0xA00

define HAL_USE_I2C TRUE
define STM32_I2C_USE_I2C1 TRUE

define HAL_UART_MIN_TX_SIZE 256
define HAL_UART_MIN_RX_SIZE 128

define HAL_UART_STACK_SIZE 256
define STORAGE_THD_WA_SIZE 512


define HAL_I2C_CLEAR_ON_TIMEOUT 0

define HAL_DEVICE_THREAD_STACK 768

define AP_PARAM_MAX_EMBEDDED_PARAM 0

define HAL_I2C_INTERNAL_MASK 0

# LIS3MDL compass
COMPASS LIS3MDL SPI:lis3mdl false ROTATION_YAW_270

# MS5611 baro
BARO MS56XX SPI:ms5611

define HAL_BARO_ALLOW_INIT_NO_BARO

define HAL_PERIPH_ENABLE_GPS
define HAL_PERIPH_ENABLE_MAG
define HAL_PERIPH_ENABLE_BARO

# reduce the number of CAN RX Buffer
define HAL_CAN_RX_QUEUE_SIZE 32
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # hw definition file for processing by chibios_pins.py
# for airbotf4 bootloader

# MCU class and specific type
MCU STM32F4xx STM32F405xx

# board ID for firmware load
APJ_BOARD_ID 128

# crystal frequency
OSCILLATOR_HZ 8000000

FLASH_SIZE_KB 1024

# don't allow bootloader to use more than 16k
FLASH_USE_MAX_KB 16

# bootloader is installed at zero offset
FLASH_RESERVE_START_KB 0

# LEDs
PB5 LED_BOOTLOADER OUTPUT LOW
define HAL_LED_ON 0

# the location where the bootloader will put the firmware
FLASH_BOOTLOADER_LOAD_KB 64


# order of UARTs
SERIAL_ORDER OTG1

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

# Add CS pins to ensure they are high in bootloader
PA4 MPU6000_CS CS
PB3 FLASH_CS CS
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # hw definition file for processing by chibios_pins.py
# Airbot F4, Flip32 F4
# with F405 mcu, mpu6000 imu

MCU STM32F4xx STM32F405xx

HAL_CHIBIOS_ARCH_F405 1

# board ID for firmware load
APJ_BOARD_ID 128

# crystal frequency
OSCILLATOR_HZ 8000000

STM32_ST_USE_TIMER 5

# flash size
FLASH_SIZE_KB 1024
FLASH_RESERVE_START_KB 64

# order of I2C buses
I2C_ORDER I2C2

# order of UARTs
SERIAL_ORDER OTG1 USART1 EMPTY USART6

#adc
PC1 BAT_CURR_SENS ADC1 SCALE(1)
PC2 BAT_VOLT_SENS ADC1 SCALE(1)
PA0 RSSI_IN ADC1

#pwm output
PB0 TIM1_CH2N TIM1 PWM(1) GPIO(50)
PB1 TIM1_CH3N TIM1 PWM(2) GPIO(51)
PA3 TIM2_CH4 TIM2 PWM(3) GPIO(52)
PA2 TIM2_CH3 TIM2 PWM(4) GPIO(53)
PA1 TIM2_CH2 TIM2 PWM(5) GPIO(54)
PA8 TIM1_CH1 TIM1 PWM(6) GPIO(55)

PA4 MPU6000_CS CS
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

PB10 I2C2_SCL I2C2
PB11 I2C2_SDA I2C2

PA10 USART1_RX USART1
PA9 USART1_TX USART1

PC6 USART6_TX USART6
PC7 USART6_RX USART6

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

PB3 FLASH_CS CS
PC12 SPI3_MOSI SPI3
PC11 SPI3_MISO SPI3
PC10 SPI3_SCK SPI3

PB5 LED OUTPUT HIGH GPIO(57)
PB4 TIM3_CH1 TIM3 GPIO(56) ALARM

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1
PC5 VBUS INPUT OPENDRAIN

# "PPM" solder pad/resistor should be soldered and "S-BUS" resistor/solder pad removed
# Overwise UART1 or RCIN will not work
PB14 TIM12_CH1 TIM12 RCININT PULLDOWN LOW

# SPI Device table 
SPIDEV mpu6000    SPI1 DEVID1 MPU6000_CS MODE3 1*MHZ 8*MHZ
SPIDEV dataflash  SPI3 DEVID1 FLASH_CS MODE3 32*MHZ 32*MHZ

# enable logging to dataflash
define HAL_LOGGING_DATAFLASH_ENABLED 1

# one IMU
IMU Invensense SPI:mpu6000_cs ROTATION_YAW_180

# one baro
BARO MS56XX I2C:0:0x77

# no builtin compasses
define ALLOW_ARM_NO_COMPASS
define HAL_PROBE_EXTERNAL_I2C_COMPASSES
define HAL_I2C_INTERNAL_MASK 0
define HAL_COMPASS_AUTO_ROT_DEFAULT 2

STORAGE_FLASH_PAGE 1
define HAL_STORAGE_SIZE 15360

# define default battery setup
define HAL_BATT_VOLT_PIN 12
define HAL_BATT_CURR_PIN 11
define HAL_BATT_VOLT_SCALE 11
define HAL_BATT_CURR_SCALE 18.2

define AP_NOTIFY_GPIO_LED_1_ENABLED 1
define AP_NOTIFY_GPIO_LED_1_PIN 57

# 64kB FLASH_RESERVE_START_KB means we're lacking a lot of space:
include ../include/minimize_features.inc
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /*
 * This file is free software: you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the
 * Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * Modified for use in AP_HAL by Andrew Tridgell and Siddharth Bharat Purohit
 */

#include "hal.h"
#include "usbcfg.h"
#include "stm32_util.h"
#include "flash.h"
#include "watchdog.h"


/*===========================================================================*/
/* Driver local definitions.                                                 */
/*===========================================================================*/

/*===========================================================================*/
/* Driver exported variables.                                                */
/*===========================================================================*/

/*===========================================================================*/
/* Driver local variables and types.                                         */
/*===========================================================================*/

/**
 * @brief   STM32 GPIO static initialization data.
 */
#if defined(STM32F100_MCUCONF) || defined(STM32F103_MCUCONF) || defined(STM32F105_MCUCONF)

const PALConfig pal_default_config =
{
  {VAL_GPIOA_ODR, VAL_GPIOA_CRL, VAL_GPIOA_CRH},
  {VAL_GPIOB_ODR, VAL_GPIOB_CRL, VAL_GPIOB_CRH},
  {VAL_GPIOC_ODR, VAL_GPIOC_CRL, VAL_GPIOC_CRH},
  {VAL_GPIOD_ODR, VAL_GPIOD_CRL, VAL_GPIOD_CRH},
  {VAL_GPIOE_ODR, VAL_GPIOE_CRL, VAL_GPIOE_CRH},
};

#else //Other than STM32F1/F3 series

/**
 * @brief   Type of STM32 GPIO port setup.
 */
typedef struct {
  uint32_t              moder;
  uint32_t              otyper;
  uint32_t              ospeedr;
  uint32_t              pupdr;
  uint32_t              odr;
  uint32_t              afrl;
  uint32_t              afrh;
} gpio_setup_t;

/**
 * @brief   Type of STM32 GPIO initialization data.
 */
typedef struct {
#if STM32_HAS_GPIOA || defined(__DOXYGEN__)
  gpio_setup_t          PAData;
#endif
#if STM32_HAS_GPIOB || defined(__DOXYGEN__)
  gpio_setup_t          PBData;
#endif
#if STM32_HAS_GPIOC || defined(__DOXYGEN__)
  gpio_setup_t          PCData;
#endif
#if STM32_HAS_GPIOD || defined(__DOXYGEN__)
  gpio_setup_t          PDData;
#endif
#if STM32_HAS_GPIOE || defined(__DOXYGEN__)
  gpio_setup_t          PEData;
#endif
#if STM32_HAS_GPIOF || defined(__DOXYGEN__)
  gpio_setup_t          PFData;
#endif
#if STM32_HAS_GPIOG || defined(__DOXYGEN__)
  gpio_setup_t          PGData;
#endif
#if STM32_HAS_GPIOH || defined(__DOXYGEN__)
  gpio_setup_t          PHData;
#endif
#if STM32_HAS_GPIOI || defined(__DOXYGEN__)
  gpio_setup_t          PIData;
#endif
#if STM32_HAS_GPIOJ || defined(__DOXYGEN__)
  gpio_setup_t          PJData;
#endif
#if STM32_HAS_GPIOK || defined(__DOXYGEN__)
  gpio_setup_t          PKData;
#endif
} gpio_config_t;

/**
 * @brief   STM32 GPIO static initialization data.
 */
static const gpio_config_t gpio_default_config = {
#if STM32_HAS_GPIOA
  {VAL_GPIOA_MODER, VAL_GPIOA_OTYPER, VAL_GPIOA_OSPEEDR, VAL_GPIOA_PUPDR,
   VAL_GPIOA_ODR,   VAL_GPIOA_AFRL,   VAL_GPIOA_AFRH},
#endif
#if STM32_HAS_GPIOB
  {VAL_GPIOB_MODER, VAL_GPIOB_OTYPER, VAL_GPIOB_OSPEEDR, VAL_GPIOB_PUPDR,
   VAL_GPIOB_ODR,   VAL_GPIOB_AFRL,   VAL_GPIOB_AFRH},
#endif
#if STM32_HAS_GPIOC
  {VAL_GPIOC_MODER, VAL_GPIOC_OTYPER, VAL_GPIOC_OSPEEDR, VAL_GPIOC_PUPDR,
   VAL_GPIOC_ODR,   VAL_GPIOC_AFRL,   VAL_GPIOC_AFRH},
#endif
#if STM32_HAS_GPIOD
  {VAL_GPIOD_MODER, VAL_GPIOD_OTYPER, VAL_GPIOD_OSPEEDR, VAL_GPIOD_PUPDR,
   VAL_GPIOD_ODR,   VAL_GPIOD_AFRL,   VAL_GPIOD_AFRH},
#endif
#if STM32_HAS_GPIOE
  {VAL_GPIOE_MODER, VAL_GPIOE_OTYPER, VAL_GPIOE_OSPEEDR, VAL_GPIOE_PUPDR,
   VAL_GPIOE_ODR,   VAL_GPIOE_AFRL,   VAL_GPIOE_AFRH},
#endif
#if STM32_HAS_GPIOF
  {VAL_GPIOF_MODER, VAL_GPIOF_OTYPER, VAL_GPIOF_OSPEEDR, VAL_GPIOF_PUPDR,
   VAL_GPIOF_ODR,   VAL_GPIOF_AFRL,   VAL_GPIOF_AFRH},
#endif
#if STM32_HAS_GPIOG
  {VAL_GPIOG_MODER, VAL_GPIOG_OTYPER, VAL_GPIOG_OSPEEDR, VAL_GPIOG_PUPDR,
   VAL_GPIOG_ODR,   VAL_GPIOG_AFRL,   VAL_GPIOG_AFRH},
#endif
#if STM32_HAS_GPIOH
  {VAL_GPIOH_MODER, VAL_GPIOH_OTYPER, VAL_GPIOH_OSPEEDR, VAL_GPIOH_PUPDR,
   VAL_GPIOH_ODR,   VAL_GPIOH_AFRL,   VAL_GPIOH_AFRH},
#endif
#if STM32_HAS_GPIOI
  {VAL_GPIOI_MODER, VAL_GPIOI_OTYPER, VAL_GPIOI_OSPEEDR, VAL_GPIOI_PUPDR,
   VAL_GPIOI_ODR,   VAL_GPIOI_AFRL,   VAL_GPIOI_AFRH},
#endif
#if STM32_HAS_GPIOJ
  {VAL_GPIOJ_MODER, VAL_GPIOJ_OTYPER, VAL_GPIOJ_OSPEEDR, VAL_GPIOJ_PUPDR,
   VAL_GPIOJ_ODR,   VAL_GPIOJ_AFRL,   VAL_GPIOJ_AFRH},
#endif
#if STM32_HAS_GPIOK
  {VAL_GPIOK_MODER, VAL_GPIOK_OTYPER, VAL_GPIOK_OSPEEDR, VAL_GPIOK_PUPDR,
   VAL_GPIOK_ODR,   VAL_GPIOK_AFRL,   VAL_GPIOK_AFRH}
#endif
};

/*===========================================================================*/
/* Driver local functions.                                                   */
/*===========================================================================*/

static void gpio_init(stm32_gpio_t *gpiop, const gpio_setup_t *config) {

  gpiop->OTYPER  = config->otyper;
  gpiop->OSPEEDR = config->ospeedr;
  gpiop->PUPDR   = config->pupdr;
  gpiop->ODR     = config->odr;
  gpiop->AFRL    = config->afrl;
  gpiop->AFRH    = config->afrh;
  gpiop->MODER   = config->moder;
}

static void stm32_gpio_init(void) {

  /* Enabling GPIO-related clocks, the mask comes from the
     registry header file.*/
#if defined(STM32H7)
#if !EXT_FLASH_SIZE_MB // if we have external flash resetting GPIO might disable all comms with it
  rccResetAHB4(STM32_GPIO_EN_MASK);
#endif
  rccEnableAHB4(STM32_GPIO_EN_MASK, true);
#elif defined(STM32F3)
  rccResetAHB(STM32_GPIO_EN_MASK);
  rccEnableAHB(STM32_GPIO_EN_MASK, true);
#elif defined(STM32G4) || defined(STM32L4) || defined(STM32L4PLUS)
  rccResetAHB2(STM32_GPIO_EN_MASK);
  rccEnableAHB2(STM32_GPIO_EN_MASK, true);
#else
  rccResetAHB1(STM32_GPIO_EN_MASK);
  rccEnableAHB1(STM32_GPIO_EN_MASK, true);
#endif

  /* Initializing all the defined GPIO ports.*/
#if STM32_HAS_GPIOA
  gpio_init(GPIOA, &gpio_default_config.PAData);
#endif
#if STM32_HAS_GPIOB
  gpio_init(GPIOB, &gpio_default_config.PBData);
#endif
#if STM32_HAS_GPIOC
  gpio_init(GPIOC, &gpio_default_config.PCData);
#endif
#if STM32_HAS_GPIOD
  gpio_init(GPIOD, &gpio_default_config.PDData);
#endif
#if STM32_HAS_GPIOE
  gpio_init(GPIOE, &gpio_default_config.PEData);
#endif
#if STM32_HAS_GPIOF
  gpio_init(GPIOF, &gpio_default_config.PFData);
#endif
#if STM32_HAS_GPIOG
  gpio_init(GPIOG, &gpio_default_config.PGData);
#endif
#if STM32_HAS_GPIOH
  gpio_init(GPIOH, &gpio_default_config.PHData);
#endif
#if STM32_HAS_GPIOI
  gpio_init(GPIOI, &gpio_default_config.PIData);
#endif
#if STM32_HAS_GPIOJ
  gpio_init(GPIOJ, &gpio_default_config.PJData);
#endif
#if STM32_HAS_GPIOK
  gpio_init(GPIOK, &gpio_default_config.PKData);
#endif
}

#endif //!STM32F100_MCUCONF

/**
 * @brief   Early initialization code.
 * @details This initialization must be performed just after stack setup
 *          and before any other initialization.
 *
 * You must not rely on: 1) BSS variables being cleared 2) DATA Variables being initialized 3) RAM functions to be in RAM
 * You can rely on: 1) const variables or tables 2) flash code 3) automatic variables
 */
void __early_init(void) {
#if !defined(STM32F1)
  stm32_gpio_init();
#endif
#if !HAL_XIP_ENABLED || defined(HAL_FORCE_CLOCK_INIT)
  // if running from external flash then the clocks must not be reset - instead rely on the bootloader to setup
  stm32_clock_init();
#endif
#if defined(HAL_DISABLE_DCACHE)
  SCB_DisableDCache();
#endif
#if defined(STM32H7)

  // ensure ITCM and DTCM are enabled. These could be disabled by the px4
  // bootloader
  SCB->ITCMCR |= 1; // ITCM enable
  SCB->DTCMCR |= 1; // DTCM enable

#ifdef STM32_NOCACHE_MPU_REGION_1
  // disable cache on configured regions so they can be used for DMA
  // this requires some coordination with the memory map in the MCU configuration script
  mpuConfigureRegion(STM32_NOCACHE_MPU_REGION_1,
                     STM32_NOCACHE_MPU_REGION_1_BASE,
                     MPU_RASR_ATTR_AP_RW_RW |
                     MPU_RASR_ATTR_NON_CACHEABLE |
                     STM32_NOCACHE_MPU_REGION_1_SIZE |
                     MPU_RASR_ENABLE);
#endif
#ifdef STM32_NOCACHE_MPU_REGION_2
  mpuConfigureRegion(STM32_NOCACHE_MPU_REGION_2,
                     STM32_NOCACHE_MPU_REGION_2_BASE,
                     MPU_RASR_ATTR_AP_RW_RW |
                     MPU_RASR_ATTR_NON_CACHEABLE |
                     STM32_NOCACHE_MPU_REGION_2_SIZE |
                     MPU_RASR_ENABLE);
#endif
#if defined(DUAL_CORE)
  stm32_disable_cm4_core(); // disable second core
#endif
#endif
}

void __late_init(void) {
  halInit();
  chSysInit();

  /*
   * Initialize RNG
   */
#if HAL_USE_HW_RNG && defined(RNG)
  rccEnableAHB2(RCC_AHB2ENR_RNGEN, 0);
  RNG->CR |= RNG_CR_IE;
  RNG->CR |= RNG_CR_RNGEN;
#endif

  stm32_watchdog_save_reason();
#ifndef HAL_BOOTLOADER_BUILD
  stm32_watchdog_clear_reason();
#endif
#if CH_CFG_USE_HEAP == TRUE
  malloc_init();
#endif
#ifdef HAL_USB_PRODUCT_ID
  setup_usb_strings();
#endif

#ifdef HAL_FLASH_SET_NRST_MODE
  // ensure NRST_MODE is set correctly
  stm32_flash_set_NRST_MODE(HAL_FLASH_SET_NRST_MODE);
#endif
}

#if HAL_USE_SDC || defined(__DOXYGEN__)
/**
 * @brief   SDC card detection.
 */
bool sdc_lld_is_card_inserted(SDCDriver *sdcp) {
    (void)sdcp;
    return true;
}

/**
 * @brief   SDC card write protection detection.
 */
bool sdc_lld_is_write_protected(SDCDriver *sdcp) {

  (void)sdcp;
  return false;
}
#endif /* HAL_USE_SDC */

#if HAL_USE_MMC_SPI || defined(__DOXYGEN__)
/**
 * @brief   MMC_SPI card detection.
 */
bool mmc_lld_is_card_inserted(MMCDriver *mmcp) {
  (void)mmcp;
  /* TODO: Fill the implementation.*/
  return true;
}

/**
 * @brief   MMC_SPI card write protection detection.
 */
bool mmc_lld_is_write_protected(MMCDriver *mmcp) {
  (void)mmcp;
  /* TODO: Fill the implementation.*/
  return false;
}
#endif

/**
 * @brief   Board-specific initialization code.
 * @todo    Add your board-specific code, if any.
 */
void boardInit(void) {
  HAL_BOARD_INIT_HOOK_CALL
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /*
 * This file is free software: you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the
 * Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * Code by Andrew Tridgell and Siddharth Bharat Purohit
 */
#pragma once

#include "hwdef.h"

#ifndef HAL_BOARD_INIT_HOOK_DEFINE
#define HAL_BOARD_INIT_HOOK_DEFINE
#endif

#ifndef HAL_BOARD_INIT_HOOK_CALL
#define HAL_BOARD_INIT_HOOK_CALL
#endif

// default to interrupts on port D
#ifndef HAL_GPIO_INTERRUPT_PORT
#define HAL_GPIO_INTERRUPT_PORT EXT_MODE_GPIOD
#endif

#if !defined(_FROM_ASM_)
#ifdef __cplusplus
extern "C" {
#endif
  void boardInit(void);
  HAL_BOARD_INIT_HOOK_DEFINE
#ifdef __cplusplus
}
#endif
#endif /* _FROM_ASM_ */

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /*
 * This file is free software: you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the
 * Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
/*
  bouncebuffer code for DMA safe memory operations
 */
#include "stm32_util.h"
#include <stdint.h>
#include <string.h>
#include <stdio.h>
#include "bouncebuffer.h"

// Enable when trying to check if you are not just listening yourself
#define ENABLE_ECHO_SAFE 0

/*
  initialise a bouncebuffer
 */
void bouncebuffer_init(struct bouncebuffer_t **bouncebuffer, uint32_t prealloc_bytes, bool axi_sram)
{
    (*bouncebuffer) = calloc(1, sizeof(struct bouncebuffer_t));
    osalDbgAssert(((*bouncebuffer) != NULL), "bouncebuffer init");
    (*bouncebuffer)->on_axi_sram = axi_sram;
    if (prealloc_bytes) {
        (*bouncebuffer)->dma_buf = axi_sram?malloc_axi_sram(prealloc_bytes):malloc_dma(prealloc_bytes);
        if ((*bouncebuffer)->dma_buf) {
            (*bouncebuffer)->size = prealloc_bytes;
        }
    }
}

/*
  setup for reading from a device into memory, allocating a bouncebuffer if needed
  Note that *buf can be NULL, in which case we allocate DMA capable memory, but don't
  copy to it in bouncebuffer_finish_read(). This avoids DMA failures in dummyrx in the SPI LLD
 */
bool bouncebuffer_setup_read(struct bouncebuffer_t *bouncebuffer, uint8_t **buf, uint32_t size)
{
    if (!bouncebuffer || mem_is_dma_safe(*buf, size, bouncebuffer->on_axi_sram)) {
#if defined(STM32H7)
        /*
          on H7 the cache needs invalidating before a read to ensure
          there is no stale data in the buffer
         */
        stm32_cacheBufferInvalidate(*buf, (size+31)&~31);
#endif
        return true;
    }
    osalDbgAssert((bouncebuffer->busy == false), "bouncebuffer read");        
    bouncebuffer->orig_buf = *buf;
    if (bouncebuffer->size < size) {
        if (bouncebuffer->size > 0) {
            free(bouncebuffer->dma_buf);
        }
        bouncebuffer->dma_buf = bouncebuffer->on_axi_sram?malloc_axi_sram(size):malloc_dma(size);
        if (!bouncebuffer->dma_buf) {
            bouncebuffer->size = 0;
            return false;
        }
        bouncebuffer->size = size;
    }
    *buf = bouncebuffer->dma_buf;
#if ENABLE_ECHO_SAFE
    memset(bouncebuffer->dma_buf, 0xBB, bouncebuffer->size);
#endif
#if defined(STM32H7)
    osalDbgAssert((((uint32_t)*buf)&31) == 0, "bouncebuffer read align");
    stm32_cacheBufferInvalidate(*buf, (size+31)&~31);
#endif
    bouncebuffer->busy = true;
    return true;
}

/*
  finish a read operation
 */
void bouncebuffer_finish_read(struct bouncebuffer_t *bouncebuffer, const uint8_t *buf, uint32_t size)
{
    if (bouncebuffer && buf == bouncebuffer->dma_buf) {
        osalDbgAssert((bouncebuffer->busy == true), "bouncebuffer finish_read");
        if (bouncebuffer->orig_buf) {
            memcpy(bouncebuffer->orig_buf, buf, size);
        }
        bouncebuffer->busy = false;
    }
}


/*
  setup for reading from memory to a device, allocating a bouncebuffer if needed
 */
bool bouncebuffer_setup_write(struct bouncebuffer_t *bouncebuffer, const uint8_t **buf, uint32_t size)
{
    if (!bouncebuffer || mem_is_dma_safe(*buf, size, bouncebuffer->on_axi_sram)) {
#if defined(STM32H7)
        /*
          on H7 we need to flush any pending writes to memory before the DMA operation
         */
        stm32_cacheBufferFlush(*buf, (size+31)&~31);
#endif
        return true;
    }
    osalDbgAssert((bouncebuffer->busy == false), "bouncebuffer write");        
    if (bouncebuffer->size < size) {
        if (bouncebuffer->size > 0) {
            free(bouncebuffer->dma_buf);
        }
        bouncebuffer->dma_buf = bouncebuffer->on_axi_sram?malloc_axi_sram(size):malloc_dma(size);
        if (!bouncebuffer->dma_buf) {
            bouncebuffer->size = 0;
            return false;
        }
        bouncebuffer->size = size;
    }
    if (*buf) {
        memcpy(bouncebuffer->dma_buf, *buf, size);
    }
    *buf = bouncebuffer->dma_buf;
#if defined(STM32H7)
    osalDbgAssert((((uint32_t)*buf)&31) == 0, "bouncebuffer write align");
    stm32_cacheBufferFlush(*buf, (size+31)&~31);
#endif
    bouncebuffer->busy = true;
    return true;
}


/*
  finish a write operation
 */
void bouncebuffer_finish_write(struct bouncebuffer_t *bouncebuffer, const uint8_t *buf)
{
    if (bouncebuffer && buf == bouncebuffer->dma_buf) {
        osalDbgAssert((bouncebuffer->busy == true), "bouncebuffer finish_wite");        
        bouncebuffer->busy = false;
    }
}

/*
  abort an operation
 */
void bouncebuffer_abort(struct bouncebuffer_t *bouncebuffer)
{
    if (bouncebuffer) {
        bouncebuffer->busy = false;
    }
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      /*
  bouncebuffer code for supporting ChibiOS drivers that use DMA, but may be passed memory that
  is not DMA safe. 

  This API assumes that there will be only one user of a bouncebuffer at a time
 */

#pragma once

#ifdef __cplusplus
extern "C" {
#endif

struct bouncebuffer_t {
    uint8_t *dma_buf;
    uint8_t *orig_buf;
    uint32_t size;
    bool busy;
    bool on_axi_sram;
};

/*
  initialise a bouncebuffer
 */
void bouncebuffer_init(struct bouncebuffer_t **bouncebuffer, uint32_t prealloc_bytes, bool axi_sram);

/*
  setup for reading from a device into memory, allocating a bouncebuffer if needed
 */
bool bouncebuffer_setup_read(struct bouncebuffer_t *bouncebuffer, uint8_t **buf, uint32_t size);
    
/*
  finish a read operation
 */
void bouncebuffer_finish_read(struct bouncebuffer_t *bouncebuffer, const uint8_t *buf, uint32_t size);
    
/*
  setup for reading from memory to a device, allocating a bouncebuffer if needed
 */
bool bouncebuffer_setup_write(struct bouncebuffer_t *bouncebuffer, const uint8_t **buf, uint32_t size);
    
/*
  finish a write operation
 */
void bouncebuffer_finish_write(struct bouncebuffer_t *bouncebuffer, const uint8_t *buf);

/*
  abort an operation
 */
void bouncebuffer_abort(struct bouncebuffer_t *bouncebuffer);

#ifdef __cplusplus
}
#endif
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              /*
 * This file is free software: you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the
 * Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * Modified for use in AP_HAL by Andrew Tridgell and Siddharth Bharat Purohit
 */

/**
 * @file    templates/chconf.h
 * @brief   Configuration file template.
 * @details A copy of this file must be placed in each project directory, it
 *          contains the application specific kernel settings.
 *
 * @addtogroup config
 * @details Kernel related settings and hooks.
 * @{
 */

#pragma once

#include "hwdef.h"

#define _CHIBIOS_RT_CONF_
#define _CHIBIOS_RT_CONF_VER_7_0_
/*===========================================================================*/
/**
 * @name System timers settings
 * @{
 */
/*===========================================================================*/

#if !defined(FALSE)
#define FALSE                               0
#endif

#if !defined(TRUE)
#define TRUE                                1
#endif

#ifdef HAL_CHIBIOS_ENABLE_ASSERTS
#define CH_DBG_ENABLE_ASSERTS TRUE
#define CH_DBG_ENABLE_CHECKS TRUE
#define CH_DBG_SYSTEM_STATE_CHECK TRUE
#undef CH_DBG_ENABLE_STACK_CHECK
#define CH_DBG_ENABLE_STACK_CHECK TRUE

// Generate assertions on a GPIO pin
#ifdef HAL_GPIO_PIN_FAULT
#ifndef _FROM_ASM_
#ifdef __cplusplus
extern "C" {
#endif
  void fault_printf(const char *fmt, ...);
#ifdef __cplusplus
}
#endif
#endif
#define osalDbgAssert(c, remark) do { if (!(c)) { fault_printf("%s:%d: %s", __FILE__, __LINE__, remark ); chDbgAssert(c, remark); } } while (0)
#endif

#endif // HAL_CHIBIOS_ENABLE_ASSERTS

#if HAL_ENABLE_THREAD_STATISTICS
#define CH_DBG_STATISTICS TRUE
#else
#define CH_DBG_STATISTICS FALSE
#endif

/**
 * @brief   Handling of instances.
 * @note    If enabled then threads assigned to various instances can
 *          interact each other using the same synchronization objects.
 *          If disabled then each OS instance is a separate world, no
 *          direct interactions are handled by the OS.
 */
#if !defined(CH_CFG_SMP_MODE)
#define CH_CFG_SMP_MODE                     FALSE
#endif

/**
 * @brief   Time Stamps APIs.
 * @details If enabled then the time stamps APIs are included in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_TIMESTAMP)
#define CH_CFG_USE_TIMESTAMP                TRUE
#endif

/**
 * @brief   System time counter resolution.
 * @note    Allowed values are 16 or 32 bits.
 */
#ifndef CH_CFG_ST_RESOLUTION
#define CH_CFG_ST_RESOLUTION                32
#endif

/**
 * @brief   System tick frequency.
 * @details Frequency of the system timer that drives the system ticks. This
 *          setting also defines the system tick time unit. We set this to 1000000
 *          in ArduPilot so we get maximum resolution for timing of delays
 */
#ifndef CH_CFG_ST_FREQUENCY
#define CH_CFG_ST_FREQUENCY                 1000000
#endif

/**
 * @brief   Time intervals data size.
 * @note    Allowed values are 16, 32 or 64 bits.
 */
#if !defined(CH_CFG_INTERVALS_SIZE)
#define CH_CFG_INTERVALS_SIZE               CH_CFG_ST_RESOLUTION
#endif

/**
 * @brief   Time types data size.
 * @note    Allowed values are 16 or 32 bits.
 */
#if !defined(CH_CFG_TIME_TYPES_SIZE)
#define CH_CFG_TIME_TYPES_SIZE              32
#endif

/**
 * @brief   Time delta constant for the tick-less mode.
 * @note    If this value is zero then the system uses the classic
 *          periodic tick. This value represents the minimum number
 *          of ticks that is safe to specify in a timeout directive.
 *          The value one is not valid, timeouts are rounded up to
 *          this value.
 */
#ifndef CH_CFG_ST_TIMEDELTA
#define CH_CFG_ST_TIMEDELTA                 10
#endif

/*
  default to a large interrupt stack for now. We may trim this later
  if we become confident of our interrupt handler requirements. Note
  that we pay for this stack size in every thread, so it is quite
  expensive in memory
 */
#ifndef PORT_INT_REQUIRED_STACK
#define PORT_INT_REQUIRED_STACK 128
#endif


/** @} */

/*===========================================================================*/
/**
 * @name Kernel parameters and options
 * @{
 */
/*===========================================================================*/

/**
 * @brief   Round robin interval.
 * @details This constant is the number of system ticks allowed for the
 *          threads before preemption occurs. Setting this value to zero
 *          disables the preemption for threads with equal priority and the
 *          round robin becomes cooperative. Note that higher priority
 *          threads can still preempt, the kernel is always preemptive.
 * @note    Disabling the round robin preemption makes the kernel more compact
 *          and generally faster.
 * @note    The round robin preemption is not supported in tickless mode and
 *          must be set to zero in that case.
 */
#if !defined(CH_CFG_TIME_QUANTUM)
#define CH_CFG_TIME_QUANTUM                 0
#endif

/**
 * @brief   Managed RAM size.
 * @details Size of the RAM area to be managed by the OS. If set to zero
 *          then the whole available RAM is used. The core memory is made
 *          available to the heap allocator and/or can be used directly through
 *          the simplified core memory allocator.
 *
 * @note    In order to let the OS manage the whole RAM the linker script must
 *          provide the @p __heap_base__ and @p __heap_end__ symbols.
 * @note    Requires @p CH_CFG_USE_MEMCORE.
 */
#if !defined(CH_CFG_MEMCORE_SIZE)
#define CH_CFG_MEMCORE_SIZE                 0
#endif

/**
 * @brief   Idle thread automatic spawn suppression.
 * @details When this option is activated the function @p chSysInit()
 *          does not spawn the idle thread. The application @p main()
 *          function becomes the idle thread and must implement an
 *          infinite loop.
 */
#if !defined(CH_CFG_NO_IDLE_THREAD)
#define CH_CFG_NO_IDLE_THREAD               FALSE
#endif

/** @} */

/*===========================================================================*/
/**
 * @name Performance options
 * @{
 */
/*===========================================================================*/

/**
 * @brief   OS optimization.
 * @details If enabled then time efficient rather than space efficient code
 *          is used when two possible implementations exist.
 *
 * @note    This is not related to the compiler optimization options.
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_OPTIMIZE_SPEED)
#define CH_CFG_OPTIMIZE_SPEED               TRUE
#endif

/** @} */

/*===========================================================================*/
/**
 * @name Subsystem options
 * @{
 */
/*===========================================================================*/

/**
 * @brief   Time Measurement APIs.
 * @details If enabled then the time measurement APIs are included in
 *          the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_TM)
#define CH_CFG_USE_TM                       TRUE
#endif

/**
 * @brief   Threads registry APIs.
 * @details If enabled then the registry APIs are included in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_REGISTRY)
#define CH_CFG_USE_REGISTRY                 TRUE
#endif

/**
 * @brief   Threads synchronization APIs.
 * @details If enabled then the @p chThdWait() function is included in
 *          the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_WAITEXIT)
#define CH_CFG_USE_WAITEXIT                 TRUE
#endif

/**
 * @brief   Semaphores APIs.
 * @details If enabled then the Semaphores APIs are included in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_SEMAPHORES)
#define CH_CFG_USE_SEMAPHORES               TRUE
#endif

/**
 * @brief   Semaphores queuing mode.
 * @details If enabled then the threads are enqueued on semaphores by
 *          priority rather than in FIFO order.
 *
 * @note    The default is @p FALSE. Enable this if you have special
 *          requirements.
 * @note    Requires @p CH_CFG_USE_SEMAPHORES.
 */
#if !defined(CH_CFG_USE_SEMAPHORES_PRIORITY)
#define CH_CFG_USE_SEMAPHORES_PRIORITY      FALSE
#endif

/**
 * @brief   Mutexes APIs.
 * @details If enabled then the mutexes APIs are included in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_MUTEXES)
#define CH_CFG_USE_MUTEXES                  TRUE
#endif

/**
 * @brief   Enables recursive behavior on mutexes.
 * @note    Recursive mutexes are heavier and have an increased
 *          memory footprint.
 *
 * @note    The default is @p FALSE.
 * @note    Requires @p CH_CFG_USE_MUTEXES.
 */
#if !defined(CH_CFG_USE_MUTEXES_RECURSIVE)
#define CH_CFG_USE_MUTEXES_RECURSIVE        TRUE
#endif

/**
 * @brief   Conditional Variables APIs.
 * @details If enabled then the conditional variables APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 * @note    Requires @p CH_CFG_USE_MUTEXES.
 */
#if !defined(CH_CFG_USE_CONDVARS)
#define CH_CFG_USE_CONDVARS                 FALSE
#endif

/**
 * @brief   Conditional Variables APIs with timeout.
 * @details If enabled then the conditional variables APIs with timeout
 *          specification are included in the kernel.
 *
 * @note    The default is @p TRUE.
 * @note    Requires @p CH_CFG_USE_CONDVARS.
 */
#if !defined(CH_CFG_USE_CONDVARS_TIMEOUT)
#define CH_CFG_USE_CONDVARS_TIMEOUT         FALSE
#endif

/**
 * @brief   Events Flags APIs.
 * @details If enabled then the event flags APIs are included in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_EVENTS)
#define CH_CFG_USE_EVENTS                   TRUE
#endif

/**
 * @brief   Events Flags APIs with timeout.
 * @details If enabled then the events APIs with timeout specification
 *          are included in the kernel.
 *
 * @note    The default is @p TRUE.
 * @note    Requires @p CH_CFG_USE_EVENTS.
 */
#if !defined(CH_CFG_USE_EVENTS_TIMEOUT)
#define CH_CFG_USE_EVENTS_TIMEOUT           TRUE
#endif

/**
 * @brief   Synchronous Messages APIs.
 * @details If enabled then the synchronous messages APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_MESSAGES)
#define CH_CFG_USE_MESSAGES                 FALSE
#endif

/**
 * @brief   Synchronous Messages queuing mode.
 * @details If enabled then messages are served by priority rather than in
 *          FIFO order.
 *
 * @note    The default is @p FALSE. Enable this if you have special
 *          requirements.
 * @note    Requires @p CH_CFG_USE_MESSAGES.
 */
#if !defined(CH_CFG_USE_MESSAGES_PRIORITY)
#define CH_CFG_USE_MESSAGES_PRIORITY        FALSE
#endif

/**
 * @brief   Mailboxes APIs.
 * @details If enabled then the asynchronous messages (mailboxes) APIs are
 *          included in the kernel.
 *
 * @note    The default is @p TRUE.
 * @note    Requires @p CH_CFG_USE_SEMAPHORES.
 */
#if !defined(CH_CFG_USE_MAILBOXES)
#define CH_CFG_USE_MAILBOXES                FALSE
#endif

/**
 * @brief   Core Memory Manager APIs.
 * @details If enabled then the core memory manager APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_MEMCORE)
#define CH_CFG_USE_MEMCORE                  TRUE
#endif

/**
 * @brief   Heap Allocator APIs.
 * @details If enabled then the memory heap allocator APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 * @note    Requires @p CH_CFG_USE_MEMCORE and either @p CH_CFG_USE_MUTEXES or
 *          @p CH_CFG_USE_SEMAPHORES.
 * @note    Mutexes are recommended.
 */
#if !defined(CH_CFG_USE_HEAP)
#define CH_CFG_USE_HEAP                     TRUE
#endif

/**
 * @brief   Memory Pools Allocator APIs.
 * @details If enabled then the memory pools allocator APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_MEMPOOLS)
#define CH_CFG_USE_MEMPOOLS                 FALSE
#endif

/**
 * @brief  Objects FIFOs APIs.
 * @details If enabled then the objects FIFOs APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_OBJ_FIFOS)
#define CH_CFG_USE_OBJ_FIFOS                FALSE
#endif

/**
 * @brief   Pipes APIs.
 * @details If enabled then the pipes APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_PIPES)
#define CH_CFG_USE_PIPES                    FALSE
#endif

/**
 * @brief   Objects Caches APIs.
 * @details If enabled then the objects caches APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_OBJ_CACHES)
#define CH_CFG_USE_OBJ_CACHES               FALSE
#endif

/**
 * @brief   Delegate threads APIs.
 * @details If enabled then the delegate threads APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_DELEGATES)
#define CH_CFG_USE_DELEGATES                FALSE
#endif

/**
 * @brief   Jobs Queues APIs.
 * @details If enabled then the jobs queues APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 */
#if !defined(CH_CFG_USE_JOBS)
#define CH_CFG_USE_JOBS                     FALSE
#endif

/**
 * @brief   Dynamic Threads APIs.
 * @details If enabled then the dynamic threads creation APIs are included
 *          in the kernel.
 *
 * @note    The default is @p TRUE.
 * @note    Requires @p CH_CFG_USE_WAITEXIT.
 * @note    Requires @p CH_CFG_USE_HEAP and/or @p CH_CFG_USE_MEMPOOLS.
 */
#if !defined(CH_CFG_USE_DYNAMIC)
#define CH_CFG_USE_DYNAMIC                  TRUE
#endif

/** @} */

/*===========================================================================*/
/**
 * @name Objects factory options
 * @{
 */
/*===========================================================================*/

/**
 * @brief   Objects Factory APIs.
 * @details If enabled then the objects factory APIs are included in the
 *          kernel.
 *
 * @note    The default is @p FALSE.
 */
#if !defined(CH_CFG_USE_FACTORY)
#define CH_CFG_USE_FACTORY                  FALSE
#endif

/**
 * @brief   Maximum length for object names.
 * @details If the specified length is zero then the name is stored by
 *          pointer but this could have unintended side effects.
 */
#if !defined(CH_CFG_FACTORY_MAX_NAMES_LENGTH)
#define CH_CFG_FACTORY_MAX_NAMES_LENGTH     8
#endif

/**
 * @brief   Enables the registry of generic objects.
 */
#if !defined(CH_CFG_FACTORY_OBJECTS_REGISTRY)
#define CH_CFG_FACTORY_OBJECTS_REGISTRY     FALSE
#endif

/**
 * @brief   Enables factory for generic buffers.
 */
#if !defined(CH_CFG_FACTORY_GENERIC_BUFFERS)
#define CH_CFG_FACTORY_GENERIC_BUFFERS      FALSE
#endif

/**
 * @brief   Enables factory for semaphores.
 */
#if !defined(CH_CFG_FACTORY_SEMAPHORES)
#define CH_CFG_FACTORY_SEMAPHORES           FALSE
#endif

/**
 * @brief   Enables factory for mailboxes.
 */
#if !defined(CH_CFG_FACTORY_MAILBOXES)
#define CH_CFG_FACTORY_MAILBOXES            FALSE
#endif

/**
 * @brief   Enables factory for objects FIFOs.
 */
#if !defined(CH_CFG_FACTORY_OBJ_FIFOS)
#define CH_CFG_FACTORY_OBJ_FIFOS            FALSE
#endif

/**
 * @brief   Enables factory for Pipes.
 */
#if !defined(CH_CFG_FACTORY_PIPES) || defined(__DOXYGEN__)
#define CH_CFG_FACTORY_PIPES                FALSE
#endif

/** @} */

/*===========================================================================*/
/**
 * @name Debug options
 * @{
 */
/*===========================================================================*/

/**
 * @brief   Debug option, kernel statistics.
 *
 * @note    The default is @p FALSE.
 */
#if !defined(CH_DBG_STATISTICS)
#define CH_DBG_STATISTICS                   FALSE
#endif

/**
 * @brief   Debug option, system state check.
 * @details If enabled the correct call protocol for system APIs is checked
 *          at runtime.
 *
 * @note    The default is @p FALSE.
 */
#if !defined(CH_DBG_SYSTEM_STATE_CHECK)
#define CH_DBG_SYSTEM_STATE_CHECK           FALSE
#endif

/**
 * @brief   Debug option, parameters checks.
 * @details If enabled then the checks on the API functions input
 *          parameters are activated.
 *
 * @note    The default is @p FALSE.
 */
#if !defined(CH_DBG_ENABLE_CHECKS)
#define CH_DBG_ENABLE_CHECKS                FALSE
#endif

/**
 * @brief   Debug option, consistency checks.
 * @details If enabled then all the assertions in the kernel code are
 *          activated. This includes consistency checks inside the kernel,
 *          runtime anomalies and port-defined checks.
 *
 * @note    The default is @p FALSE.
 */
#if !defined(CH_DBG_ENABLE_ASSERTS)
#define CH_DBG_ENABLE_ASSERTS               FALSE
#endif

/**
 * @brief   Debug option, trace buffer.
 * @details If enabled then the trace buffer is activated.
 *
 * @note    The default is @p CH_DBG_TRACE_MASK_DISABLED.
 */
#if !defined(CH_DBG_TRACE_MASK)
#define CH_DBG_TRACE_MASK                   CH_DBG_TRACE_MASK_DISABLED
#endif

/**
 * @brief   Trace buffer entries.
 * @note    The trace buffer is only allocated if @p CH_DBG_TRACE_MASK is
 *          different from @p CH_DBG_TRACE_MASK_DISABLED.
 */
#if !defined(CH_DBG_TRACE_BUFFER_SIZE)
#define CH_DBG_TRACE_BUFFER_SIZE            128
#endif

/**
 * @brief   Debug option, stack checks.
 * @details If enabled then a runtime stack check is performed.
 *
 * @note    The default is @p FALSE.
 * @note    The stack check is performed in a architecture/port dependent way.
 *          It may not be implemented or some ports.
 * @note    The default failure mode is to halt the system with the global
 *          @p panic_msg variable set to @p NULL.
 */
#if !defined(CH_DBG_ENABLE_STACK_CHECK)
#define CH_DBG_ENABLE_STACK_CHECK           TRUE
#endif

/**
 * @brief   Debug option, stacks initialization.
 * @details If enabled then the threads working area is filled with a byte
 *          value when a thread is created. This can be useful for the
 *          runtime measurement of the used stack.
 *
 * @note    The default is @p FALSE.
 */
#if !defined(CH_DBG_FILL_THREADS)
#define CH_DBG_FILL_THREADS                 TRUE
#endif

/**
 * @brief   Debug option, threads profiling.
 * @details If enabled then a field is added to the @p thread_t structure that
 *          counts the system ticks occurred while executing the thread.
 *
 * @note    The default is @p FALSE.
 * @note    This debug option is not currently compatible with the
 *          tickless mode.
 */
#if !defined(CH_DBG_THREADS_PROFILING)
#define CH_DBG_THREADS_PROFILING            FALSE
#endif

/** @} */

/*===========================================================================*/
/**
 * @name Kernel hooks
 * @{
 */
/*===========================================================================*/

/**
 * @brief   System structure extension.
 * @details User fields added to the end of the @p ch_system_t structure.
 */
#define CH_CFG_SYSTEM_EXTRA_FIELDS                                          \
  /* Add threads custom fields here.*/

/**
 * @brief   System initialization hook.
 * @details User initialization code added to the @p chSysInit() function
 *          just before interrupts are enabled globally.
 */
#define CH_CFG_SYSTEM_INIT_HOOK() {                                         \
  /* Add threads initialization code here.*/                                \
}

/**
 * @brief   Threads descriptor structure extension.
 * @details User fields added to the end of the @p thread_t structure.
 */
#ifndef CH_CFG_THREAD_EXTRA_FIELDS
#define CH_CFG_THREAD_EXTRA_FIELDS                                          \
  /* Add threads custom fields here.*/
#endif

/**
 * @brief   Threads initialization hook.
 * @details User initialization code added to the @p _thread_init() function.
 *
 * @note    It is invoked from within @p _thread_init() and implicitly from all
 *          the threads creation APIs.
 */
#define CH_CFG_THREAD_INIT_HOOK(tp) {                                       \
  /* Add threads initialization code here.*/                                \
}

/**
 * @brief   Threads finalization hook.
 * @details User finalization code added to the @p chThdExit() API.
 */
#define CH_CFG_THREAD_EXIT_HOOK(tp) {                                       \
  /* Add threads finalization code here.*/                                  \
}

/**
 * @brief   Context switch hook.
 * @details This hook is invoked just before switching between threads.
 */
#define CH_CFG_CONTEXT_SWITCH_HOOK(ntp, otp) {                              \
  /* Context switch code here.*/                                            \
}

/**
 * @brief   ISR enter hook.
 */
#define CH_CFG_IRQ_PROLOGUE_HOOK() {                                        \
  /* IRQ prologue code here.*/                                              \
}

/**
 * @brief   ISR exit hook.
 */
#define CH_CFG_IRQ_EPILOGUE_HOOK() {                                        \
  /* IRQ epilogue code here.*/                                              \
}

/**
 * @brief   Idle thread enter hook.
 * @note    This hook is invoked within a critical zone, no OS functions
 *          should be invoked from here.
 * @note    This macro can be used to activate a power saving mode.
 */
#define CH_CFG_IDLE_ENTER_HOOK() {                                          \
  /* Idle-enter code here.*/                                                \
}

/**
 * @brief   Idle thread leave hook.
 * @note    This hook is invoked within a critical zone, no OS functions
 *          should be invoked from here.
 * @note    This macro can be used to deactivate a power saving mode.
 */
#define CH_CFG_IDLE_LEAVE_HOOK() {                                          \
  /* Idle-leave code here.*/                                                \
}

/**
 * @brief   Idle Loop hook.
 * @details This hook is continuously invoked by the idle thread loop.
 */
#define CH_CFG_IDLE_LOOP_HOOK() {                                           \
  /* Idle loop code here.*/                                                 \
}

/**
 * @brief   System tick event hook.
 * @details This hook is invoked in the system tick handler immediately
 *          after processing the virtual timers queue.
 */
#define CH_CFG_SYSTEM_TICK_HOOK() {                                         \
  /* System tick event code here.*/                                         \
}

/**
 * @brief   System halt hook.
 * @details This hook is invoked in case to a system halting error before
 *          the system is halted.
 *
 * We flush all memory on STM32F7 to allow gdb to access variables currently
 * in the dcache
 */
#ifndef CH_CFG_SYSTEM_HALT_HOOK
#define CH_CFG_SYSTEM_HALT_HOOK(reason) do {                               \
        extern void memory_flush_all(void); \
        memory_flush_all(); \
        extern void system_halt_hook(void); \
        system_halt_hook(); \
} while(0)
#endif

/**
 * @brief   stack overflow event hook.
 * @details This hook is invoked when we have a stack overflow on task switch
 */
#define CH_CFG_STACK_OVERFLOW_HOOK(tp) {                                         \
  extern void stack_overflow(thread_t *tp); \
  stack_overflow(tp); \
}

/**
 * @brief   Trace hook.
 * @details This hook is invoked each time a new record is written in the
 *          trace buffer.
 */
#define CH_CFG_TRACE_HOOK(tep) {                                            \
  /* Trace code here.*/                                                     \
}

/**
 * @brief   System initialization hook.
 * @details User initialization code added to the @p chSysInit() function
 *          just before interrupts are enabled globally.
 */
#define CH_CFG_SYSTEM_INIT_HOOK() {                                         \
  /* Add system initialization code here.*/                                 \
}

/**
 * @brief   OS instance structure extension.
 * @details User fields added to the end of the @p os_instance_t structure.
 */
#define CH_CFG_OS_INSTANCE_EXTRA_FIELDS                                     \
  /* Add OS instance custom fields here.*/

/**
 * @brief   Runtime Faults Collection Unit hook.
 * @details This hook is invoked each time new faults are collected and stored.
 */
#define CH_CFG_RUNTIME_FAULTS_HOOK(mask) {                                  \
  /* Faults handling code here.*/                                           \
}

/**
 * @brief   OS instance initialization hook.
 *
 * @param[in] oip       pointer to the @p os_instance_t structure
 */
#define CH_CFG_OS_INSTANCE_INIT_HOOK(oip) {                                 \
  /* Add OS instance initialization code here.*/                            \
}

/** @} */

/*===========================================================================*/
/* Port-specific settings (override port settings defaulted in chcore.h).    */
/*===========================================================================*/


/** @} */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ##############################################################################
# Build global options
# NOTE: Can be overridden externally.
#

# Compiler options here.
ifeq ($(USE_OPT),)
  USE_OPT = -fomit-frame-pointer -falign-functions=16
endif

ifeq ($(ENABLE_DEBUG_SYMBOLS), yes)
  USE_OPT += -g3
endif

# C specific options here (added to USE_OPT).
ifeq ($(USE_COPT),)
  USE_COPT = -Os
endif

# C++ specific options here (added to USE_OPT).
ifeq ($(USE_CPPOPT),)
  USE_CPPOPT = -fno-rtti -std=gnu++11
endif

# Assembly specific options here (added to USE_OPT).
ifeq ($(USE_ASOPT),)
  USE_ASOPT = 
endif

# Assembly specific options here (added to USE_ASXOPT).
ifeq ($(USE_ASXOPT),)
  USE_ASXOPT =
endif

# Enable this if you want the linker to remove unused code and data
ifeq ($(USE_LINK_GC),)
  USE_LINK_GC = yes
endif

# Linker extra options here.
ifeq ($(USE_LDOPT),)
  USE_LDOPT =
endif

# Enable this if you want link time optimizations (LTO)
ifeq ($(USE_LTO),)
  USE_LTO = no
endif

# If enabled, this option allows to compile the application in THUMB mode.
ifeq ($(USE_THUMB),)
  USE_THUMB = yes
endif

# Enable this if you want to see the full log while compiling.
ifeq ($(USE_VERBOSE_COMPILE),)
  USE_VERBOSE_COMPILE = no
endif

# If enabled, this option makes the build process faster by not compiling
# modules not used in the current configuration.
ifeq ($(USE_SMART_BUILD),)
  USE_SMART_BUILD = no
endif

include $(CHIBIOS)/os/various/cpp_wrappers/chcpp.mk
ifeq ($(USE_FATFS),yes)
include $(CHIBIOS)/os/various/fatfs_bindings/fatfs.mk
endif

#
# Build global options
##############################################################################

##############################################################################
# Architecture or project specific options
#
HWDEF = $(AP_HAL)/hwdef
# Stack size to be allocated to the Cortex-M process stack. This stack is
# the stack used by the main() thread.
ifeq ($(USE_PROCESS_STACKSIZE),)
  USE_PROCESS_STACKSIZE = 0x400
endif

# Stack size to the allocated to the Cortex-M main/exceptions stack. This
# stack is used for processing interrupts and exceptions.
ifeq ($(USE_EXCEPTIONS_STACKSIZE),)
  USE_EXCEPTIONS_STACKSIZE = 0x400
endif

# Enables the use of FPU (no, softfp, hard).
ifeq ($(USE_FPU),)
  USE_FPU = hard
endif

#
# Architecture or project specific options
##############################################################################

##############################################################################
# Project, sources and paths
#

# Define project name here
PROJECT = ch

# Imported source files and paths
# Startup files.
include $(CHIBIOS)/$(CHIBIOS_STARTUP_MK)
# HAL-OSAL files (optional).
include $(CHIBIOS)/os/hal/hal.mk
include $(CHIBIOS)/$(CHIBIOS_PLATFORM_MK)
include $(CHIBIOS)/os/hal/osal/rt-nil/osal.mk
# RTOS files (optional).
include $(CHIBIOS)/os/rt/rt.mk
include $(CHIBIOS)/os/common/ports/ARMv7-M/compilers/GCC/mk/port.mk
# Other files (optional).
#include $(CHIBIOS)/test/rt/test.mk
include $(CHIBIOS)/os/hal/lib/streams/streams.mk

ifeq ($(USE_FATFS),yes)
include $(CHIBIOS)/os/various/cpp_wrappers/chcpp.mk
include $(CHIBIOS)/os/various/fatfs_bindings/fatfs.mk
endif

# C sources that can be compiled in ARM or THUMB mode depending on the global
# setting.

CSRC = $(sort $(ALLCSRC))

CSRC += $(HWDEF)/common/stubs.c \
	   $(HWDEF)/common/board.c \
	   $(HWDEF)/common/usbcfg.c \
	   $(HWDEF)/common/usbcfg_dualcdc.c \
	   $(HWDEF)/common/usbcfg_common.c \
	   $(HWDEF)/common/flash.c \
	   $(HWDEF)/common/malloc.c \
	   $(HWDEF)/common/hrt.c \
       $(HWDEF)/common/stm32_util.c \
       $(HWDEF)/common/bouncebuffer.c \
       $(HWDEF)/common/watchdog.c

ifeq ($(USE_USB_MSD),yes)
CSRC += $(CHIBIOS)/os/various/scsi_bindings/lib_scsi.c \
        $(CHIBIOS)/os/hal/src/hal_usb_msd.c
endif

#	   $(TESTSRC) \
#	   test.c
ifneq ($(CRASHCATCHER),)
LIBCC_CSRC = $(CRASHCATCHER)/Core/src/CrashCatcher.c \
             $(HWDEF)/common/crashdump.c

LIBCC_ASMXSRC = $(CRASHCATCHER)/Core/src/CrashCatcher_armv7m.S
endif

# C++ sources that can be compiled in ARM or THUMB mode depending on the global
# setting.
CPPSRC = $(sort $(ALLCPPSRC))

# C sources to be compiled in ARM mode regardless of the global setting.
# NOTE: Mixing ARM and THUMB mode enables the -mthumb-interwork compiler
#       option that results in lower performance and larger code size.
ACSRC =

# C++ sources to be compiled in ARM mode regardless of the global setting.
# NOTE: Mixing ARM and THUMB mode enables the -mthumb-interwork compiler
#       option that results in lower performance and larger code size.
ACPPSRC =

# C sources to be compiled in THUMB mode regardless of the global setting.
# NOTE: Mixing ARM and THUMB mode enables the -mthumb-interwork compiler
#       option that results in lower performance and larger code size.
TCSRC =

# C sources to be compiled in THUMB mode regardless of the global setting.
# NOTE: Mixing ARM and THUMB mode enables the -mthumb-interwork compiler
#       option that results in lower performance and larger code size.
TCPPSRC =

# List ASM source files here
ASMSRC = $(ALLASMSRC)
ASMXSRC = $(ALLXASMSRC)

INCDIR = $(CHIBIOS)/os/license \
         $(ALLINC) $(HWDEF)/common

ifneq ($(CRASHCATCHER),)
INCDIR += $(CRASHCATCHER)/include
endif

ifeq ($(USE_USB_MSD),yes)
INCDIR += $(CHIBIOS)/os/various/scsi_bindings
endif

#
# Project, sources and paths
##############################################################################

##############################################################################
# Compiler settings
#

#TRGT = arm-elf-
TRGT = arm-none-eabi-
CC   = $(TRGT)gcc
CPPC = $(TRGT)g++
# Enable loading with g++ only if you need C++ runtime support.
# NOTE: You can use C++ even without C++ support if you are careful. C++
#       runtime support makes code size explode.
LD   = $(TRGT)gcc
#LD   = $(TRGT)g++
CP   = $(TRGT)objcopy
AS   = $(TRGT)gcc -x assembler-with-cpp
AR   = $(TRGT)ar
OD   = $(TRGT)objdump
SZ   = $(TRGT)size
HEX  = $(CP) -O ihex
BIN  = $(CP) -O binary

# ARM-specific options here
AOPT =

# THUMB-specific options here
TOPT = -mthumb -DTHUMB

# Define C warning options here
CWARN = -Wall -Wextra -Wundef -Wstrict-prototypes -Werror

# Define C++ warning options here
CPPWARN = -Wall -Wextra -Wundef -Werror

#
# Compiler settings
##############################################################################

##############################################################################
# Start of user section
#

# List all user C define here, like -D_DEBUG=1
UDEFS = $(ENV_UDEFS) $(FATFS_FLAGS) -DHAL_BOARD_NAME=\"$(HAL_BOARD_NAME)\" \
        -DHAL_MAX_STACK_FRAME_SIZE=$(HAL_MAX_STACK_FRAME_SIZE)

ifeq ($(ENABLE_ASSERTS),yes)
 UDEFS += -DHAL_CHIBIOS_ENABLE_ASSERTS
 ASXFLAGS += -DHAL_CHIBIOS_ENABLE_ASSERTS
endif

ifeq ($(ENABLE_MALLOC_GUARD),yes)
 UDEFS += -DHAL_CHIBIOS_ENABLE_MALLOC_GUARD
 ASXFLAGS += -DHAL_CHIBIOS_ENABLE_MALLOC_GUARD
endif

ifeq ($(ENABLE_STATS),yes)
 UDEFS += -DHAL_ENABLE_THREAD_STATISTICS
 ASXFLAGS += -DHAL_ENABLE_THREAD_STATISTICS
endif

ifneq ($(AP_BOARD_START_TIME),)
 UDEFS += -DAP_BOARD_START_TIME=$(AP_BOARD_START_TIME)
endif

# Define ASM defines here
UADEFS =

ifeq ($(COPY_VECTORS_TO_RAM),yes)
 UADEFS += -DCRT0_INIT_VECTORS=1
endif

# List all user directories here
UINCDIR =

# List the user directory to look for the libraries here
ULIBDIR =

# List all user libraries here
ULIBS =

#
# End of user defines
##############################################################################
include $(HWDEF)/common/chibios_common.mk
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # ARM Cortex-Mx common makefile scripts and rules.
##############################################################################
# Processing options coming from the upper Makefile.
#

# Compiler options
OPT    := $(USE_OPT)
COPT   := $(USE_COPT)
CPPOPT := $(USE_CPPOPT)
ASOPT := $(USE_ASOPT)
ASXOPT := $(USE_ASXOPT)

# Garbage collection
ifeq ($(USE_LINK_GC),yes)
  OPT   += -ffunction-sections -fdata-sections -fno-common
  LDOPT := ,--gc-sections
else
  LDOPT :=
endif

# Linker extra options
ifneq ($(USE_LDOPT),)
  LDOPT := $(LDOPT),$(USE_LDOPT)
endif

# Link time optimizations
ifeq ($(USE_LTO),yes)
  OPT += -flto
endif

# FPU options default (Cortex-M4 and Cortex-M7 single precision).
ifeq ($(USE_FPU_OPT),)
  USE_FPU_OPT = -mfloat-abi=$(USE_FPU) -mfpu=fpv4-sp-d16 -fsingle-precision-constant
endif

# FPU-related options
ifeq ($(USE_FPU),)
  USE_FPU = hard
endif
ifneq ($(USE_FPU),no)
  OPT    += $(USE_FPU_OPT)
  DDEFS  += -DCORTEX_USE_FPU=TRUE
  DADEFS += -DCORTEX_USE_FPU=TRUE
else
  DDEFS  += -DCORTEX_USE_FPU=FALSE
  DADEFS += -DCORTEX_USE_FPU=FALSE
endif

# Process stack size
ifeq ($(USE_PROCESS_STACKSIZE),)
  LDOPT := $(LDOPT),--defsym=__process_stack_size__=0x400
else
  LDOPT := $(LDOPT),--defsym=__process_stack_size__=$(USE_PROCESS_STACKSIZE)
endif

# Exceptions stack size
ifeq ($(USE_EXCEPTIONS_STACKSIZE),)
  LDOPT := $(LDOPT),--defsym=__main_stack_size__=0x400
else
  LDOPT := $(LDOPT),--defsym=__main_stack_size__=$(USE_EXCEPTIONS_STACKSIZE)
endif

# Output directory and files
ifeq ($(BUILDDIR),)
  BUILDDIR = build
endif
ifeq ($(BUILDDIR),.)
  BUILDDIR = build
endif
OUTFILES := $(BUILDDIR)/$(PROJECT).elf \
            $(BUILDDIR)/$(PROJECT).hex \
            $(BUILDDIR)/$(PROJECT).bin \
            $(BUILDDIR)/$(PROJECT).dmp \
            $(BUILDDIR)/$(PROJECT).list

ifdef SREC
  OUTFILES += $(BUILDDIR)/$(PROJECT).srec
endif

# Source files groups and paths
ifeq ($(USE_THUMB),yes)
  TCSRC   += $(CSRC)
  TCPPSRC += $(CPPSRC)
else
  ACSRC   += $(CSRC)
  ACPPSRC += $(CPPSRC)
endif
ASRC      := $(ACSRC) $(ACPPSRC)
TSRC      := $(TCSRC) $(TCPPSRC)
SRCPATHS  := $(sort $(dir $(ASMXSRC)) $(dir $(ASMSRC)) $(dir $(ASRC)) $(dir $(TSRC)) $(dir $(LIBCC_CSRC)) $(dir $(LIBCC_ASMXSRC)))

# Various directories
OBJDIR    := $(BUILDDIR)/obj
LSTDIR    := $(BUILDDIR)/lst

# Object files groups
ACOBJS    := $(addprefix $(OBJDIR)/, $(notdir $(ACSRC:.c=.o)))
ACPPOBJS  := $(addprefix $(OBJDIR)/, $(notdir $(ACPPSRC:.cpp=.o)))
TCOBJS    := $(addprefix $(OBJDIR)/, $(notdir $(TCSRC:.c=.o)))
TCPPOBJS  := $(addprefix $(OBJDIR)/, $(notdir $(TCPPSRC:.cpp=.o)))
ASMOBJS   := $(addprefix $(OBJDIR)/, $(notdir $(ASMSRC:.s=.o)))
ASMXOBJS  := $(addprefix $(OBJDIR)/, $(notdir $(ASMXSRC:.S=.o)))
OBJS	  := $(ASMXOBJS) $(ASMOBJS) $(ACOBJS) $(TCOBJS) $(ACPPOBJS) $(TCPPOBJS)
LIBCC_ASMXOBJS := $(addprefix $(OBJDIR)/, $(notdir $(LIBCC_ASMXSRC:.S=.o)))
LIBCC_TCOBJS := $(addprefix $(OBJDIR)/, $(notdir $(LIBCC_CSRC:.c=.o)))
LIBCC_OBJS := $(LIBCC_ASMXOBJS) $(LIBCC_TCOBJS)
# Paths
IINCDIR   := $(patsubst %,-I%,$(INCDIR) $(DINCDIR) $(UINCDIR))
LLIBDIR   := $(patsubst %,-L%,$(DLIBDIR) $(ULIBDIR))
LLIBDIR   += -L$(dir $(LDSCRIPT))

# Macros
DEFS      := $(DDEFS) $(UDEFS)
ADEFS 	  := $(DADEFS) $(UADEFS)

# Libs
LIBS      := $(DLIBS) $(ULIBS)

# Various settings
MCFLAGS   := -mcpu=$(MCU)
ODFLAGS	  = -x --syms
ASFLAGS   = $(MCFLAGS) $(ADEFS) $(ASOPT)
ASXFLAGS  = $(MCFLAGS) $(ADEFS) $(ASXOPT)
ifneq ($(USE_FPU),no)
  LIBCC_ASXFLAGS = $(ASXFLAGS) $(USE_FPU_OPT)
else
  LIBCC_ASXFLAGS = $(ASXFLAGS)
endif
CFLAGS    = $(MCFLAGS) $(OPT) $(COPT) $(CWARN) $(DEFS)
LIBCC_CFLAGS = $(CFLAGS)
CPPFLAGS  = $(MCFLAGS) $(OPT) $(CPPOPT) $(CPPWARN) $(DEFS)
LDFLAGS   = $(MCFLAGS) $(OPT) -nostartfiles $(LLIBDIR) -Wl,-Map=$(BUILDDIR)/$(PROJECT).map,--cref,--no-warn-mismatch,--library-path=$(RULESPATH)/ld,--script=$(LDSCRIPT)$(LDOPT)

# provide a marker for ArduPilot build options in ChibiOS
CFLAGS    += -D_ARDUPILOT_

ifeq ($(ENABLE_ASSERTS),yes)
  ASXFLAGS += -DHAL_CHIBIOS_ENABLE_ASSERTS
endif

# Thumb interwork enabled only if needed because it kills performance.
ifneq ($(strip $(TSRC)),)
  CFLAGS   += -DTHUMB_PRESENT
  CPPFLAGS += -DTHUMB_PRESENT
  ASFLAGS  += -DTHUMB_PRESENT
  ASXFLAGS += -DTHUMB_PRESENT
  ifneq ($(strip $(ASRC)),)
    # Mixed ARM and THUMB mode.
    CFLAGS   += -mthumb-interwork
    CPPFLAGS += -mthumb-interwork
    ASFLAGS  += -mthumb-interwork
    ASXFLAGS += -mthumb-interwork
    LDFLAGS  += -mthumb-interwork
  else
    # Pure THUMB mode, THUMB C code cannot be called by ARM asm code directly.
    CFLAGS   += -mno-thumb-interwork -DTHUMB_NO_INTERWORKING
    CPPFLAGS += -mno-thumb-interwork -DTHUMB_NO_INTERWORKING
    ASFLAGS  += -mno-thumb-interwork -DTHUMB_NO_INTERWORKING -mthumb
    ASXFLAGS += -mno-thumb-interwork -DTHUMB_NO_INTERWORKING -mthumb
    LDFLAGS  += -mno-thumb-interwork -mthumb
  endif
else
  # Pure ARM mode
  CFLAGS   += -mno-thumb-interwork
  CPPFLAGS += -mno-thumb-interwork
  ASFLAGS  += -mno-thumb-interwork
  ASXFLAGS += -mno-thumb-interwork
  LDFLAGS  += -mno-thumb-interwork
endif

# Generate dependency information
ASFLAGS  += -MD -MP -MF .dep/$(@F).d
ASXFLAGS += -MD -MP -MF .dep/$(@F).d
CFLAGS   += -MD -MP -MF .dep/$(@F).d
CPPFLAGS += -MD -MP -MF .dep/$(@F).d

# Paths where to search for sources
VPATH     = $(SRCPATHS)

ifndef ECHO
T := $(shell $(MAKE) $(MAKECMDGOALS) --no-print-directory \
      -nrRf $(firstword $(MAKEFILE_LIST)) \
      ECHO="COUNTTHIS" | grep -c "COUNTTHIS")

N := x
C = $(words $N)$(eval N := x $N)
ECHO = echo "[$C/$T] ChibiOS:"
endif
all: PRE_MAKE_ALL_RULE_HOOK $(OBJS) $(LIBCC_OBJS) $(OUTFILES) POST_MAKE_ALL_RULE_HOOK

PRE_MAKE_ALL_RULE_HOOK:

POST_MAKE_ALL_RULE_HOOK:

$(LIBCC_OBJS) $(OBJS): | $(BUILDDIR) $(OBJDIR) $(LSTDIR)

$(BUILDDIR):
ifneq ($(USE_VERBOSE_COMPILE),yes)
	@echo Compiler Options
	@echo $(CC) -c $(CFLAGS) -I. $(IINCDIR) main.c -o main.o
	@echo
endif
	@mkdir -p $(BUILDDIR)

$(OBJDIR):
	@mkdir -p $(OBJDIR)

$(LSTDIR):
	@mkdir -p $(LSTDIR)

$(ACPPOBJS) : $(OBJDIR)/%.o : %.cpp $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CPPC) -c $(CPPFLAGS) $(AOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CPPC) -c $(CPPFLAGS) $(AOPT) -I. $(IINCDIR) $< -o $@
endif

$(TCPPOBJS) : $(OBJDIR)/%.o : %.cpp $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CPPC) -c $(CPPFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CPPC) -c $(CPPFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
endif

$(ACOBJS) : $(OBJDIR)/%.o : %.c $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CC) -c $(CFLAGS) $(AOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CC) -c $(CFLAGS) $(AOPT) -I. $(IINCDIR) $< -o $@
endif

$(TCOBJS) : $(OBJDIR)/%.o : %.c $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CC) -c $(CFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CC) -c $(CFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
endif

$(LIBCC_TCOBJS) : $(OBJDIR)/%.o : %.c $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CC) -c $(CFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CC) -c $(CFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
endif

$(ASMOBJS) : $(OBJDIR)/%.o : %.s $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(AS) -c $(ASFLAGS) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(AS) -c $(ASFLAGS) -I. $(IINCDIR) $< -o $@
endif

$(ASMXOBJS) : $(OBJDIR)/%.o : %.S $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CC) -c $(ASXFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CC) -c $(ASXFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
endif

$(LIBCC_ASMXOBJS) : $(OBJDIR)/%.o : %.S $(BUILDROOT)/chibios_flags.h
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(CC) -c $(LIBCC_ASXFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
else
	@$(ECHO) Compiling $(<F)
	@$(CC) -c $(LIBCC_ASXFLAGS) $(TOPT) -I. $(IINCDIR) $< -o $@
endif

$(BUILDDIR)/$(PROJECT).elf: $(OBJS) $(LDSCRIPT)
ifeq ($(USE_VERBOSE_COMPILE),yes)
	@echo
	$(LD) $(OBJS) $(LDFLAGS) $(LIBS) -o $@
else
	@echo Linking $@
	@$(LD) $(OBJS) $(LDFLAGS) $(LIBS) -o $@
endif

%.hex: %.elf
ifeq ($(USE_VERBOSE_COMPILE),yes)
	$(HEX) $< $@
else
	@echo Creating $@
	@$(HEX) $< $@
endif

%.bin: %.elf
ifeq ($(USE_VERBOSE_COMPILE),yes)
	$(BIN) $< $@
else
	@echo Creating $@
	@$(BIN) $< $@
endif

%.srec: %.elf
ifdef SREC
  ifeq ($(USE_VERBOSE_COMPILE),yes)
	$(SREC) $< $@
  else
	@echo Creating $@
	@$(SREC) $< $@
  endif
endif

%.dmp: %.elf
ifeq ($(USE_VERBOSE_COMPILE),yes)
	$(OD) $(ODFLAGS) $< > $@
	$(SZ) $<
else
	@echo Creating $@
	@$(OD) $(ODFLAGS) $< > $@
	@echo
	@$(SZ) $<
endif

%.list: %.elf
ifeq ($(USE_VERBOSE_COMPILE),yes)
	$(OD) -S $< > $@
else
	@echo Creating $@
	@$(OD) -S $< > $@
	@echo
	@echo Done
endif

ifneq ($(CRASHCATCHER),)
lib: $(OBJS) $(LIBCC_OBJS) $(BUILDDIR)/lib$(PROJECT).a $(BUILDDIR)/libcc.a pass
else
lib: $(OBJS) $(BUILDDIR)/lib$(PROJECT).a pass
endif

$(BUILDDIR)/lib$(PROJECT).a: $(OBJS)
	@$(AR) -r $@ $^
	@echo
	@echo ChibiOS: Done!

$(BUILDDIR)/libcc.a: $(LIBCC_OBJS)
	@$(AR) -r $@ $^
	@echo
	@echo CrashCatcher: Done!

pass: $(BUILDDIR)
	@echo $(foreach f,$(IINCDIR),"$(f);") > $(BUILDDIR)/include_dirs

clean: CLEAN_RULE_HOOK
	@echo Cleaning
	-rm -fR .dep $(BUILDDIR)
	@echo
	@echo Done

CLEAN_RULE_HOOK:

#
# Include the dependency files, should be the last of the makefile
#
-include $(shell mkdir .dep 2>/dev/null) $(wildcard .dep/*)

# *** EOF ***
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               /*
    ChibiOS - Copyright (C) 2006..2015 Giovanni Di Sirio

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/

/*
    this file is included by the board specific ldscript.ld which is
    generated from hwdef.dat
*/

/* RAM region to be used for Main stack. This stack accommodates the processing
   of all exceptions and interrupts*/
REGION_ALIAS("MAIN_STACK_RAM", ram0);

/* RAM region to be used for the process stack. This is the stack used by
   the main() function.*/
REGION_ALIAS("PROCESS_STACK_RAM", ram0);

/* RAM region to be used for data segment.*/
REGION_ALIAS("DATA_RAM", ram0);

/* RAM region to be used for BSS segment.*/
REGION_ALIAS("BSS_RAM", ram0);

/* RAM region to be used for the default heap.*/
REGION_ALIAS("HEAP_RAM", ram0);

__ram0_start__          = ORIGIN(ram0);
__ram0_size__           = LENGTH(ram0);
__ram0_end__            = __ram0_start__ + __ram0_size__;

ENTRY(Reset_Handler)

SECTIONS
{
    . = 0;
    _text = .;

    startup : ALIGN(16) SUBALIGN(16)
    {
        KEEP(*(.vectors))
    } > flash

    constructors : ALIGN(4) SUBALIGN(4)
    {
        __init_array_base__ = .;
        KEEP(*(SORT(.init_array.*)))
        KEEP(*(.init_array))
        __init_array_end__ = .;
    } > flash

    destructors : ALIGN(4) SUBALIGN(4)
    {
        __fini_array_base__ = .;
        KEEP(*(.fini_array))
        KEEP(*(SORT(.fini_array.*)))
        __fini_array_end__ = .;
    } > flash

    .text : ALIGN(4) SUBALIGN(4)
    {
        /* we want app_descriptor near the start of flash so a false
           positive isn't found by the bootloader (eg. ROMFS) */
        KEEP(*(.apsec_data));
        KEEP(*(.app_descriptor));
        *(.text)
        *(.text.*)
        *(.rodata)
        *(.rodata.*)
        *(.glue_7t)
        *(.glue_7)
        *(.gcc*)
    } > flash

    .ARM.extab :
    {
        *(.ARM.extab* .gnu.linkonce.armextab.*)
    } > flash

    .ARM.exidx : {
        __exidx_start = .;
        *(.ARM.exidx* .gnu.linkonce.armexidx.*)
        __exidx_end = .;
     } > flash

    .eh_frame_hdr :
    {
        *(.eh_frame_hdr)
    } > flash

    .eh_frame : ONLY_IF_RO
    {
        *(.eh_frame)
    } > flash

    .textalign : ONLY_IF_RO
    {
        . = ALIGN(8);
    } > flash

    /* Legacy symbol, not used anywhere.*/
    . = ALIGN(4);
    PROVIDE(_etext = .);

    /* Special section for exceptions stack.*/
    .mstack :
    {
        . = ALIGN(8);
        __main_stack_base__ = .;
        . += __main_stack_size__;
        . = ALIGN(8);
        __main_stack_end__ = .;
    } > MAIN_STACK_RAM

    /* Special section for process stack.*/
    .pstack :
    {
        __process_stack_base__ = .;
        __main_thread_stack_base__ = .;
        . += __process_stack_size__;
        . = ALIGN(8);
        __process_stack_end__ = .;
        __main_thread_stack_end__ = .;
    } > PROCESS_STACK_RAM

    .data : ALIGN(4)
    {
        . = ALIGN(4);
        PROVIDE(_textdata = LOADADDR(.data));
        PROVIDE(_data = .);
        __textdata_base__ = LOADADDR(.data);
        __data_base__ = .;
        *(.data)
        *(.data.*)
        *(.ramtext)
        . = ALIGN(4);
        PROVIDE(_edata = .);
        __data_end__ = .;
    } > DATA_RAM AT > flash

    .bss (NOLOAD) : ALIGN(4)
    {
        . = ALIGN(4);
        __bss_base__ = .;
        *(.bss)
        *(.bss.*)
        *(COMMON)
        . = ALIGN(4);
        __bss_end__ = .;
        PROVIDE(end = .);
    } > BSS_RAM

    .ram0_init : ALIGN(4)
    {
        . = ALIGN(4);
        __ram0_init_text__ = LOADADDR(.ram0_init);
        __ram0_init__ = .;
        *(.ram0_init)
        *(.ram0_init.*)
        . = ALIGN(4);
    } > ram0 AT > flash

    .ram0 (NOLOAD) : ALIGN(4)
    {
        . = ALIGN(4);
        __ram0_clear__ = .;
        *(.ram0_clear)
        *(.ram0_clear.*)
        . = ALIGN(4);
        __ram0_noinit__ = .;
        *(.ram0)
        *(.ram0.*)
        . = ALIGN(4);
        __ram0_free__ = .;
    } > ram0

    /* The default heap uses the (statically) unused part of a RAM section.*/
    .heap (NOLOAD) :
    {
        . = ALIGN(8);
        __heap_base__ = .;
        . = ORIGIN(HEAP_RAM) + LENGTH(HEAP_RAM);
        __heap_end__ = .;
    } > HEAP_RAM

    /* The crash log uses the unused part of a flash section.*/
    .crash_log (NOLOAD) :
    {
        . = ALIGN(32);
        __crash_log_base__ = .;
        . = ORIGIN(flash) + LENGTH(flash);
        __crash_log_end__ = .;
    } > flash

}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 